webpackJsonp([153,58,59,62,63,64,65,66,67,69,71,73,74,75,76,77,80,82,83,84,85,86,87,89,91,92,93,96,97,98,99,101,102,103,105,106,107,108,110,111,112,113,114,117,118,119,120,122,123,124,128,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147],{"+8/T":function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_userIcon__=__webpack_require__("yviC"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),getInputDefaultValue=function(assignee){return assignee&&null===assignee.id?assignee.name:""},ResourcePopover=function(_React$Component){function ResourcePopover(props){_classCallCheck(this,ResourcePopover);var _this=_possibleConstructorReturn(this,(ResourcePopover.__proto__||Object.getPrototypeOf(ResourcePopover)).call(this,props));return _this._onFocusInput=_this._onFocusInput.bind(_this),_this._onBlurInput=_this._onBlurInput.bind(_this),_this}return _inherits(ResourcePopover,_React$Component),_createClass(ResourcePopover,[{key:"_onFocusInput",value:function(){this.keyMap.enable()}},{key:"_onBlurInput",value:function(){this.keyMap.disable()}},{key:"_setCustomResource",value:function(val){this.props.setResource(val)}},{key:"_revertCustomResource",value:function(){this.customResource.value=getInputDefaultValue(this.props.assignee),this.customResource.blur()}},{key:"componentDidMount",value:function(){var _this2=this,K=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(this.customResource,"custom_resource_keymap",[{key:K.ENTER,fn:function(){return _this2._setCustomResource(_this2.customResource.value)}},{key:K.ESC,fn:function(){return _this2._revertCustomResource()}}]),this.keyMap.disable(),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"componentWillUnmount",value:function(){MM.ui.ToolTips.destroyTouchSafe(this.tooltips)}},{key:"renderCustomResource",value:function(){var _this3=this,_props=this.props,assignee=_props.assignee,isExternalTask=_props.isExternalTask,title=isExternalTask?I18n.t("js.custom_assignee_not_possible_on_external_tasks"):"";return React.createElement("div",{className:"ph-10 pt-10 mt-8 bt-1 bc-grey4 tooltip",title:title},React.createElement("input",{ref:function(el){return _this3.customResource=el},type:"text",className:"w-100%",defaultValue:getInputDefaultValue(assignee),placeholder:I18n.t("js.enter_custom"),onFocus:this._onFocusInput,onBlur:this._onBlurInput,disabled:isExternalTask}))}},{key:"render",value:function(){var _this4=this,_props2=this.props,users=_props2.users,assignee=_props2.assignee,sortedUsers=users.sortBy(function(user){return user.name.split(/\s/)[1]}),items=sortedUsers.map(function(user){return{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_userIcon__.a,{user:user,className:"small mr-5"}),label:user.name,selected:assignee&&user.id===assignee.id,onClick:function(){return _this4._setCustomResource(user.id)}}});return React.createElement("div",{ref:function(el){return _this4.container=el}},React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_list_list__.a,{className:"maxh-150 h-overflow-y",items:items}),this.renderCustomResource())}}]),ResourcePopover}(React.Component);__webpack_exports__.a=ResourcePopover}).call(__webpack_exports__,__webpack_require__("nakD"))},"+ASY":function(module,exports){function baseUnary(func){return function(value){return func(value)}}module.exports=baseUnary},"+ptD":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Images={getElements:function(images,opts){var elements=[],processed=[],noResize=!1;opts=Object.extend({idPrefix:"",containerClassName:""},opts);for(var i=0;i<images.length;i++){var image=images[i];if(image.thumbnail&&(noResize=!0),-1===processed.indexOf(image.url())){var anchor=new Element("a",{id:opts.idPrefix+image.id,href:"#",className:opts.containerClassName}),el=new Element("img");if(image.mm_default&&image.local_path?el.src=image.local_path:image.thumbnail?(el.src=image.thumbnail,el.setAttribute("data-url",image.url())):el.src=image.url(),!image.thumbnail&&!isNaN(opts.width)&&!isNaN(opts.height)){var size=noResize?[opts.width,opts.height]:image.resize(opts.width,opts.height);noResize||(el.style.width=size[0]+"px"),el.style.height=size[1]+"px"}anchor.appendChild(el),elements.push(anchor),processed.push(image.url(!0))}}return elements},checkLicense:function(element){var copyrightEl=$("img_copyright");if(copyrightEl){var id=parseInt(element.getAttribute("google_id"));if(id){var image=sideBar.images.googleSearch.items[id];copyrightEl.innerHTML=I18n.t("js.this_image_may_be_subject_to_copyright")+'. <a class="plainlink" href="'+image.contextUrl+'" target="_blank">'+I18n.t("js.open_source_page")+"</a>",copyrightEl.addClassName("info"),copyrightEl.show()}}},insertIntoLibrary:function(searcher,photo,id){var image=IdeaImage.createDummy(photo.url,photo.width&&photo.height?[photo.width,photo.height]:null);image.thumbnail=photo.thumbnailUrl;var imageContainer=Images.getElements([image],{idPrefix:searcher+"img_",containerClassName:"item rad-3"})[0],imageEl=imageContainer.select("img")[0],spinner=MM.ui.LoadingSpinner(48),gridEl=new Element("cell");imageContainer.setAttribute(searcher+"_id",id),addClassName(imageContainer,"loading"),imageContainer.insert(spinner),imageContainer.onclick=function(){return!1},imageEl.onerror=function(){spinner.remove(),imageContainer.innerHTML='<span class="h-a-center text-center">'+I18n.t("js.image_not_available")+"</span>"},imageEl.onload=function(){removeClassName(imageContainer,"loading"),spinner.remove(),gridEl.observe("click",sideBar.images.onSelectImage.bindAsEventListener(sideBar.images,imageContainer,!0)),gridEl.observe("dblclick",sideBar.images.onDblClickImage.bindAsEventListener(sideBar.images,imageContainer,!0))},gridEl.appendChild(imageContainer),mm$(searcher+"_imgs_container")&&mm$(searcher+"_imgs_container").appendChild(gridEl)}};__webpack_exports__.default=Images},"/dW8":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vconnection__=__webpack_require__("xAzy"),AVAILABLE_PROPS=["cp_from_x","cp_from_y","cp_to_x","cp_to_y","cp_scale_x","cp_scale_y","color","label"],Connection=Class.create({id:null,from_id:null,to_id:null,view:null,color:null,cp_from_x:null,cp_from_y:null,cp_to_x:null,cp_to_y:null,cp_scale_x:null,cp_scale_y:null,cp_zoom_factor:null,initialize:function(data){var _this=this;this.id=data.id,this.from_id=data.from_id,this.from=tree.root.getChild(this.from_id),this.to_id=data.to_id,this.raphael_id=data.from_id+"-"+data.to_id,this.to=tree.root.getChild(this.to_id),AVAILABLE_PROPS.each(function(prop){return _this[prop]=data[prop]}),this.view=new __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vconnection__.default(this),this.from&&this.to&&Connection.all.push(this)},__onSetProperties:function(properties,uid){var redrawConnection=!1;for(var key in properties)this[key]=properties[key],("color"===key||"label"===key||uid)&&(redrawConnection=!0);return tree.readyForConnections&&redrawConnection&&this.view.redraw(!0),!0},setProperties:function(properties){var chL=new ChangeList,oldP=this.getProperties(),newP={};for(var key in properties)newP[key]=properties[key];newP.from_id=oldP.from_id=this.from.id,newP.to_id=oldP.to_id=this.to.id,chL.changes.push(new ConnectionPropertiesChange({idea_id:this.from.id,type:"ConnectionProperties",new_data:newP,old_data:oldP})),chL.execute(),newP.label&&(newP.label=newP.label.unescapeHTML()),ServerConnection.doChanges(chL)},getProperties:function(){var _this2=this,props={};return AVAILABLE_PROPS.each(function(prop){return props[prop]=_this2[prop]}),props},destroy:function(){this.from.connections.remove(this),this.from.outgoing_connections.remove(this),this.to.connections.remove(this),Connection.all.remove(this),this.view.destroy(),this.from_id=this.from=this.to_id=this.to=this.raphael_id=this.color=this.view=null},isDrawable:function(){var toCheck=this.to.getAncestors().concat(this.from.getAncestors());return toCheck.push(this.to,this.from),!toCheck.any(function(node){return node._listener.isTemporarilyRemoved})}});Connection.all=[],Connection.get=function(from_id,to_id){for(var i=Connection.all.length;i>0;){var conn=Connection.all[--i];if(conn.from.id==from_id&&conn.to.id==to_id)return conn}},__webpack_exports__.default=Connection},"/t6o":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0_app_models_ideaComment__=__webpack_require__("ZfKP"),__WEBPACK_IMPORTED_MODULE_1_app_ui_attachmentViewer_view__=__webpack_require__("jMx0"),__WEBPACK_IMPORTED_MODULE_2_ui_components_votesBar__=__webpack_require__("d2ki"),getUserVote=function(node,user){if(!user)return IdeaVote.NONE;var vote=IdeaVote.get(node,user.id);return vote?vote.vote:IdeaVote.NONE},renderVotesBar=function renderVotesBar(vnode){var votes=vnode.node.votes,upVotes=IdeaVote.getByVote(vnode.node,IdeaVote.UP),onVote=function(e,value){vnode.select(),sideBar.comments.onVote(e,value),setTimeout(function(){return renderVotesBar(vnode)},0)},onExpand=function(){vnode.select(),sideBar.show(!0,!0),sideBar.comments.expand()};ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_votesBar__.a,{votes:votes,upVotes:upVotes,downVotes:votes.length-upVotes.length,userVote:getUserVote(vnode.node,users.selfUser),editable:App.config.editable&&"edit"===UI.Registry.mode&&sideBar&&sideBar.comments,onVote:onVote,onExpand:onExpand}),mm$("msg_popup"))};App.ui.Preview={show:function(vnode,type){var _this=this;if(!this.popover||!this.popover.visible){this.clearTimer(vnode);var popoverOpts={type:type,alignElement:mm$(vnode.node.id+"_"+type)};switch(type){case"note":vnode.node.note.stripHTML().length>250&&MM.ui.page.height>600&&(popoverOpts.klass="large"),this.doShow('<div class="note_content">'+vnode.node.note+"</div>",popoverOpts),this.popover.parent.select("a").each(function(link){link.setAttribute("target","_blank"),link.onclick=_this.doHide.bind(_this)});break;case"task":var effort="-";if(vnode.node.task.effort){effort=parseInt(vnode.node.task.effort);var units=vnode.node.task.effort.sub(effort.toString(),"");effort+=" "+I18n.t("js.helper_"+units)}var completeTitle="-";if(vnode.node.task.complete>=0){var completeIcon=vnode.node.icons.detect(function(icon){return"task"===icon.group()});completeIcon&&(completeTitle=completeIcon.getTitle())}this.doShow("<h3>"+I18n.t("js.task_information")+'</h3><p class="first" style="margin-top:1em"><label class="mr-5">'+I18n.t("js.priority")+":</label>"+(vnode.node.task.priority>=0?vnode.node.task.priority+1:"-")+'</p><p><label class="mr-5">'+I18n.t("js.complete")+":</label>"+completeTitle+'</p><p><label class="mr-5">'+I18n.t("js.start_date")+"</label>"+(vnode.node.task.from?Date.fromUTC(vnode.node.task.toString("from")).toUIString(!0):"-")+'</p><p><label class="mr-5">'+I18n.t("js.due_date")+"</label>"+(vnode.node.task.due?Date.fromUTC(vnode.node.task.toString("due")).toUIString(!0):"-")+'</p><p><label class="mr-5">'+I18n.t("js.duration")+":</label>"+effort+'</p><p><label class="mr-5">'+I18n.t("js.assigned_to")+"</label>"+vnode.node.task.toString("resource").escapeHTML()+"</p>",popoverOpts);break;case"link":this._link(vnode,popoverOpts);break;case"attachments":this._attachments(vnode,popoverOpts);break;case"comments":this._comments(vnode,popoverOpts);break;case"votes":this._votes(vnode,popoverOpts)}}},initPopover:function(options){var _this2=this;if(!this.popover){var el=new Element("div",{id:"popover_extras",style:"display:none;"}).insert(new Element("div",{id:"msg_popup"}));document.body.insert(el),this.onMouseMoveListener=this.onMove.bindAsEventListener(this),this.popover=new Popover("extras",null,{observeEvent:"none",closeOnSelect:!1,onShow:function(){return document.observe("mouseover",_this2.onMouseMoveListener)},onClose:function(){return document.stopObserving("mouseover",_this2.onMouseMoveListener)},onHide:function(){_this2.mounted&&ReactDOM.unmountComponentAtNode(mm$("msg_popup")),_this2.mounted=!1}})}this.popover.parent.className="popover "+options.type,this.popover.opener=options.alignElement,options.klass&&addClassName(this.popover.parent,options.klass)},openPopover:function(){this.popover.show(),Presentation.on?(CSS.set(this.popover.parent,{transform:CSS.scale(MM.ui.getZoomScale(this.popover.parent.getDimensions(),{minScale:1,maxScale:5,paddingX:20,paddingY:20}))}),MM.ui.centerAndShow(this.popover.parent)):canvas.scrollToElement(this.popover.opener)},doShow:function(content,options){this.initPopover(options),mm$("msg_popup").innerHTML="",options.ajaxUrl?new Ajax.Updater("msg_popup",options.ajaxUrl,{asynchronous:!0,evalScripts:!0,onComplete:this.openPopover.bind(this)}):(mm$("msg_popup").innerHTML=content,this.openPopover())},doHide:function(){this.popover&&Element.visible(this.popover.parent)&&this.popover.close()},onHover:function(vnode,type){Presentation.on||(vnode._linktimeout=setTimeout(function(){this.show(vnode,type)}.bind(this),1e3))},onMove:function(event){var target=Event.element(event);this.popover.parent.contains(target)||this.popover.opener.contains(target)||this.doHide()},clearTimer:function(vnode){vnode._linktimeout&&(clearTimeout(vnode._linktimeout),vnode._linktimeout=null)},_link:function(vnode,popoverOpts){var ret=vnode.node.getLinkObj();switch(ret.type){case"url":this.doShow("<h3>"+I18n.t("js.external_link")+'</h3><a rel="'+vnode.node.getLinkRel({link:vnode.node.link})+'" href="'+encodeURI(vnode.node.link)+'" onclick="App.ui.Preview.doHide(); return true;" target="_blank" class="ta-center w-160 ellipsis">'+encodeURI(vnode.node.link)+"</a>",popoverOpts);break;case"email":this.doShow("<h3>"+I18n.t("js.email_link")+'</h3><a href="'+encodeURI(vnode.node.link)+'" onclick="App.ui.Preview.doHide();"  class="ta-center w-180 ellipsis">'+encodeURI(vnode.node.link).substring(7)+"</a>",popoverOpts);break;case"topic":var target=mm$(ret.link);if(target)this.doShow("<h3>"+I18n.t("js.link_to_topic")+'</h3><p><a href="#" class="map" onclick="mm$(\''+vnode.node.id+"')._listener.scrollToLinkTarget(mm$('"+ret.link+"'));return false;\">"+target._listener.node.title.unescapeHTML().substring(0,28)+"</a></p><p>["+I18n.t("js.in_this_map")+"]</p>",popoverOpts);else{var url="/dialog/get_topic_ajax/"+ret.link+"?source_id="+vnode.node.id+("public"===App.config.viewMode?"&public=true":"")+(App.config.is_embedded?"&embedded=true&width="+App.config.embedWidth+"&height="+App.config.embedHeight+"&zoom="+App.config.zoomFactor:"");this.doShow("",Object.extend(popoverOpts,{ajaxUrl:url}))}}},_attachments:function(vnode,popoverOpts){var content="<h3>"+I18n.t("js.attachments")+"</h3>";if(App.config.showRevisions)content+="<ul>",vnode.node.attachments.each(function(a){content+="<li>"+a.filename.truncate(18)+" "+a.size.toHumanSize(1)+"</li>"}),content+="</ul>";else if(1==vnode.node.attachments.length&&vnode.node.attachments[0].isImage()){var a=vnode.node.attachments[0],id="tn_"+vnode.node.id;content+='<div align="center"><a href="'+a.downloadLink()+'" onclick="App.ui.Preview.showPopup('+a.id+", "+vnode.node.id+'); return false;" class="thumbnail" id="'+id+'" title="'+a.filename+'"><span style="background-image:url('+a.downloadLink()+(Presentation.on?"":"&thumb=true")+');"></span><a href="'+a.downloadLink()+'" onclick="App.ui.Preview.showPopup('+a.id+", "+vnode.node.id+'); return false;" class="inline">'+a.filename.truncate(18)+"</a> - "+a.size.toHumanSize(1)+"</div>",setTimeout('mm$("'+id+'").style.backgroundImage = "none"',a.loaded?10:1500),a.loaded=!0}else content+="<ul>",vnode.node.attachments.each(function(a){content+="<li>",content+='<a href="#" onclick="App.ui.Preview.showPopup('+a.id+", "+vnode.node.id+'); return false;" title="'+a.filename+" ("+a.size.toHumanSize(1)+')">'+a.filename.truncate(18)+"</a> - "+a.size.toHumanSize(1),content+="</li>"}),content+="</ul>";this.doShow(content,popoverOpts)},_comments:function(vnode,popoverOpts){var comments=__WEBPACK_IMPORTED_MODULE_0_app_models_ideaComment__.default.sort(vnode.node.comments),notShownCommentsLength=comments.length-2,content="";comments.slice(notShownCommentsLength,comments.length).reverse().each(function(comment){comment.read=!0,content+='<row><cell class="w-40px">'+comment.user.getAvatar("medium")+'</cell><cell><div row class="comment_date">'+comment.createdAt.ago(!0)+(comment.isEdited()?'<span class="ml-5" title="'+I18n.t("js.edited")+": "+comment.updatedAt.ago(!0)+'">'+MM.ui.icon({name:"pen",size:8,color:"grey-light",clickable:!1})+"</span>":"")+"</div><p>"+I18n.t("js.said",{v0:comment.user.displayname})+'</p><div class="comment" style="height: auto;">'+EmojiArea.getHTMLContent(comment.text)+"</div></cell></row>"}),content+='<div class="text-right">',App.config.editable&&"edit"===UI.Registry.mode&&sideBar&&sideBar.comments&&(content+='<a href="#" onclick="tree.root.getChild('+vnode.node.id+')._listener.select(); sideBar.show(true, true); sideBar.comments.expand(); return false;" style="text-decoration: underline">'+(notShownCommentsLength>0?I18n.t("js.more_d",{v0:notShownCommentsLength}):I18n.t("js.expand"))+"</a>"),content+="</div>",vnode.node._listener.__onSetProperty("comments",!0),this.doShow(content,popoverOpts)},_votes:function(vnode,popoverOpts){this.initPopover(popoverOpts),renderVotesBar(vnode),this.mounted=!0,this.openPopover()},showPopup:function(id,node_id){return this.doHide(),this.attachmentViewer=new __WEBPACK_IMPORTED_MODULE_1_app_ui_attachmentViewer_view__.default({attachmentId:id,nodeId:node_id}),this.attachmentViewer.open(),!1}}}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},"079/":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(React,ReactDOM){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_app_utils_googleSearch__=__webpack_require__("vLs6"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_skimmableList_skimmableList__=__webpack_require__("jR5l"),__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_dropdown_dropdown__=__webpack_require__("PYcA"),__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_dropdown_label__=__webpack_require__("Se7B"),__WEBPACK_IMPORTED_MODULE_6_ui_components_generic_listWithFilter__=__webpack_require__("bPcH"),LinksWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{activeType:"url",cache:{autolink:{id:null}},initialize:function($super,sidebar,parent){$super("links",sidebar,parent),this.field=$("fld_link"),Element.bindOnClick("btn_autolink",this.getAutoLink.bind(this,"google")),Element.bindOnClick("btn_removelink",this.removeLink.bind(this)),Element.bindOnClick("btn_dlg_link",this.showDialog.bind(this)),this.field.observe("focus",this.focus.bind(this)),this.blurListener=this.blur.bind(this),this.buildPopover()},focus:function(){_Event.observeBlur(this.field,this.blurListener),canvas.removeFocus(),"topic"===this.activeType&&this.showDialog()},blur:function(){_Event.stopObservingBlur(this.field,this.blurListener),canvas.addFocus(),this.setFieldValue()},setFieldValue:function(){var val;switch(this.activeType){case"topic":return;case"url":this.field.value.length>0&&this.field.value.indexOf("://")<0&&(this.field.value="http://"+this.field.value),val=encodeURI(this.field.value);break;case"email":val=this.field.value.length>0?"mailto:"+encodeURI(this.field.value):this.field.value}canvas.onSetProperty("link",val),canvas.addFocus(),App.trigger(CustomEvents.LINK_CHANGED)},onSelectNode:function(){this.updatePopover()},updateLinkControl:function(type,skip_value){var node_type=canvas.selected.node.link?canvas.selected.node.getLinkObj().type:"url";if(type||(type=node_type),this.activeType=type,mm$("cap_link").innerHTML=I18n.t("js."+type),hasClassName(this.field,"disabled")&&removeClassName(this.field,"disabled"),LinksWidget.types.each(function(t){mm$("linktype_"+t)&&removeClassName(mm$("linktype_"+t).parentNode,"selected")}),type.length&&addClassName(mm$("linktype_"+type).parentNode,"selected"),!skip_value)switch(type){case"url":this.field.value=canvas.selected.node.link&&type==node_type?canvas.selected.node.link.unescapeHTML():"";break;case"email":this.field.value=type==node_type?canvas.selected.node.link.substring(7):"";break;case"topic":var capt="";if(type==node_type){var target=$(canvas.selected.node.link.substring(6));capt=target?target._listener.node.title.truncate(20):"("+I18n.t("js.in_other_map")+")"}this.field.value=capt,addClassName(this.field,"disabled")}},buildPopover:function(){var elements=LinksWidget.types.map(function(type){return new Element("a",{href:"#",id:"linktype_"+type}).update(I18n.t("js."+type))});this.linkTypePopover=new Popover("link",this.setPopoverValue.bind(this)),this.linkTypePopover.addElements(elements)},updatePopover:function(type){this.updateLinkControl(type)},setPopoverValue:function(value){this.updateLinkControl(value.split("linktype_")[1])},showDialog:function(){var param=canvas.selected.node.link&&canvas.selected.node.getLinkObj().type==this.activeType?"&edit="+this.activeType:"";MM.ui.dialogs.show("link_"+this.activeType,{map_id:canvas.selected.node.id,param:param,autoSize:!0,onComplete:function(){MM.status.helpTopic="218027868-Link-your-topics"}})},initTopicList:function(maps,selectedMapId){var dropdown=React.createElement(__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_dropdown_dropdown__.a,{className:"w-300",opener:React.createElement(__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_dropdown_label__.a,{className:"b-1 bc-grey3 rad-5 fs-14 p-10 w-300",labelClassName:"to-ellipsis",color:"black"}),selected:maps.find(function(map){return map.value===selectedMapId}),onChange:this._updateTopicList},React.createElement(__WEBPACK_IMPORTED_MODULE_6_ui_components_generic_listWithFilter__.a,{autofocus:!0,filterableAttribute:"label",inputClassName:"m-10 content-visible"},React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_skimmableList_skimmableList__.a,null,React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_list_list__.a,{className:"maxh-300 h-overflow-y",items:maps}))));ReactDOM.render(dropdown,mm$("link_map_id"))},_updateTopicList:function(item){$("topiclist").insert(MM.ui.LoadingSpinner(48)),new Ajax.Request("/dialog/update_link_topics/"+item.value)},removeLink:function(){this.field.value="",this.updateLinkControl("url",!0),this.setFieldValue(),this.cache.autolink={id:null}},getAutoLink:function(type){if(this.cache.autolink.id==canvas.selected.node.id&&this.cache.autolink.title==canvas.selected.node.title&&this.cache.autolink.items.length>1)return this.cache.autolink.items.shift(),this.field.value=this.cache.autolink.items[0].link,this.updateLinkControl("url",!0),void this.setFieldValue();$("btn_autolink").addClassName("fx-wiggle fx-infinite fx-none"),this.saved_url=this.field.value,this.field.value=I18n.t("js.getting_auto_link"),"google"===type?(this.initGoogleSearch(),this.googleSearch.query(canvas.selected.node.title,{onComplete:this.setAutoLink.bind(this),onError:this.setAutoLink.bind(this,[])})):MM.utils.loadPipe("YtkW34uM3BGfqhPZJphxuA","sideBar.links.setAutoLink",{query:canvas.selected.node.title}),Amplitude.logEvent("wunder_link")},setAutoLink:function(data){if($("btn_autolink").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),!data||0===data.length)return Message.show(I18n.t("js.no_link_found_for_topic"),Message.INFO),void(this.field.value=this.saved_url);this.field.value=data[0].link,this.updateLinkControl("url",!0),this.setFieldValue(),this.cache.autolink={id:canvas.selected.node.id,title:canvas.selected.node.title,items:data}},getPopularLinks:function(title){var toggleLinks=mm$("get_popular_links"),container=mm$("popular_links"),open=hasClassName(toggleLinks,"open");return toggleClassName(toggleLinks,"open"),open?(hide(container),container.innerHTML=""):(show(container),this.cache.popularLinks&&this.cache.popularLinks.title===title?this.setPopularLinks(this.cache.popularLinks.items):(this.cache.popularLinks={title:title},container.insert(MM.ui.LoadingSpinner(24)),this.initGoogleSearch(),this.googleSearch.query(title,{onComplete:this.setPopularLinks.bind(this),onError:this.setPopularLinks.bind(this,[])}))),!1},setPopularLinks:function(data){var container=mm$("popular_links"),field=mm$("link_target");if(this.cache.popularLinks=Object.extend({items:data},this.cache.popularLinks),!data||0===data.length)return void(container.innerHTML=I18n.t("js.no_results_received"));container.innerHTML="",data.each(function(item){var link=new Element("a",{href:"#",title:item.description.stripTags().truncate(150),className:"ellipsis"}).update('<span class="va-middle">'+item.title+"</span>");link.onclick=function(){return field.value=item.link,addClassName(field,"highlight"),setTimeout(function(){removeClassName(field,"highlight")},300),!1},container.appendChild(link)})},initGoogleSearch:function(){if(!this.googleSearch){var options={disablePages:!0};App.hasFeature("google_cse")||(options=Object.extend({limitRequests:!0},options)),this.googleSearch=new __WEBPACK_IMPORTED_MODULE_1_app_utils_googleSearch__.GoogleWebSearch(options)}}});LinksWidget.types=["url","topic","email"],__webpack_exports__.default=LinksWidget}.call(__webpack_exports__,__webpack_require__("nakD"),__webpack_require__("x9tB"))},"15Wi":function(module,exports){function arrayPush(array,values){for(var index=-1,length=values.length,offset=array.length;++index<length;)array[offset+index]=values[index];return array}module.exports=arrayPush},"1GA3":function(module,exports){function identity(value){return value}module.exports=identity},"1M8a":function(module,__webpack_exports__,__webpack_require__){"use strict";function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),noop=function(){return null},ContextMenu=function(){function ContextMenu(){var onContextMenu=arguments.length>0&&void 0!==arguments[0]?arguments[0]:noop,onCloseContextMenu=arguments.length>1&&void 0!==arguments[1]?arguments[1]:noop;_classCallCheck(this,ContextMenu),this.onContextMenu=onContextMenu,this.onCloseContextMenu=onCloseContextMenu,this.onOpen=this.onOpen.bind(this),this.onClose=this.onClose.bind(this),this.observe()}return _createClass(ContextMenu,[{key:"observe",value:function(){window.addEventListener("contextmenu",this.onOpen)}},{key:"stopObserving",value:function(){window.removeEventListener("contextmenu",this.onOpen)}},{key:"onOpen",value:function(e){this.onContextMenu(e),window.addEventListener(MM.ua.getEvent().mousedown,this.onClose),window.addEventListener("keyup",this.onClose)}},{key:"onClose",value:function(e){this.onCloseContextMenu(e),window.removeEventListener(MM.ua.getEvent().mousedown,this.onClose),window.removeEventListener("keyup",this.onClose)}}]),ContextMenu}();__webpack_exports__.default=ContextMenu},"2J63":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Resizable={enableResizing:function(){this.handle||(this.handle=new Element("span",{className:"rhandle"}),Element.insert(this.el,{top:this.handle})),Draggables.deactivate(),this.initListeners()},disableResizing:function(){this.handle.stopObserving("mousedown",this.onMouseDown)},initListeners:function(){this.onMouseDown=this.onResizeStart.bindAsEventListener(this),this.onMouseMove=this.onResize.bindAsEventListener(this),this.onMouseUp=this.onResizeEnd.bindAsEventListener(this),this.handle.observe("mousedown",this.onMouseDown)},onResizeStart:function(e){this.toResizing(),this.mouseCoords=[Event.pointerX(e),Event.pointerY(e)],Event.stop(e),this.el.style.visibility="hidden",this.getResizer({className:this.el.className,style:{borderImage:"",borderStyle:""}});var vnode=this.el._listener,position=vnode.getTextPosition();show(App.resizer),this.initialWidth=this.getBrowserQuirks(vnode.node.title).width,this.getTextElement().innerHTML=this.getTextForResizer(vnode.node.title.replace(/\r/gi," ")),App.resizer.style.left=position[0]+"px",App.resizer.style.top=position[1]+"px",App.resizer.style.width=this.initialWidth+"px",Draggables.deactivate(),Event.observe(document,"mousemove",this.onMouseMove),Event.observe(document,"mouseup",this.onMouseUp)},onResize:function(e){Draggables.deactivate(),this.resizeElement(e)},onResizeEnd:function(e){this.resizeElement(e),Event.stopObserving(document,"mouseup",this.onMouseUp),Event.stopObserving(document,"mousemove",this.onMouseMove);var val=this.insertWraps(this.el._listener.node.title,getRealWidth(App.resizer)).safeUnescapeHTML();App.resizer.style.display="none",this.el.style.visibility="visible",this.el._listener.node.commitEdit(val,[0,0],"rename"),setTimeout(function(){this.toSelected()}.bind(this),10)},resizeElement:function(e){var movedX=Event.pointerX(e)-this.mouseCoords[0];App.resizer.style.width=this.initialWidth+movedX+"px"},getResizer:function(options){mm$("resizer_field")?App.resizer.className=options.className:(App.resizer=new Element("div",{id:"resizer_field",className:options.className}),App.resizer.container=new Element("div",{className:"tk_title"}),App.resizer.appendChild(App.resizer.container),canvas.el.appendChild(App.resizer)),App.resizer.style.top="-9999px",App.resizer.style.left="-9999px",this.applyStyles(App.resizer);for(var key in options.style)App.resizer.style[key]=options.style[key];this.unfixWidth()},getTextForResizer:function(string,fixed){var result=string.replace(/\n$/g,"<br/><br/>").replace(/\r\n/g,"<br/>").replace(/[\n]/g,"<br/>").replace(/ \</g,"<").replace(/\t/gi,"&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;");return fixed&&(result=result.replace(/[\r]/g,"<br/>")),result},getTextElement:function(){return App.resizer.container},getLabelSize:function(txt){return this.getTextElement().innerHTML=this.getTextForResizer(txt||"I",!0),{width:getRealWidth(App.resizer),height:App.resizer.clientHeight}},insertWraps:function(text,width){var _this=this,paragraphs=text.split("\n"),wrappedParagraphs=[],maxWidth=width;return paragraphs.each(function(paragraph){var words=paragraph.replace(/[\r\f\v]{1}/gi," ").split(" "),resizer=_this.getTextElement();resizer.innerHTML=words.map(function(word){return"<span>"+word.safeUnescapeHTML().escapeHTML()+"</span>"}).join(" "),maxWidth&&_this.fixWidth(maxWidth),resizer.childElements().each(function(el,i){var sibling=nextSibling(el);sibling&&sibling.clientWidth>0&&sibling.offsetTop>el.offsetTop&&(words[i]+="\r")}),wrappedParagraphs.push(words.join(" ").replace(/\r /gi,"\r"))}),wrappedParagraphs.join("\n")},getBrowserQuirks:function(title){return(MM.ua.isBrowser("Internet Explorer")||MM.ua.isBrowser("Edge")||MM.ua.isBrowser("Firefox"))&&(title=title.replace(/\r/gi," \r")),this.getLabelSize(title)},fixWidth:function(w,hard){App.resizer.setStyle({width:w+"px"}),hard&&(this.fixed_width=w)},unfixWidth:function(){App.resizer.setStyle({width:"auto",maxWidth:""}),this.fixed_width=!1}};__webpack_exports__.default=Resizable},"2UzH":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var debounce=__webpack_require__("dnTF"),debounce_default=__webpack_require__.n(debounce),urlRegex=function(opts){opts=Object.assign({strict:!0},opts);var protocol="(?:(?:[a-z]+:)?//)"+(opts.strict?"":"?"),regex="(?:"+protocol+'|www\\.)(?:\\S+(?::\\S*)?@)?(?:localhost|(?:(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)(?:\\.(?:[a-z\\u00a1-\\uffff0-9]-*)*[a-z\\u00a1-\\uffff0-9]+)*)(?::\\d{2,5})?(?:[/?#][^\\s"]*)?';return opts.exact?new RegExp("(?:^"+regex+"$)","i"):new RegExp(regex,"ig")},menu=__webpack_require__("qlDW"),copyPaste=__webpack_require__("d407"),userPreferences=__webpack_require__("h7V/"),emojiHelper=__webpack_require__("iXsu"),couldSplit=function(toSplit){return-1!==toSplit.indexOf("\n")},couldSplitTree=function(toSplit){return/\n\s/.test(toSplit)},setCursorPosition=function(el){window.getSelection().selectAllChildren(el)},editable_checkSplit=function(){var _this=this,value=this.getValue();if(!this.el._listener.node.isRoot()&&couldSplit(value)&&_editing){var elements=[new Element("a",{href:"#",id:"btn_menu_split",tabindex:0}).update(I18n.t("js.split"))];couldSplitTree(value)&&elements.push(new Element("a",{href:"#",id:"btn_menu_split_tree",tabindex:0}).update(I18n.t("js.split_into_tree"))),menu.default.showCustom(elements,{opener:this.el,noKeymap:!0,onClose:function(){_pasting=!1,_this.title.focus()}})}else _pasting=!1},editable_onPaste=function(e){if(e){var clipboardData=copyPaste.default.getPlainClipboardData(e);editable_handlePaste.call(this,clipboardData),Event.stop(e)}},editable_handlePaste=function(data){_pasting=!0,copyPaste.default.isPastingTopics(data)?copyPaste.default.onPasteTopics(data):(copyPaste.default.simulatePaste(Object(emojiHelper.a)(data)),editable_checkSplit.call(this))},onBlur=function(event){!_pasting&&_editing&&null!==this.el._listener&&this.el._listener.dcontent.toSelected(event,!0,!0)},onKeyup=function(){canvas.scrollToElement(this.el,null,!0,!0),reposition.call(this)},calculateOffset=function(){return{x:this.el.getWidth()-this.nodeWidth,y:this.title.getHeight()-this.titleHeight}},editable_getThumb=function(value){var _this2=this,urls=value.match(urlRegex());if(urls&&urls.length>0){var url=urls[0];if(users.selfUser.anonymous)return;userPreferences.a.get("expand_links",function(generateThumb){generateThumb&&1===parseInt(generateThumb.value)&&_this2.el._listener.node.generateThumb(url,{onSuccess:function(){generateThumb.new&&Message.show(I18n.t("js.generate_thumbnail",{url_start:'<a href="#" onclick="MM.ui.dialogs.dialogPreferences(); return false;">',url_end:"</a>"}),Message.NOTICE,15)}})})}},reposition=function(){var vNode=this.el._listener;Math.abs(this.widthAtLastLineDraw-this.el.getWidth())>5&&(vNode.node.isRoot()?(App.config.layout.name===App.Layouts.LeftAligned.name?vNode.translateChildNodes({x:-(this.el.getWidth()-this.widthAtLastLineDraw),y:0},App.Layouts.orientation.left):vNode.translateChildNodes({x:this.el.getWidth()-this.widthAtLastLineDraw,y:0},App.Layouts.orientation.right),vNode.redrawBoundaries()):(vNode.rc.redrawLines(!0),App.config.layout.name===App.Layouts.OrgChart.name&&(vNode.rc.translateOrgChildNodes(vNode.rc.vnode.dcontainer.el.getWidth()-this.containerWidthAtLastDraw),this.containerWidthAtLastDraw=vNode.rc.vnode.dcontainer.el.getWidth())),this.widthAtLastLineDraw=this.el.getWidth()),Math.abs(this.titleHeight-this.title.getHeight())>1&&(vNode.node.isRoot()?vNode.redrawBoundaries():vNode.rc&&(vNode.rc.redrawLines(!0),this.titleHeight=this.title.getHeight()))},editable_bindEvents=function(){var _this3=this;_pasteListener=editable_onPaste.bindAsEventListener(this),_blurListener=onBlur.bindAsEventListener(this),_keyupListener=debounce_default()(onKeyup.bindAsEventListener(this),100),this.title.observe("keyup",_keyupListener),this.title.observe("paste",_pasteListener),setTimeout(function(){return _this3.title.observe("blur",_blurListener)},0),this.simulateNodePasteCallback=function(e){editable_handlePaste.call(_this3,e.memo.clipboardData)},App.subscribe(CustomEvents.SIMULATE_TOPIC_PASTED,this.simulateNodePasteCallback)},unbindEvents=function(){this.title.stopObserving("paste",_pasteListener),this.title.stopObserving("blur",_blurListener),this.title.stopObserving("keyup",_keyupListener),_keyupListener.cancel(),App.unsubscribe(CustomEvents.SIMULATE_TOPIC_PASTED,this.simulateNodePasteCallback)},_pasteListener=void 0,_blurListener=void 0,_keyupListener=void 0,_editing=void 0,_pasting=void 0,Editable={enterEditMode:function(){if(!_editing&&(_editing=!0,_pasting=!1,this.disableDragging&&this.disableDragging(),this.title.setAttribute("contenteditable","true"),this.el.addClassName("editing"),this.titleHeight=this.title.getHeight(),this.titleWidth=this.title.getWidth()+1,this.widthAtLastLineDraw=this.el.getWidth(),this.nodeWidth=this.el.getWidth(),-1!==this.title.innerHTML.indexOf('<br class="js-automatic-break ">')||this.titleWidth>270?(this.title.textContent=this.getValue(),this.title.setStyle({"max-width":this.titleWidth+"px"})):this.title.setStyle({"max-width":"270px"}),this.title.focus(),editable_bindEvents.apply(this),canvas.__onStartEdit(),setCursorPosition(this.title),this.getResizer({className:this.el.className,style:{borderImage:"",borderStyle:"",border:"none"}}),show(App.resizer),!this.el._listener.node.isRoot()&&(this.containerWidthAtLastDraw=this.el._listener.rc.vnode.dcontainer.el.getWidth(),App.config.layout.name===App.Layouts.Aligned.name&&this.el._listener.rc.orientation===App.Layouts.orientation.left))){var map=$("tk_map"),offsetLeft=map.offsetLeft;map.style.left="auto",map.style.right="calc(100% - "+(offsetLeft+map.offsetWidth)+"px)"}},getValue:function(){var value=Object(emojiHelper.a)(this.title.innerHTML.replace(/&nbsp;|<br class="js-automatic-break ">/g," ").replace(/<br>/g,"\n")).safeUnescapeHTML();return this.el._listener.node.normalizeWhitespaces(value).trim()},setValue:function(val){_editing&&(this.title.textContent=val)},getWrappedValue:function(){var maxWidth=this.title.getWidth()+1,paddingLeft=parseFloat(window.getComputedStyle(App.resizer).getPropertyValue("padding-left"));return maxWidth+=parseFloat(window.getComputedStyle(App.resizer).getPropertyValue("padding-right"))+paddingLeft+6,this.insertWraps(this.getValue(),maxWidth)},commit:function(){var offset={x:0,y:0};this.el._listener.node.isRoot()||this.el._listener.rc.orientation===App.Layouts.orientation.left&&(offset=calculateOffset.call(this));var value=this.getWrappedValue();value!==this.el._listener.node.getTitle(!0)?(this.el._listener.node.commitEdit(value,[-offset.x,-offset.y],this._editingAction,this.el._listener.node.isFloating()),editable_getThumb.call(this,this.getValue())):0===this.el._listener.node.getTitle().length&&0===value.length?this.el._listener.node.parent.__onRemoveChild(this.el._listener.node):this.updateTitle()},leaveEditMode:function(commit){if(_editing){if(_editing=!1,_pasting=!1,this.el._listener.rc&&App.config.layout.name===App.Layouts.Aligned.name&&this.el._listener.rc.orientation===App.Layouts.orientation.left){var map=$("tk_map"),offsetLeft=map.offsetLeft;map.style.left=offsetLeft+"px",map.style.right="auto"}commit&&this.getValue().length>0?this.commit():0===this.el._listener.node.getTitle().length?this.el._listener.node.parent.__onRemoveChild(this.el._listener.node):this.updateTitle(),this.enableDragging&&this.enableDragging(),this.title.style.removeProperty("max-width"),this.title.setAttribute("contenteditable","false"),this.el.removeClassName("editing"),this.title.blur(),MM.utils.clearSelection(),unbindEvents.call(this),canvas.__onStopEdit(),this.el._listener.refreshLayout()}},setCursor:function(start,end){var selection=window.getSelection(),range=document.createRange(),textNode=this.title.childNodes[0];range.setStart(textNode,start),range.setEnd(textNode,end),selection.removeAllRanges(),selection.addRange(range)}};__webpack_exports__.default=Editable},"3Kh2":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var IdeaProperty=Class.create({initialize:function(data){data&&(this.floating=data.floating)},toJSON:function(){return{floating:this.floating}}});__webpack_exports__.default=IdeaProperty},"3sJ7":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1__iconsWidgetExpanded_iconsWidgetExpanded__=__webpack_require__("ugn0"),__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__=__webpack_require__("h7V/"),IconsWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{cache:{},recentIcons:["smilie_1","smilie_2","smilie_3","status_ok","status_error","heart","star","idea","priority_01","priority_02","priority_03","flag_red","flag_green","sign_warning","sign_info"],expandable:!0,animationShow:CSS.translate({x:"0",y:0}),animationHide:CSS.translate({x:"100%",y:0}),animationFunction:"ease",initialize:function($super,sidebar,parent){$super("icons",sidebar,parent)},load:function($super){var _this=this;Element.bindOnClick("btn_clearicon",function(){this.removeIcon()}.bind(this)),__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__.a.get("recent_icons",function(preference){preference&&preference.value&&(_this.recentIcons=preference.value.split(",").concat(_this.recentIcons).slice(0,15)),_this.buildRecentIcons()}),this.renderExpansion(),$super()},buildRecentIcons:function(){this.list=mm$("recent_icons"),this.list.innerHTML="";for(var i=0,len=this.recentIcons.length;i<len;i++){var icon=Icon.fromFullName(this.recentIcons[i]);if(icon){var element=icon.isDefault()?icon.getSpriteElement("span"):icon.getElement({className:"h-a-center"}),el=new Element("a",{id:"rec_"+icon.fullName(),href:"#",title:icon.getTitle(),className:"item recent tooltip"}).insert(element);Element.bindOnClick(el,this.toggleIcon.bind(this,icon)),this.list.insert(new Element("cell").insert(el))}}this.buildExpandButton(),MM.ui.ToolTips.destroyTouchSafe(this._tooltips),this._tooltips=MM.ui.ToolTips.touchSafe({el:this.list})},buildExpandButton:function(){var expand=new Element("a",{href:"#",className:"tooltip",title:"Choose icon"});expand.insert(MM.ui.icon({name:"arrow-right",color:"grey-lighter",size:12,iconSize:28,classes:"h-a-center"})),Element.bindOnClick(expand,this.expand.bind(this)),this.list.insert(new Element("cell").insert(expand))},toggleIcon:function(icon){canvas.selected.node.icons.find(function(nodeIcon){return nodeIcon===icon})?this.removeIcon(icon.fullName()):this.setIcon(icon.fullName())},updateRecentIconsSelection:function(){this.recentIcons.each(function(fullName){canvas.selected.node.icons.detect(function(icon){return icon.fullName()===fullName})?addClassName(mm$("rec_"+fullName),"selected"):mm$("rec_"+fullName)&&removeClassName(mm$("rec_"+fullName),"selected")})},onSelectIcon:function(event,icon){event&&Event.stop(event),this.selectedIcon&&removeClassName(mm$("icon_library_"+this.selectedIcon.fullName()).parentNode,"selected"),this.selectedIcon=icon,addClassName(mm$("icon_library_"+this.selectedIcon.fullName()).parentNode,"selected")},removeIcon:function(iconName){if(void 0===iconName)canvas.onRemoveIcon();else{var icon=Icon.get(iconName);icon&&canvas.onRemoveIcon(icon)}this.sidebar.tasks.visible&&this.sidebar.tasks.onSelectNode(),this.onSelectNode()},setIcon:function(iconName){var icon=null;iconName&&(icon=Icon.get(iconName.replace(/icon_default_/,""))),icon&&(canvas.onSetIcon(icon),this.addRecentIcon(icon.fullName()),this.sidebar.tasks.visible&&this.sidebar.tasks.onSelectNode(),App.trigger(CustomEvents.ICON_CHANGED),this.onSelectNode())},addRecentIcon:function(value){this.recentIcons.indexOf(value)<0&&(this.recentIcons.pop(),this.recentIcons.unshift(value),__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__.a.save({name:"recent_icons",value:this.recentIcons.join(",")}),this.buildRecentIcons())},onSelectNode:function(){this.updateRecentIconsSelection(),this.expansion&&this.expanded&&this.expansion.update()},onExpand:function(){this.expansion||this.renderExpansion()},renderExpansion:function(){var _this2=this,libs=[];Object.keys(Icon.libraries).without("silk").map(function(lib){var sections=Icon.getSections(lib);sections?sections.map(function(section){return libs.push({lib:lib,section:section})}):libs.push({lib:lib,section:null})}),this.expansion=ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1__iconsWidgetExpanded_iconsWidgetExpanded__.default,{libs:libs,onBack:this.contract.bind(this),onSelectIcon:this.toggleIcon.bind(this),onClose:function(){return _this2.sidebar.hide(!0,!0)}}),this.expandedEl)}});__webpack_exports__.default=IconsWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},"49TO":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_graphics__=__webpack_require__("t8zp"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_loadingSpinner__=__webpack_require__("atEJ"),_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),BoundariesWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,sidebar,parent){$super("boundaries",sidebar,parent),Element.bindOnClick("btn_remove_boundary",this.setValue.bind(this)),Element.bindOnClick("btn_customize_boundary",this.showDialog.bind(this))},load:function($super){this.list=this.el.select("grid")[0],this.list.innerHTML="";for(var styles=this._getBoundaryStyles(),i=0;i<styles.length;i++)this.addStyle(styles[i]);$super()},addStyle:function(style){var r1=Rectangle.fromPosSize(new Point(15,18),new Point(35,10)),r2=Rectangle.fromPosSize(new Point(35,10),new Point(22,26)),boundary={r1:r1,r2:r2,style:style},el=new Element("a",{href:"#",id:"style_boundary_"+style.id,className:"item",style:"background-color: #"+App.config.mapTheme.background.color});el.observe("click",this.setValue.bindAsEventListener(this,style)),__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_graphics__.Graphics.drawBoundaryPreview(el,boundary),this.list.insert(new Element("cell",{className:"topic-preview"}).insert(el))},setValue:function(event,style){if(Event.stop(event),style){var selected=canvas.allSelected,nodesWithSameBoundary=selected.filter(function(vNode){var node=vNode.node;return node.boundary&&node.boundary.style.equals(style)});selected.length===nodesWithSameBoundary.length&&(style=null)}canvas.onSetBoundary(style),this._setSelected(style)},showDialog:function(e){var _this=this,btn=e.target;MM.ui.disableButton(btn),Dialog.multipleChoice('<div id="format_dialog"></div>',{windowParameters:{id:"formatboundary",width:630,onBeforeShow:function(){$("formatboundary_content").select(".dialog_buttons")[0].style.visibility="hidden"},onShow:function(){MM.status.helpTopic="218435697-Customize",ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_loadingSpinner__.a,{size:64,opts:{className:"h-h-center"}}),mm$("format_dialog")),Promise.all([__webpack_require__.e(54).then(__webpack_require__.bind(null,"1umx")),__webpack_require__.e(60).then(__webpack_require__.bind(null,"vLqA"))]).then(function(_ref){var _ref2=_slicedToArray(_ref,1),boundaries=_ref2[0];$("formatboundary_content").select(".dialog_buttons")[0].style.visibility="visible",_this.customizeBoundary=boundaries.default,_this.customizeBoundary.init()})},onClose:function(){return MM.ui.enableButton(btn)}},choices:[{label:I18n.t("js.cancel"),callback:function(){return MM.ui.dialogs.close("formatboundary")},classes:"button"},{label:I18n.t("js.save")+"...",callback:function(){App.hasFeature("custom_styles")?_this.customizeBoundary.save():MM.ui.dialogs.dialogUpgrade("map_custom_styles")},classes:"button"},{label:I18n.t("js.ok"),callback:function(){_this.customizeBoundary.setStyle(App.config.mapTheme.id),MM.ui.dialogs.close("formatboundary")},classes:"button default"}]})},onSelectNode:function(){if(canvas.selected.node){var style=this._getStyleByBoundary(canvas.selected.node.boundary);this._setSelected(style)}},_setSelected:function(style){if(this.list.select(".selected").invoke("removeClassName","selected"),style){var boundaryElement=mm$("style_boundary_"+style.id);boundaryElement&&addClassName(boundaryElement,"selected")}},_getStyleByBoundary:function(boundary){if(boundary)return this._getBoundaryStyles().find(function(style){return boundary.style.equals(style)})},_getBoundaryStyles:function(){var styles=App.config.mapTheme.boundary_styles;return 0===styles.length&&MapTheme.getDefault()&&(styles=MapTheme.getDefault().boundary_styles),styles.concat(Style.userBoundaryStyles)}});__webpack_exports__.default=BoundariesWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},"4XN+":function(module,exports){function stubArray(){return[]}module.exports=stubArray},"4dmE":function(module,exports,__webpack_require__){function toKey(value){if("string"==typeof value||isSymbol(value))return value;var result=value+"";return"0"==result&&1/value==-INFINITY?"-0":result}var isSymbol=__webpack_require__("hyfS"),INFINITY=1/0;module.exports=toKey},"5cCM":function(module,exports,__webpack_require__){function assignValue(object,key,value){var objValue=object[key];hasOwnProperty.call(object,key)&&eq(objValue,value)&&(void 0!==value||key in object)||baseAssignValue(object,key,value)}var baseAssignValue=__webpack_require__("tZex"),eq=__webpack_require__("0huu"),objectProto=Object.prototype,hasOwnProperty=objectProto.hasOwnProperty;module.exports=assignValue},"62Jj":function(module,exports){App.ui.Message={INFO:"info",NOTICE:"info",WARNING:"warning",ERROR:"error",captions:[I18n.t("js.info")+":",I18n.t("js.note")+":",I18n.t("js.warning")+":",I18n.t("js.error")+":",I18n.t("js.did_you_know")],duration:5,show:function(text,level,duration){if(!Presentation.on){this.element||(this.element=$("popover_message")),this.duration=duration||this.duration;var icon=MM.ui.icon({name:level||this.WARNING,size:16}),newHTML="<div row>"+icon+'<p class="mh-10">'+text+"</p></div>";this.element.innerHTML===newHTML&&this.visible?(this.clearTimer(),this.setTimer()):(this.element.update(newHTML),CSS.set(this.element,{top:"-60px",left:UI.Registry.getViewportOffset("left")+"px",transitionDuration:0}),this.timeout&&this.clearTimer(),setTimeout(function(){CSS.Effect.Morph(this.element,{duration:.8,style:{top:UI.Registry.getViewportOffset("top")+"px",opacity:"1"}}),this.setTimer()}.bind(this),10)),this.visible=!0}},hide:function(){CSS.Effect.Morph(this.element,{duration:.8,style:{left:"-360px",opacity:"0"}}),this.clearTimer(),this.visible=!1},showSticky:function(html,type){var el=new Element("div",{id:"popover_message_sticky",class:"popover message sticky rad-5 "+(type||"")});document.body.appendChild(el),mm$("popover_message_sticky").innerHTML=html,new Effect.Appear(el)},hideSticky:function(){$("popover_message_sticky").remove()},setTimer:function(){-1!==this.duration&&(this.timeout=setTimeout(function(){this.hide()}.bind(this),1e3*this.duration))},clearTimer:function(){this.timeout&&clearTimeout(this.timeout),this.timeout=null}},window.Message=App.ui.Message},"6B3d":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_ui_components_customizeTopic_fontSizeButtons__=__webpack_require__("CT+U"),renderFontSizeButtons=function(selected){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_customizeTopic_fontSizeButtons__.a,{selectedValue:selected,onSelect:canvas.onSetStyle.bind(canvas,"fontSize")}),mm$("btn-size-container"))},FormatWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,sidebar,parent){$super("format",sidebar,parent),Element.bindOnClick("btn_bold",canvas.onSetStyle.bind(canvas,"bold","toggle")),Element.bindOnClick("btn_italic",canvas.onSetStyle.bind(canvas,"italic","toggle"))},onSelectNode:function(){MM.ui.buttonUnselect("btn_bold","btn_italic");var style=canvas.selected.node.currentStyle();renderFontSizeButtons(style.fontSize),style.bold&&MM.ui.buttonSelect("btn_bold"),style.italic&&MM.ui.buttonSelect("btn_italic")}});__webpack_exports__.default=FormatWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},"7jJu":function(module,exports){function getValue(object,key){return null==object?void 0:object[key]}module.exports=getValue},"83D3":function(module,exports){function arrayIncludesWith(array,value,comparator){for(var index=-1,length=null==array?0:array.length;++index<length;)if(comparator(value,array[index]))return!0;return!1}module.exports=arrayIncludesWith},"8yla":function(module,exports){function arrayEach(array,iteratee){for(var index=-1,length=null==array?0:array.length;++index<length&&!1!==iteratee(array[index],index,array););return array}module.exports=arrayEach},"9pOK":function(module,exports){function isNull(value){return null===value}module.exports=isNull},A9ap:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var SideBarWidget=Class.create({visible:!1,expandable:!1,onExpand:function(){return null},initialize:function(id,sidebar,parent){this.id=id,this.sidebar=sidebar,this.el=$(id),this.parent=parent,this.expandable&&(this.expandedEl=$(id+"_expanded")),this.animationHide&&this.expandedEl&&CSS.set(this.expandedEl,{transform:this.animationHide})},show:function(_show){function show(_x){return _show.apply(this,arguments)}return show.toString=function(){return _show.toString()},show}(function(contract){this.visible||(this.visible=!0,contract&&this.sidebar.expandedWidget&&!this.expandable&&this.sidebar.expandedWidget.contract(),show(this.el),this.loaded||this.load(),canvas.selected&&this.onSelectNode(),UI.Registry.notify(this.sidebar,"onResize"),this.parent&&this.parent.onShow(this))}),hide:function(_hide){function hide(){return _hide.apply(this,arguments)}return hide.toString=function(){return _hide.toString()},hide}(function(){hide(this.el),this.visible=!1,UI.Registry.notify(this.sidebar,"onResize")}),toggle:function(){this.visible?this.hide():this.show()},load:function(){this.loaded=!0},toViewMode:function(){},toEditMode:function(){},onSelectNode:function(){},expand:function(){this.expandable&&!this.expanded&&(this.sidebar.expandedWidget=this,this.expanded=!0,this.positionExpandedEl(this.expandedEl),App.setPreference("sidebar_extended",this.id),this.onExpand())},contract:function(){this.expandable&&(App.setPreference("sidebar_extended",null),this.sidebar.expandedWidget=null,this.expanded=!1,this.positionExpandedEl(this.sidebar.defaults.toolbar))},positionExpandedEl:function(elToShow){this.sidebar.hide(!0,!1,this.animationHide,this.animationFunction),this.sidebar.expandedElement=elToShow,this.sidebar.show(!0,!1,this.animationShow,this.animationFunction)}});__webpack_exports__.default=SideBarWidget},AGfX:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var _typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},Task=Class.create({from:null,due:null,resource:null,effort:"",priority:-1,complete:-1,initialize:function(task){task.from&&(this.from=new Date(task.from)),task.due&&(this.due=new Date(task.due)),this.resource=null,"string"==typeof task.resource&&""!==task.resource?this.resource={id:task.resource_id,name:task.resource}:"object"===_typeof(task.resource)&&(this.resource=task.resource),this.effort=task.effort||"",this.priority=void 0!==task.priority&&task.priority>-1?task.priority:-1,this.complete=void 0!==task.complete&&task.complete>-1?task.complete:-1},equals:function(task){return!(this.from&&!task.from||!this.from&&task.from||this.from&&task.from&&this.from.toString()!=task.from.toString())&&(!(this.due&&!task.due||!this.due&&task.due||this.due&&task.due&&this.due.toString()!=task.due.toString())&&(!(this.resource&&!task.resource||!this.resource&&task.resource||this.resource&&task.resource&&(this.resource.name!=task.resource.name||this.resource.id!=task.resource.id))&&(this.effort==task.effort&&(this.priority==task.priority&&this.complete==task.complete))))},empty:function(){return!this.from&&!this.due&&!this.resource&&!this.effort&&this.priority<0&&this.complete<0},iconsOnly:function(){return!(this.from||this.due||this.resource||this.effort)},toString:function(property){return"due"===property?this.due?this.due.getMonth()+1+"/"+this.due.getDate()+"/"+this.due.getFullYear():"-":"from"===property?this.from?this.from.getMonth()+1+"/"+this.from.getDate()+"/"+this.from.getFullYear():"-":"resource"===property?this.resource?this.resource.name:"-":void 0}});__webpack_exports__.default=Task},BLbw:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_loadingSpinner__=__webpack_require__("atEJ"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_sectionHeader__=__webpack_require__("zISO"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_skimmableList_skimmableList__=__webpack_require__("jR5l"),__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_listWithFilter__=__webpack_require__("bPcH"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),openMap=function(e,id){id&&(e.metaKey||e.ctrlKey||e.shiftKey?window.open("/"+id):window.location.href="/"+id)},_maps=[],MapsPopover=function(_React$Component){function MapsPopover(props){_classCallCheck(this,MapsPopover);var _this=_possibleConstructorReturn(this,(MapsPopover.__proto__||Object.getPrototypeOf(MapsPopover)).call(this,props));return _this.state={isLoading:!0,items:_maps},_this._createNewMap=_this._createNewMap.bind(_this),_this}return _inherits(MapsPopover,_React$Component),_createClass(MapsPopover,[{key:"_createNewMap",value:function(e){e.preventDefault(),MM.ui.disableButton(this.newMapBtn),document.location.href=document.location.protocol+"//"+document.location.host+"/maps/new?template_id=0"}},{key:"componentWillMount",value:function(){var _this2=this;new Ajax.Request("/maps/get_user_maps",{onSuccess:function(transport){var maps=transport.responseText.evalJSON();_maps=[],maps.each(function(map){_maps.push({label:map.title,className:"ellipsis",style:{whiteSpace:"pre"},onClick:function(e){return openMap(e,map.id)}})}),_this2.setState({isLoading:!1,items:_maps})}})}},{key:"render",value:function(){var _this3=this;return this.state.isLoading?React.createElement("div",{className:"ta-center"},React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_loadingSpinner__.a,{size:48,opts:{className:"h-iblock m-10"}})):React.createElement("div",{className:""},React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_sectionHeader__.a,{title:I18n.t("js.my_maps"),className:"ph-15 fs-18 pb-10",titleClassName:"mv-5 c-grey fw-500"}),React.createElement(__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_listWithFilter__.a,{autofocus:!0,inputClassName:"mh-15 mb-10",filterableAttribute:"label"},React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_skimmableList_skimmableList__.a,null,React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_list_list__.a,{items:this.state.items,className:"maxh-300px h-overflow-y"}))),React.createElement("a",{ref:function(el){return _this3.newMapBtn=el},className:"button default m-10",onClick:this._createNewMap},I18n.t("js.new_mind_map")))}}]),MapsPopover}(React.Component);__webpack_exports__.a=MapsPopover}).call(__webpack_exports__,__webpack_require__("nakD"))},CKi4:function(module,exports,__webpack_require__){function omitBy(object,predicate){return pickBy(object,negate(baseIteratee(predicate)))}var baseIteratee=__webpack_require__("EAyW"),negate=__webpack_require__("t6QJ"),pickBy=__webpack_require__("yDlx");module.exports=omitBy},"CT+U":function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),FontSizeButtons=function(_React$Component){function FontSizeButtons(props){_classCallCheck(this,FontSizeButtons);var _this=_possibleConstructorReturn(this,(FontSizeButtons.__proto__||Object.getPrototypeOf(FontSizeButtons)).call(this,props));return _this.state={selected:_this.props.selectedValue},_this}return _inherits(FontSizeButtons,_React$Component),_createClass(FontSizeButtons,[{key:"_handleClick",value:function(value,e){e.preventDefault(),e.stopPropagation(),this.props.onSelect(value),this.setState({selected:value})}},{key:"componentDidMount",value:function(){this.tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"componentWillReceiveProps",value:function(nextProps){nextProps.selectedValue&&this.props.selected!==nextProps.selectedValue&&this.setState({selected:nextProps.selectedValue})}},{key:"render",value:function(){var _this2=this,fontSizes=[{name:"small",value:100,className:"m-0",iconSize:"10"},{name:"medium",value:120,className:null,iconSize:"16"},{name:"large",value:150,className:"m-0",iconSize:"20"}];return React.createElement("div",{ref:function(el){return _this2.container=el},className:"h-flex-row "+this.props.className},fontSizes.map(function(fontSize,index){var className="tooltip widget-button s-36 "+fontSize.className+(_this2.state.selected===fontSize.value?" selected":"");return React.createElement("a",{key:index,href:"#",className:className,title:I18n.t("js.text_size."+fontSize.name),onClick:_this2._handleClick.bind(_this2,fontSize.value)},React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{opts:{name:"text-size",size:fontSize.iconSize}}))}))}}]),FontSizeButtons}(React.Component);FontSizeButtons.defaultProps={className:"",onSelect:function(){}},__webpack_exports__.a=FontSizeButtons}).call(__webpack_exports__,__webpack_require__("nakD"))},FN6h:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_dropdown_dropdown__=__webpack_require__("PYcA"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_dropdown_button__=__webpack_require__("qzqB"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_list_list__=__webpack_require__("worM"),mediaSources={youtube:{label:"YouTube"},vimeo:{},dailymotion:{},google:{},iconfinder:{label:"IconFinder",iconClassName:"rad-0"},url:{label:"URL"},skoletube:{label:"SkoleTube"}},MediaSourcesDropdown=function(props){var sources=props.sources,selectedSource=props.selectedSource,onChange=props.onChange,items=sources.map(function(source){var _mediaSources$source=mediaSources[source],_mediaSources$source$=_mediaSources$source.label,label=void 0===_mediaSources$source$?source.capitalize():_mediaSources$source$,_mediaSources$source$2=_mediaSources$source.iconClassName,iconClassName=void 0===_mediaSources$source$2?"":_mediaSources$source$2;return{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_svgIcon__.a,{opts:{name:("url"===source?"":"service-")+source,size:22,parentClasses:"rad-100% mr-8 "+iconClassName}}),label:label,value:source}});return React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_dropdown_dropdown__.a,{opener:React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_dropdown_button__.a,{className:"w-190 mr-10"}),selected:items.find(function(item){return item.value===selectedSource}),onChange:onChange},React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_list_list__.a,{items:items}))};__webpack_exports__.a=MediaSourcesDropdown}).call(__webpack_exports__,__webpack_require__("nakD"))},G8SJ:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_ui_components_colorPalette__=__webpack_require__("zOua"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_4_ui_core_popover__=__webpack_require__("SZxL"),__WEBPACK_IMPORTED_MODULE_5_app_utils_constants__=__webpack_require__("67vC"),__WEBPACK_IMPORTED_MODULE_6_utils_emojiHelper__=__webpack_require__("iXsu"),FONT_SIZES=[10,12,14,18],ALIGNMENT={left:"text-left-aligned",right:"text-right-aligned",center:"text-centered",justify:"text-justify"},DEFAULTS={color:"000000",fontSize:12},NotesWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,sidebar,parent){$super("notes",sidebar,parent),this.field=$("note_content"),this.blurListener=this.onBlur.bind(this),this.keymap=new MM.utils.KeyMap(this.field,"notes_keymap",[{key:MM.utils.KeyEvent.TAB,stopEvent:!0,fn:function(){return MM.utils.replaceSelection("\t")}},{key:"s",ctrl:!0,fn:this.onBlur.bind(this)}]),this.keymap.disable(),Element.bindOnClick("btn_removenote",this.removeNote.bind(this)),Element.bindOnClick("btn_autonote",this.getAutoNote.bind(this)),Element.bindOnClick("btn_dlg_notes_widget",this.showDialog.bind(this)),this.state={color:DEFAULTS.color}},load:function($super){this.initCE(),$super()},focus:function(){this.show(!0),this.field.focus()},onFocus:function(){_Event.observeBlur(this.field,this.blurListener),this.keymap.enable(),canvas.removeFocus()},onBlur:function(){_Event.stopObservingBlur(this.field,this.blurListener),this.field.blur(),this.keymap.disable(),canvas.addFocus(),this.save(this.getValue())},initCE:function(){this.field.contentEditable=!0,this.field.observe("focus",this.onFocus.bind(this))},showDialog:function(e){e&&e.stop(),this.shown||(this.shown=!0,canvas.removeFocus(),MM.utils.loadCSS("app/map/quill.css"),MM.utils.loadScript("tools/quill/quill.js",function(){MM.ui.dialogs.show("notes_widget",{controller:"dialog",dlg_name:"notes_widget",width:590,noHelp:!0,onComplete:this.setupDialogContent.bind(this,canvas.selected.node.note),onDestroy:function(){clearTimeout(this.selectionTimeout),this.selectionTimeout=null,this.shown=!1,this.editor_dlg=null,this.sizePopover.destroy(),this.sizePopover=null,this.alignPopover.destroy(),this.alignPopover=null,this.colorPopover.destroy(),this.colorPopover=null,MM.ui.ToolTips.destroyTouchSafe(this.tooltips),this.tooltips=null,canvas.addFocus()}.bind(this)})}.bind(this)))},setupDialogContent:function(val){if(mm$("notes_header").innerHTML=val?I18n.t("js.edit_note"):I18n.t("js.add_note"),this.initEditor(),this.buildPopovers(),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.editor_dlg.modules.toolbar.container}),val){this.editor_dlg.root.innerHTML="";var tmp=new Element("div").update(val);tmp.firstChild.tagName||(tmp=new Element("div").update(tmp.outerHTML)),tmp.childElements().each(function(line){setTimeout(function(){this.editor_dlg.root.appendChild(line)}.bind(this),100)}.bind(this))}this.selectionTimeout=setTimeout(this.setEditorDlgSelection.bind(this),400)},initEditor:function(){this.editor_dlg=new Quill("#node_content_dlg",{modules:{toolbar:{container:"#notes_toolbar"},"link-tooltip":{template:'<span class="title" style="margin-right: 5px;">'+I18n.t("js.visit_url")+':</span><a href="#" class="url" target="_blank"></a><input class="input" type="text"><span style="margin: 0 5px;">-</span><a href="#" class="change">'+I18n.t("js.change")+'</a><a href="#" class="done">'+I18n.t("js.done")+"</a>"},"image-tooltip":{template:'<input class="input" type="textbox"><div class="preview"><span>'+I18n.t("js.preview")+'</span></div><a href="#" class="cancel">'+I18n.t("js.cancel")+'</a><a href="#" class="insert">'+I18n.t("js.insert")+"</a>"}},theme:"snow"}),this.initEditorListeners(),this.pasteManager=this.editor_dlg.getModule("paste-manager"),this.switchModeBtn=mm$("btn_switch_mode"),this.renderSwitchButton(),this.switchModeBtn.observe("click",this.onSwitchMode.bind(this)),mm$("btn_erase").observe("click",this.removeFormat.bind(this))},initEditorListeners:function(){this.editor_dlg.on("text-change",this.onTextChange.bind(this)),this.editor_dlg.on("selection-change",this.onSelectionChange.bind(this))},onTextChange:function(delta,source){if(this.getDialogValue().length>65e3&&MM.ui.dialogs.showError(I18n.t("js.note_is_too_long")),!this.pasteManager.plainText){var range=this.editor_dlg.getSelection();range&&this.updateAlignBtn(range)}},onSelectionChange:function(range){if(!this.pasteManager.plainText&&range){var contents=this.editor_dlg.getContents(range.end-1,range.end);if(contents&&contents.ops.length>0){var attributes=contents.ops[0].attributes,color="";if(attributes.color){attributes.color.split(",").each(function(val){val=parseInt(val.replace(/[^\d]/g,"")).toString(16),color+=val.length>1?val:"0"+val})}else color=DEFAULTS.color;this.updateFontColorBtn(color),this.updateFontSizeBtn(attributes.size)}this.updateAlignBtn(range)}},buildPopovers:function(){var _this=this;this.colorPopover=new __WEBPACK_IMPORTED_MODULE_4_ui_core_popover__.c("color",{onShow:function(){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_colorPalette__.a,{selectedColor:_this.state.color,onItemClick:_this.changeFontColor.bind(_this)}),_this.colorPopover.widgetContainer)}}),this.sizePopover=new __WEBPACK_IMPORTED_MODULE_4_ui_core_popover__.c("size"),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_list_list__.a,{items:FONT_SIZES.map(function(size){return{label:React.createElement("span",{className:"fs-"+size},size,"pt"),onClick:_this.changeFontSize.bind(_this,size)}})}),this.sizePopover.widgetContainer),this.alignPopover=new __WEBPACK_IMPORTED_MODULE_4_ui_core_popover__.c("align"),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_list_list__.a,{items:Object.keys(ALIGNMENT).map(function(alignment){return{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_svgIcon__.a,{opts:{name:ALIGNMENT[alignment],size:18,consize:20,color:"blue",classes:"h-a-center",parentClasses:"p-r mr-8px"}}),label:I18n.t("js.text_alignment."+alignment),onClick:_this.changeAlignment.bind(_this,alignment)}})}),this.alignPopover.widgetContainer)},_getSelection:function(){return this.editor_dlg.focus(),this.editor_dlg.getSelection()},changeFontSize:function(val){var range=this._getSelection(),fontSize=val+"px";this.editor_dlg.prepareFormat("size",fontSize),range&&range.end>range.start&&this.editor_dlg.formatText(range.start,range.end,"size",fontSize),this.updateFontSizeBtn(val)},changeAlignment:function(val){var range=this._getSelection();this.editor_dlg.formatLine(range,"align",val,"user"),this.updateAlignBtn(range,val)},removeNote:function(){this.saveFromValue(""),NotesWidget.cache.autonote={id:null}},getAutoNote:function(){NotesWidget.cache.autonote.id==canvas.selected.node.id&&NotesWidget.cache.autonote.title==canvas.selected.node.title&&NotesWidget.cache.autonote.items.length>1?(NotesWidget.cache.autonote.items.shift(),this.saveFromValue(NotesWidget.cache.autonote.items[0].content)):(ServerConnection.autoNote({query:canvas.selected.node.title},this.setAutoNote.bind(this)),$("btn_autonote").addClassName("fx-wiggle fx-infinite fx-none")),Amplitude.logEvent("wunder_note")},setAutoNote:function(data){if($("btn_autonote").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),data.error||0===data.items.length)return void Message.show(I18n.t("js.no_auto_note_found_for_topic"),Message.INFO);NotesWidget.cache.autonote={id:canvas.selected.node.id,title:canvas.selected.node.title,items:data.items},this.saveFromValue(data.items[0].content)},getValue:function(){return Object(__WEBPACK_IMPORTED_MODULE_6_utils_emojiHelper__.a)(this.field.innerHTML)},getDialogValue:function(){return this.pasteManager.plainText?Object(__WEBPACK_IMPORTED_MODULE_6_utils_emojiHelper__.a)(this.editor_dlg.getText()).escapeHTML():Object(__WEBPACK_IMPORTED_MODULE_6_utils_emojiHelper__.a)(this.editor_dlg.getHTML())},save:function(value){canvas.selected.node.note!==value&&(App.trigger(CustomEvents.NOTE_CHANGED),"<br>"===value&&(value=""),canvas.onSetProperty("note",value,{onOk:Windows.close.bind(Windows,"notes_widget")}))},saveFromValue:function(value){"<p>&nbsp;</p>"===value&&(value=""),this.setValue(value),this.save(value)},saveFromDialog:function(){this.saveFromValue(this.getDialogValue())},setValue:function(value){this.field&&(this.field.innerHTML=value.replace(/\n/g,"<br/>"))},onSelectNode:function(){this.setValue(canvas.selected.node.note||"")},setEditorDlgSelection:function(range){range=Object.extend({start:0,end:0},range),setTimeout(this.editor_dlg.setSelection.bind(this.editor_dlg,range.start,range.end),0)},onSwitchMode:function(event){event.stop();var range=this._getSelection();if(this.pasteManager.plainText)this.doSwitchMode(!1,range);else{if(this.editor_dlg.getText().trim().empty())return void this.doSwitchMode(!0,range);Dialog.confirm("<h2>"+I18n.t("js.convert_to_plain_text")+"</h2><p>"+I18n.t("js.convert_to_plain_text_information")+"</p>",{okLabel:I18n.t("js.si"),cancelLabel:I18n.t("js.njet"),ok:function(){this.doSwitchMode(!0,range),Dialog.closeInfo()}.bind(this),cancel:this.setEditorDlgSelection.bind(this,range),windowParameters:{width:270}})}},doSwitchMode:function(plain,selection){this.pasteManager.plainText=plain;var toolbar=mm$("notes_toolbar");plain?(this.editor_dlg.setContents([{value:this.editor_dlg.getText().replace(/<br\/>/g,"\n")}]),addClassName(toolbar,"h-hidden"),toolbar.style.opacity=0,this.switchModeBtn.innerHTML=I18n.t("js.switch_to_formatted_text")):(removeClassName(toolbar,"h-hidden"),new Effect.Opacity(toolbar,{from:0,to:1,duration:.5}),this.switchModeBtn.innerHTML=I18n.t("js.switch_to_plain_text")),this.renderSwitchButton(),this.setEditorDlgSelection(selection)},renderSwitchButton:function(){this.switchModeBtn.innerHTML=this.pasteManager.plainText?MM.ui.icon({name:"copy",size:20,parentClasses:"h-iblock mr-5px",color:"grey-light"})+I18n.t("js.switch_to_formatted_text"):MM.ui.icon({name:"file-format-generic",size:20,parentClasses:"h-iblock mr-5px"})+I18n.t("js.switch_to_plain_text")},changeFontColor:function(color){var rgb="rgb("+parseInt(color.substring(0,2),16)+", "+parseInt(color.substring(2,4),16)+", "+parseInt(color.substring(4,6),16)+")",range=this._getSelection();this.editor_dlg.prepareFormat("color",rgb),range&&range.end>range.start&&this.editor_dlg.formatText(range.start,range.end,"color",rgb),this.updateFontColorBtn(color)},removeFormat:function(event){event.stop();var range=this._getSelection(),text=this.editor_dlg.getText(range.start,range.end);this.editor_dlg.deleteText(range.start,range.end),this.editor_dlg.insertText(range.start,text)},updateAlignBtn:function(range,value){if(!value){var line=this.editor_dlg.editor.doc.findLineAt(range.end)[0];value=line&&line.formats.align?line.formats.align:"left"}this.alignPopover.opener.update(MM.ui.icon({name:ALIGNMENT[value],size:18,consize:18,color:"blue"}))},updateFontSizeBtn:function(value){value=parseInt(value),!isNaN(value)&&FONT_SIZES.include(value)||(value=DEFAULTS.fontSize),this.sizePopover.field.update(value+"pt")},updateFontColorBtn:function(val){val=__WEBPACK_IMPORTED_MODULE_5_app_utils_constants__.COLORS.include(val)?val:DEFAULTS.color,this.state.color!==val&&(this.state.color=val,mm$("btn_color_bg").style.backgroundColor="#"+this.state.color)}});NotesWidget.cache={autonote:{id:null}},__webpack_exports__.default=NotesWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},Gdal:function(module,exports,__webpack_require__){function baseRest(func,start){return setToString(overRest(func,start,identity),func+"")}var identity=__webpack_require__("atk5"),overRest=__webpack_require__("ORg+"),setToString=__webpack_require__("1GA3");module.exports=baseRest},GgL9:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_models_linkedList__=__webpack_require__("kLIQ"),__WEBPACK_IMPORTED_MODULE_1_utils_imageQueue__=__webpack_require__("pNvO"),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},previewSize={width:110,height:74};App.ui.Slide=Class.create({initialize:function(data){this.id=data.id,this.nodes=data.nodes||[],this.padding=data.padding||{top:0,right:0,bottom:0,left:0},this.next_slide_id=data.next_slide_id,this.transition=void 0!==data.transition?data.transition:void 0!==App.ui.SlideShow?App.ui.SlideShow.defaultTransition:App.ui.Slide.Transition.fast_zoom_pan,this.setRectangle()},setRectangle:function(){this.rectangle=null;var visibleNodes=this.nodes.findAll(function(node){return node.isVisible()});0!==visibleNodes.length&&(this.rectangle=canvas.getRectangleFromNodes(visibleNodes),this.rectangle&&this.rectangle.addPadding(this.padding))},save:function(options){if(0!==this.nodes.length){options=Object.extend({},options);var nodes=[];this.nodes.each(function(node){for(var withChildren=node.children.length>0,i=0;i<node.children.length&&withChildren;){var child=node.children[i];this.nodes.include(child)||(withChildren=!1),i++}nodes.push({id:node.id,with_children:withChildren})}.bind(this));var parameters={map_id:App.config.map_id,nodes:Object.toJSON(nodes),padding:Object.toJSON(this.padding),transition:this.transition};this.id&&Object.extend(parameters,{id:this.id}),this.next&&Object.extend(parameters,{next_slide:this.next.id}),new Ajax.Request("/presentation/slide",{parameters:parameters,onSuccess:function(transport){var response=transport.responseText.evalJSON();response.error?(Message.show("The slide could not be saved.",Message.ERROR),options.onFailure&&options.onFailure()):this.id=response.slide.id}.bind(this)})}},buildUI:function(useEffect){if(this.setRectangle(),!this.rectangle)return void(this.selection&&(this.selection.remove(),this.selection=null));var coordinates={x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y};if(!this.selection||this.selection.areaCoords.x1!==coordinates.x1||this.selection.areaCoords.x2!==coordinates.x2||this.selection.areaCoords.y1!==coordinates.y1||this.selection.areaCoords.y2!==coordinates.y2){var options=Object.extend(this.defaultSelectionOptions(),{displayOnInit:!0,useEffect:useEffect,onloadCoords:{x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y}});this.selection&&Selections.all.indexOf(this.selection)>-1?(this.selection.areaCoords=coordinates,this.selection.drawArea()):"undefined"!=typeof Selection&&void 0!==Selection.Base&&App.config.editable&&(this.selection=new Selection.Base("canvas",options),this.selection.deselect(),void 0===App.ui.SlideShow||App.ui.SlideShow.selectionsVisible||this.selection.hide())}},getSize:function(){return this.rectangle?this.rectangle.dimensions():{width:0,height:0}},getCoords:function(){return this.rectangle||this.setRectangle(),this.rectangle?{x1:this.rectangle.p1.x,y1:this.rectangle.p1.y,x2:this.rectangle.p2.x,y2:this.rectangle.p2.y}:{x1:0,y1:0,x2:0,y2:0}},transformCoordsForPreview:function(mapSize){var coords=this.getCoords(),x=Math.min(coords.x1,coords.x2)-mapSize.left,y=Math.min(coords.y1,coords.y2)-mapSize.top,width=Math.abs(coords.x2-coords.x1),height=Math.abs(coords.y2-coords.y1);if(width<previewSize.width&&height<previewSize.height)return x-=(previewSize.width-width)/2,y-=(previewSize.height-height)/2,{x:parseInt(x),y:parseInt(y),width:previewSize.width,height:previewSize.height};var factorWidth=width/previewSize.width,factorHeight=height/previewSize.height,factor=Math.max(factorWidth,factorHeight);if(factorWidth>factorHeight){y-=(previewSize.height*factor-height)/2}else{x-=(previewSize.width*factor-width)/2}return{x:parseInt(x),y:parseInt(y),width:parseInt(previewSize.width*factor),height:parseInt(previewSize.height*factor)}},getPreviewImageSrc:function(opts){var previewCoords=this.transformCoordsForPreview(opts);return"/export/image_section/"+App.config.map_id+"?x="+previewCoords.x+"&y="+previewCoords.y+"&w="+previewCoords.width+"&h="+previewCoords.height},onExitPlay:function(){this.nodes.each(function(node){removeClassName(node._listener.dcontent.el,"slideshow_current")}),this.nodes.detect(function(node){return!node.isVisible()})&&this.selection&&(this.selection.remove(),this.selection=null),canvas.closeTemporarilyOpen()},onPlay:function(){var redrawn=!1;if(this.nodes.detect(function(node){return!node.isVisible()})&&(this.nodes.each(function(node){node._listener.makeVisible()}),this.buildUI(),redrawn=!0),this.nodes.each(function(node){addClassName(node._listener.dcontent.el,"slideshow_current")}),this.prev?MM.ui.enableButton("slideshow-prev"):MM.ui.disableButton("slideshow-prev"),this.next?MM.ui.enableButton("slideshow-next"):MM.ui.disableButton("slideshow-next"),mm$("slideshow_steps")){mm$("slideshow_step"+this.id).className="selected";for(var slide=this.prev;slide;)mm$("slideshow_step"+slide.id).className="seen",slide=slide.prev;for(slide=this.next;slide;)mm$("slideshow_step"+slide.id).className="unseen",slide=slide.next}return redrawn},onEnter:function(){},defaultSelectionOptions:function(){return{}}}),App.ui.VSlide=Class.create(App.ui.Slide,{initialize:function($super,data){$super(data),this.registerObservers(),App.trigger(CustomEvents.SLIDE_CREATED)},registerObservers:function(){this.content=new Element("a"),this.label=new Element("span"),this.opener=new Element("div",{className:"p-a at-5 ar-5 z-10"}).update(MM.ui.icon({name:"opener",size:12})),this.imagePreview=new Element("img",{className:"h-hidden"}),this.content.insert(this.opener).insert(this.label),this.content.insert(this.imagePreview),this.element=new Element("div",{class:"slide h-cp"}).insert(this.content),this.element.setStyle({backgroundColor:"#"+App.config.mapTheme.background.color}),this.element.listener=this,App.config.editable&&(Event.observe(this.element,"click",this.select.bindAsEventListener(this,!0)),Event.observe(this.element,"contextmenu",this.showMenu.bindAsEventListener(this)),Event.observe(this.opener,"click",this.showMenu.bindAsEventListener(this)))},save:function($super){this.rectangle&&this.updatePreview(),$super({onFailure:this.remove.bind(this)})},buildUI:function($super,useEffect){$super(useEffect),this.show()},copy:function(){var slide=new App.ui.VSlide({transition:this.transition,padding:this.padding,nodes:this.nodes});return slide.selection=this.selection,slide},select:function(event,scroll){if(event&&event.shiftKey){var slide=App.ui.SlideShow.selectedSlide;if(parseInt(slide.element.id.replace("mmslide_",""))<this.element.id.replace("mmslide_",""))for(;slide&&slide.next&&slide.next!=this;)slide=slide.next,slide.onSelect();else for(;slide&&slide.prev&&slide.prev!=this;)slide=slide.prev,slide.onSelect()}else if(event&&(event.metaKey||event.ctrlKey)){if(this.isSelected()&&App.ui.SlideShow.selected.length>1)return void this.deselect(event)}else App.ui.SlideShow.selected.each(function(slide){slide.deselect()}),App.ui.SlideShow.selected=[];this.onSelect(),App.ui.SlideShow.selectedSlide=this,this.selection&&App.ui.SlideShow.selectionsVisible&&scroll&&canvas.centerOnElement(this.selection.selArea),event&&event.preventDefault()},onSelect:function(){if(!this.isSelected()){App.ui.SlideShow.selectionsVisible&&this.nodes.detect(function(node){return!node.isVisible()})&&(this.nodes.each(function(node){node._listener.makeVisible()}),this.buildUI(),App.ui.SlideShow.updateLabels()),App.ui.SlideShow.selected.push(this),App.trigger(CustomEvents.SELECTED_SLIDE,{slide:this}),this.element.addClassName("selected"),this.selection&&this.selection.select();var listParent=App.ui.SlideShow.element.parentNode,slideWidth=App.ui.SlideShow.element.clientWidth/App.ui.SlideShow.list.length,slideOffset=Math.round(slideWidth*App.ui.SlideShow.list.indexOf(this))+20;listParent.scrollLeft<=slideOffset&&slideOffset<=listParent.scrollLeft+listParent.clientWidth-slideWidth||(listParent.scrollLeft<slideOffset?listParent.scrollLeft=slideOffset:listParent.scrollLeft=slideOffset-listParent.clientWidth+slideWidth)}},isSelected:function(){return this.element.hasClassName("selected")},deselect:function(event){App.ui.SlideShow.selectedSlide===this&&(App.ui.SlideShow.selectedSlide=null),App.ui.SlideShow.selected=App.ui.SlideShow.selected.without(this),this.element.removeClassName("selected"),this.selection&&this.selection.deselect(),canvas.closeTemporarilyOpen(),this.selection&&!this.nodes.detect(function(node){return node.isVisible()})&&(this.selection.remove(),this.selection=null),event&&"object"===(void 0===event?"undefined":_typeof(event))&&Event.stop(event)},remove:function(){CSS.set(this.element,{transform:CSS.scale(.01),transition:"all 500ms ease"}),setTimeout(function(){this.element.remove(),this.selection.remove(),this.selection=null}.bind(this),500)},show:function(){this.element.show()},showMenu:function(e){Event.stop(e);var el=e.findElement();this.select();var _App$ui$SlideShow=App.ui.SlideShow,popover=_App$ui$SlideShow.popover;_App$ui$SlideShow.selectedSlide.id===this.id&&popover.visible&&popover.opener===el||(popover.opener=el,popover.show())},onStartDrag:function(){canvas.disableScrollByDrag(),this.markedNodes=this.nodes,this.markNodes(this.markedNodes)},onDrag:function(selection){if(canvas.disableScrollByDrag(),this.unMarkNodes(this.markedNodes),selection.areaCoords){var rectangle=new Rectangle(new Point(selection.areaCoords.x1,selection.areaCoords.y1),new Point(selection.areaCoords.x2,selection.areaCoords.y2));this.markedNodes=canvas.getNodesFromRectangle(rectangle)}this.markNodes(this.markedNodes)},onEndDrag:function(selection){if(canvas.enableScrollByDrag(),this.unMarkNodes(this.markedNodes),this.markedNodes=null,selection=selection||this.selection){var oldNodes=this.nodes;if(this.updateNodes(selection.areaCoords),this.nodes=this.nodes.reject(function(node){return node.id<0}),0===this.nodes.length)return Message.show(I18n.t("js.slideshow_no_nodes_error"),Message.INFO),void(this.selection?(this.nodes=oldNodes,this.buildUI(),App.ui.SlideShow.updateLabels(),this.isSelected()&&this.selection.select()):selection.remove());var rectangle1=this.nodes[0]._listener.dcontent.el.toRectangle();this.nodes.each(function(node){var rectangle=node._listener.dcontent.el.toRectangle();rectangle1=Rectangle.max(rectangle1,rectangle)});var coords=selection.areaCoords,rectangle=new Rectangle(new Point(coords.x1,coords.y1),new Point(coords.x2,coords.y2)),bigRectangle=Rectangle.max(rectangle1,rectangle);this.padding={top:Math.abs(bigRectangle.p1.y-rectangle1.p1.y),right:Math.abs(bigRectangle.p2.x-rectangle1.p2.x),bottom:Math.abs(bigRectangle.p2.y-rectangle1.p2.y),left:Math.abs(bigRectangle.p1.x-rectangle1.p1.x)},this.setRectangle();var newCoords={x1:bigRectangle.p1.x,y1:bigRectangle.p1.y,x2:bigRectangle.p2.x,y2:bigRectangle.p2.y};selection.setAreaCoords(newCoords,!1,!1,1),selection.drawArea(),this.element.parentNode||App.ui.SlideShow.onEndDrag(this),this.select()}},updatePreview:function(){var _this=this,src=this.getPreviewImageSrc(App.ui.SlideShow.mapSize),onLoad=function(img){_this.imagePreview.src=img.src,removeClassName(_this.imagePreview,"h-hidden")};__WEBPACK_IMPORTED_MODULE_1_utils_imageQueue__.a.add({image:{src:src},onLoad:onLoad})},isInViewport:function(){var boundingClientRect=this.element.getBoundingClientRect();return boundingClientRect.left>0&&boundingClientRect.right<window.innerWidth},updateLabel:function(position){this.element.id="mmslide_"+(position+1),this.label.update(position+1),this.selection&&this.selection.updateLabel(position+1)},updateNodes:function(coords){if(this.unMarkNodes(),coords){var rectangle=new Rectangle(new Point(coords.x1,coords.y1),new Point(coords.x2,coords.y2));this.nodes=canvas.getNodesFromRectangle(rectangle),this.setRectangle()}},markNodes:function(nodes){nodes=nodes||this.nodes,nodes.each(function(node){addClassName(node._listener.dcontent.el,"drop_label")})},unMarkNodes:function(nodes){nodes=nodes||this.nodes,nodes.each(function(node){removeClassName(node._listener.dcontent.el,"drop_label")})},blurForCut:function(){Effect.Fade(this.element.id,{from:1,to:.5})},unblurForCut:function(){Effect.Fade(this.element.id,{from:.5,to:1})},defaultSelectionOptions:function(){return{listener:this,onStartDrag:this.onStartDrag.bind(this),onDrag:this.onDrag.bind(this),onEndDrag:this.onEndDrag.bind(this),onUpdate:this.save.bind(this),captureKeys:!1}}}),Object.extend(App.ui.Slide,__WEBPACK_IMPORTED_MODULE_0_models_linkedList__.a.Node)},HTWB:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_models_ideaVideo__=__webpack_require__("Kh9o"),__WEBPACK_IMPORTED_MODULE_1__searchWrapper__=__webpack_require__("wvK4"),__WEBPACK_IMPORTED_MODULE_2__skoletube_videos_search__=__webpack_require__("i5N/"),YoutubeSearch=Class.create({loaded:!1,initialize:function(options){this.options=options||{}},load:function(callback){MM.utils.loadScript("https://apis.google.com/js/client.js",function(){setTimeout(function(){if(void 0===gapi.client)return void this.load(callback);gapi.client.load("youtube","v3",callback),this.loaded=!0}.bind(this),500)}.bind(this))},query:function(_query,options){this.loaded?this.doSearch(_query,options):this.load(this.doSearch.bind(this,_query,options))},queryVideoDetails:function(query,options){options=Object.extend({details:!0},options),this.query(query,options)},doSearch:function(query,options){if(options=Object.extend({per_page:10},options),gapi.client.setApiKey(ServerData.keys.googleOauth),options.details)var request=gapi.client.youtube.videos.list({part:"snippet",id:query,fields:"items/snippet/title"});else{this.queryText=query.toLowerCase();var request=gapi.client.youtube.search.list({part:"snippet",type:"video",maxResults:options.per_page,fields:"items(id, snippet)",q:this.queryText})}request.execute(function(response){response&&response.items?options.onComplete(response.items.map(function(item){return{id:item.id?item.id.videoId:"",url:item.id?item.id.videoId:"",title:item.snippet.title}})):options.onComplete([])})}}),VimeoSearch=Class.create({api_url:"https://api.vimeo.com/videos?",api_detail_url:"https://vimeo.com/api/oembed.json?url=https://vimeo.com/",initialize:function(options){this.options=options||{}},createRequest:function(url,headers,options){var xhr=new XMLHttpRequest;xhr.open("GET",url,!0),headers&&(xhr.setRequestHeader("Authorization","bearer "+ServerData.keys.vimeo),xhr.setRequestHeader("Accept","application/vnd.vimeo.*+json;version=3.2"),xhr.setRequestHeader("Content-Type","application/json")),xhr.onreadystatechange=function(request){return function(){if(4===request.readyState&&200===request.status){var response=JSON.parse(request.responseText);response.data?options.onComplete&&options.onComplete(response.data.map(function(video){return{id:video.uri.replace("/videos/",""),url:video.uri.replace("/videos/",""),title:video.name}})):options.onComplete([response])}}}(xhr),xhr.send()},query:function(_query2,options){this.queryText=_query2.toLowerCase();var parameters=Object.toQueryString(Object.extend({query:_query2,page:1,per_page:10},options)),url=this.api_url+parameters.toLowerCase();this.createRequest(url,!0,options)},queryVideoDetails:function(query,options){this.createRequest(this.api_detail_url+query,!1,options)}}),DailymotionSearch=Class.create({initialize:function(options){this.options=options||{}},createRequest:function(id,params){var data=mm$(id);data&&document.body.removeChild(data),data=new Element("script",{id:id,src:"https://api.dailymotion.com/"+params}),document.body.appendChild(data)},query:function(_query3,options){window.dailymotionCallback=this.showSearchResult.bind(this);var parameter={limit:options.per_page||10,personal:0,private:0,search:_query3},params="videos?fields=id,title&"+Object.toQueryString(parameter)+"&callback=dailymotionCallback";this.createRequest("dailymotion_script",params),this.queryText=_query3.toLowerCase(),this.callback&&this.callback==options.onComplete||(this.callback=options.onComplete)},queryVideoDetails:function(query,options){window.dailymotionCallback=this.showSearchResult.bind(this);var params="video/"+query+"?fields=";options.fields.each(function(field){params+=field+","}),this.createRequest("dailymotion_script",params+"&callback=dailymotionCallback"),this.callback&&this.callback==options.onComplete||(this.callback=options.onComplete)},showSearchResult:function(response){if(delete window.dailymotionCallback,this.callback)if(response.list){var results=response.list;this.callback(results.map(function(result){return{id:result.id,url:result.id,title:result.title}}))}else response.title?this.callback([{id:"",url:"",title:response.title}]):this.callback([])}}),VideoSearchWrapper=Class.create(__WEBPACK_IMPORTED_MODULE_1__searchWrapper__.default,{initialize:function($super,options){switch($super(options),this.options=Object.extend({type:"videos"},this.options),this.options.searcher){case"youtube":this.search=new YoutubeSearch,this.options.embedURL="//www.youtube.com/embed/";break;case"vimeo":this.search=new VimeoSearch,this.options.embedURL="//player.vimeo.com/video/";break;case"dailymotion":this.search=new DailymotionSearch,this.options.embedURL="//www.dailymotion.com/embed/video/";break;case"skoletube":this.search=new __WEBPACK_IMPORTED_MODULE_2__skoletube_videos_search__.default,this.options.embedURL="//www.skoletube.dk/e/"}},insertListElement:function(item,index){var list=mm$(this.options.searcher+"_"+this.options.type+"_container");if(list){var video=new __WEBPACK_IMPORTED_MODULE_0_app_models_ideaVideo__.default({url:this.options.embedURL+item.url,source:this.searcher,size:{width:320,height:200},title:item.title}),listElement=new Element("li",{className:"p5 very-rounded text-center"}),spinner=MM.ui.LoadingSpinner(48),el=video.getElement();addClassName(el,"mb5"),Event.observeOnce(el,"load",function(index,video,listElement,spinner){this.items[index]=video;var selector=new Element("div",{class:"icon-svg video_selector","data-icon":"checkmark",title:I18n.t("js.select_video")}),title=new Element("p").update(video.title.escapeHTML());spinner.remove(),listElement.appendChild(selector),listElement.appendChild(title),listElement.onclick=this.options.onItemSelect.curry(video),selector.onclick=this.options.onItemSelect.curry(video)}.bind(this,index,video,listElement,spinner)),listElement.appendChild(el),listElement.appendChild(spinner),list.appendChild(listElement)}},onNoResultsFound:function(){this.ui&&mm$(this.options.searcher+"_"+this.options.type+"_container").update(I18n.t("js.no_video_was_found"))},destroy:function(){this.search.items=[],this.search.queryText=null,this.ui=!1}});__webpack_exports__.default=VideoSearchWrapper},Hnr2:function(module,exports,__webpack_require__){function castArray(){if(!arguments.length)return[];var value=arguments[0];return isArray(value)?value:[value]}var isArray=__webpack_require__("zOp4");module.exports=castArray},HqoD:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_models_boundary__=__webpack_require__("qlsV"),__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vconnection__=__webpack_require__("xAzy"),__WEBPACK_IMPORTED_MODULE_2_app_models_ideaComment__=__webpack_require__("ZfKP"),__WEBPACK_IMPORTED_MODULE_3_app_models_ideaImage__=__webpack_require__("oMUV"),__WEBPACK_IMPORTED_MODULE_4_app_models_ideaVideo__=__webpack_require__("Kh9o"),__WEBPACK_IMPORTED_MODULE_5_app_models_task__=__webpack_require__("AGfX"),__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__=__webpack_require__("/dW8"),__WEBPACK_IMPORTED_MODULE_7_app_utils_constants__=__webpack_require__("67vC"),__WEBPACK_IMPORTED_MODULE_9_app_utils_videoHelpers__=(__webpack_require__("oxsE"),__webpack_require__("vu0f")),MapNode=Class.create({id:null,title:null,parent:null,children:null,closed:null,pos:null,icons:[],style:null,note:null,link:null,task:null,externalTask:null,_listener:null,hidden:null,modifiedAt:null,modifiedBy:null,attachments:null,idea_image:null,idea_video:null,comments:null,connections:null,outgoing_connections:null,initialize:function(data){if(this.id=data.id,this.children=[],this.title=data.title,this.closed=data.closed||!1,this.icons=[],data.icon){var icons=[];data.icon.split(",").each(function(iconString){var icon=Icon.fromFullName(iconString);icon&&icons.push(icon)}.bind(this)),this.icons=Icon.compactAndOrder(icons)}data.style&&(this.style=new Style(data.style)),this.note=data.note,this.link=data.link?data.link.escapeHTML():"",data.idea_video&&(this.idea_video=new __WEBPACK_IMPORTED_MODULE_4_app_models_ideaVideo__.default(Object.extend(data.idea_video,{idea_id:this.id}))),this.getTaskObject(data.task),this.externalTask=data.externalTask,this.pos=data.pos,this.modifiedAt=data.modifiedAt?new Date(data.modifiedAt):new Date,this.modifiedBy=data.modifiedBy,this.attachments=[],this.idea_image=null,this.connections=[],this.outgoing_connections=[],this.ideaProperty=data.ideaProperty,data.boundary&&(this.boundary=new __WEBPACK_IMPORTED_MODULE_0_app_models_boundary__.default(Object.extend(data.boundary)),this.boundary.node=this),tree.nodes[data.id]=this,this.votes=[],data.votes&&data.votes.each(function(vote){this.votes.push(new IdeaVote(vote)),-1===IdeaVote.nodesWithVotes.indexOf(this)&&IdeaVote.nodesWithVotes.push(this)}.bind(this)),this.comments=[],data.comments&&data.comments.each(function(comment){this.comments.push(new __WEBPACK_IMPORTED_MODULE_2_app_models_ideaComment__.default(comment))}.bind(this))},defaultStyle:function(){if(!App.config.mapTheme)return null;return this.isRoot()?Object.clone(App.config.mapTheme.root_style):this.parent.isRoot()?Object.clone(App.config.mapTheme.root_children_style):Object.clone(App.config.mapTheme.nodes_style)},currentStyle:function(){return this.style?this.style:this.defaultStyle()},__onAddChild:function(child,rank,uid,param,wasTemporarilyRemoved){return child.parent=this,child.hidden=!1,"number"==typeof rank&&rank>=0?this.children.insert(child,rank):this.children[this.children.length]=child,!!this._listener.__onAddChild(child._listener,this.rank(child),tree.notPainted,uid,param,wasTemporarilyRemoved)||(this.children.remove(child),!1)},addChild:function(position,rank,style,floating){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();this.closed&&this.toggleClosed();var newId=tree.uncommitedId,chL=new ChangeList;if(chL.changes.push(new InsertChange({idea_id:this.id,new_data:{id:newId,parent:this.id,title:tree.default_title,style:null,pos:position||null,rank:null!==rank?rank:this.children.length,closed:!1}})),floating&&chL.changes.push(new IdeaPropertiesChange({idea_id:newId,type:"IdeaProperties",new_data:{floating:!0}})),style&&chL.changes.push(new TextStyleChange({idea_id:newId,type:"TextStyle",new_data:{style:style.toJSON()}})),chL.execute()){var child=this.getChild(newId);return mapView.hasMapFeature("graphics")&&App.config.editable&&App.config.currentlyEditable&&child._listener.dcontent.toEditing(null,null!==rank?"insert-sibling":"insert"),child}return null},addChildren:function(nodes){this.closed&&this.toggleClosed();for(var changes=[],i=0;i<nodes.length;i++){var escapedTitle=this.escapeTitle(nodes[i].title);if(nodes[i].id)changes.push(new RenameChange({idea_id:nodes[i].id,type:"Title",new_data:{title:escapedTitle}}));else{var newId=--tree.uncommitedId,new_data={id:newId,parent:this.id,title:escapedTitle,style:null};nodes[i].link&&Object.extend(new_data,{link:nodes[i].link}),nodes[i].note&&Object.extend(new_data,{note:nodes[i].note}),nodes[i].video&&Object.extend(new_data,{video:nodes[i].video});var change=new InsertChange({idea_id:newId,type:"Insert",new_data:new_data});changes.push(change)}}ChangeList.layoutAlteringChangeset(changes)},__onRemoveChild:function(child,uid,mode){mode=mode||"definitive",this.children.remove(child),"definitive"===mode&&(mapView.hasMapFeature("graphics")&&child.__onRemoveAllConnections(),tree.nodes[child.id]=null),child.hidden||(this._listener.__onRemoveChild(child._listener,uid,mode),child.hidden=!0,child.parent=null,mapView.hasMapFeature("graphics")&&App.config.layout.elasticLayout&&ChangeList.elasticLayoutChangeset(rectangleLayouter.remove(child)))},__onShowChild:function(child){return!(!child.hidden||!this.isInMapStructure())&&(child.hidden=!1,this._listener.__onAddChild(child._listener,this.rank(child),null),rectangleLayouter.update(this),!0)},__onHideChild:function(child,mode){return mode=mode||"definitive",!(child.hidden||!this.children.include(child))&&(child.hidden=!0,this._listener.__onRemoveChild(child._listener,null,mode),!mapView.hasMapFeature("graphics")||("temporary"!=mode&&App.config.layout.elasticLayout&&ChangeList.elasticLayoutChangeset(rectangleLayouter.remove(child)),rectangleLayouter.update(this),!0))},removeChild:function(child){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();var change=new RemoveChange({idea_id:child.id,type:"Delete"});change.executeLocally(),ServerConnection.doChange(change)},toggleAllClosed:function(nonPersistent){for(var node=this;node.parent;)node=node.parent,node.closed&&node.toggleClosed(nonPersistent)},toggleClosed:function(nonPersistent){this.isRoot()||(this.closed=!this.closed,this._listener.__onToggleClosed(),App.config.persistent&&!nonPersistent&&users.selfUser&&ServerConnection.toggleClosed({ids:[this.id]}))},toggleClosedDetail:function(level){var ids=[],parentDepth=this.depth();this.eachChild(function(node){var depth=node.depth()-parentDepth;(node.closed&&level>depth||!node.closed&&level==depth&&node.hasChildren())&&(ids.push(node.id),node.closed=!node.closed,node._listener.__onToggleClosed(),rectangleLayouter.update(node))},!1),App.config.persistent&&ServerConnection.toggleClosed({ids:ids})},__onReposition:function(newPos,uid,nonPersistent){return nonPersistent||this.touch(uid),this.pos=newPos,this._listener.__onReposition(uid),!0},__onMove:function(newParent,rank,uid,position,isTemporary){if(this.touch(uid),uid)var param={moveClone:this.cloneWithPosition(this._listener.dcontainer.el)};return this.parent.__onRemoveChild(this,null,isTemporary?"temporary":"move"),position&&(this.pos=position),newParent.__onAddChild(this,rank,uid,param||[],!0),newParent.isRoot()?(uid||rectangleLayouter.update(this),mapView.hasMapFeature("graphics")&&this._listener.rc.paint()):uid||rectangleLayouter.update(newParent),!0},__onRename:function(title,uid){return this.touch(uid),this.title=title,this._listener.__onRename(uid),!0},rename:function(title,off){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(!title.match(/^\s*$/)&&title!==this.title){var chL=new ChangeList;if(this.isRootC()&&off&&App.config.layout.elasticLayout){var reposition=new RepositionChange({idea_id:this.id,type:"Reposition",old_data:{pos:this.pos},new_data:{pos:Math.offset(this.pos,off)}});reposition.execute(),chL.changes.push(reposition)}title=this.escapeTitle(title),chL.changes.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.getRawTitle()},new_data:{id:this.id,title:title}})),this.__onRename(title),App.config.layout.elasticLayout&&chL.doNodeLayoutingChanges(this),ServerConnection.doChanges(chL),this.isRoot()&&App.trigger(CustomEvents.ROOT_RENAMED)}},insertRename:function(title,off,floating,sibling){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();title=this.escapeTitle(title),this.__onRename(title),this.pos&&off&&App.config.layout.elasticLayout&&this.__onReposition([this.pos[0]+off[0],this.pos[1]+off[1]]);var chL=new ChangeList;chL.changes.push(new InsertChange({idea_id:this.id,type:"Insert",new_data:{id:this.id,parent:this.parent.id,title:title,style:null,pos:this.pos,closed:this.closed,rank:this.parent.rank(this)}})),floating&&chL.changes.push(new IdeaPropertiesChange({idea_id:this.id,type:"IdeaProperties",new_data:{floating:!0}})),this.style&&chL.changes.push(new TextStyleChange({idea_id:this.id,type:"TextStyle",new_data:{style:this.style.toJSON()}})),App.config.layout.elasticLayout&&chL.doNodeLayoutingChanges(chL.changes.first().node()),ServerConnection.doChanges(chL),App.trigger(CustomEvents.TOPIC_INSERTED),sibling&&App.trigger(CustomEvents.SIBLING_ADDED)},generateThumb:function(url){var _this=this,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(options.onError||(options.onError=function(){return!0}),options.onSuccess||(options.onError=function(){return!0}),!(this.link||this.idea_image||this.idea_video)){this._listener.setLoadingOnDrop();var testImage=new Image;testImage.src="/images/download_url?url="+url,testImage.onload=function(){_this.generateImageThumb(url,{onError:options.onError,onSuccess:options.onSuccess})},testImage.onerror=function(){new Ajax.Request("/maps/expand_link/",{parameters:{link:url},onSuccess:function(transport){var response=transport.responseJSON;if(response.url){var videoLink=Object(__WEBPACK_IMPORTED_MODULE_9_app_utils_videoHelpers__.checkLink)(response.url);videoLink.video&&videoLink.source?(_this.generateVideoThumb(videoLink,url,response),options.onSuccess()):(_this.generateWebsiteThumb(url,response),options.onSuccess())}else _this._listener.removeLoadingFromDrop()},onFailure:function(){options.onError(),_this._listener.removeLoadingFromDrop()}})}}},generateVideoThumb:function(videoLink,url,response){var changes=[],title=response.title,link=response.url,video=new __WEBPACK_IMPORTED_MODULE_4_app_models_ideaVideo__.default({url:__WEBPACK_IMPORTED_MODULE_9_app_utils_videoHelpers__.embeddedURLs[videoLink.source]+videoLink.video,source:videoLink.source,size:{width:480,height:272}});changes.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.title},new_data:{title:this.title.replace(url,title)}})),changes.push(new AddVideoChange({idea_id:this.id,type:"AddVideo",new_data:video.toJSON()})),changes.push(new LinkChange({idea_id:this.id,type:"Link",old_data:{link:this.link},new_data:{link:link}})),ChangeList.layoutAlteringChangeset(changes),this._listener.removeLoadingFromDrop()},generateImageThumb:function(url){var options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};options.onError||(options.onError=function(){return!0}),options.onSuccess||(options.onError=function(){return!0});var params={def_image_id:"",idea_image_url:url};MM.utils.File.uploadImage([this],params,{successCallback:function(file,targets){Tree.utils.setImage(new __WEBPACK_IMPORTED_MODULE_3_app_models_ideaImage__.default(file),targets),options.onSuccess()},errorCallback:function(){options.onError(),this._listener.removeLoadingFromDrop()}})},generateWebsiteThumb:function(url,response){var _this2=this,title=response.title,link=response.url,changes=[];if(title.length>0&&changes.push(new RenameChange({idea_id:this.id,type:"Title",old_data:{title:this.title},new_data:{title:this.title.replace(url,title)}})),changes.push(new LinkChange({idea_id:this.id,type:"Link",old_data:{link:this.link},new_data:{link:link}})),!response.images[0])return ChangeList.layoutAlteringChangeset(changes),void this._listener.removeLoadingFromDrop();MM.utils.File.uploadImage([this],{idea_image_url:response.images[0].src},{successCallback:function(file){var image=new __WEBPACK_IMPORTED_MODULE_3_app_models_ideaImage__.default(file);changes.push(new AddImageChange({idea_id:_this2.id,type:"AddImage",new_data:{idea_image_id:image.id,details:{url:image.download_link,size:[500,300]}},old_data:{idea_image_id:_this2.idea_image?_this2.idea_image.id:null}})),ChangeList.layoutAlteringChangeset(changes)},errorCallback:function(){ChangeList.layoutAlteringChangeset(changes),Message.show(I18n.t("your_request_was_not_done"),Message.ERROR)}})},commitEdit:function(newTitle,off,action,floating){var _this3=this,commitAction=function(){"insert"===action||"insert-sibling"===action?_this3.insertRename(newTitle,off,floating,"insert-sibling"===action):_this3.rename(newTitle,off)};ServerConnection.canQueueDoRequests()?commitAction():ServerConnection.registerPendingCode(commitAction)},__onSetIcon:function(icon,uid){if(icon||(icon=[]),this.touch(uid),icon&&"string"==typeof icon){var icons=[];icon.split(",").each(function(iconString){var icon=Icon.fromFullName(iconString);icon&&icons.push(icon)}.bind(this)),this.icons=Icon.compactAndOrder(icons)}else this.icons=[];return this.updateTaskFromIcons(this.icons),this._listener.__onSetIcon(!1,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetStyle:function(style,uid){return this.touch(uid),this.style=style,this._listener.__onSetStyle(tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetProperty:function(key,value,uid){switch(this.touch(uid),this[key]=value,key){case"task":this.getTaskObject(value),this._listener.__onSetProperty("task",tree.notPainted,uid),this._listener.__onSetProperty("externalTask",tree.notPainted,uid);break;case"link":this.link=this.link?this.link.escapeHTML():"",this._listener.__onSetProperty("link",tree.notPainted,uid);break;default:this._listener.__onSetProperty(key,tree.notPainted,uid)}return mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onSetIdeaProperty:function(ideaProperty,uid){return this.touch(uid),this.ideaProperty=ideaProperty,this._listener.__onSetIdeaProperty(tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddAttachment:function(attachment,uid){this.touch(uid),this.attachments.push(attachment),1==this.attachments.length&&this._listener.__onSetProperty("attachments",tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},addAttachment:function(attachment){ChangeList.layoutAlteringChangeset([new AddAttachmentChange({idea_id:this.id,type:"AddAttachment",new_data:{attachment_id:attachment.id}})])},__onRemoveAttachment:function(attachment,uid){this.touch(uid),this.attachments.remove(attachment),this._listener.__onSetProperty("attachments",!1,uid),0==this.attachments.length&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},removeAttachment:function(attachment){ChangeList.layoutAlteringChangeset([new RemoveAttachmentChange({idea_id:this.id,type:"RemoveAttachment",old_data:{attachment_id:attachment.id}})])},__onAddComment:function(comment,uid){this.touch(uid),this.comments.push(comment),this._listener.__onSetProperty("comments",tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},__onRemoveComment:function(comment,uid){this.touch(uid),this.comments.remove(comment),this._listener.__onSetProperty("comments",!1,uid),0===this.comments.length&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this)},removeComment:function(comment){ChangeList.layoutAlteringChangeset([new RemoveCommentChange({idea_id:this.id,type:"RemoveComment",old_data:{idea_comment_id:comment.id}})])},editComment:function(comment){ChangeList.layoutAlteringChangeset([new EditCommentChange({idea_id:this.id,type:"EditComment",new_data:{idea_comment_id:comment.id,text:comment.text}})])},__onAddVote:function(vote,uid){return this.touch(uid),this.votes.push(vote),-1===IdeaVote.nodesWithVotes.indexOf(this)&&IdeaVote.nodesWithVotes.push(this),IdeaVote.updateAll(this),this._listener.__onSetProperty("votes",tree.notPainted,uid),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onEditVote:function(vote,uid){return this._listener.__onSetProperty("votes",!1,uid),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onRemoveVote:function(vote,uid){return this.touch(uid),vote&&this.votes.remove(vote),0===this.votes.length?IdeaVote.nodesWithVotes.remove(this):IdeaVote.updateAll(this),this._listener.__onSetProperty("votes",!1,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddVideo:function(video,uid){return this.touch(uid),this.idea_video=video,this._listener.__onSetProperty("video",tree.notPainted,uid),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onRemoveVideo:function(uid){return this.touch(uid),this.idea_video=null,this._listener.__onSetProperty("video",tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},__onAddImage:function(uid){return this.touch(uid),this._listener.__onSetProperty("image",tree.notPainted,uid),!tree.notPainted&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},removeImage:function(){ChangeList.layoutAlteringChangeset([new RemoveImageChange({idea_id:this.id,type:"RemoveImage",old_data:{idea_image_id:this.idea_image.id}})])},__onRemoveImage:function(image,uid){return this.touch(uid),this.idea_image=null,this._listener.__onSetProperty("image",tree.notPainted,uid),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0},addBoundary:function(data){ChangeList.layoutAlteringChangeset([new AddBoundaryChange({idea_id:this.id,type:"AddBoundary",new_data:data})])},__onAddBoundary:function(){this.boundary&&this._listener.__onAddBoundary()},removeBoundary:function(){this.boundary&&ChangeList.layoutAlteringChangeset([new RemoveBoundaryChange({idea_id:this.id,type:"RemoveBoundary",old_data:this.boundary.toJSON()})])},__onRemoveBoundary:function(){this.boundary&&this.boundary.destroy(),this.boundary=null,this._listener.__onRemoveBoundary()},editBoundary:function(data){this.boundary?ChangeList.layoutAlteringChangeset([new EditBoundaryChange({idea_id:this.id,type:"EditBoundary",new_data:data,old_data:this.boundary.toJSON()})]):this.addBoundary(data)},resizeImage:function(image,width,height){ChangeList.layoutAlteringChangeset([new ResizeImageChange({idea_id:this.id,type:"ResizeImage",new_data:{idea_image_id:image.id,width:width,height:height},old_data:{idea_image_id:image.id,width:this.idea_image.width(),height:this.idea_image.height()}})])},__onResizeImage:function(image,uid){return this.touch(uid),this.idea_image.equals(image)?(this._listener.__onResizeImage(uid),this._listener.image.onSelect(),mapView.hasMapFeature("graphics")&&rectangleLayouter.update(this),!0):Message.show(I18n.t("js.image_does_not_match"),Message.ERROR,5)},__onAddConnection:function(connection,uid){return this.touch(uid),this.connections.push(connection),this.outgoing_connections.push(connection),connection.to.connections.push(connection),this._listener.__onAddConnection(connection),!0},__onRemoveConnection:function(connection,uid){return this.touch(uid),this._listener.__onRemoveConnection(connection),!!connection&&(connection.destroy(),!0)},__onRemoveAllConnections:function(){for(var i=this.connections.length-1;i>=0;i--)this.__onRemoveConnection(this.connections[i]);for(i=0;i<this.children.length;i++)this.children[i].__onRemoveAllConnections()},connectTo:function(node){var chL=new ChangeList,conn=__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__.default.get(node.id,this.id);conn&&chL.changes.push(new RemoveConnectionChange({idea_id:node.id,type:"RemoveConnection",old_data:{from_id:node.id,to_id:this.id,color:conn.color||__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vconnection__.DEFAULT_COLOR}})),chL.changes.push(new AddConnectionChange({idea_id:this.id,type:"AddConnection",new_data:{from_id:this.id,to_id:node.id,color:__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vconnection__.DEFAULT_COLOR}})),chL.execute(),ServerConnection.doChanges(chL)},disconnectFrom:function(node){var chL=new ChangeList,conn=__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__.default.get(this.id,node.id);chL.changes.push(new RemoveConnectionChange({idea_id:this.id,type:"RemoveConnection",old_data:{from_id:this.id,to_id:node.id,color:conn.color||__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vconnection__.DEFAULT_COLOR}})),chL.execute(),ServerConnection.doChanges(chL)},getLinkObj:function(){var m=this.link.match(/^([^:]+):[\/]*(.*)$/);if(m){var linkType;switch(m[1]){case"mailto":linkType="email";break;case"topic":linkType="topic";break;default:linkType="url"}return{protocol:m[1],link:m[2],type:linkType}}return{type:"url"}},getLinkRel:function(_ref){var _ref$link=_ref.link;return/(mindmeister|meistertask).com/i.test(void 0===_ref$link?"":_ref$link)?"noopener":"nofollow noopener"},touch:function(uid){uid?(this.modifiedBy=uid,this.modifiedAt=new Date):"undefined"!=typeof RevisionBrowser&&RevisionBrowser.on||(this.modifiedBy=users&&users.selfUser?users.selfUser[0]:null,this.modifiedAt=new Date),this._listener.dcontent&&this._listener.dcontent.setHoverTitle()},changeId:function(new_id){this._listener.__onChangeId(this.id,new_id),tree.nodes[new_id]=tree.nodes[this.id],tree.nodes[this.id]=null,this.id=new_id},changeImageId:function(image_id){if(this.idea_image){if(!__WEBPACK_IMPORTED_MODULE_3_app_models_ideaImage__.default.get(image_id)){var image=Object.clone(this.idea_image);image.id=image_id,__WEBPACK_IMPORTED_MODULE_3_app_models_ideaImage__.default.all[image_id]=image,this.idea_image=image,this.__onAddImage()}}},normalizeWhitespaces:function(value){return value.replace(new RegExp(String.fromCharCode(160),"g")," ")},replaceLineBreaksWithHTML:function(title){return title.replace(/\n/gi,"<br/>").replace(/\r/gi,'<br class="js-automatic-break ">')},getTitle:function(noBreaks){var ret=this.normalizeWhitespaces(this.title);return noBreaks||(ret=this.replaceLineBreaksWithHTML(ret)),ret},getTitleWithLinks:function(noBreaks){return this.getTitle(noBreaks).toLink()},getRawTitle:function(){return this.title.safeUnescapeHTML()},escapeTitle:function(title){return(title.match(/^\s*$/)?"":title).escapeHTML()},getSingleLineTitle:function(){return this.getRawTitle().replace(/[\n\r]/gi," ")},getTaskObject:function(task,skip_icons){task?(this.task=new __WEBPACK_IMPORTED_MODULE_5_app_models_task__.default(task),this.task.empty()&&(this.task=null)):(this.task=null,this.externalTask=null),skip_icons||this.updateTaskFromIcons(this.icons)},updateTaskFromIcons:function(icons){this.task||(this.task=new __WEBPACK_IMPORTED_MODULE_5_app_models_task__.default({}));var priorityIcon=icons.detect(function(icon){return"priority"===icon.group()});this.task.priority=priorityIcon?__WEBPACK_IMPORTED_MODULE_7_app_utils_constants__.TASK.priority.indexOf(priorityIcon.id):-1;var taskIcon=icons.detect(function(icon){return"task"===icon.group()});this.task.complete=taskIcon?__WEBPACK_IMPORTED_MODULE_7_app_utils_constants__.TASK.complete.indexOf(taskIcon.id):-1,this.task.empty()&&(this.task=null)},setTaskNotify:function(value){ServerConnection.setTaskNotify(this.id,value)},hasChildren:function(){return this.children.any(function(c){return!c.hidden})},numChildren:function(){return this.children.count(function(c){return!c.hidden})},countTotalChildren:function(){for(var count=0,i=0;i<this.children.length;i++)count+=this.children[i].countTotalChildren();return 1+count},isChild:function(node){return!!this.parent&&(this.parent==node||this.parent.isChild(node))},isChildOrSelf:function(node){return node==this||!!this.parent&&this.parent.isChildOrSelf(node)},isRoot:function(){return null==this.parent},isRootC:function(){return this.parent&&this.parent.isRoot()},getRootC:function(){return this.isRoot()?null:this.ancestor(this.depth()-1)},rank:function(node){return this.indexOf(node)},indexOf:function(node){return this.children.indexOf(node)},depth:function(){return this.parent?1+this.parent.depth():0},ancestor:function(rank){return 0==rank?this:this.parent?this.parent.ancestor(rank-1):null},getAncestors:function(){var anc=[];return this.parent&&(anc=this.parent.getAncestors(),anc.push(this.parent)),anc},equals:function(node){return this.id==node.id},getChildRecursive:function(id){if(id===this.id)return this;for(var i=0;i<this.children.length;i++){var found=this.children[i].getChild(id);if(found)return found}return null},getChild:function(id){var n=tree.nodes[id];return n||(tree.nodes[id]=this.getChildRecursive(id))},isVisible:function(){return!this.hidden&&this.getAncestors().all(function(a){return!a.hidden&&!a.closed})},isFloating:function(){return this.ideaProperty&&this.ideaProperty.floating},getVisibleChild:function(id){var c=this.getChild(id);return c&&c.isVisible()?c:null},isInMapStructure:function(){return this===tree.root||this.getAncestors().include(tree.root)},getVisibleParent:function(){return this.isVisible()?this:this.parent.getVisibleParent()},getVisibleChildren:function(){for(var visibleChildren=[],i=0;i<this.children.length;i++)this.children[i].isVisible()&&visibleChildren.push(this.children[i]);return visibleChildren},getChildByTitle:function(title){if(title===this.title)return this;for(var i=0;i<this.children.length;i++){var found=this.children[i].getChildByTitle(title);if(found)return found}return null},getMiddleChild:function(){if(this.closed||!this.hasChildren())return null;var idx,children=this.getVisibleChildren();return idx=children.length%2==0?children.length/2-1:parseInt(children.length/2),children[idx]},getNextSibling:function(){if(this.isRootC())return tree.root._listener.getNextSibling(this._listener);var rank=this.parent?this.parent.children.indexOf(this):-1;if(-1===rank)return null;for(;++rank<this.parent.children.length&&this.parent.children[rank].hidden;);return rank>=this.parent.children.length?null:this.parent.children[rank]},getPrevSibling:function(){if(this.isRootC())return tree.root._listener.getPrevSibling(this._listener);var rank=this.parent?this.parent.children.indexOf(this):-1;if(-1===rank)return null;for(;--rank>=0&&this.parent.children[rank].hidden;);return rank<0?null:this.parent.children[rank]},getNextSiblingExtended:function(customDepth){for(var prevBranch,ancestorRank=0,depth=this.depth(),ancestor=null,depthDifference=customDepth?customDepth-depth:0;depth-ancestorRank>0;){if(ancestor=this.ancestor(ancestorRank),prevBranch=ancestor.getNextSibling())return prevBranch.getTopChild(ancestorRank+depthDifference);ancestorRank+=1}return null},getPrevSiblingExtended:function(customDepth){for(var prevBranch,ancestorRank=0,depth=this.depth(),ancestor=null,depthDifference=customDepth?customDepth-depth:0;depth-ancestorRank>0;){if(ancestor=this.ancestor(ancestorRank),prevBranch=ancestor.getPrevSibling())return prevBranch.getBottomChild(ancestorRank+depthDifference);ancestorRank+=1}return null},getTopChild:function(depth){return this.children&&this.children.length>0&&depth>0?this.children.first().getTopChild(depth-1):this},getBottomChild:function(depth){return this.children&&this.children.length>0&&depth>0?this.children.last().getBottomChild(depth-1):this},doBreadthFirstTraversal:function(callback){for(var queue=[this];queue.length>0;){var node=queue.shift();callback(node),node.children.each(function(child){queue.push(child)})}},cloneWithPosition:function(el){for(var clone=el.cloneNode(!0),elements=this.getElementsByClassName(clone,"tk_label"),i=0,len=elements.length;i<len;i++)elements[i].style.color="#ccc";Position.absolutize(clone);var oldpos=el.cumulativeOffset();return clone.style.left=oldpos[0]+"px",clone.style.top=oldpos[1]-35+"px",clone},getElementsByClassName:function(node,classname){for(var a=[],re=new RegExp("\\b"+classname+"\\b"),els=node.getElementsByTagName("*"),i=0,j=els.length;i<j;i++)re.test(els[i].className)&&a.push(els[i]);return a},eachChild:function(iterator,params){for(var paramsChildren=iterator(this,params),i=0;i<this.children.length;i++)this.children[i].eachChild(iterator,paramsChildren)},detect:function(iterator){var result;return this.eachChild(function(node){if(iterator(node))throw result=node,$break}),result},eachChildWithoutSelf:function(iterator,param){for(var i=0;i<this.children.length;i++)this.children[i].eachChild(iterator,param)},destroy:function(){for(var i=0,len=this.children.length;i<len;i++)this.children[i].destroy();for(i=0,len=this.connections.length;i<len;i++)this.connections[i]&&this.connections[i].destroy();this._listener=null,this.parent=null,this.children=null}});__webpack_exports__.default=MapNode},InUJ:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0__tabNode__=__webpack_require__("yiO2"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Tabs=function(_React$Component){function Tabs(props){_classCallCheck(this,Tabs);var _this=_possibleConstructorReturn(this,(Tabs.__proto__||Object.getPrototypeOf(Tabs)).call(this,props));return _this.handleNodeClick=_this.handleNodeClick.bind(_this),_this}return _inherits(Tabs,_React$Component),_createClass(Tabs,[{key:"handleNodeClick",value:function(node){this.props.onClick(node.props.name),this.setActiveTab(node.props.name)}},{key:"setActiveTab",value:function(tab){var node=this.refs[tab],selectedNode=this.state.selectedNode;selectedNode&&selectedNode.setState({selected:!1}),node.setState({selected:!0}),this.setState({selectedNode:node})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"componentDidMount",value:function(){var selectNodeName=this.props.libs[0],selectedNode=this.refs[selectNodeName];selectedNode.setState({selected:!0}),this.setState({selectedNode:selectedNode})}},{key:"render",value:function(){var _this2=this;return React.createElement("div",{className:this.props.classes},this.props.libs.map(function(lib,index){var icon="lib-"+lib.replace(/_/g,"-");return React.createElement(__WEBPACK_IMPORTED_MODULE_0__tabNode__.a,{key:index,name:lib,ref:lib,icon:icon,selected:!1,selectedColor:"blue",defaultColor:"grey-lighter",iconSize:16,handleClick:_this2.handleNodeClick})}))}}]),Tabs}(React.Component);__webpack_exports__.a=Tabs}).call(__webpack_exports__,__webpack_require__("nakD"))},K2yx:function(module,exports,__webpack_require__){function isArrayLike(value){return null!=value&&isLength(value.length)&&!isFunction(value)}var isFunction=__webpack_require__("xOlx"),isLength=__webpack_require__("mL1V");module.exports=isArrayLike},Kh9o:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Video=Class.create({url:null,source:null,title:null,size:null,frameOptions:{youtube:"&showinfo=1"+(MM.ua.isBrowser("Internet Explorer")?"":"&html5=1"),vimeo:"&title=0&byline=0&portrait=0",dailymotion:MM.ua.isBrowser("Internet Explorer")?"":"&html=1"},initialize:function(data){data&&(this.url=data.url,this.title=data.title||"",this.size=data.size?[data.size.width,data.size.height]:[320,200],this.updateSource())},toJSON:function(){return{url:this.url,source:this.source,width:this.width(),height:this.height(),title:this.title}},updateSource:function(){this.source=this.url.split(".")[1]},width:function(){return this.size[0]},height:function(){return this.size[1]},getElement:function(){return this.el||(this.el=new Element("iframe",{src:this.url+(this.url.indexOf("?")>=0?"&":"?")+"wmode=transparent"+(this.frameOptions[this.source]?this.frameOptions[this.source]:""),width:this.width(),height:this.height(),frameborder:0,allowfullscreen:""})),this.el}});__webpack_exports__.default=Video},"L/YL":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__=__webpack_require__("ZfKP"),__WEBPACK_IMPORTED_MODULE_2_app_canvas_copyPaste__=__webpack_require__("d407"),__WEBPACK_IMPORTED_MODULE_3_utils_emojiHelper__=__webpack_require__("iXsu"),onPaste=function(e){var clipboardData=__WEBPACK_IMPORTED_MODULE_2_app_canvas_copyPaste__.default.getPlainClipboardData(e);__WEBPACK_IMPORTED_MODULE_2_app_canvas_copyPaste__.default.simulatePaste(Object(__WEBPACK_IMPORTED_MODULE_3_utils_emojiHelper__.a)(clipboardData)),Event.stop(e)},sanitizeTextContent=function(text,escapeContent){var textContent=text.gsub(/\\n/,"\n");return escapeContent?textContent.escapeHTML():textContent},emojifyComment=function(text,escapeContent){var content=escapeContent?text.escapeHTML():text;return EmojiArea.getHTMLContent(content)},CommentsWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{expandable:!0,animationShow:CSS.translate({x:"0",y:0}),animationHide:CSS.translate({x:"100%",y:0}),animationFunction:"ease",initialize:function($super,sidebar,parent){var _this=this;$super("comments",sidebar,parent),this.textarea=new EmojiArea(mm$("new_comment_textarea"),{editor:mm$("new_comment")}),this.textarea.editor.observe("focus",this.onFocus.bind(this,this.textarea)),this.textarea.editor.observe("blur",this.onBlur.bind(this,this.textarea,!1)),this.textarea.editor.observe("paste",onPaste),this.expandedTextarea=new EmojiArea(mm$("new_comment_expanded_textarea"),{editor:mm$("new_comment_expanded")}),this.expandedTextarea.editor.observe("focus",this.onFocus.bind(this,this.expandedTextarea)),this.expandedTextarea.editor.observe("blur",this.onBlur.bind(this,this.expandedTextarea,!1)),this.expandedTextarea.editor.observe("paste",onPaste),Element.bindOnClick("expand_comments",this.expand.bind(this)),Element.bindOnClick("vote_count",this.expand.bind(this)),mm$("filter_votes_expanded").onchange=this.filter.bind(this);var K=MM.utils.KeyEvent;this.keymap=new MM.utils.KeyMap(document,"comments_keymap",[{key:K.ESC,stopEvent:!1,handler:function(){_this.activeEditor.hasFocus=!1,_this.activeEditor.editor.blur()}},{key:K.ENTER,notShift:!0,handler:this.onCommit.bind(this)},{key:K.TAB,stopEvent:!0,handler:function(){return MM.utils.replaceSelection("\t")}}]),this.keymap.disable(),this.popover=new Popover("commentsmenu",this.doEditActions.bind(this),{offset:[14,20]}),$$("div.vote.like").each(function(el){el.observe("click",this.onVote.bindAsEventListener(this,IdeaVote.UP))}.bind(this)),$$("div.vote.unlike").each(function(el){el.observe("click",this.onVote.bindAsEventListener(this,IdeaVote.DOWN))}.bind(this))},onVote:function(event,vote){event.preventDefault(),event.stopPropagation(),canvas.onSetVote(vote)},getEditActionsElements:function(comment){var elements=[new Element("a",{href:"#",id:"comment_delete"}).update(I18n.t("js.delete"))];return comment.user.id===users.selfUser.id&&elements.insert(new Element("a",{href:"#",id:"comment_edit"}).update(I18n.t("js.edit")),0),elements},doEditActions:function(action){var opener=this.popover.opener,commentId=parseInt(opener.id.replace("comment_edit_opener_",""));if(!commentId||"number"!=typeof commentId)return!1;switch(action){case"comment_edit":this.edit(commentId);break;case"comment_delete":var comment=__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default.get(commentId);canvas.selected.node.removeComment(comment)}return!1},onFocus:function(emojiarea){canvas.removeFocus(),this.keymap.enable(),this.activeEditor=emojiarea,addClassName(emojiarea.editor,"active")},onBlur:function(emojiarea,destroy){emojiarea.hasFocus||(canvas.addFocus(),this.keymap.disable(),removeClassName(emojiarea.editor,"active"),destroy&&emojiarea.menu.dispose(),MM.utils.clearSelection())},onBlurEdit:function(emojiarea){if(!emojiarea.hasFocus){emojiarea.editor.setAttribute("contenteditable","false"),emojiarea.textarea.value=this.currentCommentText,emojiarea.editor.innerHTML=emojifyComment(this.currentCommentText,!0).gsub(/\n/,"<br/>"),emojiarea.editor.stopObserving("focus"),emojiarea.editor.stopObserving("blur"),emojiarea.editor.stopObserving("paste",onPaste);var commentId=emojiarea.editor.id.gsub(/[^\d]/,"");addClassName($("comment_"+commentId).select(".icon_container")[0],"hidden"),sideBar.comments.onBlur(emojiarea,!0)}},onSelectNode:function(){if(this.expanded){mm$("all_comments").innerHTML="";var commentsAndVotes=canvas.selected.node.comments.concat(canvas.selected.node.votes);commentsAndVotes.sort(function(a,b){return(a instanceof __WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default?a.createdAt:a.voted_at)-(b instanceof __WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default?b.createdAt:b.voted_at)}),commentsAndVotes.each(function(element){element instanceof __WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default?(element.read=!0,this.addCommentLine(element)):element instanceof IdeaVote&&this.addVoteLine(element)}.bind(this))}canvas.selected.node._listener.__onSetProperty("comments",!0),this.updateCommentCount(),this.updateVotesBar()},onAddComment:function(comment){canvas.selected.node.comments.indexOf(comment)<0||(this.addCommentLine(comment,comment.isUnsaved()),this.updateCommentCount())},onEditComment:function(comment){if(!(canvas.selected.node.comments.indexOf(comment)<0)){var existingCommentLine=mm$("comment_"+comment.id);if(existingCommentLine){var isEditor=comment.user.id===users.selfUser.id;existingCommentLine.replace(this.commentLine(comment,isEditor)),isEditor&&addClassName(mm$("comment_"+comment.id),"unsaved"),this.bindCommentOpener(comment)}else this.addCommentLine(comment);this.updateCommentCount()}},onRemoveComment:function(comment){var existingCommentLine=mm$("comment_"+comment.id);existingCommentLine&&new Effect.SlideUp("comment_"+comment.id,{duration:.5,afterFinish:function(){remove(existingCommentLine)}}),this.updateCommentCount()},onCommentAdded:function(comment,oldCommentId){var commentLine=mm$("comment_"+oldCommentId);commentLine&&(commentLine.id="comment_"+comment.id,mm$("comment_text_"+oldCommentId).id="comment_text_"+comment.id,mm$("comment_text_"+comment.id).innerHTML=emojifyComment(comment.text,!1),mm$("comment_text_"+oldCommentId+"_textarea").id="comment_text_"+comment.id+"_textarea",mm$("comment_"+oldCommentId+"_emoji").id="comment_"+comment.id+"_emoji",mm$("comment_edit_opener_"+oldCommentId).id="comment_edit_opener_"+comment.id,this.removeUnsavedOverlay(comment))},onCommentEdited:function(comment){mm$("comment_"+comment.id)&&(mm$("comment_text_"+comment.id).innerHTML=emojifyComment(comment.text,!1),this.removeUnsavedOverlay(comment))},updateCommentCount:function(){var commentCount=canvas.selected.node.comments.length;0===commentCount?(mm$("expand_comments").innerHTML="",hide(mm$("expand_comments")),MM.ui.disableButton("expand_comments")):(mm$("expand_comments").innerHTML=commentCount>1?I18n.t("js.comments",{v0:commentCount}):I18n.t("js.comment",{v0:commentCount}),show(mm$("expand_comments")),MM.ui.enableButton("expand_comments"))},onAddVote:function(vote){canvas.selected.node.votes.indexOf(vote)<0||(this.addVoteLine(vote,!0),this.updateVotesBar(!0))},onEditVote:function(vote){if(!(canvas.selected.node.votes.indexOf(vote)<0)){var existingVoteLine=mm$("vote_"+vote.user.id+"_"+vote.idea_id);existingVoteLine?existingVoteLine.replace(this.voteLine(vote)):this.addVoteLine(vote),this.updateVotesBar(!0)}},onRemoveVote:function(vote){var existingVoteLine=mm$("vote_"+vote.user.id+"_"+vote.idea_id);existingVoteLine&&remove(existingVoteLine),this.updateVotesBar(!0)},updateVotesBar:function(animateBar){var votesCount=canvas.selected.node.votes.length,downVotesCount=IdeaVote.getByVote(canvas.selected.node,IdeaVote.DOWN).length,existingVote=IdeaVote.get(canvas.selected.node,users.selfUser.id),text=votesCount+(1===votesCount?" "+I18n.t("js.vote"):" "+I18n.t("js.votes"));if($$("#votes .vote, #votes_expanded .vote").each(function(el){removeClassName(el,"active")}),existingVote&&existingVote.user.id===users.selfUser.id){(existingVote.vote>0?$$("#votes .vote.like, #votes_expanded .vote.like"):$$("#votes .vote.unlike, #votes_expanded .vote.unlike")).each(function(el){addClassName(el,"active")})}IdeaVote.maxVotes>0&&($$(".vote_progress_bar.orange").each(function(el){this.redrawVotesBar(el,downVotesCount,animateBar)}.bind(this)),$$(".vote_progress_bar.green").each(function(el){this.redrawVotesBar(el,votesCount,animateBar)}.bind(this))),mm$("vote_count").innerHTML=text,mm$("vote_count_expanded").innerHTML=text,mm$("filter_votes_expanded").checked&&this.updateFilterView()},redrawVotesBar:function(el,voteCount,animated){animated?addClassName(el,"animated"):removeClassName(el,"animated"),el.style.width=voteCount/IdeaVote.maxVotes*100+"%"},commentLine:function(comment,escapeContent){var div=new Element("div",{id:"comment_"+comment.id,className:"comment_line mb-15"+(comment.id<0?" unsaved":"")});return div.innerHTML='<div row class="align-items-start">'+comment.user.getAvatar("large mr-8")+'<div column grow><div row class="comment_date">'+comment.createdAt.ago(!0)+(comment.isEdited()?'<span class="ml-5" title="'+I18n.t("js.edited")+": "+comment.updatedAt.ago(!0)+'">'+MM.ui.icon({name:"pen",size:8,color:"grey-light",clickable:!1})+"</span>":"")+'</div><p class="mb-5px">'+I18n.t("js.said",{v0:comment.user.displayname})+'</p><textarea id="comment_text_'+comment.id+'_textarea" style="display: none">'+sanitizeTextContent(comment.text,escapeContent)+'</textarea><div class="p-r"><div id="comment_text_'+comment.id+'" class="comment" style="height: auto;">'+emojifyComment(comment.text,escapeContent)+"</div>"+(comment.user.id===users.selfUser.id||comment.user.anonymous&&users.selfUser.isOwner()?'<a class="icon comment_edit" id="comment_edit_opener_'+comment.id+'"></a>':"")+'</div><div class="icon_container hidden"><div row><a id="comment_'+comment.id+'_emoji" class="icon-svg" data-icon="smiley-face" data-size="24" data-color="grey-lighter" href="#"></a><input type="button" class="button default ml-auto" value="'+I18n.t("js.save_changes")+'" onmousedown="sideBar.comments.onCommit(); return false;" tabindex="-1"/></div></div></div></div>',div},addCommentLine:function(comment,escapeContent){var list=mm$("all_comments");list.insertBefore(this.commentLine(comment,escapeContent),list.firstChild),this.bindCommentOpener(comment)},bindCommentOpener:function(comment){var opener=mm$("comment_edit_opener_"+comment.id);opener&&(opener.onclick=function(){this.popover.opener=opener,this.popover.visible||(this.popover.removeElements(),this.popover.addElements(this.getEditActionsElements(comment))),this.popover.togglePopover(),this.popover.sizeAndPosition()}.bind(this))},addVoteLine:function(vote){var list=mm$("all_comments");list.insertBefore(this.voteLine(vote),list.firstChild)},voteLine:function(vote){var div=new Element("div",{id:"vote_"+vote.user.id+"_"+vote.idea_id,className:"votes_widget h-flex-row align-items-start mb-25"});return div.innerHTML='<div class="w-40">'+vote.user.getAvatar("large")+'</div><div column grow><span class="comment_date">'+vote.voted_at.ago(!0)+"</span><span>"+I18n.t("js.voted",{v0:vote.user.displayname})+"</span></div>"+MM.ui.icon({name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"h-cd p-r vote active"+(vote.vote===IdeaVote.UP?" like":" unlike")}),div},onCommit:function(){this.activeEditor&&(this.activeEditor.hasFocus=!1,this.commit(this.activeEditor.editor.id))},commit:function(fieldId){if(mm$(fieldId)){var textarea=mm$(fieldId+"_textarea"),text=Object(__WEBPACK_IMPORTED_MODULE_3_utils_emojiHelper__.a)(textarea.value.replace(/\s+$/,""));if(""!==text){mm$(fieldId).blur(),canvas.addFocus();var changes=[];if("new_comment"===fieldId||"new_comment_expanded"===fieldId)mm$(fieldId).innerHTML="",textarea.value="",__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default.uncommitedId--,changes.push(new AddCommentChange({idea_id:canvas.selected.node.id,type:"AddComment",new_data:{text:text,user_id:users.selfUser.id,idea_id:canvas.selected.node.id,id:__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default.uncommitedId}})),ChangeList.layoutAlteringChangeset(changes);else{var commentId=parseInt(fieldId.replace(/[^\d]/g,""));if(!isNaN(commentId)){var comment=__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default.get(commentId);comment&&comment.text!==text&&(comment.update(text),canvas.selected.node.editComment(comment),addClassName(mm$("comment_"+commentId),"unsaved"))}}}}},edit:function(commentId){var comment=__WEBPACK_IMPORTED_MODULE_1_app_models_ideaComment__.default.get(commentId);if(comment&&comment.user.id===users.selfUser.id){this.editTextarea=new EmojiArea(mm$("comment_text_"+commentId+"_textarea"),{editor:mm$("comment_text_"+commentId),menu:"edit_comment_emoji",menuOpener:mm$("comment_"+comment.id+"_emoji")}),this.currentCommentText=this.editTextarea.textarea.value,this.editTextarea.editor.observe("focus",this.onFocus.bind(this,this.editTextarea)),this.editTextarea.editor.observe("blur",this.onBlurEdit.bind(this,this.editTextarea)),this.editTextarea.editor.observe("paste",onPaste),removeClassName($("comment_"+commentId).select(".icon_container")[0],"hidden"),this.editTextarea.editor.focus();var range=document.createRange();range.selectNodeContents(this.editTextarea.editor),MM.utils.addSelection(range)}},removeUnsavedOverlay:function(comment){var commentEl=mm$("comment_"+comment.id);removeClassName(commentEl,"unsaved")},filter:function(){mm$("filter_votes_expanded").checked?this.updateFilterView():this.removeFilterView()},updateFilterView:function(){var baseFontSize=tree.root.defaultStyle().fontSize;tree.root.eachChild(function(node){if(node.votes.length>0){var upvotes=IdeaVote.getByVote(node,IdeaVote.UP).length,downvotes=node.votes.length-upvotes,fontSize=baseFontSize+(upvotes>0?baseFontSize*(upvotes/IdeaVote.maxVotes):0)-(downvotes>0?baseFontSize*(downvotes/IdeaVote.maxVotes):0);node._listener.dcontent.el.style.fontSize=(fontSize>0?fontSize:50)+"%",node._listener.dcontent.el.style.opacity<1&&(node._listener.dcontent.el.style.opacity=1)}else node._listener.dcontent.el.style.opacity=.5,node._listener.dcontent.el.style.fontSize=baseFontSize+"%";node._listener.refreshLayout(),node.isRootC()?node._listener.rc.redrawRootLine():node.isRoot()&&canvas.root.reposition()}.bind(this))},removeFilterView:function(){tree.root.eachChild(function(node){node.style?Style.applyToElement(node.style,node._listener.dcontent.el):Style.removeFromElement(node._listener.dcontent.el),node._listener.dcontent.el.style.opacity=1,node._listener.refreshLayout(),node.isRootC()?node._listener.rc.redrawRootLine():node.isRoot()&&canvas.root.reposition()}.bind(this))}});__webpack_exports__.default=CommentsWidget},"L7X+":function(module,exports,__webpack_require__){function escape(string){return string=toString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}var escapeHtmlChar=__webpack_require__("rP4o"),toString=__webpack_require__("GLmR"),reUnescapedHtml=/[&<>"']/g,reHasUnescapedHtml=RegExp(reUnescapedHtml.source);module.exports=escape},MQVt:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__mediaSearch__=__webpack_require__("Z6lC"),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},ImageSearch=Class.create(__WEBPACK_IMPORTED_MODULE_0__mediaSearch__.default,{initialize:function($super,options){$super(_extends({type:"images"},options))},transformResults:function(items){return items.map(function(image){return{title:image.title,description:image.description,thumbnailUrl:image.thumbnail_url,url:image.image_url}})}});__webpack_exports__.default=ImageSearch},MbB6:function(module,exports,__webpack_require__){function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounce(func,wait,{leading:leading,maxWait:wait,trailing:trailing})}var debounce=__webpack_require__("dnTF"),isObject=__webpack_require__("xwKO"),FUNC_ERROR_TEXT="Expected a function";module.exports=throttle},NCMo:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__vgenericNode__=__webpack_require__("Vw2l"),__WEBPACK_IMPORTED_MODULE_1__block__=__webpack_require__("cQwG"),__WEBPACK_IMPORTED_MODULE_2_app_ui_users__=__webpack_require__("ePfb"),VNode=(__webpack_require__("3Ox4"),Class.create(__WEBPACK_IMPORTED_MODULE_0__vgenericNode__.default,{dcontainer:null,dchildren:null,dopener:null,rc:null,initialize:function(node){this.node=node,this.icons=[],this.cache={};var className="tk_label";this.node.parent.isRoot()?className+=" root_child":className+=" node",this.node.isFloating()&&(className+=" floating"),this.dcontent=new __WEBPACK_IMPORTED_MODULE_1__block__.default(className),this.dcontent.el.id=this.node.id,this.dcontent.el._listener=this,this.dcontent.setTitle(),App.config.editable&&App.config.currentlyEditable||(this.dcontent.el.style.cursor="default"),App.config.editable&&App.config.currentlyEditable&&this.initEditMode(),this.__onSetStyle(!0),this.node.icons.length>0&&this.__onSetIcon(!0),this.node.note&&this.__onSetProperty("note",!0),this.node.link&&this.__onSetProperty("link",!0),this.node.attachments.length>0&&this.__onSetProperty("attachments",!0),this.node.task&&this.__onSetProperty("task",!0),this.node.comments.length>0&&this.__onSetProperty("comments",!0),this.node.idea_image&&this.__onSetProperty("image",!0),this.node.idea_video&&this.__onSetProperty("video",!0),this.node.externalTask&&this.__onSetProperty("externalTask",!0),this.dchildren=new __WEBPACK_IMPORTED_MODULE_1__block__.default("tk_children"),this.dchildren.el.id="tk_children_"+this.node.id,this.children=[],this._initOpener(),this.dcontainer=new __WEBPACK_IMPORTED_MODULE_1__block__.default("tk_container"),this.dcontainer.el.id="tk_container_"+this.node.id,this.node.boundary&&addClassName(this.dcontainer.el,"with-boundary");var contentOpenerContainer=new __WEBPACK_IMPORTED_MODULE_1__block__.default("tk_open_container");App.config.layout.orientation===App.Layouts.orientation.down?(contentOpenerContainer.appendChild(this.dopener),contentOpenerContainer.appendChild(this.dcontent)):(contentOpenerContainer.appendChild(this.dcontent),contentOpenerContainer.appendChild(this.dopener)),this.dcontainer.appendChild(contentOpenerContainer),Element.hide(this.dopener.el),this.dcontainer.appendChild(this.dchildren),Element.hide(this.dchildren.el)},initEditMode:function(){this.dcontent.enabled||(this.dcontent.makeSelectable(),this.dcontent.makeEditable(),this.dcontent.toInactive(),this.dcontent.makeResizable(),this.dcontent.enableResizing(),this.dcontent.makeDraggable(),this.dcontent.enableDragging(),this.dcontent.makeDroppable(),this.dcontent.enableDropping(),this.dcontent.el.observe("dblclick",Prototype.stopEvent),this.dcontent.el.style.cursor="move",this.image&&this.image.toEditMode())},initViewOnlyMode:function(){this.dcontent.toInactive&&this.dcontent.toInactive(),this.dcontent.disableSelecting&&this.dcontent.disableSelecting(),this.dcontent.disableResizing&&this.dcontent.disableResizing(),this.dcontent.disableDragging&&this.dcontent.disableDragging(),this.dcontent.disableDropping&&this.dcontent.disableDropping(),this.dcontent.el.stopObserving("dblclick",Prototype.stopEvent),this.dcontent.el.style.cursor="default",this.image&&this.image.toViewMode()},setRc:function(rc){for(var i=0,len=this.children.length;i<len;i++)this.children[i].setRc(rc);this.rc=rc},refreshLayout:function(){this.rc.refreshLayout()},getSizesForLayouter:function(includeOffsets,includeChildRectangle){var verticalOffset,horizontalOffset,childRectangle,center=canvas.getCenter(),block=this.rc.vnode.dcontainer,size=block.size();if(includeOffsets&&(verticalOffset=this.dcontent.parent.getPosition()[1],horizontalOffset=this.dchildren.size()[0],this.node.hasChildren()&&(horizontalOffset+=this.dopener.size()[0]+6)),includeChildRectangle){var cSize=new Point(this.dcontent.parent.size()[0]+this.dchildren.size()[0],this.dcontainer.size()[1]);childRectangle=new Rectangle(new Point([0,0]),cSize)}var p1=Math.offset(canvas.getElementOffset(block.el),[-center[0],-center[1]]),p2=Math.offset(p1,size);return p1[0]-=15,p1[1]-=15,p2[0]+=15,p2[1]+=15,{rectangle:new Rectangle(new Point(p1),new Point(p2)),offsets:[horizontalOffset,verticalOffset],childRectangle:childRectangle}},getContentOffset:function(){var offset=this.dcontent.parent.getPosition();return this.rc.orientation===App.Layouts.orientation.left&&this.node.hasChildren()&&(offset[0]+=this.dopener.size()[0]+6),offset},__onChangeId:function($super,old_id,new_id){$super(old_id,new_id),this.dchildren.el.id="tk_children_"+new_id,this.dcontainer.el.id="tk_container_"+new_id},__onAddChild:function(vnode,rank,notPainted,uid,param,wasTemporarilyRemoved){return vnode.setRc(this.rc),vnode.parent=this,hasClassName(vnode.dcontent.el,"root_child")&&(vnode.dcontainer.resetPosition(),removeClassName(vnode.dcontent.el,"root_child"),removeClassName(vnode.dcontainer.el,"left_pane")),addClassName(vnode.dcontent.el,"node"),this.dchildren.insertChild(vnode.dcontainer,rank,uid),this.children.insert(vnode,rank),1===this.children.length?(Element.show(this.dopener.el),this.node.closed||Element.show(this.dchildren.el),addClassName(this.dchildren.el,"single_child")):2===this.children.length&&removeClassName(this.dchildren.el,"single_child"),!!notPainted||(wasTemporarilyRemoved&&(vnode.isTemporarilyRemoved=!1),tree.notPainted||this.refreshLayout(),uid&&void 0!==__WEBPACK_IMPORTED_MODULE_2_app_ui_users__.default&&__WEBPACK_IMPORTED_MODULE_2_app_ui_users__.default&&(param&&param.moveClone?__WEBPACK_IMPORTED_MODULE_2_app_ui_users__.default.highlightMovement(vnode,uid,param.moveClone):__WEBPACK_IMPORTED_MODULE_2_app_ui_users__.default.highlightNode(vnode,uid)),tree.finishedInitialization&&this.node.closed&&this.node.toggleClosed(),!0)},__onRemoveChild:function(vnode,uid,mode){if(canvas.isSelected(vnode)&&"definitive"===mode){(vnode.node.getPrevSibling()||vnode.node.getNextSibling()||this.node)._listener.select(null,null,!0,!0)}if(uid){var recursive=function(vn){return canvas.isSelected(vn)?(vn.dcontent.toInactive(),this.select(),!0):vn.children.any(recursive)}.bind(this);recursive(vnode)}this.dchildren.removeChild(vnode.dcontainer),this.children=this.children.reject(function(c){return c===vnode}),0===this.children.length?(this.node.closed&&this.node.toggleClosed(),Element.hide(this.dopener.el)):1===this.children.length&&addClassName(this.dchildren.el,"single_child"),vnode.parent=null,vnode.isTemporarilyRemoved="move"===mode,tree.notPainted||"definitive"!==mode&&"move"!==mode&&"cancel"!==mode||this.refreshLayout(),rectangleLayouter.update(this.node)},_childSelected:function(){for(var i=0;i<this.children.length;i++){var c=this.children[i];if(canvas.isSelected(c)||c.children[0]&&c._childSelected())return!0}return!1},_initOpener:function(){var icon=new Element("div",{className:"h-flex-row justify-center h-100%"}).insert(new Element("span",{className:"tk_open_indicator s-6 rad-100%"}));this.dopener=new __WEBPACK_IMPORTED_MODULE_1__block__.default("tk_open"),this.dopener.el.update(icon),this._updateOpener(),this.dopener.el.observe("click",function(){this.node.toggleClosed()}.bind(this)),this.dopener.el.observe("dblclick",Event.stop)},_updateOpener:function(){this.node.closed?removeClassName(this.dopener.el,"open"):addClassName(this.dopener.el,"open")},__onToggleClosed:function(){var offsetLeft=0,offsetTop=0;if(mapView.hasMapFeature("graphics")&&App.config.layout.autoAlign&&!tree.notPainted&&canvas.selected){var offset=canvas.getNodeCanvasOffset(canvas.selected);offsetLeft=offset[0]-canvas.getScrollLeft(),offsetTop=offset[1]-canvas.getScrollTop()}if(_Element.toggle(this.dchildren.el),this._updateOpener(),this.node.closed?1===this.node.children.length?this.dopener.el.title=I18n.t("js.one_child_idea"):this.dopener.el.title=I18n.t("js.more_child_ideas_d",{v0:this.node.children.length}):this.dopener.el.title="",this.refreshLayout(),this.node.closed&&this._childSelected()&&App.config.editable&&App.config.currentlyEditable&&this.select(),this.node.closed?this.node.eachChildWithoutSelf(function(c){for(var i=0,len=c.connections.length;i<len;i++)c.connections[i].view.clear()}):this.node.eachChildWithoutSelf(function(c){for(var i=0,len=c.connections.length;i<len;i++)c.connections[i].view.redraw()}),void 0!==App.ui.SlideShow&&App.ui.SlideShow.initialized){var slides=[],nodes=[];this.node.getRootC().eachChild(function(child){return nodes.push(child)}),App.ui.SlideShow.list.each(function(slide){nodes.any(function(node){return slide.nodes.indexOf(node)>=0})&&slides.push(slide)}),slides.each(function(slide){slide.buildUI(),slide.updateLabel(App.ui.SlideShow.list.indexOf(slide))})}if(mapView.hasMapFeature("graphics")&&(rectangleLayouter.update(this.node),ChangeList.autoLayoutChangeset()),mapView.hasMapFeature("graphics")&&App.config.layout.autoAlign&&!tree.notPainted&&canvas.selected){var _offset=canvas.getNodeCanvasOffset(canvas.selected);canvas.scrollTo([_offset[0]-offsetLeft,_offset[1]-offsetTop],!1)}},__onAddBoundary:function(){addClassName(this.dcontainer.el,"with-boundary"),this.rc.redrawLines(),this.rc.refreshLayout()},__onRemoveBoundary:function(){removeClassName(this.dcontainer.el,"with-boundary"),this.rc.redrawLines(),this.rc.refreshLayout()},select:function(event,rememberedDepth,doCommit,noScroll,noUnselect){App.config.editable&&App.config.currentlyEditable&&this.dcontent&&("number"==typeof rememberedDepth&&(canvas._rememberedDepth=rememberedDepth),this.dcontent.toSelected(event,doCommit,noScroll,noUnselect))},openTemporarily:function(){this.node.closed&&(this.node.toggleClosed(!0),canvas.tempOpen||(canvas.tempOpen=[]),canvas.tempOpen.push(this.node))},makeVisible:function(){this.node.getAncestors().each(function(node){node.closed&&node._listener.openTemporarily()})},__onReposition:function(uid){tree.notPainted||this.rc.reposition(uid),rectangleLayouter.update(this.node)},showTask:function(){this.dcontent.el.setStyle({opacity:1})},hideTask:function(){this.dcontent.el.setStyle({opacity:.2})},calculateLinePoints:function(){this._horizontalLine=this.horizontalLine(),this._verticalLine=this.verticalLine()},offsetLinePoints:function(){var p=this.getContentOffset();this._horizontalLine[0][0]+=p[0],this._horizontalLine[1][0]+=p[0],this._horizontalLine[0][1]+=p[1],this._horizontalLine[1][1]+=p[1],this._verticalLine&&(this._verticalLine[0][0]+=p[0],this._verticalLine[1][0]+=p[0],this._verticalLine[0][1]+=p[1],this._verticalLine[1][1]+=p[1])},lineCoordinates:function(type){if("live"===type){var nodeOffset=this.dcontent.getPosition(),nodeOrigin=this.node.pos?this.node.pos[0]:0;if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up||App.config.layout.orientation===App.Layouts.orientation.left||nodeOrigin+nodeOffset[0]>=0)var p=(this._tempRc?this._tempRc:this.rc).vnode._horizontalLine[0];else{var p=(this._tempRc?this._tempRc:this.rc).vnode._horizontalLine[1];p[0]-=(this._tempRc?this._tempRc:this.rc).vnode.dopener.size()[0]+6}return Math.offset(p,nodeOffset)}return this.rc.orientation===App.Layouts.orientation.left?this._horizontalLine[1]:this._horizontalLine[0]},horizontalLine:function(){var contentSize=this.dcontent.size(),cx1=0,cx2=contentSize[0],cy=contentSize[1],halfOpener=this.dopener.size()[0]/2;return this.rc.orientation===App.Layouts.orientation.left?(cx1-=halfOpener,cx2+=halfOpener,this.node.isRootC()&&(cx2-=2)):App.config.layout.orientation===App.Layouts.orientation.down?(cx1+=halfOpener+2,cx2+=2*halfOpener,this.node.children.length>0&&(cx2+=halfOpener)):cx2+=halfOpener,[[cx1,cy],[cx2,cy]]},verticalLine:function(){if(this.node.closed||!this.node.hasChildren())return null;var p1=[0,0],p2=[0,0];return p1[1]=this.children.first()._horizontalLine[0][1],p2[1]=this.children.last()._horizontalLine[0][1]+this.children.last().dcontainer.pos[1],this.rc.orientation===App.Layouts.orientation.left?p1[0]=p2[0]=this.dchildren.size()[0]:p1[0]=p2[0]=0,[p1,p2]},getContainerRCOffset:function(){if(this.node.isRootC())return[0,0];var rcPos=Element.cumulativeOffset(this.rc.vnode.dcontainer.el),pos=Element.cumulativeOffset(this.dcontainer.el);return[pos[0]-rcPos[0],pos[1]-rcPos[1]]},mark:function(){canvas.allSelected.indexOf(this)<0&&addClassName(this.dcontent.el,"selected")},unmark:function(){canvas.allSelected.indexOf(this)<0&&removeClassName(this.dcontent.el,"selected")},findAffected:function(point){if(!this.dcontainer.contains(point))return null;var containerPoint=Math.negativeOffset(point,this.dcontainer.getPosition());if(this.dcontent.parent.contains(containerPoint))return this.dcontent.el;if(this.dchildren.contains(containerPoint)){for(var affected=null,childrenPoint=Math.negativeOffset(containerPoint,this.dchildren.getPosition()),i=0,len=this.children.length;i<len&&!(affected=this.children[i].findAffected(childrenPoint));i++);return affected||(Droppables.last_active?Droppables.last_active.element:null)}return this.node.isRootC()&&this.dcontainer.contains(containerPoint)||!this.node.isRootC()&&this.dcontainer.contains(point)?this.dcontent.el:null},getParallelNode:function(rootChild){var vnode=null;if(rootChild)for(var offset=this.dcontent.el.cumulativeOffset(),elements=$$("#tk_container_"+rootChild._listener.dcontent.el.id+" .tk_label"),i=0;null===vnode&&i<=elements.length-1;){var nodeOffset=elements[i].cumulativeOffset();nodeOffset.top>offset.top-20&&nodeOffset.top<offset.top+20&&(vnode=elements[i]._listener),i++}return vnode},getLeftCounterpart:function(){var rootChild=this.rc.vnode.node.getPrevSibling();return this.getParallelNode(rootChild)},getRightCounterpart:function(){var rootChild=this.rc.vnode.node.getNextSibling();return this.getParallelNode(rootChild)},destroy:function(){for(var i=0,len=this.children.length;i<len;i++)this.children[i].destroy(),this.children[i]=null;this.dcontent.el._listener=null,this.dcontent.disableDragging&&this.dcontent.disableDragging(),this.dcontent.disableDropping&&this.dcontent.disableDropping(),this.dcontent.destroy(),this.dcontent=null,this.dopener.destroy(),this.dopener=null,this.dchildren.destroy(),this.dchildren=null,this.dcontainer.destroy(),this.dcontainer=null,this.node=null,this.rc=null,this.children=null,this.parent=null}}));VNode.naturalCompare=function(vnode1,vnode2){return String.naturalCompare(vnode1.node.getRawTitle().toLowerCase(),vnode2.node.getRawTitle().toLowerCase())},__webpack_exports__.default=VNode},Ne51:function(module,exports,__webpack_require__){function baseDifference(array,values,iteratee,comparator){var index=-1,includes=arrayIncludes,isCommon=!0,length=array.length,result=[],valuesLength=values.length;if(!length)return result;iteratee&&(values=arrayMap(values,baseUnary(iteratee))),comparator?(includes=arrayIncludesWith,isCommon=!1):values.length>=LARGE_ARRAY_SIZE&&(includes=cacheHas,isCommon=!1,values=new SetCache(values));outer:for(;++index<length;){var value=array[index],computed=null==iteratee?value:iteratee(value);if(value=comparator||0!==value?value:0,isCommon&&computed===computed){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===computed)continue outer;result.push(value)}else includes(values,computed,comparator)||result.push(value)}return result}var SetCache=__webpack_require__("2mhJ"),arrayIncludes=__webpack_require__("sfIr"),arrayIncludesWith=__webpack_require__("83D3"),arrayMap=__webpack_require__("eKAY"),baseUnary=__webpack_require__("+ASY"),cacheHas=__webpack_require__("3AGJ"),LARGE_ARRAY_SIZE=200;module.exports=baseDifference},"ORg+":function(module,exports,__webpack_require__){function overRest(func,start,transform){return start=nativeMax(void 0===start?func.length-1:start,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),array=Array(length);++index<length;)array[index]=args[start+index];index=-1;for(var otherArgs=Array(start+1);++index<start;)otherArgs[index]=args[index];return otherArgs[start]=transform(array),apply(func,this,otherArgs)}}var apply=__webpack_require__("W/Il"),nativeMax=Math.max;module.exports=overRest},PlM2:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),Icon=function(_React$Component){function Icon(props){_classCallCheck(this,Icon);var _this=_possibleConstructorReturn(this,(Icon.__proto__||Object.getPrototypeOf(Icon)).call(this,props));return _this.state={selected:!1},_this}return _inherits(Icon,_React$Component),_createClass(Icon,[{key:"selectNode",value:function(icon,e){e.preventDefault(),e.stopPropagation(),this.props.onSelectIcon(icon)}},{key:"render",value:function(){var icon=this.props.icon,bgPos="0 "+24*-this.props.index+"px",className=this.props.className+" item tooltip"+(this.state.selected?" selected":"");return React.createElement("cell",null,React.createElement("a",{href:"#",className:className,title:icon.getTitle(),onClick:this.selectNode.bind(this,icon)},React.createElement("span",{ref:icon.fullName(),style:{backgroundPosition:bgPos}})))}}]),Icon}(React.Component);Icon.defaultProps={className:""},__webpack_exports__.default=Icon}.call(__webpack_exports__,__webpack_require__("nakD"))},QHRq:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0_lodash_uniq__=__webpack_require__("uwez"),__WEBPACK_IMPORTED_MODULE_0_lodash_uniq___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_lodash_uniq__),__WEBPACK_IMPORTED_MODULE_1_lodash_flatten__=__webpack_require__("lqP1"),__WEBPACK_IMPORTED_MODULE_1_lodash_flatten___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_lodash_flatten__),__WEBPACK_IMPORTED_MODULE_2_lodash_difference__=__webpack_require__("iB8H"),__WEBPACK_IMPORTED_MODULE_2_lodash_difference___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_2_lodash_difference__),__WEBPACK_IMPORTED_MODULE_3_lodash_each__=__webpack_require__("8yla"),__WEBPACK_IMPORTED_MODULE_3_lodash_each___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_3_lodash_each__),__WEBPACK_IMPORTED_MODULE_4_lodash_escape__=__webpack_require__("L7X+"),__WEBPACK_IMPORTED_MODULE_4_lodash_escape___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_4_lodash_escape__),__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_6_ui_components_popovers_emojiPopover__=__webpack_require__("ukVN"),__WEBPACK_IMPORTED_MODULE_7_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_8_ui_core_popover__=__webpack_require__("SZxL"),__WEBPACK_IMPORTED_MODULE_9_ui_core_searchField__=__webpack_require__("VkG4"),Filter={icons:[],selectableIcons:[],text:"",results:[],type:"all",filterTypes:{all:"search",idea:"idea-caption",author:"user",task:"checkmark",icons:"lib-emoji-people"},init:function(field){var _this=this,options=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.field=mm$(field),this.toggledOpen=[],this.openerMarked=[],this.options=options,this.popover=new __WEBPACK_IMPORTED_MODULE_8_ui_core_popover__.c("filter"),this._updatePopoverOpener("all"),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_7_ui_components_generic_list_list__.a,{items:Object.keys(this.filterTypes).map(function(type){return{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_svgIcon__.a,{opts:{name:_this.filterTypes[type],size:12,consize:12,color:"grey-light",classes:"h-a-center",parentClasses:"p-r mr-8"}}),label:I18n.t("js.filter_"+type),onClick:_this.setPanelValue.bind(_this,type)}})}),this.popover.widgetContainer),this.field.value="",this.searchField=new __WEBPACK_IMPORTED_MODULE_9_ui_core_searchField__.a(this.field.id,{onChange:this.updateText.bind(this)});var exceptions=["ja","zh","ko"];this.minSearchLength=exceptions.indexOf(I18n.locale)>-1?1:3;var K=MM.utils.KeyEvent;this.keymap=new MM.utils.KeyMap(document,"fld_filter",[{key:K.ESC,stopEvent:!1,fn:function(){$(this.field.id).clear(),this.clearText(),$(this.field.id).blur()}.bind(this)}]),this.keymap.disable(),Element.on(this.field.id,"focus",this.onFocus.bind(this)),Element.on(this.field.id,"blur",this.onBlur.bind(this)),Element.bindOnClick("btn_search_previous",this.goToResult.bind(this,-1)),Element.bindOnClick("btn_search_next",this.goToResult.bind(this,1)),App.subscribe(CustomEvents.ICON_CHANGED,this.buildIcons.bind(this))},onFocus:function(){this.keymap&&this.keymap.enable(),this.options.onFocus&&this.options.onFocus()},onBlur:function(){this.keymap&&this.keymap.disable(),this.options.onBlur&&this.options.onBlur()},updateText:function(text){this.text=text.toLowerCase(),this.text.length>=this.minSearchLength?this.doFilter():0===this.text.length&&this.clearText()},clearText:function(event){event&&event.stop(),this.text="",this.field.value="",this.unmarkResults(),this.clearResults(),this.unblurMap(),this.results=[],canvas.scrollToNode(canvas.selected)},activate:function(){this.field.activate()},doFilter:function(){if(this.unmarkResults(),this.results=[],this.currentIndex=0,0===this.text.length&&"icons"!=this.type)return void this.updateResults();for(var id in tree.getNodes()){var node=tree.nodes[id],matches=!0;if("icons"===this.type)if(this.icons.length>0)for(var i=0,len=this.icons.length;i<len;i++)node.icons.include(this.icons[i])||(matches=!1);else matches=!1;else this.filterText(node)||(matches=!1);matches?(this.results.push(id),node._listener.unBlur()):node._listener.blur()}this.blurMap(),this.updateResults(),this.markResults(),0===this.results.length?canvas.scrollToNode(canvas.selected):this.goToResult(0)},updateResults:function(){this.results.length>0?(1===this.results.length?mm$("msg_filter").innerHTML=I18n.t("js.match"):mm$("msg_filter").innerHTML=I18n.t("js.matches",{v0:this.results.length}),show(mm$("msg_filter")),show(mm$("btn_search_previous")),show(mm$("btn_search_next"))):(mm$("msg_filter").innerHTML=I18n.t("js.no_matches_found"),mm$("msg_filter").show(),hide(mm$("btn_search_previous")),hide(mm$("btn_search_next"))),addClassName(mm$("map_header"),"is-filtered")},clearResults:function(){mm$("msg_filter").innerHTML="",hide(mm$("msg_filter")),removeClassName(mm$("map_header"),"is-filtered"),hide(mm$("btn_search_previous")),hide(mm$("btn_search_next"))},goToResult:function(index,event){var toClose=this.toggledOpen;if(0!==this.results.length){this.currentIndex=this.currentIndex+index,this.currentIndex>=this.results.length&&(this.currentIndex=0),this.currentIndex<0&&(this.currentIndex=this.results.length-1);for(var node=tree.nodes[this.results[this.currentIndex]],toOpen=[],parent=node.parent;parent;)toOpen.push(parent),parent=parent.parent;toClose=toClose.diff(toOpen,function(node1,node2){return node1==node2});for(var i=0,len=toClose.length;i<len;i++)toClose[i].closed||toClose[i].toggleClosed(!0);for(var i=0,len=toOpen.length;i<len;i++)toOpen[i].closed&&(toOpen[i].toggleClosed(!0),this.toggledOpen.push(toOpen[i]));var element=node._listener.dcontent.el;if(canvas.centerOnElement(element),0!==index){var restoreColor=node.currentStyle()&&node.currentStyle().backgroundColor?"#"+node.currentStyle().backgroundColor:"transparent";new Effect.Highlight(element,{restorecolor:restoreColor,duration:2})}}},unmarkResults:function(){for(var i=0,len=this.toggledOpen.length;i<len;i++)this.toggledOpen[i].closed||this.toggledOpen[i].toggleClosed(!0);for(var i=0,len=this.results.length;i<len;i++){var node=tree.nodes[this.results[i]];node&&node._highlighted&&this.unHighlightNode(node)}for(var i=0,len=this.openerMarked.length;i<len;i++)removeClassName(this.openerMarked[i]._listener.dopener.el,"highlighted")},blurMap:function(){$("graphics_container").style.opacity="0.1"},unblurMap:function(){for(var id in tree.getNodes())tree.nodes[id]._listener.unBlur();$("graphics_container").style.opacity="1"},markResults:function(){this.openerMarked=[];for(var i=0,len=this.results.length;i<len;i++){var node=tree.nodes[this.results[i]];if(node){var visibleParent=node.getVisibleParent();visibleParent!=node&&(addClassName(visibleParent._listener.dopener.el,"highlighted"),this.openerMarked.push(visibleParent)),this.highlightNode(node)}}},highlightNode:function(node){var val=this.field.value;if(""!==val){var titleEl=node._listener.dcontent.title;__WEBPACK_IMPORTED_MODULE_3_lodash_each___default()(titleEl.childNodes,function(node){var highlighted=MM.utils.highlightText(node.textContent,val);highlighted!==node.textContent&&(highlighted=__WEBPACK_IMPORTED_MODULE_4_lodash_escape___default()(highlighted).replace(/&lt;(\/?em)&gt;/g,"<$1>"),node.nodeType===Node.TEXT_NODE?(titleEl.insertBefore(new Element("span").update(highlighted),node),titleEl.removeChild(node)):node.innerHTML=highlighted)}),node._highlighted=!0}},unHighlightNode:function(node){node._listener.dcontent.title.update(node.getTitleWithLinks()),node._highlighted=null},getMapIcons:function(){return __WEBPACK_IMPORTED_MODULE_0_lodash_uniq___default()(__WEBPACK_IMPORTED_MODULE_1_lodash_flatten___default()(Object.values(tree.getNodes()).map(function(node){return node.icons})))},buildIcons:function(){var container=mm$("icons_filter");container.innerHTML="";var allIcons=this.getMapIcons();0==this.selectableIcons.length&&(this.selectableIcons=allIcons.slice(0,2));for(var i=0;i<this.selectableIcons.length;i++){var icon=this.selectableIcons[i],className="h-flex-row justify-center item"+(this.icons.include(icon)?" selected":""),content=new Element("a",{href:"#",className:className}),link=icon.getElement();link.id="filtericon_"+icon.fullName(),link.className="w-20px h-20px",content.appendChild(link),container.appendChild(content),link.observe("click",this.onAddIcon.bindAsEventListener(this,icon))}this.renderPopover(allIcons)},renderPopover:function(){var _this2=this,allIcons=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.getMapIcons(),icons=__WEBPACK_IMPORTED_MODULE_2_lodash_difference___default()(allIcons,this.selectableIcons);if(icons.length>0){var items=[];icons.each(function(icon){var className="lib_"+Icon.sectionToString(icon.library,icon.section)+(_this2.icons.include(icon)?" selected":"");items.push({name:icon.fullName(),className:className,element:React.createElement("span",{style:{backgroundPosition:"0 "+24*-icon.getSpritePosition()+"px"}})})}),this.iconsPanel||(this.iconsPanel=new __WEBPACK_IMPORTED_MODULE_8_ui_core_popover__.c("filtericon")),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_6_ui_components_popovers_emojiPopover__.a,{className:"icon-grid",emojis:items,elementsInRow:Math.min(8,items.length),onSelect:this.addIcon.bind(this)}),this.iconsPanel.widgetContainer),$("btn_filtericon").show()}else $("btn_filtericon").hide()},addToSelectableIcons:function(icon){this.selectableIcons.unshift(icon);for(var all=this.selectableIcons.length;all>0;){var lastIcon=this.selectableIcons[all];!this.icons.include(lastIcon)&&this.selectableIcons.length>5&&(this.selectableIcons=this.selectableIcons.without(lastIcon)),all--}if(this.selectableIcons.length>4)for(all=this.selectableIcons.length;all>4;)lastIcon=this.selectableIcons[all],this.selectableIcons=this.selectableIcons.without(lastIcon),all--;this.buildIcons()},onAddIcon:function(event,icon){event&&Event.stop(event),this.addIcon(icon.fullName())},addIcon:function(iconName){var icon=Icon.get(iconName);return this.icons.include(icon)?(this.icons=this.icons.without(icon),mm$("filtericon_"+icon.fullName())&&removeClassName(mm$("filtericon_"+icon.fullName()).parentNode,"selected"),this.renderPopover()):(this.icons.push(icon),this.selectableIcons.include(icon)||this.addToSelectableIcons(icon),mm$("filtericon_"+icon.fullName())&&addClassName(mm$("filtericon_"+icon.fullName()).parentNode,"selected")),this.doFilter(),!1},_updatePopoverOpener:function(value){var icon=MM.ui.icon({name:this.filterTypes[value],size:14,color:"grey3"}),triangle=MM.ui.icon({name:"triangle",size:9,color:"grey3"});this.popover.opener.innerHTML=icon+triangle},setPanelValue:function(value){(""==this.field.value||hasClassName(this.field,"inactive"))&&(this.field.value=I18n.t("js.filter_"+value),Form.defaultHint(this.field.id)),"icons"==value?(this.searchField.clear(),this.clearText(),hide(this.field),show(mm$("grd_filter")),this.buildIcons()):"icons"==this.type&&(hide(mm$("grd_filter")),show(this.field)),this.type=value,this._updatePopoverOpener(value),this.unblurMap(),this.doFilter()},filterText:function(node){var matched=!1;switch(this.type){case"all":var task=node.task,note=node.note,user=users?users.findByID(node.modifiedBy,!0):null;matched=node.getRawTitle().toLowerCase().indexOf(this.text)>=0||task&&task.resource&&task.resource.name.toLowerCase().indexOf(this.text)>=0||note&&note.toLowerCase().indexOf(this.text)>=0||user&&user.name&&user.name.toLowerCase().indexOf(this.text)>=0;break;case"idea":matched=node.getRawTitle().toLowerCase().indexOf(this.text)>=0;break;case"author":var user=users?users.findByID(node.modifiedBy,!0):null;matched=user&&user.name&&user.name.toLowerCase().indexOf(this.text)>=0;break;case"task":var task=node.task;matched=task&&task.resource&&task.resource.name.toLowerCase().indexOf(this.text)>=0}return matched}};__webpack_exports__.default=Filter}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},Qy9x:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var VNodeVideo=Class.create({vnode:null,idea_video:null,initialize:function(vnode,video){this.vnode=vnode,this.idea_video=video,this.idea_video&&(this.el=new Element("div",{className:"tk_video_container"}),this.el.appendChild(this.idea_video.getElement()))},updateVideo:function(video){this.idea_video=video,this.idea_video.el=null,this.el.update(this.idea_video.getElement())},remove:function(){this.vnode.dcontent.removeChild(this.dcontainer)},showPlaceholder:function(){if(mm$("video_placeholder"+this.vnode.node.id))return void(this.placeholder=mm$("video_placeholder_"+this.vnode.node.id));this.el.setStyle({opacity:0,visibility:"hidden"});var thumbnail=MM.ui.icon({name:"play",size:16,color:"grey-lighter",clickable:!1,parentClasses:"h-a-center"});this.placeholder=new Element("div",{id:"video_placeholder_"+this.vnode.node.id,className:"tk_video_placeholder video_border h-a-center"}).insert(thumbnail),this.el.parentNode.appendChild(this.placeholder)},removePlaceholder:function(){this.el.setStyle({opacity:1,visibility:""}),this.placeholder&&this.el.parentNode.removeChild(this.placeholder)}});__webpack_exports__.default=VNodeVideo},Qziv:function(module,exports){function stubFalse(){return!1}module.exports=stubFalse},"Rq/x":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vroot__=__webpack_require__("Wp5U"),__WEBPACK_IMPORTED_MODULE_1_app_ui_filter__=__webpack_require__("QHRq"),__WEBPACK_IMPORTED_MODULE_2_ui_fullscreen__=__webpack_require__("wgYI"),MapView=Class.create({el:null,root:null,mode:null,NAV:!0,EDIT:!1,initialize:function(){Event.observe(this.container,"scroll",function(){GeneralPopover.getLastOpened()&&GeneralPopover.getLastOpened().sizeAndPosition()})},hasMapFeature:function(feature){return this.features.indexOf(feature)>=0},initEditMode:function(){this.navigationMode(),this._navigationKeyMap?this._navigationKeyMap.enable():this._navigationKeyMap=new MM.utils.KeyMap(document,"navigation_keymap",[]),this._editKeyMap?this._editKeyMap.enable():this._editKeyMap=new MM.utils.KeyMap(document,"edit_keymap",[])},initViewOnlyMode:function(){this.navigationMode(),this._viewOnlyKeyMap?this._viewOnlyKeyMap.enable():this._viewOnlyKeyMap=new MM.utils.KeyMap(document,"viewonly_keymap",[]),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable()},disableEditMode:function(){},disableViewOnlyMode:function(){},enableViewOnlyMode:function(node){node.initViewOnlyMode(),node.children.each(function(child){this.enableViewOnlyMode(child)}.bind(this))},enableEditMode:function(node){node.initEditMode(),node.children.each(function(child){this.enableEditMode(child)}.bind(this))},postLoad:function(){},buildFromModel:function(){this.root=new __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vroot__.default(tree.root),tree.root._listener=this.root,this.root.buildFromModel()},destroy:function(){this.removeFocus(),this.root.destroy(),this.el.innerHTML=""},__onStartEdit:function(){this.editMode()},__onStopEdit:function(){this.navigationMode()},editMode:function(){this.mode!=this.EDIT&&(this.mode=this.EDIT)},navigationMode:function(){this.mode!=this.NAV&&(this.mode=this.NAV)},addFocus:function(){Windows.focusedWindow||(App.config.editable&&App.config.currentlyEditable?this.mode==this.EDIT&&this._editKeyMap?(this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap.enable()):this._navigationKeyMap&&(this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap.enable()):this._viewOnlyKeyMap&&(this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._viewOnlyKeyMap.enable()),App.ui.Footer&&"slideshow"===App.ui.Footer.activeBar&&App.ui.SlideShow&&App.ui.SlideShow.keyMap&&!Presentation.on&&App.ui.SlideShow.keyMap.enable(),MM.ua.isBrowser("Internet Explorer")||this.el.focus(),void 0!==__WEBPACK_IMPORTED_MODULE_1_app_ui_filter__.default&&__WEBPACK_IMPORTED_MODULE_1_app_ui_filter__.default.searchField&&__WEBPACK_IMPORTED_MODULE_1_app_ui_filter__.default.searchField.field.blur&&__WEBPACK_IMPORTED_MODULE_1_app_ui_filter__.default.searchField.field.blur(),this.hasFocus=!0)},removeFocus:function(){this.mode=null,App.config.editable&&App.config.currentlyEditable?(this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.disable()):this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),App.ui.Footer&&"slideshow"===App.ui.Footer.activeBar&&void 0!==App.ui.SlideShow&&App.ui.SlideShow.keyMap.disable(),this.hasFocus=!1},onToggleFullscreen:function(){__WEBPACK_IMPORTED_MODULE_2_ui_fullscreen__.a.toggle()},onShowDialog:function(dlg){sideBar&&sideBar[dlg].showDialog()},onUndo:function(){ServerConnection.isPending()||(App.config.shareMode===App.MULTI?Message.show(I18n.t("js.undo_in_collaboration_mode"),Message.NOTICE,8):(MM.ui.enableButton("btn_redo"),ServerConnection.undo())),App.trigger(CustomEvents.UNDO)},onRedo:function(){App.config.shareMode==App.MULTI||ServerConnection.isPending()||(App.config.shareMode===App.MULTI?Message.show(I18n.t("js.redo_in_collaboration_mode"),Message.NOTICE,8):(MM.ui.enableButton("btn_undo"),ServerConnection.redo()))},onToggleSidebar:function(){sideBar&&sideBar.toggle(!0)},toEditMode:function(){if(this.root&&this.enableEditMode(this.root),this.initEditMode(),this._viewOnlyKeyMap&&this._viewOnlyKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.enable(),"undefined"!=typeof canvas&&canvas){var nodeToSelect;if(canvas.selected&&document.body.contains(canvas.selected.dcontent.el))nodeToSelect=canvas.selected;else if(App.config.targetId){var target=tree.root.getChild(App.config.targetId);nodeToSelect=target&&target._listener?target._listener:canvas.root}else nodeToSelect=canvas.root;nodeToSelect&&nodeToSelect.dcontent&&nodeToSelect.select()}},toViewMode:function(){this.root&&this.enableViewOnlyMode(this.root),this.disableEditMode(),this._navigationKeyMap&&this._navigationKeyMap.disable(),this._editKeyMap&&this._editKeyMap.disable(),this.initViewOnlyMode()}});__webpack_exports__.default=MapView},TEdV:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_ui_users__=__webpack_require__("ePfb");App.Layout={autoAlign:!0,elasticLayout:!0,rootChildrenPosition:!1,orientation:null,minOffset:[10,0],initialize:function(){},getLineStyle:function(){return App.config.mapTheme.line.style},paintRoot:function(){canvas.el.appendChild(canvas.root.dcontent.el),canvas.root.reposition(),canvas.root.dcontent.doMove()},paintRootChild:function(rootChild,atMapInit){return canvas.el.appendChild(rootChild.vnode.dcontainer.el),rootChild.reposition(),!0},repositionRootChild:function(rootChild,uid){if(rootChild.vnode.node.pos){if(uid)var moveClone=rootChild.vnode.node.cloneWithPosition(rootChild.vnode.dcontainer.el);rootChild.vnode.dcontainer.move(rootChild.domCoords()),rootChild.orientation!==rootChild.getOrientation()&&(rootChild.orientation=rootChild.getOrientation(),rootChild.orientation===App.Layouts.orientation.left?addClassName(rootChild.vnode.dcontainer.el,"left_pane"):removeClassName(rootChild.vnode.dcontainer.el,"left_pane")),rootChild.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),uid&&void 0!==__WEBPACK_IMPORTED_MODULE_0_app_ui_users__.default&&__WEBPACK_IMPORTED_MODULE_0_app_ui_users__.default&&__WEBPACK_IMPORTED_MODULE_0_app_ui_users__.default.highlightMovement(rootChild.vnode,uid,moveClone)}},refreshRootChildLayout:function(rootChild){var current=rootChild.vnode.getContentOffset(),old=rootChild.vnode.dcontent.pos;rootChild.vnode.dcontainer.shift([old[0]-current[0],old[1]-current[1]]),rootChild.vnode.dcontainer.doMove(),rootChild.vnode.dcontent.move(current),rootChild.redrawLines()},mapSize:function(){return rectangleLayouter.getTotalSize()},canvasBounds:function(){var offsetX=0,offsetY=0;if(this.autoAlign){var mapSize=this.mapSize(),offset=mapSize.offset,maxWidth=mapSize.width+(offset?offset[0]:0),maxHeight=mapSize.height+(offset?offset[1]:0);this.orientation===App.Layouts.orientation.left||this.orientation===App.Layouts.orientation.right?maxWidth*=2:this.orientation===App.Layouts.orientation.down&&(maxHeight*=2)}else var rectangleSize=rectangleLayouter.getTotalSize(),onTheLeft=rectangleSize.centerOffset[0],onTheRight=rectangleSize.width-rectangleSize.centerOffset[0]+App.SIDEBAR_WIDTH,onTop=rectangleSize.centerOffset[1],onTheBottom=rectangleSize.height-rectangleSize.centerOffset[1],maxWidth=Math.max(2*onTheLeft,2*onTheRight,rectangleSize.width),maxHeight=Math.max(2*onTop,2*onTheBottom,rectangleSize.height);return canvas.size[0]<maxWidth&&(offsetX=maxWidth-canvas.size[0]),canvas.size[1]<maxHeight&&(offsetY=maxHeight-canvas.size[1]),[offsetX,offsetY]},nextTopicPosition:function(parent){return null}},App.Layouts={},App.Layouts.orientation={left:0,right:1,up:2,down:4},App.Layouts.Default=Object.extend(Object.clone(App.Layout),{id:0,name:"default",autoAlign:!1,rootChildrenPosition:!0}),App.Layouts.Aligned=Object.extend(Object.clone(App.Layout),{id:1,name:"aligned",rootChildrenPosition:!0,paintRoot:function(){var map=document.createElement("div");canvas.root._leftContainer=document.createElement("div"),canvas.root._rightContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),map.id="tk_map",canvas.root._leftContainer.id="tk_rootchildren_left",canvas.root._leftContainer.className="tk_children",canvas.root._rightContainer.id="tk_rootchildren_right",canvas.root._rightContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(map),map.appendChild(canvas.root._leftContainer),map.appendChild(canvas.root._rootContainer),map.appendChild(canvas.root._rightContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(rootChild,atMapInit){rootChild.orientation=rootChild.getOrientation();var container=rootChild.orientation===App.Layouts.orientation.left?canvas.root._leftContainer:canvas.root._rightContainer,self=rootChild,children=canvas.root.children.filter(function(c){return c.rc.orientation===self.orientation&&c.rc!==self});children.sort(function(a,b){return a.node.pos[1]-b.node.pos[1]});for(var i=0;i<children.length&&!(children[i].node.pos[1]>=rootChild.vnode.node.pos[1]);i++);return i<children.length?container.insertBefore(rootChild.vnode.dcontainer.el,children[i].dcontainer.el):container.appendChild(rootChild.vnode.dcontainer.el),canvas.root._refreshRootCAngles(),atMapInit||rootChild.vnode.refreshLayout(),!0},repositionRootChild:function(rootChild,uid){if(rootChild.vnode.node.pos){var changedOrientation=rootChild.orientation!==rootChild.getOrientation();rootChild.paint(),changedOrientation&&canvas.root.children.each(function(c){c.rc.calculateLinePoints();var offsetY=c.rc.graphics.translateLines();offsetY&&c.rc.translateBoundaries({x:0,y:offsetY})}),rectangleLayouter.updateAll()}},refreshRootChildLayout:function(rootChild){canvas.root.reposition();for(var self=rootChild,children=canvas.root.children.filter(function(c){return c.rc.orientation===self.orientation&&c.rc!==self}),i=0;i<children.length;i++){var c=children[i];c.rc.calculateLinePoints();var offsetY=c.rc.graphics.translateLines();offsetY&&c.rc.translateBoundaries({x:0,y:offsetY})}},mapSize:function(){var _canvas$root=canvas.root,_leftContainer=_canvas$root._leftContainer,_rootContainer=_canvas$root._rootContainer,_rightContainer=_canvas$root._rightContainer,leftSize={width:_leftContainer.clientWidth,height:_leftContainer.clientHeight},rootSize={width:_rootContainer.clientWidth+100,height:_rootContainer.clientHeight},rightSize={width:_rightContainer.clientWidth,height:_rightContainer.clientHeight},leftContainerOffset=_leftContainer.cumulativeOffset();return{width:leftSize.width+rootSize.width+rightSize.width,height:Math.max(leftSize.height,rootSize.height,rightSize.height),offset:leftContainerOffset,centerOffset:[leftSize.width+rootSize.width/2,_rootContainer.cumulativeOffset().top+rootSize.height/2-Math.min(leftContainerOffset.top,_rightContainer.cumulativeOffset().top)]}},nextTopicPosition:function(parent){if(!parent.isRoot())return null;var position,rightNodes=[],leftNodes=[];if(parent.children.each(function(child){child.pos[0]>0?rightNodes.push(child):leftNodes.push(child)}),rightNodes.length<2||rightNodes.length<leftNodes.length){var sibling=rightNodes.sort(function(a,b){return b.pos[1]-a.pos[1]})[0];position=[100,sibling?sibling.pos[1]+75:0]}else{var sibling=leftNodes.sort(function(a,b){return b.pos[1]-a.pos[1]})[0];position=[-100,sibling?sibling.pos[1]+75:0]}return position}}),App.Layouts.AutoAlignedLayout=Object.extend(Object.clone(App.Layout),{elasticLayout:!1,repositionRootChild:function(rootChild,uid){rootChild.paint(),canvas.root._refreshRootCAngles()},refreshRootChildLayout:function(rootChild){canvas.root.reposition();for(var self=rootChild,children=canvas.root.children.filter(function(c){return c.rc!=self}),i=0;i<children.length;i++){var c=children[i];c.rc.calculateLinePoints();var offsetY=c.rc.graphics.translateLines();offsetY&&c.rc.translateBoundaries({x:0,y:offsetY})}}}),App.Layouts.OrgChart=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:2,name:"org_chart",orientation:App.Layouts.orientation.down,getLineStyle:function(){return MapTheme.lineStraightCorner},paintRoot:function(){var map=document.createElement("div");canvas.root._rootContainer=document.createElement("div"),canvas.root._rootChildrenContainer=document.createElement("div"),map.id="tk_map",canvas.root._rootContainer.id="tk_rootcontainer",canvas.root._rootChildrenContainer.id="tk_rootchildrencontainer",canvas.el.appendChild(map),map.appendChild(canvas.root._rootContainer),map.appendChild(canvas.root._rootChildrenContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(rootChild,atMapInit){rootChild.vnode.node.pos||(rootChild.vnode.node.pos=[0,0]),rootChild.orientation=App.Layouts.orientation.right;var container=canvas.root._rootChildrenContainer,children=canvas.root.children;children.sort(function(a,b){return a.node.pos[0]===b.node.pos[0]?a.node.pos[1]-b.node.pos[1]:a.node.pos[0]-b.node.pos[0]});var i=children.indexOf(rootChild.vnode)+1;return i<children.length&&mm$(children[i].dcontainer.el.id)?container.insertBefore(rootChild.vnode.dcontainer.el,children[i].dcontainer.el):container.appendChild(rootChild.vnode.dcontainer.el),atMapInit||rootChild.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var rootChildrenContainer=mm$("tk_rootchildrencontainer"),width=rootChildrenContainer.scrollWidth,height=mm$("tk_rootcontainer").clientHeight+rootChildrenContainer.clientHeight+40,offsetLeft=rootChildrenContainer.cumulativeOffset().left,rootSize=canvas.root.getSize();return rootSize[1]+=40,{width:width,height:height,offset:[offsetLeft<this.minOffset[0]?this.minOffset[0]:0,0],centerOffset:[canvas.root.dcontent.el.cumulativeOffset().left+rootSize[0]/2-offsetLeft,rootSize[1]/2]}},nextTopicPosition:function(parent){if(!parent.isRoot())return null;var lastChild=parent.children.sort(function(a,b){return b.pos[0]-a.pos[0]})[0];return lastChild?[lastChild.pos[0]+75]:[100,0]}}),App.Layouts.LeftAligned=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:3,name:"left_aligned",orientation:App.Layouts.orientation.left,paintRoot:function(){var map=document.createElement("div");canvas.root._leftContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),map.id="tk_map",canvas.root._leftContainer.id="tk_rootchildren_left",canvas.root._leftContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(map),map.appendChild(canvas.root._leftContainer),map.appendChild(canvas.root._rootContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(rootChild,atMapInit){rootChild.vnode.node.pos||(rootChild.vnode.node.pos=[0,0]),rootChild.orientation=this.orientation;var container=canvas.root._leftContainer,self=rootChild,children=canvas.root.children.filter(function(c){return c.rc!=self});children.sort(function(a,b){return a.node.pos[1]-b.node.pos[1]});for(var i=0;i<children.length&&!(children[i].node.pos[1]>=rootChild.vnode.node.pos[1]);i++);return i<children.length&&mm$(children[i].dcontainer.el.id)?container.insertBefore(rootChild.vnode.dcontainer.el,children[i].dcontainer.el):container.appendChild(rootChild.vnode.dcontainer.el),atMapInit||rootChild.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var totalWidth=mm$("tk_rootcontainer").clientWidth+mm$("tk_rootchildren_left").clientWidth,totalHeight=mm$("tk_rootchildren_left").clientHeight;mm$("tk_rootcontainer").clientHeight>totalHeight&&(totalHeight=mm$("tk_rootcontainer").clientHeight);var rootSize=[mm$("tk_rootcontainer").clientWidth,mm$("tk_rootcontainer").clientHeight];return{width:totalWidth,height:totalHeight,offset:[0,0],centerOffset:[mm$("tk_rootchildren_left").clientWidth+rootSize[0]/2,mm$("tk_rootcontainer").cumulativeOffset().top+rootSize[1]/2-mm$("tk_rootchildren_left").cumulativeOffset().top]}},nextTopicPosition:function(parent){if(!parent.isRoot())return null;var lastChild=parent.children.sort(function(a,b){return b.pos[1]-a.pos[1]})[0];return lastChild?[lastChild.pos[0],lastChild.pos[1]+75]:[-100,0]}}),App.Layouts.RightAligned=Object.extend(Object.clone(App.Layouts.AutoAlignedLayout),{id:4,name:"right_aligned",orientation:App.Layouts.orientation.right,paintRoot:function(){var map=document.createElement("div");canvas.root._rightContainer=document.createElement("div"),canvas.root._rootContainer=document.createElement("div"),map.id="tk_map",canvas.root._rightContainer.id="tk_rootchildren_right",canvas.root._rightContainer.className="tk_children",canvas.root._rootContainer.id="tk_rootcontainer",canvas.el.appendChild(map),map.appendChild(canvas.root._rootContainer),map.appendChild(canvas.root._rightContainer),canvas.root._rootContainer.appendChild(canvas.root.dcontent.el)},paintRootChild:function(rootChild,atMapInit){rootChild.vnode.node.pos||(rootChild.vnode.node.pos=[0,0]),rootChild.orientation=this.orientation;var container=canvas.root._rightContainer,self=rootChild,children=canvas.root.children.filter(function(c){return c.rc!==self});children.sort(function(a,b){return a.node.pos[1]-b.node.pos[1]});for(var i=0;i<children.length&&!(children[i].node.pos[1]>=rootChild.vnode.node.pos[1]);i++);return i<children.length&&mm$(children[i].dcontainer.el.id)?container.insertBefore(rootChild.vnode.dcontainer.el,children[i].dcontainer.el):container.appendChild(rootChild.vnode.dcontainer.el),atMapInit||rootChild.vnode.refreshLayout(),canvas.root._refreshRootCAngles(),!0},mapSize:function(){var totalWidth=mm$("tk_rootcontainer").clientWidth+mm$("tk_rootchildren_right").clientWidth,totalHeight=mm$("tk_rootchildren_right").clientHeight;mm$("tk_rootcontainer").clientHeight>totalHeight&&(totalHeight=mm$("tk_rootcontainer").clientHeight);var rootSize=[mm$("tk_rootcontainer").clientWidth,mm$("tk_rootcontainer").clientHeight];return{width:totalWidth,height:totalHeight,offset:[0,0],centerOffset:[rootSize[0]/2,canvas.root.dcontent.el.cumulativeOffset().top+rootSize[1]/2-mm$("tk_rootchildren_right").cumulativeOffset().top]}},nextTopicPosition:function(parent){if(!parent.isRoot())return null;var lastChild=parent.children.sort(function(a,b){return b.pos[1]-a.pos[1]})[0];return lastChild?[lastChild.pos[0],lastChild.pos[1]+75]:[100,0]}}),App.Layouts.get=function(id){switch(id){case 0:return App.Layouts.Default;case 1:return App.Layouts.Aligned;case 2:return App.Layouts.OrgChart;case 3:return App.Layouts.LeftAligned;case 4:return App.Layouts.RightAligned;default:return App.Layouts.Default}},App.Layouts.getAll=function(){return[App.Layouts.Default,App.Layouts.Aligned,App.Layouts.LeftAligned,App.Layouts.RightAligned,App.Layouts.OrgChart]}},TIa6:function(module,exports,__webpack_require__){function basePickBy(object,paths,predicate){for(var index=-1,length=paths.length,result={};++index<length;){var path=paths[index],value=baseGet(object,path);predicate(value,path)&&baseSet(result,castPath(path,object),value)}return result}var baseGet=__webpack_require__("Vf/c"),baseSet=__webpack_require__("ylcm"),castPath=__webpack_require__("Hnr2");module.exports=basePickBy},TKta:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_models_node__=__webpack_require__("HqoD"),__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vnode__=__webpack_require__("NCMo"),__WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vroot__=__webpack_require__("Wp5U"),__WEBPACK_IMPORTED_MODULE_3_app_models_boundary__=__webpack_require__("qlsV"),__WEBPACK_IMPORTED_MODULE_4_app_models_attachment__=__webpack_require__("j1ii"),__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__=__webpack_require__("ZfKP"),__WEBPACK_IMPORTED_MODULE_6_app_models_ideaProperty__=__webpack_require__("3Kh2"),__WEBPACK_IMPORTED_MODULE_7_app_models_ideaVideo__=__webpack_require__("Kh9o"),__WEBPACK_IMPORTED_MODULE_9_app_models_connectionModel__=(__webpack_require__("xfYt"),__webpack_require__("/dW8")),Change=Class.create({change:null,initialize:function(changeData){this.change=changeData,this.change.id=Change.id++},node:function(){return tree.root.getChild(this.change.idea_id)},execute:function(){},executeLocally:function(){return this.execute()},undo:function(){return this.execute(!0)},redo:function(){return this.execute()},handleResponse:MM.utils.empty,toJSON:function(){return this.change},_undo:function(without_uid){return this.execute(!0,without_uid)},_redo:function(without_uid){return this.execute(!1,without_uid)}});Change.id=0;var InsertChange=Class.create(Change,{undo:function(mode){var node=tree.root.getChild(this.change.new_data.id);return!!node&&node.parent.__onHideChild(node,mode)},_undo:function(without_uid){var node=tree.root.getChild(this.change.new_data.id);if(node)node.parent.__onRemoveChild(node);else for(var changes=[this.change.new_data].flatten(),i=0;i<changes.size();i++){var ch=changes[i];new RemoveChange({idea_id:ch.idea_id,old_data:ch.new_data}).execute(!1,without_uid)}},redo:function(){var node=tree.root.getChild(this.change.new_data.id);return!!node&&node.parent.__onShowChild(node)},_redo:function(without_uid){var node=tree.root.getChild(this.change.new_data.id);node?node.parent.__onShowChild(node):new InsertChange(this.change).execute(!1,without_uid)},_executeSimple:function(opposite,without_uid){var newData=this.change.new_data;newData.closed=newData.closed&&newData.closed.toBoolean?newData.closed.toBoolean():newData.closed||!1;var newNode=new __WEBPACK_IMPORTED_MODULE_0_app_models_node__.default(newData);if(newData.id<=tree.uncommitedId&&(tree.uncommitedId=newData.id-1),newData.icon&&mapView.hasMapFeature("icons"))for(var icons=newData.icon.split(","),i=0,len=icons.length;i<len;i++)Icon.fromFullName(icons[i]);if(newData.idea_image&&mapView.hasMapFeature("images")&&"undefined"!=typeof IdeaImage){var new_image=IdeaImage.get(newData.idea_image.id);new_image||(new_image=new IdeaImage(newData.idea_image)),newNode.idea_image=new_image}if(newData.attachments&&mapView.hasMapFeature("attachments")&&newData.attachments.length>0&&void 0!==__WEBPACK_IMPORTED_MODULE_4_app_models_attachment__.default)for(var i=0,len=newData.attachments.length;i<len;i++){var newAttachment=new __WEBPACK_IMPORTED_MODULE_4_app_models_attachment__.default(newData.attachments[i]);newNode.attachments.push(newAttachment)}if(newData.parent){var parent=tree.root.getChild(newData.parent);if(parent){if(newNode.parent=parent,(void 0===newNode.pos||null===newNode.pos)&&newNode.parent.isRoot()){var pos=App.config.layout.nextTopicPosition(newNode.parent);newNode.pos=pos,this.change.new_data.pos=pos}newNode._listener=new __WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vnode__.default(newNode);var success=without_uid?parent.__onAddChild(newNode,newData.rank):parent.__onAddChild(newNode,newData.rank,newData.modifiedBy);return canvas.liveUpdateHighlight(newNode),success}return!1}return tree.root=newNode,newNode._listener=new __WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vroot__.default(newNode),tree.root._listener.paint(),canvas.liveUpdateHighlight(newNode),!0},execute:function(opposite,without_uid){var data=this.change.new_data,parent=tree.root?tree.root.getChild(data.parent):null;if(parent&&parent.isRoot())return InsertChange.rootChild([this]);var result=this._executeSimple(opposite,without_uid),node=tree.root?tree.root.getChild(data.id):null;return node&&mapView.hasMapFeature("graphics")&&rectangleLayouter.update(node),result},handleResponse:function(response){if(!response.error){var node=tree.root.getChild(this.change.new_data.id);node&&node.changeId(response.id),ServerConnection.fixQueuedChangesIds(this.change.new_data.id,response.id)}},executeLocally:MM.utils.empty});InsertChange.rootChild=function(changes,opposite,without_uid){if(!(changes.length<=0)){var success=!0;tree.finishedInitialization||(tree.notPainted=!0);for(var i=0;i<changes.length;i++)success=success&&changes[i]._executeSimple(opposite,without_uid);var node=tree.root.getChild(changes[0].change.new_data.id);if(mapView.hasMapFeature("graphics")){if(App.config.layout.elasticLayout)var elastic=rectangleLayouter.update(node);node._listener.rc.paint(),tree.notPainted=!1,canvas.checkBounds(),App.config.layout.elasticLayout&&ChangeList.elasticLayoutChangeset(elastic)}return success}},InsertChange.toChangeArray=function(changeData,newId){var changes=[],d=changeData.new_data;if(newId&&(changeData.idea_id=changeData.new_data.id=newId),d.attachments&&d.attachments.length>0){for(var i=0,len=d.attachments.length;i<len;i++){var att=d.attachments[i];changes.push(new AddAttachmentChange({idea_id:changeData.idea_id,type:"AddAttachment",new_data:{attachment_id:att.id,details:att}}))}d.attachments=[]}return d.idea_image&&(changes.push(new AddImageChange({idea_id:changeData.idea_id,type:"AddImage",new_data:{idea_image_id:d.idea_image.id,details:d.idea_image}})),d.idea_image=null),d.boundary&&(changes.push(new AddBoundaryChange({idea_id:changeData.idea_id,type:"AddBoundary",new_data:d.boundary})),d.boundary=null),changes.unshift(new InsertChange(changeData)),changes};var RemoveChange=Class.create(Change,{undo:function(){var node=this.node();return!!node&&node.parent.__onShowChild(node)},_undo:function(without_uid){for(var connectionChanges=[],otherChanges=[],i=0,len=this.change.old_data.length;i<len;i++){var ch=this.change.old_data[i];ch.type.include("Connection")?connectionChanges.push(ch):otherChanges.push(ch)}for(var changes=otherChanges.concat(connectionChanges),i=0,len=changes.length;i<len;i++){var ch=changes[i],change=new window[ch.type+"Change"](ch),chData=change.change.new_data;"Insert"===ch.type&&(chData.modifiedAt=new Date(chData.modifiedAt)),change.execute(!1,without_uid)}},redo:function(){var node=this.node();return!!node&&node.parent.__onHideChild(node)},_redo:function(){var node=this.node();node&&node.parent.__onRemoveChild(node)},execute:function(opposite,without_uid){var node=this.node();if(node){var result=without_uid?node.parent.__onRemoveChild(node):node.parent.__onRemoveChild(node,this.change.user_id);return canvas.selected&&!canvas.selected.isVisible()&&users.selfUser&&this.change.user_id===users.selfUser.id&&canvas.scrollToNode(canvas.selected),result}return!1},executeLocally:function(){var node=this.node();node.parent.__onHideChild(node),canvas.selected&&!canvas.selected.isVisible()&&users.selfUser&&this.change.user_id===users.selfUser.id&&canvas.scrollToNode(canvas.selected)},handleResponse:function(response){if(!response.error){var node=this.node();node.parent.__onRemoveChild(node)}}}),DeleteChange=RemoveChange,RenameChange=Class.create(Change,{execute:function(opposite,without_uid){var node=this.node(),data=opposite?this.change.old_data:this.change.new_data;if(!node)return!1;var success=without_uid?node.__onRename(data.title):node.__onRename(data.title,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),TitleChange=RenameChange,RepositionChange=Class.create(Change,{execute:function(opposite,without_uid){var data=opposite?this.change.old_data:this.change.new_data,node=this.node(),nonPersistent="NonPersistentReposition"===this.change.type;return!!node&&(without_uid?node.__onReposition(data.pos,null,nonPersistent):node.__onReposition(data.pos,this.change.user_id,nonPersistent))}}),NonPersistentRepositionChange=RepositionChange,MoveChange=Class.create(Change,{execute:function(opposite,without_uid,isTemporary){var data=opposite?this.change.old_data:this.change.new_data,destination=tree.root.getChild(data.parent),source=this.node();if(destination&&source&&source.isInMapStructure()){if(without_uid)var success=source.__onMove(destination,data.rank,null,data.pos,isTemporary);else var success=source.__onMove(destination,data.rank,this.change.user_id,data.pos,isTemporary);return canvas.liveUpdateHighlight(source),success}return!1},undo:function(isTemporary){return this.execute(!0,isTemporary)},redo:function(isTemporary){return this.execute(!1,isTemporary)}}),IconChange=Class.create(Change,{execute:function(opposite,without_uid){var node=this.node();if(!node)return!1;var icon=opposite?this.change.old_data.icon:this.change.new_data.icon,success=without_uid?node.__onSetIcon(icon):node.__onSetIcon(icon,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),TextStyleChange=Class.create(Change,{execute:function(opposite,without_uid){var node=this.node();if(!node)return!1;var style=opposite?this.change.old_data.style:this.change.new_data.style;style&&(style=new Style(style));var success=without_uid?node.__onSetStyle(style):node.__onSetStyle(style,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),IdeaPropertiesChange=Class.create(Change,{execute:function(opposite,without_uid){var node=this.node();if(!node)return!1;var floating=opposite?!!this.change.old_data&&this.change.old_data.floating:!!this.change.new_data&&this.change.new_data.floating,ideaProperty=null;floating&&(ideaProperty=new __WEBPACK_IMPORTED_MODULE_6_app_models_ideaProperty__.default({floating:floating}));var success=without_uid?node.__onSetIdeaProperty(ideaProperty):node.__onSetIdeaProperty(ideaProperty,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),PropertyChange=Class.create(Change,{undo:function(type){var value=this.change.old_data[type],node=this.node();return!!node&&node.__onSetProperty(type,value)},execute:function(type,opposite,without_uid){var node=this.node();if(!node)return!1;var value=opposite?this.change.old_data[type]:this.change.new_data[type],success=without_uid?node.__onSetProperty(type,value):node.__onSetProperty(type,value,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),NoteChange=Class.create(PropertyChange,{undo:function($super){return $super("note")},execute:function($super,opposite,without_uid){return $super("note",opposite,without_uid)},handleResponse:function(response){"undefined"!=typeof sideBar&&sideBar.onSelectNode()}}),LinkChange=Class.create(PropertyChange,{undo:function($super){return $super("link")},execute:function($super,opposite,without_uid){return $super("link",opposite,without_uid)}}),TaskChange=Class.create(PropertyChange,{undo:function($super){return $super("task")},execute:function($super,opposite,without_uid){return $super("task",opposite,without_uid)}}),AddAttachmentChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveAttachmentChange({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var node=this.node();if(!node)return!1;var attachment=__WEBPACK_IMPORTED_MODULE_4_app_models_attachment__.default.get(this.change.new_data.attachment_id);if(!attachment){var a=this.change.new_data.details;attachment=new __WEBPACK_IMPORTED_MODULE_4_app_models_attachment__.default(a)}return without_uid?node.__onAddAttachment(attachment):node.__onAddAttachment(attachment,this.change.user_id),"undefined"!=typeof sideBar&&sideBar&&sideBar.attachments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.attachments.onAddAttachment(attachment),canvas.liveUpdateHighlight(node),!0}}),RemoveAttachmentChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddAttachmentChange({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var node=this.node();if(!node)return!1;var att=__WEBPACK_IMPORTED_MODULE_4_app_models_attachment__.default.get(this.change.old_data.attachment_id);return without_uid?node.__onRemoveAttachment(att):node.__onRemoveAttachment(att,this.change.user_id),"undefined"!=typeof sideBar&&sideBar&&sideBar.attachments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.attachments.onRemoveAttachment(att),canvas.liveUpdateHighlight(node),!0}}),AddCommentChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveCommentChange({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var node=this.node();if(!node)return!1;var comment=__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default.get(this.change.new_data.idea_comment_id);return comment||(comment=new __WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default(this.change.new_data)),without_uid?node.__onAddComment(comment):node.__onAddComment(comment,this.change.user_id),"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onAddComment(comment),canvas.liveUpdateHighlight(node),!0},handleResponse:function(response){if(!response.error){var comment=__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default.get(this.change.new_data.id);comment&&(comment.id=response.idea_comment_id,comment.text=response.text,comment.createdAt=new Date(response.created_at),comment.updatedAt=new Date(response.created_at),"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&sideBar.comments.expanded&&sideBar.comments.onCommentAdded(comment,this.change.new_data.id))}}}),EditCommentChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new EditCommentChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var comment=__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default.get(this.change.new_data.idea_comment_id);return comment&&(comment.text=this.change.new_data.text,this.change.new_data.updated_at&&(comment.updatedAt=new Date(this.change.new_data.updated_at)),"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onEditComment(comment)),canvas.liveUpdateHighlight(this.node()),!0},handleResponse:function(response){if(!response.error){var comment=__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default.get(this.change.new_data.idea_comment_id);comment&&(comment.updatedAt=new Date(response.updated_at),comment.text=response.text,"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&sideBar.comments.expanded&&sideBar.comments.onCommentEdited(comment))}}}),RemoveCommentChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddCommentChange({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var node=this.node();if(!node)return!1;var id=this.change.old_data.idea_comment_id||this.change.old_data.id,comment=__WEBPACK_IMPORTED_MODULE_5_app_models_ideaComment__.default.get(id);return comment&&(without_uid?node.__onRemoveComment(comment):node.__onRemoveComment(comment,this.change.user_id),"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onRemoveComment(comment)),canvas.liveUpdateHighlight(node),!0}}),AddVoteChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveVoteChange({idea_id:this.change.idea_id,old_data:this.change.new_data,user:this.change.user}).execute();if(void 0!==this.change.new_data&&this.change.new_data){var node=this.node();if(!node)return!1;var user=IdeaVote.getChangeUser(this.change.new_data,this.change.user),vote=IdeaVote.get(tree.root.getChild(this.change.idea_id),user.id);vote||(vote=new IdeaVote({idea_id:this.change.new_data.idea_id,user_id:user.id,vote:this.change.new_data.vote,voted_at:this.change.new_data.voted_at}));var success=without_uid?node.__onAddVote(vote):node.__onAddVote(vote,this.change.user_id);return"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onAddVote(vote),canvas.liveUpdateHighlight(node),success}}}),EditVoteChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new EditVoteChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data,user:this.change.user}).execute();var node=this.node();if(!node)return!1;var user=IdeaVote.getChangeUser(this.change.new_data,this.change.user),vote=IdeaVote.get(tree.root.getChild(this.change.idea_id),user.id);if(vote){vote.vote=this.change.new_data.vote,this.change.new_data.voted_at&&(vote.voted_at=new Date(this.change.new_data.voted_at));var success=without_uid?node.__onEditVote(vote):node.__onEditVote(vote,this.change.user_id);"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onEditVote(vote)}return canvas.liveUpdateHighlight(node),success}}),RemoveVoteChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddVoteChange({idea_id:this.change.idea_id,new_data:this.change.old_data,user:this.change.user}).execute();var node=this.node();if(!node)return!1;var user=IdeaVote.getChangeUser(this.change.old_data,this.change.user),vote=IdeaVote.get(tree.root.getChild(this.change.idea_id),user.id),success=without_uid?node.__onRemoveVote(vote):node.__onRemoveVote(vote,this.change.user_id);return"undefined"!=typeof sideBar&&sideBar&&sideBar.comments&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&sideBar.comments.onRemoveVote(vote),canvas.liveUpdateHighlight(node),success}}),AddImageChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddImageChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();if(void 0!==this.change.new_data&&this.change.new_data){var image=IdeaImage.get(this.change.new_data.idea_image_id);if(!image&&this.change.new_data.details){var img=this.change.new_data.details;image=new IdeaImage(img)}var node=this.node();if(!node)return!1;node.idea_image=image;var success=without_uid?node.__onAddImage():node.__onAddImage(this.change.user_id);return canvas.liveUpdateHighlight(node),success}},handleResponse:function(response){response.error||(response.idea_image&&(this.node().idea_image=new IdeaImage(response.idea_image),this.node().__onAddImage(this.change.user_id)),tree.root.getChild(response.idea_id).changeImageId(response.idea_image_id))}}),RemoveImageChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddImageChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:{idea_image_id:null}}).execute();var image=IdeaImage.get(this.change.old_data.idea_image_id),node=this.node();if(!node)return!1;var success=without_uid?node.__onRemoveImage(image):node.__onRemoveImage(image,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),ResizeImageChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new ResizeImageChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var image=IdeaImage.get(this.change.new_data.idea_image_id),node=this.node();if(!node)return!1;image||(image=new IdeaImage(this.change.new_data.details),node.idea_image=image),image.size=[this.change.new_data.width,this.change.new_data.height];var success=without_uid?node.__onResizeImage(image):node.__onResizeImage(image,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),AddConnectionChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveConnectionChange({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var conn=new __WEBPACK_IMPORTED_MODULE_9_app_models_connectionModel__.default(this.change.new_data);if(conn.from&&conn.to){var success=without_uid?conn.from.__onAddConnection(conn):conn.from.__onAddConnection(conn,this.change.user_id);return canvas.liveUpdateHighlight(this.node()),success}return!1}}),RemoveConnectionChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddConnectionChange({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var conn;conn=this.change.old_data?__WEBPACK_IMPORTED_MODULE_9_app_models_connectionModel__.default.get(this.change.old_data.from_id,this.change.old_data.to_id):__WEBPACK_IMPORTED_MODULE_9_app_models_connectionModel__.default.get(this.change.new_data.from_id,this.change.new_data.to_id);var node=this.node();if(!node||!conn)return!1;var success=without_uid?node.__onRemoveConnection(conn):node.__onRemoveConnection(conn,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),ConnectionPropertiesChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new ConnectionPropertiesChange({idea_id:this.change.idea_id,old_data:this.change.new_data,new_data:this.change.old_data}).execute();var conn=__WEBPACK_IMPORTED_MODULE_9_app_models_connectionModel__.default.get(this.change.new_data.from_id,this.change.new_data.to_id);return!!(conn&&conn.from&&conn.to)&&conn.__onSetProperties(this.change.new_data,without_uid?void 0:this.change.user_id)}}),ChangeConnectionColorChange=ConnectionPropertiesChange,AddVideoChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveVideoChange({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var node=this.node();if(!node)return!1;var video=new __WEBPACK_IMPORTED_MODULE_7_app_models_ideaVideo__.default(Object.extend(this.change.new_data,{idea_id:this.change.idea_id})),success=without_uid?node.__onAddVideo(video):node.__onAddVideo(video,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),RemoveVideoChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddVideoChange({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var node=this.node();if(!node)return!1;var success=without_uid?node.__onRemoveVideo():node.__onRemoveVideo(this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),EditVideoChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new EditVideoChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var node=this.node();if(!node)return!1;var video=node.idea_video;video.url=this.change.new_data.url,video.title=this.change.new_data.title,video.updateSource();var success=without_uid?node.__onAddVideo(video):node.__onAddVideo(video,this.change.user_id);return canvas.liveUpdateHighlight(node),success}}),AddBoundaryChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new RemoveBoundaryChange({idea_id:this.change.idea_id,old_data:this.change.new_data}).execute();var node=this.node();return!!node&&(node.boundary=new __WEBPACK_IMPORTED_MODULE_3_app_models_boundary__.default(Object.extend(this.change.new_data,{idea_id:this.change.idea_id})),node.__onAddBoundary(),canvas.liveUpdateHighlight(node),!0)}}),RemoveBoundaryChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new AddBoundaryChange({idea_id:this.change.idea_id,new_data:this.change.old_data}).execute();var node=this.node();return!!node&&(node.__onRemoveBoundary(),canvas.liveUpdateHighlight(node),!0)}}),EditBoundaryChange=Class.create(Change,{execute:function(opposite,without_uid){if(opposite)return new EditBoundaryChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var node=this.node();if(!node)return!1;var boundary=node.boundary;return boundary&&(boundary.view.destroy(),boundary.style.update(this.change.new_data),node.__onAddBoundary(),canvas.liveUpdateHighlight(node)),!0}}),MapThemeChange=Class.create(Change,{execute:function(opposite,without_uid){if(mapView.hasMapFeature("graphics")){if(opposite)return new MapThemeChange({idea_id:this.change.idea_id,new_data:this.change.old_data,old_data:this.change.new_data}).execute();var theme=MapTheme.get(this.change.new_data.id);return theme||(theme=new MapTheme(this.change.new_data)),MapTheme.closeActivity(),theme.id>0&&theme.root_style&&theme.root_children_style&&theme.nodes_style&&(MapTheme.activity=new MM.ui.Activity(I18n.t("js.applying_theme"),{progress:!0,autoUpdate:!0,duration:2e4}),canvas.removeTheme(App.config.mapTheme),canvas.applyTheme(theme),App.trigger(CustomEvents.THEME_CHANGED)),!0}},handleResponse:function(response){if(!response.error&&response.theme&&response.theme.id!==App.config.mapTheme.id){canvas.removeTheme(App.config.mapTheme);var theme=MapTheme.get(response.theme.id);theme||(theme=new MapTheme(response.theme)),canvas.applyTheme(theme),App.trigger(CustomEvents.THEME_CHANGED)}}}),MapPropertiesChange=Class.create(Change,{execute:function(opposite){var data=opposite?this.change.old_data:this.change.new_data;return canvas.__onSetMapProperties(data),!0}}),ChangeList=Class.create({changes:null,initialize:function(){this.changes=[]},hasPersistentChanges:function(){return this.changes.any(function(change){return"NonPersistentReposition"!==change.type})},getChange:function(id){for(var i=this.changes.length;i>0;){var change=this.changes[--i];if(change.change.id===id)return change}},toJSON:function(){return this.changes.collect(function(change){return change.toJSON()})},toArray:function(){return this.changes},_do:function(func,param){for(var success=!0,i=0,len=this.changes.length;i<len;i++)success=success&&this.changes[i][func](param);return success},execute:function(opposite){return this._do("execute",opposite)},executeLocally:function(opposite){return this._do("executeLocally",opposite)},undo:function(temporary){for(var success=!0,i=this.changes.length;i--;)success=success&&this.changes[i].undo(temporary)},redo:function(temporary){return this._do("redo",temporary)},merge:function(otherChangeList){this.changes=this.changes.concat(otherChangeList.changes)},_doLayoutingChanges:function(layoutData,type){if(0!==layoutData.length)for(var i=0,len=layoutData.length;i<len;i++){var ch,data=layoutData[i],offset=data[1],newPos=Math.offset(data[0].pos,offset);data[0].pos[0]===newPos[0]&&data[0].pos[1]===newPos[1]||(type=type||"NonPersistentReposition",ch=new window[type+"Change"]({idea_id:data[0].id,type:type,old_data:{pos:data[0].pos},new_data:{pos:newPos}}),ch.execute(),this.changes.push(ch))}},doAutoLayoutingChanges:function(){this._doLayoutingChanges(rectangleLayouter.autoLayout())},doAutoCondenseChanges:function(){this._doLayoutingChanges(rectangleLayouter.autoCondense(),"Reposition")},doAutoAlignedChanges:function(type){for(var pos,c=canvas.root.children,center=canvas.getCenter(),i=0;i<c.length;i++){pos=Math.negativeOffset(canvas.getNodeCanvasOffset(c[i]),center),type=type||"Reposition";var ch=new window[type+"Change"]({idea_id:c[i].node.id,type:type,old_data:{pos:c[i].node.pos},new_data:{pos:pos}});tree.notPainted=!0,ch.execute(),tree.notPainted=!1,this.changes.push(ch)}},doNodeLayoutingChanges:function(node){App.config.layout.autoAlign||node.isRoot()||this._doLayoutingChanges(rectangleLayouter.changeRectangleTidy(rectangleLayouter.getRectangle(node.getRootC())))},handleResponse:function(response){if(response.responses)for(var i=0,len=response.responses.length;i<len;i++){var r=response.responses[i];r.client_id&&this.getChange(r.client_id).handleResponse(r)}}});ChangeList.layoutAlteringChangeset=function(changes){var chL=new ChangeList;chL.changes=chL.changes.concat(changes),changes.each(function(change){change.execute()}),App.config.layout.autoAlign||changes.each(function(change){chL.doNodeLayoutingChanges(change.node())}),ServerConnection.doChanges(chL)},ChangeList.autoLayoutChangeset=function(){if(!App.config.layout.autoAlign){var chL=new ChangeList;return chL.doAutoLayoutingChanges(),chL}},ChangeList.elasticLayoutChangeset=function(layoutData){layoutData&&(ChangeList.lastElasticChangeset||(ChangeList.lastElasticChangeset=new ChangeList),ChangeList.lastElasticChangeset._doLayoutingChanges(layoutData))},ChangeList.executeChangesGrouped=function(changes,withoutUid){for(var group=[],rcs={},i=0;i<changes.length;i++){var change=changes[i];"Insert"===change.change.type?tree.root&&change.change.new_data.parent===tree.root.id?(InsertChange.rootChild(group),group=[change],rcs[change.change.new_data.id]=change.change.new_data.id):(group[0]&&group[0].change.new_data.id===rcs[change.change.new_data.parent]?group.push(change):(group[0]&&(InsertChange.rootChild(group),group=[]),change.execute(!1,withoutUid)),rcs[change.change.new_data.id]=rcs[change.change.new_data.parent]):(group.length>0&&(InsertChange.rootChild(group),group=[]),change.execute(!1,withoutUid))}group.length>0&&InsertChange.rootChild(group)},ChangeList.executeChanges=function(changes){for(var currentNodeAffected=!1,i=0,len=changes.length;i<len;i++){var ch=changes[i];changes[i]=new window[ch.type+"Change"](ch),changes[i].new_data&&canvas.selected&&changes[i].new_data.idea_id===canvas.selected.node.id&&(currentNodeAffected=!0),"Insert"===ch.type&&(ch.new_data.modifiedAt=new Date(ch.new_data.modifiedAt))}ChangeList.executeChangesGrouped(changes,0===App.config.shareMode&&App.config.liveUpdate);var change=changes[0]?changes[0].change:null;if(App.config.liveUpdate&&change&&tree.finishedInitialization){var ideaId=null;if("Insert"===change.type&&change.new_data&&change.new_data.id?ideaId=change.new_data.id:change.idea_id&&(ideaId=change.idea_id),ideaId){var el=mm$(ideaId.toString());el&&canvas.centerOnElement(el)}}"undefined"!=typeof sideBar&&sideBar&&("undefined"==typeof RevisionBrowser||!RevisionBrowser.on&&!RevisionBrowser.painted)&&currentNodeAffected&&sideBar.onSelectNode()},ChangeList.executeServerChanges=function(changes){for(var connectionChanges=[],otherChanges=[],i=0,len=changes.length;i<len;i++){var ch=changes[i];ch.type.include("Connection")?connectionChanges.push(ch):otherChanges.push(ch)}tree.notPainted=!1,ChangeList.executeChanges(otherChanges),ChangeList.executeChanges(connectionChanges),tree.notPainted||otherChanges.any(function(c){return"MapProperties"===c.type})&&ChangeList.autoLayoutChangeset()},window.InsertChange=InsertChange,window.RemoveChange=RemoveChange,window.DeleteChange=DeleteChange,window.RenameChange=RenameChange,window.TitleChange=TitleChange,window.RepositionChange=RepositionChange,window.NonPersistentRepositionChange=NonPersistentRepositionChange,window.MoveChange=MoveChange,window.IconChange=IconChange,window.TextStyleChange=TextStyleChange,window.IdeaPropertiesChange=IdeaPropertiesChange,window.PropertyChange=PropertyChange,window.NoteChange=NoteChange,window.LinkChange=LinkChange,window.TaskChange=TaskChange,window.AddAttachmentChange=AddAttachmentChange,window.RemoveAttachmentChange=RemoveAttachmentChange,window.AddCommentChange=AddCommentChange,window.EditCommentChange=EditCommentChange,window.RemoveCommentChange=RemoveCommentChange,window.AddVoteChange=AddVoteChange,window.EditVoteChange=EditVoteChange,window.RemoveVoteChange=RemoveVoteChange,window.AddImageChange=AddImageChange,window.RemoveImageChange=RemoveImageChange,window.ResizeImageChange=ResizeImageChange,window.AddConnectionChange=AddConnectionChange,window.RemoveConnectionChange=RemoveConnectionChange,window.ConnectionPropertiesChange=ConnectionPropertiesChange,window.ChangeConnectionColorChange=ChangeConnectionColorChange,window.AddVideoChange=AddVideoChange,window.RemoveVideoChange=RemoveVideoChange,window.EditVideoChange=EditVideoChange,window.AddBoundaryChange=AddBoundaryChange,window.RemoveBoundaryChange=RemoveBoundaryChange,window.EditBoundaryChange=EditBoundaryChange,window.MapThemeChange=MapThemeChange,window.ChangeList=ChangeList,window.MapPropertiesChange=MapPropertiesChange},U8js:function(module,exports){function isIndex(value,length){return!!(length=null==length?MAX_SAFE_INTEGER:length)&&("number"==typeof value||reIsUint.test(value))&&value>-1&&value%1==0&&value<length}var MAX_SAFE_INTEGER=9007199254740991,reIsUint=/^(?:0|[1-9]\d*)$/;module.exports=isIndex},UWmw:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_ui_components_taskWidget_resourcePopover__=__webpack_require__("+8/T"),__WEBPACK_IMPORTED_MODULE_2_ui_core_popover__=__webpack_require__("SZxL"),__WEBPACK_IMPORTED_MODULE_3_app_models_task__=__webpack_require__("AGfX"),__WEBPACK_IMPORTED_MODULE_4_app_utils_constants__=__webpack_require__("67vC"),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},TasksWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{effort_units:["hours","days","weeks","months"],initialize:function($super,sidebar,parent){$super("tasks",sidebar,parent),this.buildPopovers(),Element.bindOnClick("btn_removetask",this.removeTask.bind(this)),Element.bindOnClick("btn_autotask",this.setAutoTask.bind(this)),this.setupPromotion()},load:function($super){$super()},setupPromotion:function(){MM.utils.getCookie("ignore_mt_task_promotion")&&mm$("mt_task_promotion")&&(mm$("tasks_content").removeClassName("h-hidden"),mm$("mt_task_promotion").addClassName("h-hidden"))},buildPopovers:function(){MM.utils.loadScript("tools/datepicker.js",this.buildDatePickers.bind(this),function(){return"function"==typeof DatePicker}),this.priorityPopover&&!this.advancedOn||(this.priorityPopover=this.buildPopover("priority")),this.completePopover&&!this.advancedOn||(this.completePopover=this.buildPopover("complete")),this.resourcePopover&&!this.advancedOn||(this.resourcePopover=this.buildPopover("resource"),this.renderResourcePopover()),this.advancedOn&&(this.effortPopover=this.buildPopover("effort_units"))},renderResourcePopover:function(){var _this=this;if(canvas.selected){var node=canvas.selected.node,assignee=node.task?node.task.resource:null;ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_taskWidget_resourcePopover__.a,{users:users.allUsers,assignee:assignee,isExternalTask:!!node.externalTask,setResource:function(value){return _this.setPopoverValue("resource",value)}}),this.resourcePopover.widgetContainer)}},buildPopover:function(type){var _this2=this;if("resource"===type)return new __WEBPACK_IMPORTED_MODULE_2_ui_core_popover__.c(type,{onShow:this.renderResourcePopover.bind(this),onHide:function(){return ReactDOM.unmountComponentAtNode(_this2.resourcePopover.widgetContainer)}});var array;switch(type){case"priority":array=[-1,1,2,3,4,5,6,7].collect(function(i){return"priority_0"+i});break;case"complete":array=[-1,1,2,3,4,5].collect(function(i){return"task_"+i});break;case"effort_units":array=this.effort_units}var elements=[];array.each(function(obj){elements.push(this.getEntryForType(obj,type))}.bind(this));var popover=new Popover(type,this.setPopoverValue.bind(this,type),{offset:[0,0]});return popover.addElements(elements),popover},_getIconElement:function(id){var icon=null;id&&(icon=Icon.fromFullName(id));var element=new Element("a",{class:"iconized library ellipsis"+(icon?"":" empty"),href:"#"});return icon&&(element.id=icon.id,element.title=icon.getTitle()),element.innerHTML=icon?icon.getTitle():I18n.t("js.none"),element.style.backgroundImage=icon?'url("'+icon.url()+'")':"none",element},getEntryForType:function(value,type){switch(type){case"priority":case"complete":return this._getIconElement(value);case"resource":if((value=this.getUserFromResource(value))&&"object"==(void 0===value?"undefined":_typeof(value))){var el=new Element("a",{href:"#",className:"h-flex-row"});el.insert(value.getAvatar("small mr-5")),el.insert(new Element("span").update(value.name))}else{var el=new Element("a");el.update(value?value.escapeHTML():I18n.t("js.not_assigned"))}return el;case"effort_units":value=value.replace("effort_","");var el=new Element("a",{id:"effort_"+value,href:"#"});return el.update(I18n.t("js.helper_"+value)),el;case"startdate":var el=new Element("a");return el.update(value||I18n.t("js.not_started")),el;case"duedate":case"enddate":var el=new Element("a");return el.update(value||I18n.t("js.not_due")),el}},setPopoverValue:function(type,value){switch("none"===value&&(value=null),type){case"priority":case"complete":if(this.advancedOn)this[type+"_advanced_cache"]=value?__WEBPACK_IMPORTED_MODULE_4_app_utils_constants__.TASK[type].indexOf(value):-1;else if(value)canvas.onSetIcon(Icon.get(value));else{var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.removeIconGroup("complete"===type?"task":type,nodes)}break;case"resource":this.resourcePopover.close(),this.setResource(value);var task=canvas.selected.node.task;task&&task.resource&&task.resource.id===value&&(value=null);break;case"duedate":value=this.getFormattedDate(this.getDateFromField("duedate"));break;case"enddate":case"startdate":var startDate=this.getDateFromField("startdate"),endDate=this.getDateFromField("enddate"),changedDate="enddate"===type?endDate:startDate;startDate&&endDate&&startDate>endDate?MM.ui.dialogs.showError(I18n.t("js.start_date_is_set_after_due_date")):changedDate&&-1!==changedDate.toString().indexOf("Invalid Date")?(MM.ui.dialogs.showError(I18n.t("js.invalid_task_date")),value=null):MM.ui.dialogs.hideError(),value=this.getFormattedDate(changedDate);break;case"effort_units":this.setEffort(value)}this.updateDropdown(value,type),this.advancedOn||this.setFieldValue(type)},updatePopover:function(pname){for(var i=0;i<__WEBPACK_IMPORTED_MODULE_4_app_utils_constants__.TASK[pname].length;i++)mm$(pname+"_"+__WEBPACK_IMPORTED_MODULE_4_app_utils_constants__.TASK[pname][i]).className=canvas.selected.node["task_"+pname]==i?"selected":""},updateDropdown:function(value,type){if(mm$("btn_"+type)){$("btn_"+type).select("span")[0].update(this.getEntryForType(value,type))}},getUserFromResource:function(value){if("object"==(void 0===value?"undefined":_typeof(value)))return value;var id=value;"string"==typeof id&&(id=parseInt(id.substring(9)));var ret=users.findByID(id,!0);return"object"==(void 0===ret?"undefined":_typeof(ret))?ret:value},buildDatePickers:function(){this.advancedOn?(this.startdatepicker=new DatePicker({relative:"fld_startdate",opener:"btn_startdate",parent:"popover_startdate",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_startdate"],cellCallback:this.setPopoverValue.bind(this,"startdate")}),this.startdatepicker.load(),this.duedatepicker=new DatePicker({relative:"fld_enddate",opener:"btn_enddate",parent:"popover_enddate",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_enddate"],cellCallback:this.setPopoverValue.bind(this,"enddate")}),this.duedatepicker.load()):this.datepicker||(this.datepicker=new DatePicker({relative:"fld_duedate",opener:"btn_duedate",parent:"popover_date",language:I18n.locale,keepFieldEmpty:!0,ignore:["fld_duedate"],cellCallback:this.setPopoverValue.bind(this,"duedate")}),this.datepicker.load())},setResource:function(value){mm$("fld_resourceid").value="",mm$("fld_resource").value=value,users.allUsers.each(function(u){u.id===value&&(mm$("fld_resourceid").value=value,mm$("fld_resource").value=u.name)})},setEffort:function(value){mm$("fld_effort_units").value=I18n.t("js.helper_"+value.split("effort_")[1]),this.task_effort_key=value.split("effort_")[1],this.updateDropdown(value,"effort_units")},checkEffort:function(){var eff_val=parseInt(mm$("fld_effort").value);return isNaN(eff_val)?"":(eff_val>999&&(eff_val=999),eff_val.toString()+this.task_effort_key)},setFieldValue:function(field){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);switch(field){case"resource":var resourceValue=""!=mm$("fld_resource").value?mm$("fld_resource").value:null,resourceIdValue=""!=mm$("fld_resourceid").value?parseInt(mm$("fld_resourceid").value):null;break;case"duedate":var dueDateValue=this.getDateFromField(field)}var tasks=[];canvas.allSelected.each(function(vnode){var task=vnode.node.task,priority=-1,complete=-1,resource=resourceValue,resourceId=resourceIdValue,dueDate=dueDateValue,newTask=null;task&&(priority=task.priority,complete=task.complete,"duedate"!==field&&(dueDate=task.due),"resource"===field?task.resource&&task.resource.id&&task.resource.id===resourceIdValue&&(resourceId=null,resource=null):resource=task.resource),(dueDate||resourceId||resource||priority>-1||complete>-1)&&(newTask=new __WEBPACK_IMPORTED_MODULE_3_app_models_task__.default({due:dueDate,resource:resource,resource_id:resourceId,priority:priority,complete:complete})),task&&newTask&&task.equals(newTask)||tasks.push({node:vnode.node,task:newTask})}.bind(this)),Tree.utils.setTask(tasks)},onSelectNode:function(){canvas.selected.node.updateTaskFromIcons(canvas.selected.node.icons),["priority","complete"].each(function(g){this.updateDropdown(canvas.selected.node.task?__WEBPACK_IMPORTED_MODULE_4_app_utils_constants__.TASK[g][canvas.selected.node.task[g]]:null,g)},this);var duedate=null;canvas.selected.node.task&&canvas.selected.node.task.due?(duedate=canvas.selected.node.task.due,mm$("fld_duedate").value=duedate.toUIString(!0),mm$("fld_duedate").setAttribute("date",this.datePickerDateFormat(duedate)),mm$("fld_enddate")&&(mm$("fld_enddate").value=duedate.toUIString(!0),mm$("fld_enddate").setAttribute("date",this.datePickerDateFormat(duedate)))):(mm$("fld_duedate").value="",mm$("fld_duedate").removeAttribute("date"),mm$("fld_enddate")&&(mm$("fld_enddate").value="",mm$("fld_enddate").removeAttribute("date"))),this.updateDropdown(this.getFormattedDate(duedate),"duedate");var resource=null;if(canvas.selected.node.task&&canvas.selected.node.task.resource?(resource=mm$("fld_resource").value=canvas.selected.node.task.resource.name||"",canvas.selected.node.task.resource.id?(mm$("fld_resourceid").value=canvas.selected.node.task.resource.id,users.findByID(canvas.selected.node.task.resource.id,!0)&&(resource=canvas.selected.node.task.resource.id)):mm$("fld_resourceid").value=""):(mm$("fld_resource").value="",mm$("fld_resourceid").value=""),this.updateDropdown(resource,"resource"),this.advancedOn){this.updateDropdown(this.getFormattedDate(duedate),"enddate");var start_date=null;if(canvas.selected.node.task&&canvas.selected.node.task.from&&(start_date=canvas.selected.node.task.from,mm$("fld_startdate").value=start_date.toUIString(!0),mm$("fld_startdate").setAttribute("date",this.datePickerDateFormat(start_date))),this.updateDropdown(this.getFormattedDate(start_date),"startdate"),canvas.selected.node.task&&canvas.selected.node.task.effort){mm$("fld_effort").value=parseInt(canvas.selected.node.task.effort)||"";var eff_units=canvas.selected.node.task.effort.sub(parseInt(canvas.selected.node.task.effort).toString(),"");mm$("fld_effort_units").value=eff_units,mm$("effort_"+eff_units).parentNode.className+=(mm$("effort_"+eff_units).parentNode.className?" ":"")+"selected",this.setEffort("effort_"+eff_units)}else mm$("fld_effort_units")&&(mm$("fld_effort_units").value=I18n.t("js.helper_hours"),this.setEffort("effort_hours"))}},showDialog:function(){canvas.selected?(this.datepicker.disable(),canvas.removeFocus(),this.advancedOn=!0,MM.ui.dialogs.show("task",{height:350,width:640,action:"task_details_ajax/"+canvas.selected.node.id,onClose:function(){canvas.addFocus(),this.advancedOn=!1,this.buildPopovers()}.bind(this)}),this.task_notification=null,this.priority_advanced_cache=canvas.selected.node.task?canvas.selected.node.task.priority:-1,this.complete_advanced_cache=canvas.selected.node.task?canvas.selected.node.task.complete:-1):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetNotification:function(value){this.task_notification=value},beforeSetTask:function(){this.startdatepicker&&this.duedatepicker&&(this.startdatepicker.disable(),this.duedatepicker.disable())},saveAdvancedTask:function(ok){if(this.beforeSetTask(),ok){var task=new __WEBPACK_IMPORTED_MODULE_3_app_models_task__.default({from:this.getDateFromField("startdate"),due:this.getDateFromField("enddate"),resource:""!=mm$("fld_resource").value?mm$("fld_resource").value:null,resource_id:""!=mm$("fld_resourceid").value?parseInt(mm$("fld_resourceid").value):null,effort:this.checkEffort(),priority:this.priority_advanced_cache,complete:this.complete_advanced_cache}),tasks=[];canvas.allSelected.each(function(vnode){vnode.node.task&&vnode.node.task.equals(task)||tasks.push({node:vnode.node,task:task})}.bind(this)),tasks.length>0&&Tree.utils.setTask(tasks),setTimeout(this.onSelectNode.bind(this),500),this.task_notification&&canvas.selected.node.setTaskNotify(this.task_notification)}},onCloseDialog:function(ok){Windows.close("task"),this.saveAdvancedTask(ok),this.datepicker.enable()},removeTask:function(){canvas.selected?(canvas.onRemoveTask(),this.onSelectNode()):Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},setAutoTask:function(){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);var priority=Math.floor(6*Math.random()),complete=Math.floor(4*Math.random()),dueDate=new Date;if(dueDate.setHours(12),dueDate.setMinutes(0),dueDate.setSeconds(0),dueDate.setDate(dueDate.getDate()+7),dueDate=Date.toUTC(dueDate.getTime()),void 0===this.user_advanced_cache||this.user_advanced_cache===users.allUsers.length-1?this.user_advanced_cache=0:this.user_advanced_cache++,users.allUsers[this.user_advanced_cache])var task=new __WEBPACK_IMPORTED_MODULE_3_app_models_task__.default({from:null,due:dueDate,effort:null,priority:priority,complete:complete,resource:users.allUsers[this.user_advanced_cache].name,resource_id:users.allUsers[this.user_advanced_cache].id});else var task=new __WEBPACK_IMPORTED_MODULE_3_app_models_task__.default({from:null,due:dueDate,effort:null,priority:priority,complete:complete,resource:null});var tasks=[];canvas.allSelected.each(function(vnode){tasks.push({node:vnode.node,task:task})}),Tree.utils.setTask(tasks),this.onSelectNode(),Amplitude.logEvent("wunder_task")},getFormattedDate:function(date){return date?Date.fromUTC(date).toUIString(!0):date},datePickerDateFormat:function(date){return date?date.getMonth()+1+"/"+date.getDate()+"/"+date.getFullYear():date},prepareDate:function(date){if(!date)return date;var newDate=new Date(date);return newDate.setHours(12),newDate.setMinutes(0),newDate.setSeconds(0),newDate.setTime(newDate.getTime()-60*newDate.getTimezoneOffset()*1e3),newDate=Date.toUTC(newDate.getTime())},getDateFromField:function(fieldName){var date=this.prepareDate(mm$("fld_"+fieldName).getAttribute("date"));return date&&-1!==date.toString().indexOf("Invalid Date")?null:date}});__webpack_exports__.default=TasksWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},UeFO:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var VNodeIcon=Class.create({vnode:null,icon:null,initialize:function(vnode,icon){if(this.icon=icon,this.vnode=vnode,this.icon){this.el=new Element("div",{className:"tk_icon_container"}),this.el.writeAttribute("icon-id",this.icon.id);var imageElement=this.icon.getElement({className:"tk_icon i16"});this.el.appendChild(imageElement),this.listener=canvas.onSetGroupIcon.bindAsEventListener(canvas,vnode.node,icon);var index=vnode.node.icons.indexOf(this.icon);(vnode.image||vnode.video)&&index++,vnode.dcontent.insertChild(this,index),App.config.editable&&App.config.currentlyEditable&&this.enable()}},animate:function(){var el=childElements(this.el)[0];addClassName(el,"appear"),setTimeout(function(){removeClassName(el,"appear")},300)},animateDeletion:function(options){CSS.set(childElements(this.el)[0],{transform:CSS.scale(.1),transformOrigin:"50% 50%",transitionDuration:"300ms"}),options.onFinish&&setTimeout(function(){options.onFinish(this)}.bind(this),300)},disable:function(){addClassName(this.el,"disabled"),this.el.stopObserving("click",this.listener)},enable:function(){removeClassName(this.el,"disabled"),this.el.observe("click",this.listener)}});__webpack_exports__.default=VNodeIcon},VQwZ:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__graphics__=__webpack_require__("t8zp"),__WEBPACK_IMPORTED_MODULE_1__vconnection__=__webpack_require__("xAzy");__webpack_exports__.default=Class.create({el:null,pos:null,arrindex:null,connection:null,initialize:function(pos,arrindex,connection){this.arrindex=arrindex,this.connection=connection,this.pos=pos,this.uid=this.connection.raphael_id,this.el||(this.el=new Element("div",{id:"connection_handler_"+this.uid+"_"+this.arrindex,className:"connection_handle",width:"20px",height:"20px"})),canvas.el.appendChild(this.el),this.draggable=new Draggable(this.el,{onStart:this._onStart.bind(this),onDrag:this._onDrag.bind(this),onEnd:this._onEnd.bind(this),starteffect:!1,endeffect:!1,revert:this._onRevert.bind(this),reverteffect:this._onRevertUpdate.bind(this)}),Event.observe(this.el,"mousedown",this._onMouseDown.bind(this)),this.move(pos),this.hide(),this.mouseStartX=0,this.mouseStartY=0,this.dx=0,this.dy=0,this.revertPrevPos=pos,this.firstdrag=!0,this.revertX=0,this.revertY=0},getElementAndRootPositions:function(){var elx=parseInt(this.el.style.left)+parseInt(this.el.getAttribute("width"))/2,ely=parseInt(this.el.style.top)+parseInt(this.el.getAttribute("height"))/2,elp={x:elx,y:ely},curve=__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[0],path=curve.attrs.path,arrow=__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[1][4],path2=arrow.attrs.path;return[elp,{x:path[0][1],y:path[0][2]},{x:path2[3][1],y:path2[3][2]}]},getElementRadius:function(){return parseInt(Math.sqrt(Math.pow(parseInt(this.el.getAttribute("width"))/2,2)+Math.pow(parseInt(this.el.getAttribute("height"))/2,2)))},getDistance:function(p1,p2){var dx=p2.x-p1.x,dy=p2.y-p1.y;return Math.sqrt(dx*dx+dy*dy)},RaphaelHandler:function(dx,dy){__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[1][this.arrindex].update(dx,dy)},RaphaelHandlerAbsolute:function(x,y){__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[1][this.arrindex].updateAbsolute(x,y)},saveControlPointPositions:function(p1,p2){var controls=__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[1],color=__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[0].attr("stroke"),root={x:controls[2].attrs.cx,y:controls[2].attrs.cy},arrow={x:controls[3].attrs.cx,y:controls[3].attrs.cy};this.connection.setProperties({cp_from_x:parseInt(root.x-p1.x),cp_from_y:parseInt(root.y-p1.y),cp_to_x:parseInt(arrow.x-p2.x),cp_to_y:parseInt(arrow.y-p2.y),cp_scale_x:parseInt(p2.x-p1.x),cp_scale_y:parseInt(p2.y-p1.y),color:color?color.substr(1):__WEBPACK_IMPORTED_MODULE_1__vconnection__.DEFAULT_COLOR})},_onMouseDown:function(event){this.dragging=!0,App.connectionPopover&&App.connectionPopover.close(),Event.observeOnce(document,"mouseup",this._onMouseUp.bind(this))},_onMouseUp:function(){this.dragging=!1},_onStart:function(el,event){canvas.disableScrollByDrag(),this.mouseStartX=Event.pointerX(event),this.mouseStartY=Event.pointerY(event)},_onDrag:function(el,event){var dist,positions=this.getElementAndRootPositions(),elp=positions[0],p1=positions[1],p2=positions[2],radius=this.getElementRadius();2==this.arrindex&&(dist=this.getDistance(elp,p1)),3==this.arrindex&&(dist=this.getDistance(elp,p2)),dist<__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][0].attrs.r+radius?(2==this.arrindex&&__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][0].show(),3==this.arrindex&&__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][1].show()):(2==this.arrindex&&__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][0].hide(),3==this.arrindex&&__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][1].hide()),this.dx=Event.pointerX(event)-this.mouseStartX,this.dy=Event.pointerY(event)-this.mouseStartY,this.RaphaelHandlerAbsolute(elp.x,elp.y),this.mouseStartX+=this.dx,this.mouseStartY+=this.dy,this.firstdrag&&(this.revertX+=this.dx,this.revertY+=this.dy)},_onEnd:function(el,event){canvas.enableScrollByDrag();var positions=this.getElementAndRootPositions(),elp=positions[0];this.RaphaelHandlerAbsolute(elp.x,elp.y),this.mouseStartX=0,this.mouseStartY=0,this.dx=0,this.dy=0},_onRevert:function(el){var dist,positions=this.getElementAndRootPositions(),elp=positions[0],p1=positions[1],p2=positions[2],radius=this.getElementRadius();return 2==this.arrindex&&(dist=this.getDistance(elp,p1)),3==this.arrindex&&(dist=this.getDistance(elp,p2)),dist>__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][0].attrs.r+radius?(this.revertPrevPos=elp,this.firstdrag=!1,this.saveControlPointPositions(p1,p2),!1):(__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][0].hide(),__WEBPACK_IMPORTED_MODULE_0__graphics__.Graphics.connectionstack.get(this.uid)[2][1].hide(),!0)},_onRevertUpdate:function(el,y,x){this.move(this.revertPrevPos),this.firstdrag?(this.RaphaelHandler(-this.revertX,-this.revertY),this.revertX=0,this.revertY=0,this.firstdrag=!0):(this.RaphaelHandler(-x,-y),this.firstdrag=!1)},move:function(point){this.el.style.left=point.x-parseInt(this.el.getAttribute("width"))/2+"px",this.el.style.top=point.y-parseInt(this.el.getAttribute("height"))/2+"px"},hide:function(){this.el.addClassName("hidden")},show:function(){this.el.removeClassName("hidden")},destroy:function(){Element.discard(this.el),this.connection=this.pos=null}})},"Vf/c":function(module,exports){function getValue(object,key){return null==object?void 0:object[key]}module.exports=getValue},Vw2l:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vnodeImage__=__webpack_require__("HM34"),__WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vnodeVideo__=__webpack_require__("Qy9x"),__WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vnode__=__webpack_require__("NCMo"),__WEBPACK_IMPORTED_MODULE_3_app_canvas_views_vnodeIcon__=__webpack_require__("UeFO"),__WEBPACK_IMPORTED_MODULE_4_app_models_ideaComment__=__webpack_require__("ZfKP"),__WEBPACK_IMPORTED_MODULE_5_app_ui_users__=__webpack_require__("ePfb"),__WEBPACK_IMPORTED_MODULE_6_app_canvas_views_graphics__=__webpack_require__("t8zp"),__WEBPACK_IMPORTED_MODULE_7_app_utils_math__=__webpack_require__("3Ox4"),VGenericNode=Class.create({node:null,parent:null,children:null,image:null,icons:[],dcontent:null,refreshLayout:function(){},mark:function(){},unmark:function(){},__onRename:function(uid){if(uid&&App.config.editable&&App.config.currentlyEditable&&this.dcontent.isEditing())var selection=window.getSelection(),range=selection.getRangeAt(0),start=range.startOffset,end=range.endOffset;if(this.dcontent.updateTitle(),range&&this.dcontent.setCursor&&this.dcontent.setCursor(start,end),this.image&&(this.dcontent.childrenLength=null),tree.notPainted||(this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()),this.node.isRoot()){var title=this.node.getSingleLineTitle();document.title=title+" -"+document.title.split("-")[1],mm$("map-title")&&(mm$("map-title").textContent=title),canvas.root.reposition()}__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default&&uid&&__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default.highlightNode(this,uid),canvas.selected===this&&sideBar&&sideBar.onSelectNode()},__onSetIcon:function(notPainted,uid){!(notPainted=notPainted||tree.notPainted)&&this.image&&(this.dcontent.children[1].el.style.marginLeft="0");for(var i=this.icons.length,iconsToAnimateDelete=!1;i--;)if(this.node.icons.indexOf(this.icons[i].icon)<0){var iconToRemove=this.icons[i];!tree.finishedInitialization||iconToRemove.icon.group()&&this.node.icons.detect(function(_icon){return _icon.group()===this.group()}.bind(iconToRemove.icon))?this.dcontent.removeChild(iconToRemove):(iconsToAnimateDelete=!0,iconToRemove.animateDeletion({onFinish:function(iconToRemove){this.dcontent.removeChild(iconToRemove)}.bind(this)})),this.icons=this.icons.without(iconToRemove)}for(var i=0,len=this.node.icons.length;i<len;i++){if(-1===this.icons.collect(function(vicon){return vicon.icon}).indexOf(this.node.icons[i])){var vicon=new __WEBPACK_IMPORTED_MODULE_3_app_canvas_views_vnodeIcon__.default(this,this.node.icons[i]);this.icons.push(vicon),tree.finishedInitialization&&vicon.animate()}}App.config.inline_tasks&&this.updateTaskLayer(),notPainted||(iconsToAnimateDelete?setTimeout(function(){this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()}.bind(this),350):(this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine())),__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default&&users&&uid&&__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default.highlightNode(this,uid)},__onSetStyle:function(notPainted,uid){notPainted=notPainted||tree.notPainted,this.node.style?Style.applyToElement(this.node.style,this.dcontent.el):notPainted||Style.removeFromElement(this.dcontent.el),notPainted||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default&&uid&&__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default.highlightNode(this,uid),sideBar&&canvas.selected==this&&sideBar.format.onSelectNode()},__onSetIdeaProperty:function(notPainted,uid){if(notPainted=notPainted||tree.notPainted,notPainted||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),(uid&&"undefined"!=typeof users&&users.selfUser&&uid===users.selfUser.id||void 0===uid)&&this.node.ideaProperty&&this.node.ideaProperty.floating&&!MM.utils.getCookie("saw_floatingwarning"))return Message.show(I18n.t("js.floating_nodes_warning",{v0:'<a href="#" onclick="return MM.ui.openHelp(\'/218493487-Edit-your-map\')">',v1:"</a>"}),Message.INFO,30),MM.utils.setCookie("saw_floatingwarning","1",365),!0;__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default&&uid&&__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default.highlightNode(this,uid)},openLink:function(){if(!this.node.link)return!1;var linkObj=this.node.getLinkObj();if("topic"!==linkObj.type)return this.doOpenLink(this.node.link.unescapeHTML(),linkObj.type),!1;var target=mm$(linkObj.link);if(target)App.ui.Preview.clearTimer(this),this.scrollToLinkTarget(target);else{var win=this.doOpenLink("",linkObj.type);new Ajax.Request("/maps/get_topic_target/"+linkObj.link,{onSuccess:function(transport){var link="/"+linkObj.link;transport.responseJSON&&transport.responseJSON.link&&(link=transport.responseJSON.link),win.location.href=link}.bind(this)})}return!1},_updateLink:function(el){el.rel=this.node.getLinkRel({link:this.node.link});var _node$getLinkObj=this.node.getLinkObj(),type=_node$getLinkObj.type,link=_node$getLinkObj.link;switch(type){case"url":el.href=this.node.link.unescapeHTML();break;case"email":el.href="mailto:"+link;break;default:"phantomjs"===App.config.environment?el.href="https://mindmeister.com/"+link:(el.href="#",Element.bindOnClickNoBubble(el,this.openLink.bind(this)))}},scrollToLinkTarget:function(target){var vNode=target._listener;if(!vNode.node.isVisible()){vNode.node.getVisibleParent().toggleClosed()}canvas.centerOnElement(target),vNode.select(null,null,null,!0)},doOpenLink:function(link,type){if("email"!==type)return window.open(link);window.location.href=link},openExternalTask:function(){return!!this.node.externalTask&&(App.trigger(CustomEvents.EXTERNAL_TASK_OPENED),window.open(ServerData.keys.mtDomain+"/app#task/"+this.node.externalTask.external_token),!1)},__onSetProperty:function(key,notPainted,uid){notPainted=notPainted||tree.notPainted;var existingElement=mm$(this.node.id+"_"+key);if("image"===key)this.node.idea_image?(existingElement&&this.image&&(this.dcontent.removeChild({el:existingElement}),__WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vnodeImage__.default.removeImage(this.image),notPainted||this.dcontent.onImageRemoved()),this.image=new __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_vnodeImage__.default(this,this.node.idea_image),this.image.show(),this.dcontent.insertChild(this.image.dcontainer,0),this.dcontent.isSelected&&this.isSelected()&&this.image.dcontainer.toSelected()):existingElement&&(this.dcontent.removeChild({el:existingElement}),this.image=null,notPainted||this.dcontent.onImageRemoved());else if("video"===key)this.node.idea_video?(this.video?this.video.updateVideo(this.node.idea_video):this.video=new __WEBPACK_IMPORTED_MODULE_1_app_canvas_views_vnodeVideo__.default(this,this.node.idea_video),this.dcontent.insertChild(this.video,0),"phantomjs"===App.config.environment&&this.video.showPlaceholder()):(this.dcontent.removeChild(this.video),this.video=null),"undefined"!=typeof sideBar&&sideBar&&canvas.selected===this&&sideBar.onSelectNode();else if("externalTask"===key)existingElement&&this.dcontent.removeChild({el:existingElement}),this.node.externalTask&&(existingElement=new Element("div",{id:this.node.id+"_"+key,className:"tk_tail",title:I18n.t("js.click_to_view_task_in_meistertask")}),Element.bindOnClickNoBubble(existingElement,this.openExternalTask.bind(this)),this._updatePropertyIcon(existingElement,key),this._appendPropertyIcon(existingElement));else if("attachments"===key&&this.node.attachments.length>0||"task"===key&&this.node.task&&!this.node.task.iconsOnly()&&!this.node.task.empty()||"comments"===key&&this.node.comments.length>0||"votes"===key&&this.node.votes.length>0||"attachments"!==key&&"task"!==key&&"comments"!==key&&"votes"!==key&&this.node[key])if(existingElement)switch(key){case"comments":this._updatePropertyIcon(existingElement,key);break;case"task":App.config.inline_tasks&&this.updateTaskLayer();break;case"votes":existingElement.update(this.updateVotesLayer({animate:!1}));break;case"link":this._updateLink(existingElement)}else"votes"===key?(existingElement=new Element("div",{id:this.node.id+"_"+key,class:"tk_tail",style:"position: relative;"}),existingElement.update(this.updateVotesLayer({animate:tree.finishedInitialization})),this._appendPropertyIcon(existingElement)):"link"===key?(existingElement=new Element("a",{id:this.node.id+"_"+key,className:"tk_tail",target:"_blank"}),this._updateLink(existingElement),this._updatePropertyIcon(existingElement,key),this._appendPropertyIcon(existingElement)):(existingElement=new Element("div",{id:this.node.id+"_"+key,className:"tk_tail"}),this._updatePropertyIcon(existingElement,key),this._appendPropertyIcon(existingElement),"task"===key&&App.config.inline_tasks&&(this.dtasklayer=new Element("div",{id:this.node.id+"_task_layer",className:"h-flex-row justify-sb tk_task"}),this.updateTaskLayer(),this.dcontent.appendChild({el:this.dtasklayer}))),"link"!==key&&Element.bindOnClickNoBubble(existingElement,App.ui.Preview.show.bind(App.ui.Preview,this,key)),Event.observe(existingElement,"mouseover",App.ui.Preview.onHover.bind(App.ui.Preview,this,key)),Event.observe(existingElement,"mouseout",App.ui.Preview.clearTimer.bind(App.ui.Preview,this));else{if(!existingElement)return;this.dcontent.removeChild({el:mm$(this.node.id+"_"+key)}),"task"==key&&this.dtasklayer&&App.config.inline_tasks&&(this.dcontent.removeChild({el:this.dtasklayer}),this.dtasklayer=null)}notPainted||(this.refreshLayout(),this.node.isRootC()?this.rc.redrawRootLine():this.node.isRoot()&&canvas.root.reposition()),App.ui.Users&&uid&&App.ui.Users.highlightNode(this,uid)},__onResizeImage:function(uid){this.image&&this.image.dcontainer.setSize([this.node.idea_image.width(),this.node.idea_image.height()]),tree.notPainted||(this.node.isRoot()?this.reposition():this.refreshLayout()),__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default&&uid&&__WEBPACK_IMPORTED_MODULE_5_app_ui_users__.default.highlightNode(this,uid)},_updatePropertyIcon:function(element,key){var icons={attachments:"widget-attachment",task:"checkmark-thin",externalTask:"mt-checkmark",comments:"widget-comment",link:"link"},svgOpts={name:icons[key]||"widget-"+key,color:"grey-light",size:12,consize:16};"comments"===key&&(__WEBPACK_IMPORTED_MODULE_4_app_models_ideaComment__.default.getUnread(this.node.comments).length>0?(addClassName(element,"bg-orange"),svgOpts.color="white"):removeClassName(element,"bg-orange")),element.update(MM.ui.icon(svgOpts))},_appendPropertyIcon:function(element){this.dtasklayer?this.dcontent.el.insertBefore(element,this.dtasklayer):this.dcontent.appendChild({el:element})},updateTaskLayer:function(){if(this.dtasklayer&&this.node.task){var html="",iconOpts={size:this.node.isRoot()?14:10,color:"grey-light"};if(this.node.task.due){html='<div row class="rounded due'+(this.node.task.due<=new Date&&this.node.task.complete<4?' overdue" title="'+I18n.t("js.overdue")+'">':'">')+MM.ui.icon(Object.extend({name:"categories-events"},iconOpts))+"<div>"+this.node.task.due.toUIString(!0)+"</div></div>"}if(this.node.task.resource){html+="<div row>";var ret=users.findByID(this.node.task.resource.id,!0);html+=ret?ret.getAvatar(this.node.isRoot()?"small":"tiny"):MM.ui.icon(Object.extend({name:"user"},iconOpts)),html+="<div>"+this.node.task.resource.name.escapeHTML()+"</div></div>"}this.dtasklayer.innerHTML=html}},updateVotesLayer:function(options){var voteCount=this.node.votes.length,upVotes=IdeaVote.getByVote(this.node,IdeaVote.UP).length,maxVoteCount=IdeaVote.maxVotes,container=new Element("span",{class:"h-14px w-14px lh-0 h-a-center"});return options=Object.extend(options,{width:14,height:14,colors:["#8ACC47","#FF5319","#e0e4e6"],strokeWidth:2.5}),__WEBPACK_IMPORTED_MODULE_6_app_canvas_views_graphics__.Graphics.drawDonutChart(container,[upVotes,voteCount-upVotes,maxVoteCount-voteCount],maxVoteCount,options),container},__onAddConnection:function(connection){tree.readyForConnections&&connection.view.redraw()},__onRemoveConnection:function(connection){connection&&connection.view.clear()},__onChangeId:function(old_id,new_id){this.dcontent.el.id=new_id;for(var children=this.dcontent.children,i=children.length;i>0;){var el=children[--i].el;-1==el.className.indexOf("tk_tail")&&-1==el.className.indexOf("tk_image_container")||(el.id=el.id.gsub(old_id.toString(),new_id.toString()))}},buildFromModel:function(){for(var arr=this.node.children,i=0;i<arr.length;i++){var vnode=new __WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vnode__.default(arr[i]);arr[i]._listener=vnode,this.__onAddChild(vnode,arr[i].parent.rank(arr[i]),!0),vnode.buildFromModel()}},setLoadingOnDrop:function(){var id=this.node.id+"_loading";if(!mm$(id)){var obj=new Element("div",{id:id,class:"tk_tail p-r"});obj.appendChild(MM.ui.LoadingSpinner(12)),this._appendPropertyIcon(obj),this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine()}},removeLoadingFromDrop:function(){var el=mm$(this.node.id+"_loading");el&&(this.dcontent.removeChild({el:el}),this.refreshLayout(),this.node.isRootC()&&this.rc.redrawRootLine())},getTextPosition:function(){var position=canvas.getElementOffset(this.dcontent.el);return position[0]+=this.node.icons.length*(Icon.default_width+4),this.image&&(position[1]+=this.image.dcontainer.el.clientHeight),this.video&&(position[1]+=this.video.el.clientHeight),position},getGhostPosition:function(index,position,referenceNode){var pos,child,offset=[0,0],gs=[Math.round(App.GHOST_SIZE[0]),Math.round(App.GHOST_SIZE[1])];if(this.node.hasChildren())if(pos=[0,0],position){var center=canvas.getCenter();position[1]>0&&(offset[1]=-56),referenceNode?(pos=Math.offset(position,canvas.getNodeCanvasOffset(referenceNode)),pos[0]>center[0]?offset[0]=-136:pos[0]+=referenceNode.dcontent.size()[0]-gs[0]-21,canvas._dropPosition=Math.offset(referenceNode.node.pos,position)):(pos=Math.offset(center,position),position[0]>0?offset[0]=-136:pos[0]-=gs[0]+21,canvas._dropPosition=position)}else if(this.rc.orientation===App.Layouts.orientation.left?pos[0]=canvas.getElementOffset(this.dchildren.el)[0]+this.dchildren.size()[0]-gs[0]-this.dopener.el.clientWidth:(offset[0]=-136,pos[0]=canvas.getElementOffset(this.dchildren.el)[0],"org_chart"!==App.config.layout.name&&(pos[0]-=this.dopener.el.clientWidth/2)),0===index)child=this.children[0],pos[1]=canvas.getNodeCanvasOffset(child)[1]-(child.dcontent.size()[1]+gs[1]/2)/2;else if(index==this.children.length){offset[1]=-56,child=this.children[this.children.length-1];var containerSize=child.dcontainer.size()[1]+child.dcontent.size()[1]-child.dcontent.pos[1]-gs[1];"org_chart"!==App.config.layout.name&&(containerSize/=2),pos[1]=canvas.getNodeCanvasOffset(child)[1]+containerSize}else{offset[1]=-28;var i=this.children[index-1],i1=this.children[index],posi=canvas.getNodeCanvasOffset(i),posi1=canvas.getNodeCanvasOffset(i1);pos[1]=(posi[1]+i.dcontent.size()[1]+posi1[1]-gs[1])/2}else{var elSize=this.dcontent.size(),hBorder=this.dcontent.el.offsetWidth-elSize[0],vBorder=this.dcontent.el.offsetHeight-elSize[1];pos=canvas.getNodeCanvasOffset(this),this.rc.orientation==App.Layouts.orientation.left?pos[0]-=gs[0]+24:(offset[0]=-136,pos[0]+=elSize[0]),pos[0]+=hBorder/2,pos[1]+=elSize[1]/2+vBorder/2-gs[1]}return{pos:pos,offset:offset}},getCentralPosition:function(){var rect=this.dcontent.el.getBoundingClientRect();return{left:rect.left+rect.width/2,top:rect.top+rect.height/2}},isVisible:function(){var el=this.dcontent.el;if(!el)return!1;var rect=el.getBoundingClientRect(),containerRect=document.body.getBoundingClientRect(),viewportOffset=UI.Registry.viewportOffset;return rect.left>=viewportOffset.left&&containerRect.right-viewportOffset.right>=rect.right&&rect.top>=viewportOffset.top&&containerRect.bottom-viewportOffset.bottom>=rect.bottom},isSelected:function(){return this.dcontent&&this.dcontent.isSelected&&this.dcontent.isSelected()},isPartiallySelected:function(){return this.dcontent&&this.dcontent.isPartiallySelected&&this.dcontent.isPartiallySelected()},isEditing:function(){return this.dcontent&&this.dcontent.isEditing&&this.dcontent.isEditing()},eachChild:function(iterator,bottomUp,noRecurse){if(bottomUp||iterator(this),!noRecurse)for(var i=0,len=this.children.length;i<len;i++)this.children[i].eachChild(iterator,bottomUp);bottomUp&&iterator(this)},eachChildWithCounter:function(iterator,counter,bottomUp,noRecurse){bottomUp||iterator(this,counter);for(var i=0;i<this.children.length;i++)noRecurse?iterator(this.children[i],i+1):this.children[i].eachChildWithCounter(iterator,i+1);bottomUp&&iterator(this,counter)},highlight:function(color,persistent){if(color){var restoreColor=null;this.node.style&&this.node.style.backgroundColor&&(restoreColor="#"+this.node.style.backgroundColor),new Effect.Highlight(this.dcontent.el,{startcolor:"#ffffff",endcolor:color||"#cccccc",restorecolor:persistent?color:restoreColor,duration:.7,afterFinish:function(){!restoreColor&&this.dcontent&&removeStyle(this.dcontent.el,"background-color")}.bind(this)})}else this.node.style?(color=this.node.style.backgroundColor,color?this.dcontent.el.style.backgroundColor="#"+color:removeStyle(this.dcontent.el,"background")):removeStyle(this.dcontent.el,"background")},blur:function(){addClassName(this.dcontent.el,"blured")},unBlur:function(){removeClassName(this.dcontent.el,"blured")},selectByUser:function(user,persistent){var _this=this,userColor=user.color||"#cccccc",container=$("collaborators_for_"+this.node.id);container||(container=new Element("div",{id:"collaborators_for_"+this.node.id,className:"tk_author_name_container"}),this.dcontent.el.appendChild(container)),this.dcontent.el.addClassName("user_selected"),this.dcontent.el.style.borderColor=userColor;var objText=$("node_"+this.node.id+"_selected_by_"+user.id);objText?show(objText):(objText=new Element("div",{id:"node_"+this.node.id+"_selected_by_"+user.id,className:"tk_author_name",style:"display: none; background-color: "+userColor}),container.appendChild(objText),container.setStyle({left:"0",bottom:"100%"}),new Effect.Appear(objText,{duration:.7,afterFinish:function(){persistent&&_this.unSelectByUser(user)}})),objText.innerHTML!==user.displayname&&(objText.innerHTML=user.displayname)},unSelectByUser:function(user){var element=mm$("node_"+this.node.id+"_selected_by_"+user.id);this.node.style&&this.node.style.borderColor?this.dcontent.el.style.borderColor="#"+this.node.style.borderColor:(removeStyle(this.dcontent.el,"border-color"),this.dcontent.el.removeClassName("user_selected")),element&&hide(element)},distanceFromCenter:function(){var center=canvas.root.getCenter(),nodePos=this.dcontent.el.cumulativeOffset(),p1=new Point(center[0],center[1]),p2=new Point(nodePos[0],nodePos[1]);return new __WEBPACK_IMPORTED_MODULE_7_app_utils_math__.Line(p1,p2).length()}});__webpack_exports__.default=VGenericNode},"W/Il":function(module,exports){function apply(func,thisArg,args){switch(args.length){case 0:return func.call(thisArg);case 1:return func.call(thisArg,args[0]);case 2:return func.call(thisArg,args[0],args[1]);case 3:return func.call(thisArg,args[0],args[1],args[2])}return func.apply(thisArg,args)}module.exports=apply},WGdr:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0_ui_components_popovers_mapsPopover__=__webpack_require__("BLbw"),__WEBPACK_IMPORTED_MODULE_1_ui_components_popovers_mapPropertiesPopover__=__webpack_require__("jS0c"),__WEBPACK_IMPORTED_MODULE_2_ui_core_popover__=__webpack_require__("SZxL"),__WEBPACK_IMPORTED_MODULE_3_app_ui_filter__=__webpack_require__("QHRq"),Header={init:function(){this.el=$("map_header"),Element.bindOnClick("btn_add",function(){canvas.onAdd()}),Element.bindOnClick("btn_remove",function(){canvas.onRemove()}),Element.bindOnClick("btn_undo",function(){canvas.onUndo()}),Element.bindOnClick("btn_redo",function(){canvas.onRedo()}),Element.bindOnClick("btn_connect",function(){canvas.onAddConnection()}),__WEBPACK_IMPORTED_MODULE_3_app_ui_filter__.default.init("fld_filter",{onBlur:canvas.addFocus.bind(canvas)}),MM.ui.ToolTips.touchSafe({el:this.el}),this.viewportSpace={top:this.el.getHeight()},UI.Registry.add(this),UI.Registry.notify(this,"show"),this._renderMapPropertiesPopover(),App.subscribe(CustomEvents.THEME_CHANGED,this._renderMapPropertiesPopover),ServerData.isLoggedIn&&document.body.clientWidth>=680&&(App.mapsPopover=new __WEBPACK_IMPORTED_MODULE_2_ui_core_popover__.c("maps",{onShow:function(){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_popovers_mapsPopover__.a,null),App.mapsPopover.widgetContainer)},onHide:function(){ReactDOM.unmountComponentAtNode(App.mapsPopover.widgetContainer)}}))},changeLayout:function(layout){layout!==App.config.layout&&(App.showMapLoading(),setTimeout(function(){tree.changeLayout(layout),App.hideMapLoading(),this._renderMapPropertiesPopover()}.bind(this),100))},_renderMapPropertiesPopover:function(){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_popovers_mapPropertiesPopover__.a,{user:users.selfUser,viewOnly:!App.config.editable,isExternal:App.config.is_external,layouts:App.Layouts.getAll(),currentLayout:App.config.layout,teamTemplates:MapTheme.team(),templates:MapTheme.templates}),mm$("properties-container"))},show:function(use_effect){CSS.set(this.el,{top:"0px",transitionDuration:use_effect?"500ms":"0ms"}),UI.Registry.notify(this,"show")},hide:function(use_effect){CSS.set(this.el,{top:-this.el.offsetHeight+"px",transitionDuration:use_effect?"500ms":"0ms"}),UI.Registry.notify(this,"hide")},toEditMode:function(){MM.ui.enableButton("btn_add","btn_remove","btn_connect"),App.config.shareMode!=App.MULTI&&MM.ui.enableButton("btn_undo","btn_redo")},toViewMode:function(){MM.ui.disableButton("btn_add","btn_remove","btn_connect","btn_undo","btn_redo"),MM.ui.disableButton("btn_undo","btn_redo")}};__webpack_exports__.default=Header}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},Wp5U:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__vgenericNode__=__webpack_require__("Vw2l"),__WEBPACK_IMPORTED_MODULE_1__block__=__webpack_require__("cQwG"),__WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vrootChild__=__webpack_require__("rX76"),__WEBPACK_IMPORTED_MODULE_3_app_models_connectionModel__=__webpack_require__("/dW8"),VRoot=Class.create(__WEBPACK_IMPORTED_MODULE_0__vgenericNode__.default,{pcenter:null,initialize:function(node){this.children=[],this.node=node,this.icons=[],mapView.root=this,this.dcontent=new __WEBPACK_IMPORTED_MODULE_1__block__.default("tk_label root"),this.dcontent.el.id=node.id,this.dcontent.el._listener=this,this.dcontent.setTitle(),App.config.editable&&App.config.currentlyEditable&&this.initEditMode(),this.__onSetStyle(!0),this.node.icons.length>0&&this.__onSetIcon(!0),this.node.note&&this.__onSetProperty("note",!0),this.node.link&&this.__onSetProperty("link",!0),this.node.attachments.length>0&&this.__onSetProperty("attachments",!0),this.node.task&&this.__onSetProperty("task",!0),this.node.comments.length>0&&this.__onSetProperty("comments",!0),this.node.idea_image&&this.__onSetProperty("image",!0),this.node.idea_video&&this.__onSetProperty("video",!0)},initEditMode:function(){this.dcontent.enabled||(this.dcontent.makeSelectable(),this.dcontent.makeEditable(),this.dcontent.toInactive(),this.dcontent.makeResizable(),this.dcontent.enableResizing())},initViewOnlyMode:function(){this.dcontent.toInactive&&this.dcontent.toInactive(),this.dcontent.disableSelecting&&this.dcontent.disableSelecting(),this.dcontent.disableResizing&&this.dcontent.disableResizing(),this.dcontent.el.style.cursor="default"},refreshLayout:function(){if(App.config.layout.autoAlign)for(var i=0,len=canvas.root.children.length;i<len;i++){var rootChild=canvas.root.children[i];rootChild.rc.redrawRootLine(),rootChild.rc.redrawLines()}},translateChildNodes:function(offset,orientation){if(App.config.layout.autoAlign)for(var i=0,len=canvas.root.children.length;i<len;i++){var rootChild=canvas.root.children[i];rootChild.rc.redrawRootLine(),rootChild.rc.orientation!==orientation&&orientation||(rootChild.rc.translateBoundaries({x:offset.x,y:offset.y}),rootChild.rc.graphics.childrenPath.translate(offset.x,offset.y))}},findAffected:function(point){if(this.dcontent.contains(point))return this.dcontent.el;for(var affected=null,i=0,len=this.children.length;i<len;i++){var offsetPoint=point;if(App.config.layout.autoAlign&&(offsetPoint=Math.negativeOffset(point,canvas.getElementOffset(this.children[i].dcontainer.el.parentNode))),affected=this.children[i].findAffected(offsetPoint))break}return affected},select:function(event,rememberedDepth,doCommit,noScroll,noUnselect){App.config.editable&&App.config.currentlyEditable&&this.dcontent&&(canvas._rememberedDepth=rememberedDepth,this.dcontent.toSelected(event,doCommit,noScroll,noUnselect))},reposition:function(doNotRedrawChildren){var c=this.dcontent,layout=App.config.layout;if(layout.autoAlign){var appliedLayout=App.Layouts.get(layout.id),mapEl=$("tk_map"),canvasCenter=canvas.getCenter(),root=$("tk_rootcontainer"),rootCenterPos=[root.offsetLeft+root.clientWidth/2,root.offsetTop+root.clientHeight/2],left=Math.max(canvasCenter[0]-rootCenterPos[0],0);appliedLayout===App.Layouts.LeftAligned&&"phantomjs"!==App.config.environment?mapEl.style.right="calc(100% - "+(mapEl.getWidth()+left)+"px)":mapEl.style.left=left+"px",mapEl.style.top=canvasCenter[1]-rootCenterPos[1]+"px",this.pcenter=canvasCenter,tree.notPainted||doNotRedrawChildren||this.children.each(function(c){c.rc.redrawLines()})}else c.move([parseInt(canvas.size[0]/2-c.el.offsetWidth/2),parseInt(canvas.size[1]/2-c.el.offsetHeight/2)]),c.doMove(),this.pcenter=[parseInt(c.pos[0]+c.size()[0]/2),parseInt(c.pos[1]+c.size()[1]/2)];this.redrawBoundaries()},getCenter:function(){var el=this.dcontent.el,p=canvas.getNodeCanvasOffset(this);return[p[0]+parseInt(el.clientWidth/2),p[1]+parseInt(el.clientHeight/2)]},paint:function(){App.config.layout.paintRoot();var children=this.children.clone();children.sort(function(a,b){return a.node.pos&&b.node.pos?a.node.pos[1]-b.node.pos[1]:0});for(var i=0,len=children.length;i<len;i++)children[i].rc.paint(!0);if(App.config.layout.autoAlign){this.reposition(!0);for(var i=0,len=children.length;i<len;i++)children[i].rc.redrawLines()}},makeVisible:function(){return!0},redrawBoundaries:function(){this.__onAddBoundary()},__onAddBoundary:function(){this.node.boundary&&this.node.boundary.view.redraw()},__onRemoveBoundary:function(){this.node.boundary&&this.node.boundary.view.destroy()},__onAddChild:function(vnode,rank,notPainted,uid,param,wasTemporarilyRemoved){var vRootC=new __WEBPACK_IMPORTED_MODULE_2_app_canvas_views_vrootChild__.default(vnode);return vnode.setRc(vRootC),this.children.push(vnode),vnode.parent=this,removeClassName(vnode.dcontent.el,"node"),addClassName(vnode.dcontent.el,"root_child"),!!notPainted||(wasTemporarilyRemoved&&(vnode.isTemporarilyRemoved=!1),!!vRootC.paint()&&(uid&&void 0!==App.ui.Users&&App.ui.Users&&(param&&param.moveClone?App.ui.Users.highlightMovement(vnode,uid,param.moveClone):App.ui.Users.highlightNode(vnode,uid)),!0))},__onRemoveChild:function(vnode,uid,mode){if(canvas.isSelected(vnode)&&"definitive"===mode){(vnode.node.getPrevSibling()||vnode.node.getNextSibling()||this.node)._listener.select(null,null,!0,!0)}vnode.dcontainer.el.parentNode&&(vnode.dcontainer.el.parentNode.removeChild(vnode.dcontainer.el),App.config.layout.autoAlign&&canvas.root.reposition()),vnode.rc.destroyLines();for(var i=0,len=vnode.node.connections.length;i<len;i++)vnode.__onRemoveConnection(vnode.node.connections[i]);this.children=this.children.reject(function(c){return c===vnode}),rectangleLayouter.update(this.node)},_refreshRootCAngles:function(){for(var i=0,len=this.children.length;i<len;i++){var c=this.children[i];if(!c.rc.vnode.node.pos)return;c.rc.angle=Math.slopeAngle(c.rc.vnode.node.pos)}this.children.sort(function(child1,child2){return child1.node.pos[1]-child2.node.pos[1]})},_childCloserToAngle:function(child1,child2,angle1,angle2){return Math.abs(child1.rc.angle-angle1)<(angle2?Math.abs(child2.rc.angle-angle2):Math.abs(child2.rc.angle-angle1))?child1:child2},getChildAtAngle:function(angle){var child=null;if(0==this.children.length)return null;var children=this.children.sortBy(function(child){return child.rc.angle});if(angle<children.first().rc.angle)return this._childCloserToAngle(children.first(),children.last(),angle,angle+360);if(angle>children.last().rc.angle)return this._childCloserToAngle(children.first(),children.last(),angle+360,angle);for(var i=0,len=children.length;i<len;i++)if(angle<children[i].rc.angle){var prevChild=children[i-1];child=this._childCloserToAngle(children[i],prevChild,angle);break}return child},getLeftChildren:function(){return this.children.filter(function(child){return child.rc.orientation==App.Layouts.orientation.left})},getRightChildren:function(){return this.children.filter(function(child){return child.rc.orientation==App.Layouts.orientation.right})},getNextSibling:function(initialChild){if(null===initialChild.node.pos)return null;if(App.config.layout.rootChildrenPosition){var children=this.children.filter(function(c){return c.rc.orientation===initialChild.rc.orientation&&c!==initialChild&&c.node.pos[1]>initialChild.node.pos[1]});return children.sort(function(a,b){return a.node.pos[1]-initialChild.node.pos[1]-(b.node.pos[1]-initialChild.node.pos[1])}),children.length>0?children[0].node:null}var element=initialChild.rc.vnode.dcontainer.el.nextSibling;return element?tree.root.getChild(parseInt(element.id.replace("tk_container_",""))):null},getPrevSibling:function(initialChild){if(null===initialChild.node.pos)return null;if(App.config.layout.rootChildrenPosition){var children=this.children.filter(function(c){return c.rc.orientation===initialChild.rc.orientation&&c!==initialChild&&c.node.pos[1]<initialChild.node.pos[1]});return children.sort(function(a,b){return initialChild.node.pos[1]-a.node.pos[1]-(initialChild.node.pos[1]-b.node.pos[1])}),children.length>0?children[0].node:null}var element=initialChild.rc.vnode.dcontainer.el.previousSibling;return element?tree.root.getChild(parseInt(element.id.replace("tk_container_",""))):null},getSize:function(){return this.dcontent.size()},destroy:function(){if(this.children){for(var i=0,len=this.children.length;i<len;i++)this.children[i].rc.destroy(),this.children[i].destroy(),this.children[i]=null;this.children=null,this.dcontent.destroy(),this.dcontent=null,this.node=null,__WEBPACK_IMPORTED_MODULE_3_app_models_connectionModel__.default.all.each(function(c){c.view.destroy()})}}});__webpack_exports__.default=VRoot},Xxf7:function(module,exports){function basePropertyOf(object){return function(key){return null==object?void 0:object[key]}}module.exports=basePropertyOf},"YQ4/":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),StylesWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,sidebar,parent){$super("styles",sidebar,parent),Element.bindOnClick("btn_remove_style",this.setValue.bind(this)),Element.bindOnClick("btn_customize_style",this.showDialog)},load:function($super){this.list=this.el.select("grid")[0],this.list.innerHTML="",this.styles=[],App.config.mapTheme.styles.concat(Style.teamStyles).each(function(style){this.addStyle(style)}.bind(this)),$super()},addStyle:function(style){this.styles.push(style);var el=new Element("span",{href:"#",className:"tk_label"}).update("Abc");Style.applyToElement(style,el);var link=new Element("a",{id:"style_"+style.id,href:"#",className:"tooltip item"}).setStyle({backgroundColor:"#"+App.config.mapTheme.background.color}).insert(el);link.observe("click",this.setValue.bindAsEventListener(this,style)),style.name&&(link.title=style.name),this.list.insert(new Element("cell",{className:"topic-preview"}).insert(link))},setValue:function(e,style){if(Event.stop(e),style){var selected=canvas.allSelected,nodesWithSameStyle=selected.filter(function(vNode){var node=vNode.node;return node.style&&node.style.equals(style)});selected.length===nodesWithSameStyle.length&&(style=null)}canvas.onSetFullStyle(style),this._setSelected(style)},_setSelected:function(style){if(this.list.select(".selected").invoke("removeClassName","selected"),style){var el=mm$("style_"+style.id);el&&addClassName(el,"selected")}},showDialog:function(){MM.ui.dialogs.dialogCustomizeTopic({themeId:App.config.mapTheme.id})},onSelectNode:function(){if(this.list.select(".selected").invoke("removeClassName","selected"),canvas.selected&&canvas.selected.node.style){var style=this.styles.find(function(style){return style.equals(canvas.selected.node.style)});style&&mm$("style_"+style.id)&&addClassName(mm$("style_"+style.id),"selected")}}});__webpack_exports__.default=StylesWidget},Z6lC:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var MediaSearch=Class.create({initialize:function(options){this.options=options||{}},query:function(_query,options){this.callback=options.onComplete,this.queryText=_query,this.queryGroup=options.hasOwnProperty("group_id")?options.group_id:this.queryGroup,this.doSearch(options)},nextPage:function(page){this.doSearch({page:page})},doSearch:function(params){this.queryGroup&&(params=Object.extend({group_id:this.queryGroup},params)),this.queryText.empty()?this.doSearchAll(params):this.doTextSearch(params)},doTextSearch:function(params){params=Object.extend({query:this.queryText},params),new Ajax.Request("/skoletube/"+(this.queryGroup?"group":"user")+"_"+this.options.type+"_search",{method:"GET",asynchronous:!0,parameters:params,onSuccess:this.onSearchComplete.bind(this),onFailure:this.onSearchError.bind(this),onException:this.onSearchError.bind(this),onTimeout:this.onSearchError.bind(this)})},doSearchAll:function(params){new Ajax.Request("/skoletube/"+(this.queryGroup?"group":"user")+"_"+this.options.type,{method:"GET",asynchronous:!0,parameters:params,onSuccess:this.onSearchComplete.bind(this),onFailure:this.onSearchError.bind(this),onException:this.onSearchError.bind(this),onTimeout:this.onSearchError.bind(this)})},onSearchComplete:function(transport){var response=transport.responseJSON;if(response.error)"Authentication required"===response.error?MM.ui.dialogs.dialogSkoletubeLogin(this.options.type):this.onSearchError();else if(this.callback){if(response.media)var results=this.transformResults?this.transformResults(response.media):response.media;else var results=[];this.callback(results,response.total_pages,response.current_page)}},onSearchError:function(){MM.ui.dialogs.showError(I18n.t("js.s_could_not_be_contacted",{v0:"Skoletube"}))}});__webpack_exports__.default=MediaSearch},ZfKP:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var IdeaComment=Class.create({id:null,user:null,text:null,createdAt:null,updatedAt:null,initialize:function(data){data&&(this.id=data.id||data.idea_comment_id,this.user=users.findByID(data.user_id,!0),this.text=data.text,this.createdAt=data.created_at?new Date(data.created_at):new Date,this.updatedAt=data.updated_at?new Date(data.updated_at):new Date,this.read=App.config.previousVisit>this.createdAt,IdeaComment.all.push(this))},update:function(text){this.text=text,this.updatedAt=new Date},equals:function(comment){return this.id===comment.id},isUnsaved:function(){return this.id<=0},isEdited:function(){return this.updatedAt-this.createdAt>0},toJSON:function(){return{id:this.id,user_id:this.user.id,text:this.text,createdAt:this.createdAt,updatedAt:this.updatedAt}},getElement:function(){return this.el||(this.el=new Element("div",{class:"comment"}).update(this.text)),this.el}});IdeaComment.all=[],IdeaComment.get=function(id){for(var i=IdeaComment.all.length;i>0;)if(IdeaComment.all[--i].id===id)return IdeaComment.all[i];return null},IdeaComment.sort=function(comments){return comments.sort(function(c1,c2){return c1.createdAt-c2.createdAt})},IdeaComment.getUnread=function(comments){if(!users.selfUser)return[];for(var i=comments.length,unread=[];i>0;){var comment=comments[--i];comment.user.id===users.selfUser.id||comment.read||unread.push(comment)}return unread},IdeaComment.uncommitedId=0,__webpack_exports__.default=IdeaComment},"ZjT+":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_2_app_utils_imageSearch__=__webpack_require__("aVfQ"),__WEBPACK_IMPORTED_MODULE_3_app_utils_images__=__webpack_require__("+ptD"),__WEBPACK_IMPORTED_MODULE_4_ui_components_mediaSourcesDropdown__=__webpack_require__("FN6h"),__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__=__webpack_require__("h7V/"),__WEBPACK_IMPORTED_MODULE_6_ui_core_popover__=__webpack_require__("SZxL"),ImagesWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{recentImages:[],searchers:["url","google","iconfinder"],initialize:function($super,sidebar,parent){$super("images",sidebar,parent)},load:function($super){Element.bindOnClick("btn_remove_image",this.removeImage.bindAsEventListener(this)),Element.bindOnClick("btn_auto_image",this.setAutoImage.bind(this)),$("btn_add_image").update(I18n.t("js.add_image")),this.recentImages=MM.utils.getCookie("recentImages")?MM.utils.getCookie("recentImages").split(",").concat(this.recentImages).slice(0,6):[],0==IdeaImage.default_images.length&&IdeaImage.initDefault(),this.defaultImages=__WEBPACK_IMPORTED_MODULE_3_app_utils_images__.default.getElements(IdeaImage.default_images,{idPrefix:"image_",containerClassName:"item recent",width:28,height:28}),this.recentImages.length<=0&&(this.recentImages=this.defaultImages.slice(0,6)),ServerData.isLoggedIn&&ServerData.user.unilogin&&this.searchers.push("skoletube"),this.buildRecentImages(),this.buildPopover(),this.uploadBtn=mm$("btn_upload_local_img"),this.uploadBtn.observe("change",this.onLocalFileChosen.bind(this)),$super()},buildRecentImages:function(){this.list=mm$("recent_images"),this.list.select(".recent").each(function(el){el.remove()}),this.recentImages.each(function(image){var container=new Element("cell");container.insert(image),container.observe("click",this.setDefaultImage.bindAsEventListener(this,image.id)),this.list.insert(container)}.bind(this))},save:function(icon,idx){},buildPopover:function(){this.imagePopover=new __WEBPACK_IMPORTED_MODULE_6_ui_core_popover__.c("add_image",{offset:[0,-5]});var items=[{label:I18n.t("js.upload_new_image"),onClick:this.dialogUploadImage.bind(this)},{label:I18n.t("js.use_an_image_from_the_web"),onClick:this.dialogWebImage.bind(this)},{label:I18n.t("js.draw_image"),onClick:this.dialogDrawImage.bind(this)}];App.config.anonymousUser||items.push({label:I18n.t("js.browse_image_library"),onClick:this.dialogImageLibrary.bind(this)}),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_list_list__.a,{items:items}),this.imagePopover.widgetContainer)},setDefaultImage:function(event,image_id){if(event.stop(),!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);var id=parseInt(image_id.split("_")[1]),image=IdeaImage.get(id);if(!image)return void Message.show(I18n.t("js.image_could_not_be_found"),Message.NOTICE);this.uploadImage(image)},onLocalFileChosen:function(e){e.stop();var file=this.uploadBtn.files[0];file&&(MM.utils.File.uploadImageFile(this._getSelectedTopics(),file,{onProgress:this.onImageUpload.bind(this),successCallback:function(file,targets){Tree.utils.setImage(new IdeaImage(file),targets)}}),mm$("frm_upload_local_img")&&mm$("frm_upload_local_img").reset())},dialogUploadImage:function(){if(!App.hasFeature("attachments"))return void MM.ui.dialogs.dialogUpgrade("map_attachments");this.uploadBtn.click()},dialogWebImage:function(){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);canvas.removeFocus(),this.selectedImage=null,this.googleSearch=null,this.iconFinderSearch=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&(this.skoletubeSearch=null),MM.ui.dialogs.show("image_web",{dlg_name:"image_web",action:"image_web_ajax/"+App.config.map_id,param:"idea_id="+canvas.selected.node.id,width:710,keymap:new MM.utils.KeyMap(document,"image_web_keymap",[]),onComplete:this.onDialogWebImageShow.bind(this),onClose:function(){this.selectedImage=null,this.linkImageUrl=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.destroy()}.bind(this)})},dialogDrawImage:function(editImage){var _this=this;return App.hasFeature("attachments")?canvas.selected?(canvas.removeFocus(),void MM.ui.dialogs.show("image_draw",{dlg_name:"image_draw",width:550,noHelp:!0,onComplete:function(){__webpack_require__.e(150).then(__webpack_require__.bind(null,"rg7Z")).then(function(module){_this.doodling=module.default,_this.doodling.init(300,300,"000000",editImage?canvas.selected.node.idea_image:null)})},onClose:function(){_this.doodling&&(_this.doodling.destroy(),_this.doodling=null)}})):void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE):void MM.ui.dialogs.dialogUpgrade("map_attachments")},dialogImageLibrary:function(){canvas.removeFocus(),IdeaImage.user_images=[],MM.ui.dialogs.show("image_library",{dlg_name:"image_library",height:380,width:676})},onDialogWebImageShow:function(){var _this2=this;__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__.a.get("image_searcher",function(preference){var selected=preference&&_this2.searchers.indexOf(preference.value)>=0?preference.value:null;_this2._renderSourceDropdown(selected),mm$("idea_image_url").onkeyup=_this2.previewImage.bind(_this2),mm$("set_image_button").onclick=function(){return _this2.addImage(),!1}})},_renderSourceDropdown:function(selectedSource){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_4_ui_components_mediaSourcesDropdown__.a,{sources:this.searchers,selectedSource:selectedSource||"google",onChange:this.setImageType.bind(this)}),mm$("btn-source-container"))},onSkoletubeLogin:function(){MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.load("images",this.searchSkoletube.bind(this))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),this._renderSourceDropdown("iconfinder")},setImageType:function(item){var _this3=this,type=item.value;if(!canvas.selected)return void this.showInvalidImage(I18n.t("js.please_select_an_idea_first"));if(hide(mm$("img_copyright")),this.searchers.indexOf(type)>-1){switch(this.searchers.without(type).each(function(searcher){hide(mm$(searcher+"_search")),hide(mm$(searcher+"_imgs"))}),show(mm$(type+"_search")),show(mm$(type+"_imgs")),this.selectedImage=null,MM.ui.dialogs.hideError(),type){case"google":this.searchGoogle();break;case"iconfinder":this.searchIconFinder();break;case"skoletube":__webpack_require__.e(61).then(__webpack_require__.bind(null,"TMGa")).then(function(){return MM.external.Skoletube.Groups.load("images",_this3.searchSkoletube.bind(_this3))});break;case"url":$("preview_image").select("img")[0]&&(this.selectedImage=IdeaImage.createDummy($("preview_image").select("img")[0].src))}__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__.a.save({name:"image_searcher",value:type})}},previewImage:function(){var value=mm$("idea_image_url").value;if(value!==this.linkImageUrl){this.linkImageUrl=value;var container=mm$("preview_image"),preview=container.select(".preview")[0],loadingSpinner=container.select(".loading-spinner-48")[0],image=container.select("img")[0];image||(image=new Element("img",{class:"maxw-225px h-a-center",alt:I18n.t("js.image_unavailable")}),container.appendChild(image)),hide(preview),hide(image),loadingSpinner||(loadingSpinner=MM.ui.LoadingSpinner(48),container.appendChild(loadingSpinner)),image.onload=function(){loadingSpinner.remove(),show(image),this.selectedImage=IdeaImage.createDummy(this.linkImageUrl)}.bind(this),image.onerror=function(){loadingSpinner.remove(),this.selectedImage=null,hide(image),show(preview),preview.select("cell")[0].innerHTML=I18n.t("js.image_unavailable")}.bind(this),image.src="/images/download_url?url="+this.linkImageUrl}},initGoogleSearch:function(autoImage){if(!this.googleSearch){if(!App.hasFeature("google_cse"))var searcherOptions={limitRequests:!0};this.googleSearch=new __WEBPACK_IMPORTED_MODULE_2_app_utils_imageSearch__.default({element:mm$("gsc_field"),searcher:"google",searcherOpts:searcherOptions,onSearch:function(){this.selectedImage=null}.bind(this)}),autoImage||(this.googleSearch.options.element.value=canvas.selected.node.getSingleLineTitle())}},searchGoogle:function(){this.initGoogleSearch(),this.googleSearch.search.options.disablePages=!1,this.googleSearch.ui=!0,this.googleSearch.query(this.googleSearch.options.element.value)},autoSearchGoogle:function(target){this.initGoogleSearch(!0),this.googleSearch.search.options.disablePages=!0,this.googleSearch.ui=!1;var handler=this.doSetAutoImage.bind(this,target);this.googleSearch.query(target.getSingleLineTitle(),{onComplete:handler,onError:handler})},searchIconFinder:function(){this.iconFinderSearch||(this.iconFinderSearch=new __WEBPACK_IMPORTED_MODULE_2_app_utils_imageSearch__.default({element:mm$("icf_field"),searcher:"iconfinder",onSearch:function(){this.selectedImage=null}.bind(this)}),this.iconFinderSearch.options.element.value=canvas.selected.node.getSingleLineTitle()),this.iconFinderSearch.query(this.iconFinderSearch.options.element.value)},searchSkoletube:function(group){this.skoletubeSearch||(this.skoletubeSearch=new __WEBPACK_IMPORTED_MODULE_2_app_utils_imageSearch__.default({element:mm$("skoletube_field"),searcher:"skoletube",caching:!1,onSearch:function(){this.selectedImage=null}.bind(this)}),this.skoletubeSearch.options.element.value=canvas.selected.node.getSingleLineTitle()),this.skoletubeSearch.query(this.skoletubeSearch.options.element.value,{group_id:group.toString()})},onSelectLibEl:function(container){for(var img=container.select("img")[0],source=getDataSet(img,"url")||img.src,selected=$$(".imgpanel .grid .selected"),i=0,len=selected.length;i<len;i++)removeClassName(selected[i],"selected");return addClassName(container,"selected"),source},onSelectImage:function(e,el,uploadImage){e.stop();var id=parseInt(el.id.split("_")[1]),url=this.onSelectLibEl(el);uploadImage?(IdeaImage.useSecureLink()&&url.include("download_url?url=")&&(url=url.split("download_url?url=")[1]),this.selectedImage=IdeaImage.createDummy(url)):this.selectedImage=IdeaImage.get(id),__WEBPACK_IMPORTED_MODULE_3_app_utils_images__.default.checkLicense(el)},onDblClickImage:function(e,el,uploadImage){e.stop(),this.googleSearch&&(this.googleSearch.search.options.disablePages=!0);var id=parseInt(el.id.split("_")[1]),url=this.onSelectLibEl(el);uploadImage?(IdeaImage.useSecureLink()&&url.include("download_url?url=")&&(url=url.split("download_url?url=")[1]),this.selectedImage=IdeaImage.createDummy(url)):this.selectedImage=IdeaImage.get(id),this.addImage()},imageLibraryTab:function(images,tab){for(var container=mm$(tab+"_container"),i=0,len=images.length;i<len;i++){var image=images[i];image=IdeaImage.get(image.id)||new IdeaImage(image);var cell=new Element("cell"),element=__WEBPACK_IMPORTED_MODULE_3_app_utils_images__.default.getElements([image],{idPrefix:"libimage_",containerClassName:"item rad-3"})[0];element.observe("click",this.onSelectImage.bindAsEventListener(this,element)),element.observe("dblclick",this.onDblClickImage.bindAsEventListener(this,element)),cell.appendChild(element),container.appendChild(cell)}mm$(tab+"_counter").innerHTML=I18n.t("js.images_s",{v0:images.length})},setImageLibraryContent:function(){this.selectedImage=null,this.imageLibraryTab(IdeaImage.default_images,"default")},setUserImagesLibrary:function(){this.imageLibraryTab(IdeaImage.user_images,"personal")},getUserImages:function(callback){var params={map_id:App.config.map_id};new Ajax.Request("/dialog/user_images",{parameters:params,asynchronous:!0,onSuccess:function(transport){IdeaImage.user_images=transport.responseText.evalJSON(),sideBar.images.setUserImagesLibrary(),callback&&callback()}})},uploadImage:function(image,topics){var params={};image.id>0?(params.def_image_id=image.id,params.idea_image_url=""):(params.def_image_id="",params.idea_image_url=image.download_link);var topics=this._getSelectedTopics(topics);topics.each(function(node){node._listener.setLoadingOnDrop()}),MM.utils.File.uploadImage(topics,params,{successCallback:function(file,targets){Tree.utils.setImage(new IdeaImage(file),targets)},errorCallback:this.showInvalidImage.bind(this)})},onImageUpload:function(progress){this.progressActivity||(this.progressActivity=new MM.ui.Activity(I18n.t("js.uploading"),{progress:!0,autoUpdate:!1})),progress>this.progressActivity.progress&&(this.progressActivity.update(progress),100===progress&&setTimeout(function(){this.progressActivity.close(),this.progressActivity=null,canvas.addFocus()}.bind(this),500))},addImage:function(){if(!canvas.selected||!this.selectedImage)return void this.showInvalidImage(this.selectedImage?I18n.t("js.please_select_an_idea_first"):I18n.t("js.no_image_selected"));this.uploadImage(this.selectedImage),Windows.closeAll(),App.trigger(CustomEvents.WEB_IMAGE_ADDED)},showInvalidImage:function(message){if(Windows.getWindow("image_library")||Windows.getWindow("image_web")){var copyright=mm$("img_copyright");copyright&&hide(copyright),mm$("library_message").innerHTML=message,new Effect.Appear("library_message",{duration:2}),setTimeout(function(){mm$("library_message")&&Effect.Fade("library_message",{duration:1})},4e3),setTimeout(function(){copyright&&show(copyright)},5e3)}else Message.show(message,Message.ERROR,5)},setAutoImage:function(){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);Element.addClassName("btn_auto_image","fx-wiggle fx-infinite fx-none"),App.trigger(CustomEvents.WUNDERBILD_ADDED),this._getSelectedTopics().each(function(topic){var cache=ImagesWidget.autoImages[topic.id];if(cache&&0!==cache.photos.length&&cache.title===topic.getSingleLineTitle()){for(var photos=cache.photos,photo=photos[0],i=0,len=photos.length-1;i<len;i++)photos[i]=photos[i+1];photos[photos.length-1]=photo,this.doSetAutoImage(topic,cache.photos)}else this.autoSearchGoogle(topic)}.bind(this)),Amplitude.logEvent("wunder_image")},doSetAutoImage:function(node,photos){if(ImagesWidget.autoImages[node.id]={title:node.getSingleLineTitle(),photos:photos},$("btn_auto_image").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),0===photos.length)return void Message.show(I18n.t("js.no_auto_image_was_found",{v0:node.title}),Message.NOTICE);this.uploadImage(IdeaImage.createDummy(photos[0].url),node)},onSelectNode:function(){},editImage:function(){this.dialogDrawImage(!0)},removeImage:function(e,topics){if(e&&e.stop(),topics=this._getSelectedTopics(topics),0===topics.length)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);Tree.utils.removeImage(topics)},_getSelectedTopics:function(topics){return topics?Array.isArray(topics)?topics:[topics]:canvas.getSelectedNodes()}});ImagesWidget.autoImages={},__webpack_exports__.default=ImagesWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},aVfQ:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__googleSearch__=__webpack_require__("vLs6"),__WEBPACK_IMPORTED_MODULE_1_app_utils_images__=__webpack_require__("+ptD"),__WEBPACK_IMPORTED_MODULE_2__searchWrapper__=__webpack_require__("wvK4"),__WEBPACK_IMPORTED_MODULE_3__skoletube_images_search__=__webpack_require__("MQVt"),GoogleImageSearch=Class.create(__WEBPACK_IMPORTED_MODULE_0__googleSearch__.GoogleSearch,{initialize:function($super,options){$super(Object.extend({type:"ImageSearch"},options))},query:function($super,_query,options){var fieldsEncoded=encodeURIComponent("queries,items")+"("+encodeURIComponent("link,image")+"("+encodeURIComponent("contextLink,width,height,thumbnailHeight,thumbnailLink,thumbnailWidth")+"))";this.queryText=_query,$super(_query,fieldsEncoded,options)},queryMore:function(options){options=Object.extend({index:this.index},options),this.query(this.queryText,options)},searchComplete:function($super,results,callback){results=results.collect(function(result){return{url:result.link,contextUrl:result.image.contextLink,thumbnailUrl:result.image.thumbnailLink,width:result.image.width,height:result.image.height}}),$super(results,callback)}}),IconFinderSearch=Class.create({api_key:"645bbd974574d9fb4092f88e4bd5531f",initialize:function(options){this.options=options||{}},query:function(_query2,options){var data=mm$("iconfinder_script");data&&document.body.removeChild(data),data=document.createElement("script"),data.id="iconfinder_script",data.src=document.location.protocol+"//www.iconfinder.com/json/search/?q="+_query2+"&c=30&p=0&min=48&max=128&api_key="+this.api_key+"&callback=sideBar.images.iconFinderSearch.search.searchComplete",document.body.appendChild(data),this.queryText=_query2,this.callback=options.onComplete},searchComplete:function(results){var icons=results.searchresults.icons;this.callback&&(results=icons?icons.collect(function(icon){return{url:icon.image,width:icon.size,height:icon.size}}):[],this.callback(results))}}),ImageSearchWrapper=Class.create(__WEBPACK_IMPORTED_MODULE_2__searchWrapper__.default,{initialize:function($super,options){switch($super(options),this.options=Object.extend({type:"imgs"},this.options),this.options.searcher){case"google":this.search=new GoogleImageSearch(this.options.searcherOpts);break;case"iconfinder":this.search=new IconFinderSearch(this.options.searcherOpts);break;case"skoletube":this.search=new __WEBPACK_IMPORTED_MODULE_3__skoletube_images_search__.default(this.options.searcherOpts)}},onSearchStarted:function($super){$super();var container=this.options.searcher+"_"+this.options.type;$(container).select(".no_elements")[0]&&($(container).select(".no_elements")[0].innerHTML=""),mm$(container+"_show_more")&&hide(mm$(container+"_show_more"))},updateItemListInfo:function(){var container=this.options.searcher+"_"+this.options.type;if(this.ui){$(container).select(".no_elements")[0]&&$(container).select(".no_elements")[0].update(I18n.t("js.images_d",{v0:this.items.length}));var showMoreEl=$(container+"_show_more");if(showMoreEl){var loadingSpinner=showMoreEl.select(".loading-spinner-12")[0];loadingSpinner&&loadingSpinner.remove(),this.items.length<this.search.options.maxResults?showMoreEl.onclick=function(e){e.stop(),this.queryMore(showMoreEl)}.bind(this):(showMoreEl.onclick=null,showMoreEl.href="https://www.google.com/images?q="+this.search.queryText),show(showMoreEl)}}},insertListElement:function(item,index){__WEBPACK_IMPORTED_MODULE_1_app_utils_images__.default.insertIntoLibrary(this.options.searcher,item,index)},onNoResultsFound:function(){if(this.options.handler)this.options.handler([]);else if(this.ui){var container=this.options.searcher+"_"+this.options.type;$(container).select(".no_elements")[0]&&$(container).select(".no_elements")[0].update(I18n.t("js.no_images")),addClassName(mm$(container+"_container"),"empty"),mm$(container+"_container").update('<div class="w-100% fs-14">'+I18n.t("js.no_image_was_found")+"</div>")}}});__webpack_exports__.default=ImageSearchWrapper},aaAh:function(module,exports,__webpack_require__){function baseUniq(array,iteratee,comparator){var index=-1,includes=arrayIncludes,length=array.length,isCommon=!0,result=[],seen=result;if(comparator)isCommon=!1,includes=arrayIncludesWith;else if(length>=LARGE_ARRAY_SIZE){var set=iteratee?null:createSet(array);if(set)return setToArray(set);isCommon=!1,includes=cacheHas,seen=new SetCache}else seen=iteratee?[]:result;outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value):value;if(value=comparator||0!==value?value:0,isCommon&&computed===computed){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else includes(seen,computed,comparator)||(seen!==result&&seen.push(computed),result.push(value))}return result}var SetCache=__webpack_require__("2mhJ"),arrayIncludes=__webpack_require__("sfIr"),arrayIncludesWith=__webpack_require__("83D3"),cacheHas=__webpack_require__("3AGJ"),createSet=__webpack_require__("izUU"),setToArray=__webpack_require__("4XN+"),LARGE_ARRAY_SIZE=200;module.exports=baseUniq},ahzF:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Poller={initialize:function(websockets){Modernizr.websockets&&websockets?(console.log("Poller#initialize - trying websockets"),MM.utils.loadScript("http://"+document.location.hostname+":9000/faye/client.js",this.initializeSocket.bind(this)),console.log("Poller#initialize - after loadScriptN")):(this.resetInterval(),this.pollHandler=this.poll.bind(this),this.schedulePoll())},initializeSocket:function initializeSocket(){console.log("Poller#initialize - Enabling websockets, disabling polling"),this.socket=new Faye.Client("http://"+document.location.hostname+":9000/faye"),console.log("Poller#initialize - Subscribing");var subscription=this.socket.subscribe("/map/"+tree.root.id,function(message){eval(message)});subscription.callback(function(){console.log("Subscription is now active")})},schedulePoll:function(){App.config.shareMode===App.MULTI||App.config.linkShare?this.resetInterval():"undefined"==typeof Presentation||Presentation.on||this.interval<20&&(this.interval=1.1*this.interval),setTimeout(this.pollHandler,1e3*this.interval)},poll:function(){ServerConnection.poll(),this.socket||this.schedulePoll()},resetInterval:function(){this.interval=App.config.POLL_INTERVAL}};__webpack_exports__.default=Poller},atk5:function(module,exports){function identity(value){return value}module.exports=identity},cQwG:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__editable__=__webpack_require__("2UzH"),__WEBPACK_IMPORTED_MODULE_1__resizable__=__webpack_require__("2J63"),__WEBPACK_IMPORTED_MODULE_2__selectable__=__webpack_require__("tCwE"),__WEBPACK_IMPORTED_MODULE_3__draggable__=__webpack_require__("wQol"),Block=Class.create({el:null,pos:null,children:null,childrenSize:null,childrenLength:null,initialize:function(className,tagName){this.el=document.createElement(tagName||"div"),this.el=$(this.el),this.el.className=className,this.pos=[0,0],this.children=[],this.childrenSize=null,this.childrenLength=null},size:function(){return[this.el.offsetWidth,this.el.offsetHeight]},setSize:function(size){this.el.width=size[0],this.el.height=size[1]},contains:function(point){var fsize=this.size(),pos=this.getPosition();return pos[0]<=point[0]&&pos[1]<=point[1]&&pos[0]+fsize[0]>=point[0]&&pos[1]+fsize[1]>=point[1]},getPosition:function(){return this.el.offsetParent!==this.el.parentNode?[this.el.offsetLeft-this.el.parentNode.offsetLeft,this.el.offsetTop-this.el.parentNode.offsetTop]:[this.el.offsetLeft,this.el.offsetTop]},move:function(newPos){this.pos=newPos.slice()},shift:function(offset){this.pos[0]+=offset[0],this.pos[1]+=offset[1]},doMove:function(){this.el.style.position="absolute",this.el.style.top=this.pos[1]+"px",hasClassName(this.el,"left_pane")&&"phantomjs"!==App.config.environment?(this.el.style.left="auto",this.el.style.right="calc(100% - "+(this.pos[0]+this.el.getWidth())+"px)"):(this.el.style.right="auto",this.el.style.left=this.pos[0]+"px")},resetPosition:function(){this.el.style.position="",this.el.style.left="",this.el.style.top="",this.el.style.width="",this.el.style.height=""},onImageRemoved:function(){this.el.childNodes[0].style.marginLeft="0"},setTitle:function(){var wrapper=new Element("div",{className:"h-iblock va-middle"});this.title=new Element("div",{className:"tk_title",dir:"auto"}).update(this.el._listener.node.getTitleWithLinks()),wrapper.appendChild(this.title),this.insertChild({el:wrapper},0),this.setHoverTitle()},setHoverTitle:function(){if(App.config.editable){var node=this.el._listener.node,user=users.findByID(node.modifiedBy,!0)||users.selfUser,now=(new Date).getTime();this.title.title=I18n.t("js.modified_by_s_s",{v0:user.name,v1:node.modifiedAt.toUIString(now-node.modifiedAt.getTime()>864e5)})}},updateTitle:function(){var node=this.el._listener.node,sanitizedTitle=node.getTitle(!0).safeUnescapeHTML().escapeHTML();this.title.innerHTML=node.replaceLineBreaksWithHTML(sanitizedTitle).toLink()},applyStyles:function(target){this.el._listener.node.style?Style.applyToElement(this.el._listener.node.style,target):Style.removeFromElement(target)},insertChild:function(inlineBlock,index){this.children.insert(inlineBlock,index),inlineBlock.parent=this,index>=this.children.length-1?this.el.appendChild(inlineBlock.el):this.el.insertBefore(inlineBlock.el,this.children[index+1].el)},appendChild:function(inlineBlock){this.children[this.children.length]=inlineBlock,inlineBlock.parent=this,this.el.appendChild(inlineBlock.el)},removeChild:function(inlineBlock){this.children=this.children.reject(function(c){return inlineBlock.el==c.el}),this.el.removeChild(inlineBlock.el)},destroy:function(){this.children.each(function(c){c.destroy&&c.destroy()}),this.children.clear(),Element.discard(this.el)},makeSelectable:function(){Object.extend(this,__WEBPACK_IMPORTED_MODULE_2__selectable__.default)},makeResizable:function(){Object.extend(this,__WEBPACK_IMPORTED_MODULE_1__resizable__.default)},makeEditable:function(){Object.extend(this,__WEBPACK_IMPORTED_MODULE_0__editable__.default)},makeDraggable:function(){Object.extend(this,__WEBPACK_IMPORTED_MODULE_3__draggable__._Draggable)},makeDroppable:function(){Object.extend(this,__WEBPACK_IMPORTED_MODULE_3__draggable__._Droppable)}});__webpack_exports__.default=Block},cdGT:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_app_models_ideaVideo__=__webpack_require__("Kh9o"),__WEBPACK_IMPORTED_MODULE_2_app_utils_videoSearch__=__webpack_require__("HTWB"),__WEBPACK_IMPORTED_MODULE_3_ui_components_mediaSourcesDropdown__=__webpack_require__("FN6h"),__WEBPACK_IMPORTED_MODULE_4_app_utils_videoHelpers__=__webpack_require__("vu0f"),__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__=__webpack_require__("h7V/"),VideosWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{sources:["url","youtube","vimeo","dailymotion"],resultCount:10,initialize:function($super,sidebar,parent){var _this=this;$super("videos",sidebar,parent),ServerData.isLoggedIn&&ServerData.user.unilogin?__webpack_require__.e(61).then(__webpack_require__.bind(null,"TMGa")).then(function(){_this.sources.push("skoletube"),_this.initSearchers()}):this.initSearchers()},initSearchers:function(){this.sources.without("url").each(function(searcher){this[searcher+"Search"]=new __WEBPACK_IMPORTED_MODULE_2_app_utils_videoSearch__.default({searcher:searcher,onItemSelect:this.selectVideo.bind(this),ui:!1,onSearch:function(){this.unselectVideo(this.selectedVideo),MM.ui.disableButton("btn_set_video")}.bind(this),caching:"skoletube"!==searcher})}.bind(this))},load:function($super){Element.bindOnClick("btn_remove_video",this.removeVideo.bind(this)),Element.bindOnClick("btn_auto_video",this.setAutoVideo.bind(this)),Element.bindOnClick("btn_dlg_videolibrary",this.dialogVideoSearch.bind(this)),mm$("btn_dlg_videolibrary").update(I18n.t("js.browse_videos")),$super()},setAutoVideo:function(){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);$("btn_auto_video").addClassName("fx-wiggle fx-infinite fx-none"),canvas.allSelected.each(function(vnode){this.youtubeSearch.query(vnode.node.getSingleLineTitle(),{per_page:1,onComplete:this.doSetAutoVideo.bind(this,vnode.node)})}.bind(this)),Amplitude.logEvent("wunder_video")},doSetAutoVideo:function(node,videos){if(videos.length>0){var video=new __WEBPACK_IMPORTED_MODULE_1_app_models_ideaVideo__.default({url:this.youtubeSearch.options.embedURL+videos[0].url,source:"youtube",size:{width:320,height:200},title:videos[0].title});canvas.onSetVideo(video,node)}else Message.show(I18n.t("js.no_auto_video_found_for_topic"),Message.NOTICE);$("btn_auto_video").removeClassName("fx-wiggle fx-infinite").removeClassName("fx-none"),this.youtubeSearch.search.queryText=null},removeVideo:function(){canvas.selected?canvas.onSetVideo():Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},dialogVideoSearch:function(){canvas.removeFocus(),MM.ui.dialogs.show("video_search",{dlg_name:"video_search",width:710,keymap:new MM.utils.KeyMap(document,"video_search_keymap",[]),onComplete:this.onDialogShow.bind(this)})},onDialogShow:function(){var _this2=this;this.searchField=mm$("url_field"),this.searchField.observe("keyup",this._onKeyUp.bind(this)),this.sources.without("url").each(function(searcher){var searchWrapper=this[searcher+"Search"];searchWrapper.ui=!0,searchWrapper.options.element=mm$(searcher+"_field"),searchWrapper.observeSearchField()}.bind(this)),__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__.a.get("video_searcher",function(preference){_this2._renderSourceDropdown(preference?preference.value:"youtube")})},_renderSourceDropdown:function(selectedSource){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_mediaSourcesDropdown__.a,{sources:this.sources,selectedSource:selectedSource||"youtube",onChange:this.setPopoverValue.bind(this)}),mm$("btn-source-container"))},setPopoverValue:function(item){item&&(__WEBPACK_IMPORTED_MODULE_5_utils_userPreferences__.a.save({name:"video_searcher",value:item.value}),this.updateVideoSource(item.value))},_onKeyUp:function(){var videoPreview=mm$("url_videos"),previewVideo=Object(__WEBPACK_IMPORTED_MODULE_4_app_utils_videoHelpers__.checkLink)(this.searchField.value);if(previewVideo.video&&previewVideo.source){var previewURL=this[previewVideo.source+"Search"].options.embedURL+previewVideo.video;previewURL!==this.videoURL&&(MM.ui.disableButton("btn_set_video"),this.pasteURL=this.searchField.value,this.videoURL=previewURL,this.createVideoFromLink(previewVideo,function(video){this.selectedVideo=video,MM.ui.enableButton("btn_set_video"),removeClassName(videoPreview,"invalid"),videoPreview.update(this.selectedVideo.getElement())}.bind(this)))}else MM.ui.disableButton("btn_set_video"),this.videoURL=null,this.selectedVideo=null,videoPreview.update('<cell class="va-middle ta-center">'+(ServerData.isLoggedIn&&ServerData.user.unilogin?I18n.t("js.invalid_video_url_skoletube"):I18n.t("js.invalid_video_url"))+"</cell>"),addClassName(videoPreview,"invalid")},updateVideoSource:function(source){var previous=this.activeSource||source;if(this.hideSearcher(previous),this.activeSource=source,this.showSearcher(source),"url"===source)this.searchField.value=this.pasteURL||"";else{var lastSearch=this[previous+"Search"],searchField=this[this.activeSource+"Search"].options.element;lastSearch?searchField.value=lastSearch.options.element.value||canvas.selected.node.getSingleLineTitle():searchField.value||(searchField.value=canvas.selected.node.getSingleLineTitle()),ServerData.isLoggedIn&&ServerData.user.unilogin&&"skoletube"===source&&!MM.external.Skoletube.Groups.skoletubeGroups?MM.external.Skoletube.Groups.load("videos",this.searchSkoletube.bind(this)):this.search()}},search:function(params){var searchWrapper=this[this.activeSource+"Search"],query=searchWrapper.options.element.value;query||!searchWrapper.options.caching?searchWrapper.query(query,Object.extend({per_page:this.resultCount},params)):this.showMessage(I18n.t("js.no_video_was_found"))},searchSkoletube:function(group){this.search({group_id:group.toString()})},selectVideo:function(item,event){event.stop(),this.unselectVideo(this.selectedVideo),this.selectedVideo=item,addClassName(this.selectedVideo.el.parentNode,"selected"),MM.ui.enableButton("btn_set_video")},unselectVideo:function(video){video&&video.el.parentNode&&removeClassName(video.el.parentNode,"selected"),this.selectedVideo=null},showMessage:function(message){mm$("video_message").update(message),Effect.Appear("video_message",{duration:2}),setTimeout(function(){Effect.Fade("video_message",{duration:1})},4e3)},addVideo:function(){if(!this.selectedVideo)return void this.showMessage(I18n.t("js.no_video_selected"));canvas.onSetVideo(this.selectedVideo),this.clearResults(),Windows.close("video_search")},clearResults:function(){this.sources.without("url").each(function(searcher){this[searcher+"Search"].destroy()}.bind(this)),this.pasteURL=null,this.selectedVideo=null,ServerData.isLoggedIn&&ServerData.user.unilogin&&MM.external.Skoletube.Groups.destroy(),canvas.addFocus()},onSelectNode:function(){var node=canvas.selected.node;this.updateVideoContent(node.idea_video)},updateVideoContent:function(video){var thumbnail=mm$("video_source");video?(removeClassName(mm$("videos_content"),"o-30"),thumbnail.innerHTML=MM.ui.icon({name:"service-"+video.source,size:22,clickable:!1,parentClasses:"h-a-center rad-100%"}),mm$("title_video").textContent=video.title.truncate(50)):(addClassName(mm$("videos_content"),"o-30"),thumbnail.innerHTML=MM.ui.icon({name:"play",size:16,color:"grey-lighter",parentClasses:"h-a-center js-add-image"}),mm$("title_video").textContent=I18n.t("js.no_video"),Element.bindOnClick(thumbnail.select(".js-add-image")[0],this.dialogVideoSearch.bind(this)))},createVideoFromLink:function(previewVideo,callback){var searchWrapper=this[previewVideo.source+"Search"],video=new __WEBPACK_IMPORTED_MODULE_1_app_models_ideaVideo__.default({url:searchWrapper.options.embedURL+previewVideo.video,source:previewVideo.source,size:{width:480,height:272}}),value="skoletube"===previewVideo.source?previewVideo.url:previewVideo.video.split(/[#?]/)[0];searchWrapper.search.queryVideoDetails(value,{fields:["title"],onComplete:function(videos){video.title=videos.length>0?videos[0].title:I18n.t("js.unknown_video"),callback&&callback(video)}.bind(this)})},showSearcher:function(searcher){show(mm$(searcher+"_search")),show(mm$(searcher+"_videos"))},hideSearcher:function(searcher){hide(mm$(searcher+"_search")),hide(mm$(searcher+"_videos"))},onSkoletubeLogin:function(){this.updateVideoSource("skoletube"),this.skoletubeSearch.search.queryText="",MM.external.Skoletube.Groups.load("videos",this.searchSkoletube.bind(this))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),this.skoletubeSearch.search.queryText="",this._renderSourceDropdown("youtube")}});__webpack_exports__.default=VideosWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},d2ki:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),VotesBar=function(_React$Component){function VotesBar(props){_classCallCheck(this,VotesBar);var _this=_possibleConstructorReturn(this,(VotesBar.__proto__||Object.getPrototypeOf(VotesBar)).call(this,props));return _this._showExtendedSidebar=_this._showExtendedSidebar.bind(_this),_this}return _inherits(VotesBar,_React$Component),_createClass(VotesBar,[{key:"_showExtendedSidebar",value:function(e){e.preventDefault(),e.stopPropagation(),this.props.editable&&this.props.onExpand()}},{key:"render",value:function(){var _props=this.props,editable=_props.editable,userVote=_props.userVote,downVotes=_props.downVotes,votes=_props.votes,onVote=_props.onVote,likeIcon=void 0,unlikeIcon=void 0;editable&&(unlikeIcon=React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{onClick:function(e){return onVote(e,IdeaVote.DOWN)},opts:{name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"vote unlike p-r"+(userVote<0?" active":"")}}),likeIcon=React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{onClick:function(e){return onVote(e,IdeaVote.UP)},opts:{name:"like",size:16,consize:28,classes:"h-a-center",parentClasses:"vote like p-r"+(userVote>0?" active":"")}}));var dislikeBarWidth="w-"+downVotes/IdeaVote.maxVotes*100+"%",likeBarWidth="w-"+votes.length/IdeaVote.maxVotes*100+"%";return React.createElement("div",{className:"h-flex-row w-200 votes_widget"},unlikeIcon,React.createElement("div",{className:"h-flex-row h-flex-grow ph-5"},React.createElement("div",{className:"h-6px p-r w-100%"},React.createElement("div",{className:"vote_progress_bar grey"}),React.createElement("div",{className:"vote_progress_bar orange animated "+dislikeBarWidth}),React.createElement("div",{className:"vote_progress_bar green animated "+likeBarWidth}))),likeIcon,React.createElement("div",{className:"pl-5 text-center"},React.createElement("a",{id:"vote_count_preview",href:"#",className:"fs-12"+(editable?"":" disabled"),onClick:this._showExtendedSidebar},votes.length+" "+(1===votes.length?I18n.t("js.vote"):I18n.t("js.votes")))))}}]),VotesBar}(React.Component);__webpack_exports__.a=VotesBar}).call(__webpack_exports__,__webpack_require__("nakD"))},dnTF:function(module,exports,__webpack_require__){function debounce(func,wait,options){function invokeFunc(time){var args=lastArgs,thisArg=lastThis;return lastArgs=lastThis=void 0,lastInvokeTime=time,result=func.apply(thisArg,args)}function leadingEdge(time){return lastInvokeTime=time,timerId=setTimeout(timerExpired,wait),leading?invokeFunc(time):result}function remainingWait(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime,result=wait-timeSinceLastCall;return maxing?nativeMin(result,maxWait-timeSinceLastInvoke):result}function shouldInvoke(time){var timeSinceLastCall=time-lastCallTime,timeSinceLastInvoke=time-lastInvokeTime;return void 0===lastCallTime||timeSinceLastCall>=wait||timeSinceLastCall<0||maxing&&timeSinceLastInvoke>=maxWait}function timerExpired(){var time=now();if(shouldInvoke(time))return trailingEdge(time);timerId=setTimeout(timerExpired,remainingWait(time))}function trailingEdge(time){return timerId=void 0,trailing&&lastArgs?invokeFunc(time):(lastArgs=lastThis=void 0,result)}function cancel(){void 0!==timerId&&clearTimeout(timerId),lastInvokeTime=0,lastArgs=lastCallTime=lastThis=timerId=void 0}function flush(){return void 0===timerId?result:trailingEdge(now())}function debounced(){var time=now(),isInvoking=shouldInvoke(time);if(lastArgs=arguments,lastThis=this,lastCallTime=time,isInvoking){if(void 0===timerId)return leadingEdge(lastCallTime);if(maxing)return timerId=setTimeout(timerExpired,wait),invokeFunc(lastCallTime)}return void 0===timerId&&(timerId=setTimeout(timerExpired,wait)),result}var lastArgs,lastThis,maxWait,result,timerId,lastCallTime,lastInvokeTime=0,leading=!1,maxing=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return wait=toNumber(wait)||0,isObject(options)&&(leading=!!options.leading,maxing="maxWait"in options,maxWait=maxing?nativeMax(toNumber(options.maxWait)||0,wait):maxWait,trailing="trailing"in options?!!options.trailing:trailing),debounced.cancel=cancel,debounced.flush=flush,debounced}var isObject=__webpack_require__("xwKO"),now=__webpack_require__("o72h"),toNumber=__webpack_require__("5JaQ"),FUNC_ERROR_TEXT="Expected a function",nativeMax=Math.max,nativeMin=Math.min;module.exports=debounce},ePfb:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Users={highlight:function(user){var el=mm$("user_"+user.id);el&&(el.style.borderColor=user.color||"#cccccc",setTimeout(function(){el.style.borderColor="transparent"},2e3))},highlightNode:function(vnode,userId){var user=users.findByID(userId,!0);user&&(this.highlight(user),vnode.highlight(user.color,!1))},highlightMovement:function(vnode,userId,clone){if(!App.config.layout.autoAlign&&!vnode.dcontainer.el.eventRunning){var newPos=vnode.dcontainer.el.cumulativeOffset(),elementsToMove=vnode.node.getElementsByClassName(vnode.dcontainer.el,"tk_label");elementsToMove.each(function(c){c.style.color="#cccccc"}),mm$("canvas").appendChild(clone),vnode.dcontainer.el.eventRunning=!0,new Effect.Move(clone,{x:newPos[0],y:newPos[1],mode:"absolute",afterFinish:function(){Element.discard(clone),vnode.node&&(vnode.dcontainer.el.eventRunning=!1,vnode.dcontainer.el.style.zIndex=3,elementsToMove.each(function(el){el&&el.style&&(el.style.color="#"+el._listener.node.currentStyle().color)}),vnode.dcontent.el.style.color=vnode.node.currentStyle().color,this.highlightNode(vnode,userId))}.bind(this,vnode)})}}};__webpack_exports__.default=Users},ewQx:function(module,exports,__webpack_require__){"use strict";module.exports=function(){return/\uD83D\uDC69(?:\u200D(?:(?:\uD83D\uDC69\u200D)?\uD83D\uDC67|(?:\uD83D\uDC69\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|\uD83D\uDC69\u200D(?:\uD83D\uDC69\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C\uDFF3\uFE0F\u200D\uD83C\uDF08|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642]\uFE0F|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC6F\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3C-\uDD3E\uDDD6-\uDDDF])\u200D[\u2640\u2642]\uFE0F|\uD83C\uDDFD\uD83C\uDDF0|\uD83C\uDDF6\uD83C\uDDE6|\uD83C\uDDF4\uD83C\uDDF2|\uD83C\uDDE9(?:\uD83C[\uDDEA\uDDEC\uDDEF\uDDF0\uDDF2\uDDF4\uDDFF])|\uD83C\uDDF7(?:\uD83C[\uDDEA\uDDF4\uDDF8\uDDFA\uDDFC])|\uD83C\uDDE8(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDEE\uDDF0-\uDDF5\uDDF7\uDDFA-\uDDFF])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uFE0F\u200D[\u2640\u2642]|(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2640\u2642])\uFE0F|(?:\uD83D\uDC41\uFE0F\u200D\uD83D\uDDE8|\uD83D\uDC69(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\uD83D\uDC69\u200D[\u2695\u2696\u2708]|\uD83D\uDC68(?:(?:\uD83C[\uDFFB-\uDFFF])\u200D[\u2695\u2696\u2708]|\u200D[\u2695\u2696\u2708]))\uFE0F|\uD83C\uDDF2(?:\uD83C[\uDDE6\uDDE8-\uDDED\uDDF0-\uDDFF])|\uD83D\uDC69\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]|\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D(?:\uD83D[\uDC68\uDC69])|\uD83D[\uDC68\uDC69]))|\uD83C\uDDF1(?:\uD83C[\uDDE6-\uDDE8\uDDEE\uDDF0\uDDF7-\uDDFB\uDDFE])|\uD83C\uDDEF(?:\uD83C[\uDDEA\uDDF2\uDDF4\uDDF5])|\uD83C\uDDED(?:\uD83C[\uDDF0\uDDF2\uDDF3\uDDF7\uDDF9\uDDFA])|\uD83C\uDDEB(?:\uD83C[\uDDEE-\uDDF0\uDDF2\uDDF4\uDDF7])|[#\*0-9]\uFE0F\u20E3|\uD83C\uDDE7(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEF\uDDF1-\uDDF4\uDDF6-\uDDF9\uDDFB\uDDFC\uDDFE\uDDFF])|\uD83C\uDDE6(?:\uD83C[\uDDE8-\uDDEC\uDDEE\uDDF1\uDDF2\uDDF4\uDDF6-\uDDFA\uDDFC\uDDFD\uDDFF])|\uD83C\uDDFF(?:\uD83C[\uDDE6\uDDF2\uDDFC])|\uD83C\uDDF5(?:\uD83C[\uDDE6\uDDEA-\uDDED\uDDF0-\uDDF3\uDDF7-\uDDF9\uDDFC\uDDFE])|\uD83C\uDDFB(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDEE\uDDF3\uDDFA])|\uD83C\uDDF3(?:\uD83C[\uDDE6\uDDE8\uDDEA-\uDDEC\uDDEE\uDDF1\uDDF4\uDDF5\uDDF7\uDDFA\uDDFF])|\uD83C\uDFF4\uDB40\uDC67\uDB40\uDC62(?:\uDB40\uDC77\uDB40\uDC6C\uDB40\uDC73|\uDB40\uDC73\uDB40\uDC63\uDB40\uDC74|\uDB40\uDC65\uDB40\uDC6E\uDB40\uDC67)\uDB40\uDC7F|\uD83D\uDC68(?:\u200D(?:\u2764\uFE0F\u200D(?:\uD83D\uDC8B\u200D)?\uD83D\uDC68|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66\u200D\uD83D\uDC66|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67\u200D(?:\uD83D[\uDC66\uDC67])|\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92])|(?:\uD83C[\uDFFB-\uDFFF])\u200D(?:\uD83C[\uDF3E\uDF73\uDF93\uDFA4\uDFA8\uDFEB\uDFED]|\uD83D[\uDCBB\uDCBC\uDD27\uDD2C\uDE80\uDE92]))|\uD83C\uDDF8(?:\uD83C[\uDDE6-\uDDEA\uDDEC-\uDDF4\uDDF7-\uDDF9\uDDFB\uDDFD-\uDDFF])|\uD83C\uDDF0(?:\uD83C[\uDDEA\uDDEC-\uDDEE\uDDF2\uDDF3\uDDF5\uDDF7\uDDFC\uDDFE\uDDFF])|\uD83C\uDDFE(?:\uD83C[\uDDEA\uDDF9])|\uD83C\uDDEE(?:\uD83C[\uDDE8-\uDDEA\uDDF1-\uDDF4\uDDF6-\uDDF9])|\uD83C\uDDF9(?:\uD83C[\uDDE6\uDDE8\uDDE9\uDDEB-\uDDED\uDDEF-\uDDF4\uDDF7\uDDF9\uDDFB\uDDFC\uDDFF])|\uD83C\uDDEC(?:\uD83C[\uDDE6\uDDE7\uDDE9-\uDDEE\uDDF1-\uDDF3\uDDF5-\uDDFA\uDDFC\uDDFE])|\uD83C\uDDFA(?:\uD83C[\uDDE6\uDDEC\uDDF2\uDDF3\uDDF8\uDDFE\uDDFF])|\uD83C\uDDEA(?:\uD83C[\uDDE6\uDDE8\uDDEA\uDDEC\uDDED\uDDF7-\uDDFA])|\uD83C\uDDFC(?:\uD83C[\uDDEB\uDDF8])|(?:\u26F9|\uD83C[\uDFCB\uDFCC]|\uD83D\uDD75)(?:\uD83C[\uDFFB-\uDFFF])|(?:\uD83C[\uDFC3\uDFC4\uDFCA]|\uD83D[\uDC6E\uDC71\uDC73\uDC77\uDC81\uDC82\uDC86\uDC87\uDE45-\uDE47\uDE4B\uDE4D\uDE4E\uDEA3\uDEB4-\uDEB6]|\uD83E[\uDD26\uDD37-\uDD39\uDD3D\uDD3E\uDDD6-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u270A-\u270D]|\uD83C[\uDF85\uDFC2\uDFC7]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66\uDC67\uDC70\uDC72\uDC74-\uDC76\uDC78\uDC7C\uDC83\uDC85\uDCAA\uDD74\uDD7A\uDD90\uDD95\uDD96\uDE4C\uDE4F\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD30-\uDD36\uDDD1-\uDDD5])(?:\uD83C[\uDFFB-\uDFFF])|\uD83D\uDC68(?:\u200D(?:(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC67|(?:(?:\uD83D[\uDC68\uDC69])\u200D)?\uD83D\uDC66)|\uD83C[\uDFFB-\uDFFF])|(?:[\u261D\u26F9\u270A-\u270D]|\uD83C[\uDF85\uDFC2-\uDFC4\uDFC7\uDFCA-\uDFCC]|\uD83D[\uDC42\uDC43\uDC46-\uDC50\uDC66-\uDC69\uDC6E\uDC70-\uDC78\uDC7C\uDC81-\uDC83\uDC85-\uDC87\uDCAA\uDD74\uDD75\uDD7A\uDD90\uDD95\uDD96\uDE45-\uDE47\uDE4B-\uDE4F\uDEA3\uDEB4-\uDEB6\uDEC0\uDECC]|\uD83E[\uDD18-\uDD1C\uDD1E\uDD1F\uDD26\uDD30-\uDD39\uDD3D\uDD3E\uDDD1-\uDDDD])(?:\uD83C[\uDFFB-\uDFFF])?|(?:[\u231A\u231B\u23E9-\u23EC\u23F0\u23F3\u25FD\u25FE\u2614\u2615\u2648-\u2653\u267F\u2693\u26A1\u26AA\u26AB\u26BD\u26BE\u26C4\u26C5\u26CE\u26D4\u26EA\u26F2\u26F3\u26F5\u26FA\u26FD\u2705\u270A\u270B\u2728\u274C\u274E\u2753-\u2755\u2757\u2795-\u2797\u27B0\u27BF\u2B1B\u2B1C\u2B50\u2B55]|\uD83C[\uDC04\uDCCF\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE1A\uDE2F\uDE32-\uDE36\uDE38-\uDE3A\uDE50\uDE51\uDF00-\uDF20\uDF2D-\uDF35\uDF37-\uDF7C\uDF7E-\uDF93\uDFA0-\uDFCA\uDFCF-\uDFD3\uDFE0-\uDFF0\uDFF4\uDFF8-\uDFFF]|\uD83D[\uDC00-\uDC3E\uDC40\uDC42-\uDCFC\uDCFF-\uDD3D\uDD4B-\uDD4E\uDD50-\uDD67\uDD7A\uDD95\uDD96\uDDA4\uDDFB-\uDE4F\uDE80-\uDEC5\uDECC\uDED0-\uDED2\uDEEB\uDEEC\uDEF4-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])|(?:[#\*0-9\xA9\xAE\u203C\u2049\u2122\u2139\u2194-\u2199\u21A9\u21AA\u231A\u231B\u2328\u23CF\u23E9-\u23F3\u23F8-\u23FA\u24C2\u25AA\u25AB\u25B6\u25C0\u25FB-\u25FE\u2600-\u2604\u260E\u2611\u2614\u2615\u2618\u261D\u2620\u2622\u2623\u2626\u262A\u262E\u262F\u2638-\u263A\u2640\u2642\u2648-\u2653\u2660\u2663\u2665\u2666\u2668\u267B\u267F\u2692-\u2697\u2699\u269B\u269C\u26A0\u26A1\u26AA\u26AB\u26B0\u26B1\u26BD\u26BE\u26C4\u26C5\u26C8\u26CE\u26CF\u26D1\u26D3\u26D4\u26E9\u26EA\u26F0-\u26F5\u26F7-\u26FA\u26FD\u2702\u2705\u2708-\u270D\u270F\u2712\u2714\u2716\u271D\u2721\u2728\u2733\u2734\u2744\u2747\u274C\u274E\u2753-\u2755\u2757\u2763\u2764\u2795-\u2797\u27A1\u27B0\u27BF\u2934\u2935\u2B05-\u2B07\u2B1B\u2B1C\u2B50\u2B55\u3030\u303D\u3297\u3299]|\uD83C[\uDC04\uDCCF\uDD70\uDD71\uDD7E\uDD7F\uDD8E\uDD91-\uDD9A\uDDE6-\uDDFF\uDE01\uDE02\uDE1A\uDE2F\uDE32-\uDE3A\uDE50\uDE51\uDF00-\uDF21\uDF24-\uDF93\uDF96\uDF97\uDF99-\uDF9B\uDF9E-\uDFF0\uDFF3-\uDFF5\uDFF7-\uDFFF]|\uD83D[\uDC00-\uDCFD\uDCFF-\uDD3D\uDD49-\uDD4E\uDD50-\uDD67\uDD6F\uDD70\uDD73-\uDD7A\uDD87\uDD8A-\uDD8D\uDD90\uDD95\uDD96\uDDA4\uDDA5\uDDA8\uDDB1\uDDB2\uDDBC\uDDC2-\uDDC4\uDDD1-\uDDD3\uDDDC-\uDDDE\uDDE1\uDDE3\uDDE8\uDDEF\uDDF3\uDDFA-\uDE4F\uDE80-\uDEC5\uDECB-\uDED2\uDEE0-\uDEE5\uDEE9\uDEEB\uDEEC\uDEF0\uDEF3-\uDEF8]|\uD83E[\uDD10-\uDD3A\uDD3C-\uDD3E\uDD40-\uDD45\uDD47-\uDD4C\uDD50-\uDD6B\uDD80-\uDD97\uDDC0\uDDD0-\uDDE6])\uFE0F/g}},fGk7:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_canvas_copyPaste__=__webpack_require__("d407"),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},onPaste=function(e){e.preventDefault(),e.stopPropagation();var content=__WEBPACK_IMPORTED_MODULE_0_app_canvas_copyPaste__.default.getPlainClipboardData(e);__WEBPACK_IMPORTED_MODULE_0_app_canvas_copyPaste__.default.simulatePaste(content)},EditableBlock=Class.create({el:null,initialize:function(className,options){this.options=_extends({defaultText:"Label",saveCallback:function(){},onEnterEditMode:function(){},onLeaveEditMode:function(){}},options),this.el=new Element("div",{className:"tk_editable "+className}).update(this.options.defaultText),App.config.editable&&(this.clickObserver=this.onDocumentClick.bind(this),this.el.observe("click",this.toEditing.bind(this)),this.el.observe("dblclick",this.toEditing.bind(this))),this.initKeyMap()},initKeyMap:function(){var K=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(this.el,"edit_connection_label_keymap",[{key:K.ENTER,stopEvent:!0,handler:this.stopEditing.bind(this,!0)},{key:K.ESC,stopEvent:!0,handler:this.stopEditing.bind(this,!1)}]),this.keyMap.disable()},toEditing:function(e){if(e&&(e.preventDefault(),e.stopPropagation()),!this.editing){this.editing=!0,this.options.onEnterEditMode(),this.initialValue=this.getValue(),this.el.setAttribute("contenteditable","true"),this.el.focus();var range=document.createRange();range.selectNodeContents(this.el),MM.utils.addSelection(range),Event.observe(this.el,"paste",onPaste),Event.observe(document,"click",this.clickObserver),this.keyMap.enable()}},stopEditing:function(save){this.options.onLeaveEditMode(),this.el.setAttribute("contenteditable","false"),MM.utils.clearSelection(),Event.stopObserving(this.el,"paste",onPaste),Event.stopObserving(document,"click",this.clickObserver),this.keyMap.disable(),save?this.save():this.setValue(this.initialValue),this.editing=!1,this.initialValue=""},onDocumentClick:function(e){Event.findElement(e)!==this.el&&this.stopEditing(!0)},getWidth:function(){return this.el.getWidth()},getHeight:function(){return this.el.getHeight()},setValue:function(value){this.el.update(value)},getValue:function(){return this.el.textContent.replace(/\s*$/,"").escapeHTML()},save:function(){this.options.saveCallback(this.getValue())}});__webpack_exports__.default=EditableBlock},fSlT:function(module,__webpack_exports__,__webpack_require__){"use strict";function _defineProperty(obj,key,value){return key in obj?Object.defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_lodash_omitBy__=__webpack_require__("CKi4"),__WEBPACK_IMPORTED_MODULE_0_lodash_omitBy___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_lodash_omitBy__),__WEBPACK_IMPORTED_MODULE_1_lodash_isNull__=__webpack_require__("9pOK"),__WEBPACK_IMPORTED_MODULE_1_lodash_isNull___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_lodash_isNull__),__WEBPACK_IMPORTED_MODULE_2_app_utils_constants__=__webpack_require__("67vC"),__WEBPACK_IMPORTED_MODULE_3_utils_userPreferences__=__webpack_require__("h7V/"),Tree=Class.create({root:null,notPainted:!0,readyForConnections:!1,finishedInitialization:!1,revision:null,uncommitedId:-1e3,nodes:null,default_title:"",initialize:function(revision){this.revision=revision,this.nodes={}},autoLayout:function(force){if(force||!ServerConnection.isPending()){var chL=new ChangeList;chL.doAutoLayoutingChanges(),ServerConnection.doChanges(chL)}},autoCondense:function(){var chL=new ChangeList;chL.doAutoCondenseChanges(),ServerConnection.doChanges(chL)},changeLayout:function(layout){if(App.config.layout!==layout){if(null!==App.config.layout.orientation&&!layout.orientation&&canvas.root.children.length>1)if(App.config.layout.orientation===App.Layouts.orientation.left)for(var children=canvas.root.children.sort(function(a,b){return a.node.pos[1]-b.node.pos[1]}),i=parseInt(children.length/2),len=children.length;i<len;i++)children[i].node.pos[0]=50;else if(App.config.layout.orientation===App.Layouts.orientation.right)for(var children=canvas.root.children.sort(function(a,b){return a.node.pos[1]-b.node.pos[1]}),i=0,len=parseInt(children.length/2);i<len;i++)children[i].node.pos[0]=-50;else if(App.config.layout.orientation===App.Layouts.orientation.down)for(var children=canvas.root.children.sort(function(a,b){return a.node.pos[0]-b.node.pos[0]}),i=0,len=children.length;i<len;i++)children[i].node.pos[1]=children[i].node.pos[0];var chL=new ChangeList,change=new MapPropertiesChange({idea_id:this.root.id,type:"MapProperties",old_data:{layout:App.config.layout.id},new_data:{layout:layout.id}});chL.changes.push(change),layout===App.Layouts.Default?App.config.layout===App.Layouts.Aligned?(chL.doAutoAlignedChanges(),change.execute()):(canvas.root.destroy(),canvas.destroy(),canvas.buildFromModel(),removeClassName(canvas.el,"layout_"+App.config.layout.name),App.config.layout=App.Layouts.Aligned,addClassName(canvas.el,"layout_"+App.config.layout.name),canvas.root.paint(),chL.doAutoAlignedChanges(),change.execute()):(change.execute(),chL.doAutoAlignedChanges()),ServerConnection.doChanges(chL)}},postInit:function(){this.paint(),this.finishedInitialization=!0;var oldSize=canvas.size;canvas.checkBounds(),canvas.size===oldSize&&canvas.changeSize()},paint:function(){rectangleLayouter.updateAll(),this.readyForConnections=!0;for(var i=0,len=this.root._listener.children.length;i<len;i++)this.root._listener.children[i].rc.redrawConnections();rectangleLayouter.elasticLayoutingEnabled=!0},destroy:function(){this.root.destroy()},totalNodes:function(){var total=0;for(var id in this.nodes)this.nodes.hasOwnProperty(id)&&this.nodes[id]&&total++;return total},totalConnections:function(){var total=0;for(var id in this.nodes)this.nodes.hasOwnProperty(id)&&this.nodes[id]&&(total+=this.nodes[id].outgoing_connections.length);return total},getNodes:function(){return __WEBPACK_IMPORTED_MODULE_0_lodash_omitBy___default()(this.nodes,__WEBPACK_IMPORTED_MODULE_1_lodash_isNull___default.a)}});Tree.utils={removeNodes:function(nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){if(node.isRoot())Message.show(I18n.t("js.cant_delete_root_note"),Message.WARNING);else if(!node.getAncestors().find(function(n){return!n.isRoot()&&nodes.indexOf(n)>=0})){node.isFloating()&&changes.push(new IdeaPropertiesChange({idea_id:node.id,type:"IdeaProperties",new_data:{floating:!1},old_data:{floating:!0}})),node.eachChild(function(_node){_node.boundary&&changes.push(new RemoveBoundaryChange({idea_id:_node.id,type:"RemoveBoundary",old_data:_node.boundary.toJSON()})),_node.idea_video&&changes.push(new RemoveVideoChange({idea_id:_node.id,type:"RemoveVideo",old_data:_node.idea_video.toJSON()})),_node.comments.length>0&&_node.comments.each(function(comment){changes.push(new RemoveCommentChange({idea_id:_node.id,type:"RemoveComment",old_data:{idea_comment_id:comment.id}}))}),_node.votes.length>0&&_node.votes.each(function(vote){changes.push(new RemoveVoteChange({idea_id:_node.id,type:"RemoveVote",old_data:vote.toJSON()}))})});var change=new RemoveChange({idea_id:node.id,type:"Delete"});changes.push(change)}}),tree.notPainted=!0,changes.each(function(_change,index){index===changes.length-1&&(tree.notPainted=!1),_change.executeLocally()});var chL=new ChangeList;chL.changes=changes,ServerConnection.doChanges(chL)}},connect:function(nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var chL=new ChangeList;nodes.each(function(node){if(node.isRootC()&&node.isFloating()){var change=new IdeaPropertiesChange({idea_id:node.id,type:"IdeaProperties",new_data:{floating:!1},old_data:{floating:!0}});chL.changes.push(change),change.executeLocally()}}),ServerConnection.doChanges(chL)}},disconnect:function(nodes,positions){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){node.isRootC()||changes.push(new MoveChange({idea_id:node.id,type:"Move",old_data:{parent:node.parent.id,rank:node.parent.rank(node),pos:node.pos},new_data:{parent:tree.root.id,rank:0,pos:positions[node.id]}}));var floatingChange=Tree.utils.floatingNodeChange(node,!0);floatingChange&&changes.push(floatingChange)}),ChangeList.layoutAlteringChangeset(changes)}},sortTopicsBreadthFirst:function(nodes){if(nodes.length>1){var ordered=[];tree.root.doBreadthFirstTraversal(function(node){ordered.push(node)}),nodes.sort(function(a,b){return ordered.indexOf(a)-ordered.indexOf(b)})}},moveNodes:function(nodes,dst,rank,uid,pos){if(!ServerConnection.canQueueDoRequests())return ServerConnection.networkIssues(),!1;if(!App.config.editable||!App.config.currentlyEditable)return!1;var changes=[];this.sortTopicsBreadthFirst(nodes),nodes.each(function(node){if(!(node==dst||dst.getAncestors().indexOf(node)>=0))if(dst.isRoot()&&node.isRootC())pos&&changes.push(new RepositionChange({idea_id:node.id,type:"Reposition",old_data:{pos:node.pos},new_data:{pos:pos}}));else{var floatingChange=Tree.utils.floatingNodeChange(node,!1);floatingChange&&changes.push(floatingChange);var _rank=node.parent==dst&&node.parent.rank(node)<rank?rank-1:rank;_rank+=nodes.indexOf(node),(node.parent!==dst||node.parent===dst&&node.parent.rank(node)!==_rank)&&changes.push(new MoveChange({idea_id:node.id,type:"Move",old_data:{parent:node.parent.id,rank:node.parent.rank(node),pos:node.pos},new_data:{parent:dst.id,rank:_rank,pos:pos}}))}}),ChangeList.layoutAlteringChangeset(changes)},floatingNodeChange:function(node,floating){if(floating!==node.isFloating())return new IdeaPropertiesChange({idea_id:node.id,type:"IdeaProperties",new_data:{floating:floating}})},copyNodes:function(nodes,dsts){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];Object.isArray(dsts)||(dsts=[dsts]),this.sortTopicsBreadthFirst(nodes),dsts.each(function(dst){nodes.each(function(node){node.eachChild(function(_node,id){var newId=--tree.uncommitedId;changes.push(new InsertChange({idea_id:newId,type:"Insert",new_data:{id:newId,parent:id,title:_node.title,closed:_node.closed,style:_node.style,icon:_node.icons.map(function(icon){return icon.fullName()}).join(","),note:_node.note,link:_node.link,task:_node.task}})),_node.idea_image&&changes.push(new AddImageChange({idea_id:newId,type:"AddImage",new_data:{idea_image_id:_node.idea_image.id},old_data:{idea_image_id:null}})),_node.idea_video&&changes.push(new AddVideoChange({idea_id:newId,type:"AddVideo",new_data:_node.idea_video.toJSON()}));for(var i=0,len=_node.attachments.length;i<len;i++){var attachment=_node.attachments[i];changes.push(new AddAttachmentChange({idea_id:newId,type:"AddAttachment",new_data:{attachment_id:attachment.id}}))}return _node.isFloating()&&dst.isRoot()&&changes.push(new IdeaPropertiesChange({idea_id:newId,type:"IdeaProperties",new_data:{floating:!0}})),_node.boundary&&changes.push(new AddBoundaryChange({idea_id:newId,type:"AddBoundary",new_data:_node.boundary.toJSON()})),newId},dst.id)})}),ChangeList.layoutAlteringChangeset(changes)}},addChildrenAsTree:function(nodes){var changes=[];nodes.each(function(node){var escapedTitle=node.title.escapeHTML();node.id>0?changes.push(new RenameChange({idea_id:node.id,type:"Title",new_data:{title:escapedTitle}})):changes.push(new InsertChange({idea_id:node.id,type:"Insert",new_data:{id:node.id,parent:node.parent,title:escapedTitle,style:null}}))}),ChangeList.layoutAlteringChangeset(changes)},copyNodesExternal:function(dst,changeData){if(App.config.editable&&App.config.currentlyEditable){changeData[0].new_data.parent=dst.id,dst.isRoot()&&(changeData[0].new_data.pos=null);for(var changes=[],i=0,len=changeData.length;i<len;i++){var change=changeData[i];if("AddConnection"!==change.type){change.new_data.rank&&(change.new_data.rank=null);for(var newId=--tree.uncommitedId,j=0,length=changeData.length;j<length;j++){var otherChange=changeData[j];otherChange.new_data.parent===change.new_data.id&&(otherChange.new_data.parent=newId),otherChange.idea_id===change.new_data.id&&(otherChange.idea_id=newId)}changes=changes.concat(InsertChange.toChangeArray(change,newId))}}ChangeList.layoutAlteringChangeset(changes)}},setIconChange:function(newIcons,node){var oldIcon=node.icons.map(function(icon){return icon.fullName()}).join(","),icons=node.icons;newIcons.each(function(icon){var previousIcon=null;icon.group()&&(previousIcon=icons.detect(function(_icon){return _icon.group()===icon.group()})),previousIcon?icons[icons.indexOf(previousIcon)]=icon:icons.push(icon)}),icons=Icon.compactAndOrder(icons);for(var newIcon=icons.map(function(icon){return icon.fullName()}).join(",");newIcon.length>255;){var extraIcon=icons.detect(function(icon){return newIcons.indexOf(icon)<0});if(!extraIcon)return null;icons=icons.without(extraIcon),newIcon=icons.map(function(icon){return icon.fullName()}).join(",")}return newIcon!=oldIcon?new IconChange({idea_id:node.id,type:"Icon",old_data:{icon:oldIcon},new_data:{icon:newIcon}}):null},setIcon:function(icon,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){var change=this.setIconChange([icon],node);change&&changes.push(change)}.bind(this)),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},removeIconChange:function(icons,node){var oldIcon=node.icons.map(function(icon){return icon.fullName()}).join(","),newIcons=node.icons;icons.each(function(icon){newIcons=newIcons.without(icon)});var newIcon=newIcons.map(function(icon){return icon.fullName()}).join(",");return newIcon!=oldIcon?new IconChange({idea_id:node.id,type:"Icon",old_data:{icon:oldIcon},new_data:{icon:newIcon}}):null},removeIcon:function(icon,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){var change=null;if(void 0===icon){var ic=node.icons.last();ic&&(change=this.removeIconChange([ic],node))}else change=this.removeIconChange([icon],node);change&&changes.push(change)}.bind(this)),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},removeIconGroup:function(iconGroup,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){var icon=node.icons.detect(function(icon){return icon.group()===iconGroup});icon&&changes.push(this.removeIconChange([icon],node))}.bind(this)),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},setStyle:function(key,value,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[],style=canvas.selected.node.currentStyle();if("toggle"===value)value=!style[key];else if("fontSize"===key&&[-1,1].indexOf(value)>=0){var fontSize=style.fontSize,sizes=[100,120,150],index=sizes.indexOf(fontSize)+value;index<0&&(index=0),index>=sizes.length&&(index=sizes.length-1),value=sizes[index]}nodes.each(function(node){var style=node.currentStyle();style[key]=value,changes.push(new TextStyleChange({idea_id:node.id,type:"TextStyle",new_data:{style:style.toJSON()},old_data:{style:node.style?node.style.toJSON():null}}))}),ChangeList.layoutAlteringChangeset(changes)}},setFullStyle:function(style,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){!style||style.equals(node.defaultStyle())?node.style&&changes.push(new TextStyleChange({idea_id:node.id,type:"TextStyle",new_data:{style:null},old_data:{style:node.style.toJSON()}})):node.style&&node.style.equals(style)||changes.push(new TextStyleChange({idea_id:node.id,type:"TextStyle",new_data:{style:style.toJSON()},old_data:{style:node.style?node.style.toJSON():null}}))}),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},setProperty:function(key,value,nodes){var _this=this;if(App.config.editable&&App.config.currentlyEditable){if("note"===key&&value.length>65e3)return Message.show(I18n.t("js.note_is_too_long"),Message.ERROR,5);if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();var changes=[];nodes.each(function(node){changes.push(_this.setPropertyChange(key,value,node))}),ChangeList.layoutAlteringChangeset(changes),"link"===key&&0===value.indexOf("topic:")&&this.setLinkedMapPreview(nodes,value)}},setPropertyChange:function(key,value,node){var data={idea_id:node.id,type:key.capitalize(),old_data:_defineProperty({},key,node[key]),new_data:_defineProperty({},key,value)};return new window[data.type+"Change"](data)},setLinkedMapPreview:function(nodes,link){__WEBPACK_IMPORTED_MODULE_3_utils_userPreferences__.a.get("topic_link_preview",function(preference){if(preference&&1===parseInt(preference.value)){var changes=[];nodes.each(function(node){var id=node.id,idea_image=node.idea_image,idea_video=node.idea_video,topicId=link.replace(/[^\d]/g,"");idea_video||idea_image&&!idea_image.isLinkedMapPreview()||tree.root.getChild(topicId)?idea_image&&idea_image.isLinkedMapPreview()&&changes.push(new RemoveImageChange({idea_id:id,type:"RemoveImage",old_data:{idea_image_id:idea_image.id}})):changes.push(new AddImageChange({idea_id:id,type:"AddImage",new_data:{idea_image_id:-1,topic_id:topicId},old_data:{idea_image_id:idea_image?idea_image.id:null}}))}),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}})},setTask:function(tasksArray){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){App.trigger(CustomEvents.TASK_ADDED);var chL=new ChangeList;tasksArray.each(function(taskObject){var node=taskObject.node,task=taskObject.task,icons=[],removeIcons=[];if(task&&void 0!==task.complete&&task.complete>-1)icons.push(Icon.fromFullName(__WEBPACK_IMPORTED_MODULE_2_app_utils_constants__.TASK.complete[task.complete]));else{var icon=node.icons.detect(function(icon){return"task"===icon.group()});icon&&removeIcons.push(icon)}if(task&&void 0!==task.priority&&task.priority>-1)icons.push(Icon.fromFullName(__WEBPACK_IMPORTED_MODULE_2_app_utils_constants__.TASK.priority[task.priority]));else{var icon=node.icons.detect(function(icon){return"priority"===icon.group()});icon&&removeIcons.push(icon)}if(icons.length>0){var change=this.setIconChange(icons,node);change&&chL.changes.push(change)}if(removeIcons.length>0){var change=this.removeIconChange(removeIcons,node);change&&chL.changes.push(change)}if(node.task!=task){var data={idea_id:node.id,type:"Task",old_data:{},new_data:{}};data.old_data.task=node.task,data.new_data.task=task;var change=new TaskChange(data);chL.changes.push(change)}}.bind(this)),chL.changes.size()>0&&(chL.execute(),ServerConnection.doChanges(chL))}},removeTask:function(nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var chL=new ChangeList,mtChanges=[];nodes.each(function(node){var oldIcons=[],oldTaskIcon=node.icons.detect(function(icon){return"task"===icon.group()});oldTaskIcon&&oldIcons.push(oldTaskIcon);var oldPriorityIcon=node.icons.detect(function(icon){return"priority"===icon.group()});if(oldPriorityIcon&&oldIcons.push(oldPriorityIcon),oldIcons.length>0){var change=this.removeIconChange(oldIcons,node);change&&chL.changes.push(change)}if(node.task&&(node.task.from||node.task.due||node.task.effort||node.task.resource)){var data={idea_id:node.id,type:"Task",old_data:{},new_data:{}};data.old_data.task=node.task,data.new_data.task=null;var change=new TaskChange(data);chL.changes.push(change),node.task.from=null,node.task.due=null,node.task.resource=null,node.task.effort=null}node.externalTask&&mtChanges.push(node)}.bind(this)),chL.changes.length>0&&(chL.execute(),ServerConnection.doChanges(chL))}},getTextOutline:function(start_node,indent){var text="",start_depth=start_node.depth();return start_node.eachChild(function(node){if(indent)for(var i=0;i<node.depth()-start_depth;i++)text+="\t";text+=node.title.replace(/\n/g," ").replace(/\r/g," ")+"\n"}),text},setImage:function(image,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){tree.root.getChild(node.id)&&(changes.push(new AddImageChange({idea_id:node.id,type:"AddImage",new_data:{idea_image_id:image.id,details:{url:image.download_link,size:[image.width(),image.height()]}},old_data:{idea_image_id:node.idea_image?node.idea_image.id:null}})),node.idea_video&&changes.push(new RemoveVideoChange({idea_id:node.id,type:"RemoveVideo",old_data:node.idea_video.toJSON()})))}),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},removeImage:function(nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){tree.root.getChild(node.id)&&node.idea_image&&changes.push(new RemoveImageChange({idea_id:node.id,type:"RemoveImage",old_data:{idea_image_id:node.idea_image.id}}))}),changes.length>0?ChangeList.layoutAlteringChangeset(changes):Message.show(I18n.t("js.node_has_no_image"),Message.NOTICE)}},setVideo:function(video,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){node.idea_video&&video?changes.push(new EditVideoChange({idea_id:node.id,type:"EditVideo",new_data:video.toJSON(),old_data:node.idea_video.toJSON()})):node.idea_video&&!video?changes.push(new RemoveVideoChange({idea_id:node.id,type:"RemoveVideo",old_data:node.idea_video.toJSON()})):video&&(node.idea_image&&changes.push(new RemoveImageChange({idea_id:node.id,type:"RemoveImage",old_data:{idea_image_id:node.idea_image.id}})),changes.push(new AddVideoChange({idea_id:node.id,type:"AddVideo",new_data:video.toJSON()})))}),0!==changes.length&&ChangeList.layoutAlteringChangeset(changes)}},setVote:function(vote,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var selectedVote=IdeaVote.get(canvas.selected.node,users.selfUser.id),removeVotes=selectedVote&&selectedVote.vote===vote,changes=[];nodes.each(function(node){var existingVote=IdeaVote.get(node,users.selfUser.id),_vote=new IdeaVote({idea_id:node.id,vote:vote,user_id:users.selfUser.id,voted_at:new Date});(node===canvas.selected.node||node!==canvas.selected.node&&(existingVote&&existingVote.vote!==vote||!existingVote||removeVotes))&&(existingVote?vote===existingVote.vote||removeVotes?changes.push(new RemoveVoteChange({idea_id:node.id,type:"RemoveVote",old_data:_vote.toJSON()})):changes.push(new EditVoteChange({idea_id:node.id,type:"EditVote",new_data:_vote.toJSON()})):changes.push(new AddVoteChange({idea_id:node.id,type:"AddVote",new_data:_vote.toJSON()})))}),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}},setBoundary:function(boundary,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){node.boundary&&boundary?node.boundary.style.equals(boundary)||changes.push(new EditBoundaryChange({idea_id:node.id,type:"EditBoundary",new_data:boundary.toJSON(),old_data:node.boundary.toJSON()})):node.boundary&&!boundary?changes.push(new RemoveBoundaryChange({idea_id:node.id,type:"RemoveBoundary",old_data:node.boundary.toJSON()})):boundary&&changes.push(new AddBoundaryChange({idea_id:node.id,type:"AddBoundary",new_data:boundary.toJSON()}))}),0!==changes.length&&ChangeList.layoutAlteringChangeset(changes)}},addAttachments:function(attachments,nodes){if(!ServerConnection.canQueueDoRequests())return void ServerConnection.networkIssues();if(App.config.editable&&App.config.currentlyEditable){var changes=[];nodes.each(function(node){tree.root.getChild(node.id)&&attachments.each(function(attachment){changes.push(new AddAttachmentChange({idea_id:node.id,type:"AddAttachment",new_data:{attachment_id:attachment.id}}))})}),changes.length>0&&ChangeList.layoutAlteringChangeset(changes)}}},__webpack_exports__.default=Tree},gp2O:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__views_vrootChild__=__webpack_require__("rX76"),__WEBPACK_IMPORTED_MODULE_1__views_vconnection__=__webpack_require__("xAzy"),__WEBPACK_IMPORTED_MODULE_2__views_graphics__=__webpack_require__("t8zp"),__WEBPACK_IMPORTED_MODULE_3__views_vnode__=__webpack_require__("NCMo"),__WEBPACK_IMPORTED_MODULE_4__mapView__=__webpack_require__("Rq/x"),__WEBPACK_IMPORTED_MODULE_5__copyPaste__=__webpack_require__("d407"),__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__=__webpack_require__("/dW8"),__WEBPACK_IMPORTED_MODULE_7_ui_fullscreen__=__webpack_require__("wgYI"),__WEBPACK_IMPORTED_MODULE_8_app_models_attachment__=__webpack_require__("j1ii"),__WEBPACK_IMPORTED_MODULE_9__contextMenu__=__webpack_require__("1M8a"),__WEBPACK_IMPORTED_MODULE_10_app_ui_header__=__webpack_require__("WGdr"),__WEBPACK_IMPORTED_MODULE_11_app_ui_sidebar__=__webpack_require__("qmQO"),__WEBPACK_IMPORTED_MODULE_12_app_models_poller__=__webpack_require__("ahzF"),__WEBPACK_IMPORTED_MODULE_13_app_ui_menu__=__webpack_require__("qlDW"),__WEBPACK_IMPORTED_MODULE_14_app_ui_filter__=__webpack_require__("QHRq"),__WEBPACK_IMPORTED_MODULE_15_app_ui_wheelScroll__=__webpack_require__("vQBY"),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},onContextMenu=function(){return __WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.disable()},onCloseContextMenu=function(){return __WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.enable()},Canvas=Class.create(__WEBPACK_IMPORTED_MODULE_4__mapView__.default,{selected:null,allSelected:[],containerSize:null,_marked:null,_index:null,_ghost:null,_scrolling:null,_scrolled:null,features:["graphics","selection","style","icons","images","attachments","connections","presentation"],initialize:function($super){MM.ui.initPageSize(),Position.includeScrollOffsets=!0,this.size=[1e4,6e3],this.el=$("canvas"),this.container=this.el.up(),this.clearSelection(),this.initSize(),this.enableCssZoom(),this.el.style.left=Math.max(0,(MM.ui.page.width-this.width-(App.config.hasUI?300:0))/2)+"px",this.el.style.top=Math.max(0,(MM.ui.page.height-this.height)/2)+"px",this.el.style.position="relative",this.containerSize=[this.container.offsetWidth,this.container.offsetHeight],App.ui.Zoom.initialized||App.ui.Zoom.init(this.el,this.container),"phantomjs"!==App.config.environment&&(this._onMD=this._onScrollMouseDown.bindAsEventListener(this),this._onMM=this._onScrollMouseMove.bindAsEventListener(this),this._onMU=this._onScrollMouseUp.bindAsEventListener(this),__WEBPACK_IMPORTED_MODULE_15_app_ui_wheelScroll__.default.init({container:this.el,onScroll:this.onWheelScroll.bind(this),onZoom:App.ui.Zoom.onWheel.bind(App.ui.Zoom)}),__WEBPACK_IMPORTED_MODULE_15_app_ui_wheelScroll__.default.enable(),MM.utils.File.Droppables.add(this.el,{hoverclass:"drop_label",getElement:function(element){var node=__WEBPACK_IMPORTED_MODULE_8_app_models_attachment__.default.dropWidget.getNode(element);return node?node._listener.dcontent.el:null},dropEffect:"copy",onDrop:this.onFileDrop.bind(this)})),this.initConnections(),this.el.innerHTML='<div id="graphics_container"></div>',__WEBPACK_IMPORTED_MODULE_2__views_graphics__.Graphics.initialize(this.width,this.height),"phantomjs"!==App.config.environment&&(this.createGhost(),this.createMTGhost(),Event.observe(this.container,"scroll",function(){GeneralPopover.getLastOpened()&&GeneralPopover.getLastOpened().sizeAndPosition()}),this.onStartSelectionRectangleListener=this.onStartSelectionRectangle.bind(this),this.onDragSelectionRectangleListener=this.onDragSelectionRectangle.bind(this),this.onEndDragSelectionsListener=this.onEndDragSelectionRectangle.bind(this),this.setupSelections(),__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.init()),UI.Registry.add(this),UI.Registry.notify(this,"show"),$super()},postLoad:function(){if(App.tree.postInit(),App.config.editable&&sideBar.toEditMode(),App.config.editable?App.toEditMode():App.toViewMode(),ChangeList.autoLayoutChangeset(),App.config.targetId){var node=tree.root.getChild(App.config.targetId);node.toggleAllClosed()}if("embedded"===App.config.viewMode){var zoomParam=window.location.search.toQueryParams().z;zoomParam&&"auto"===zoomParam||!zoomParam?App.ui.Zoom.zoomToFit():1!==App.config.zoomFactor&&App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(App.config.zoomFactor),!1,!1),this.onRecenter()}else if(1!==App.config.zoomFactor&&App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(App.config.zoomFactor),!1),App.config.targetId){var node=tree.root.getChild(App.config.targetId);node.toggleAllClosed(!0),this.centerOnElement($(App.config.targetId.toString()))}else this.onRecenter();if(App.config.isNew&&App.config.editable&&canvas.root.dcontent.toEditing(null,"rename"),MM.status.params.query&&mm$("fld_filter")&&(mm$("fld_filter").value=MM.status.params.query,App.ui.Filter.updateText(MM.status.params.query),App.ui.Filter.doFilter()),MM.status.params.dlg)switch(MM.status.params.dlg){case"clone":MM.ui.dialogs.dialogClone()}Event.observe(window,"unload",App.destroy.bindAsEventListener(App)),__WEBPACK_IMPORTED_MODULE_12_app_models_poller__.default.initialize(App.config.websockets),App.driveInterval=null,App.googleDrive()&&(App.driveInterval=setInterval(App.driveSave.bind(App),1e4)),App.trigger(CustomEvents.POST_LOAD)},initUI:function(){App.config.hasUI&&(["public","embedded"].include(App.config.viewMode)?(App.ui.Teaser&&App.ui.Teaser.init(),App.ui.Footer.init()):(__WEBPACK_IMPORTED_MODULE_10_app_ui_header__.default.init(),App.ui.Footer.init(),App.config.editable&&(__WEBPACK_IMPORTED_MODULE_13_app_ui_menu__.default.init(),sideBar=new __WEBPACK_IMPORTED_MODULE_11_app_ui_sidebar__.default),this.enableMobileFullScreen()));for(var icons=document.querySelectorAll(".icon-svg"),i=0;i<icons.length;i++)MM.ui.svgIcons(icons[i]);"phantomjs"!==App.config.environment&&KR.listenTo("icon-svg",MM.ui.svgIcons),App.ui.Options.init({zoomIn:this.onZoomIn.bind(this),zoomOut:this.onZoomOut.bind(this)})},enableMobileFullScreen:function(){MM.ua.isMobile&&(canvas._mobileFullScreen=!0,Event.observe(canvas.el,"click",this.toggleMobileFullScreen))},disableMobileFullScreen:function(){MM.ua.isMobile&&(canvas._mobileFullScreen=null,Event.stopObserving(canvas.el,"click",this.toggleMobileFullScreen))},toggleMobileFullScreen:function(event){var el=Event.element(event);("svg"==el.tagName.toLowerCase()||hasClassName(el,"tk_container")||el==canvas.el)&&__WEBPACK_IMPORTED_MODULE_7_ui_fullscreen__.a.toggle({skipBrowserUI:1})},enableCssZoom:function(){Element.originalCumulativeScrollOffset||(Element.originalCumulativeScrollOffset=Element.cumulativeScrollOffset),Element.cumulativeScrollOffset=function(element){return element.ancestors().include(canvas.container)||element==canvas.container?[canvas.getScrollLeft(),canvas.getScrollTop()]:Element.originalCumulativeScrollOffset(element)},Event.originalPointerX||(Event.originalPointerX=Event.pointerX),Event.pointerX=function(event){var element=event.element(),pointX=Event.originalPointerX(event);return Element.ancestors(element).include(canvas.container)?App.ui.Zoom.transformCssZoomValue(pointX,!1):pointX},Event.originalPointerY||(Event.originalPointerY=Event.pointerY),Event.pointerY=function(event){var element=event.element(),pointY=Event.originalPointerY(event);return Element.ancestors(element).include(canvas.container)?App.ui.Zoom.transformCssZoomValue(pointY,!1):pointY}},disableCssZoom:function(){Element.originalCumulativeScrollOffset&&(Element.cumulativeScrollOffset=Element.originalCumulativeScrollOffset),Event.originalPointerX&&(Event.pointerX=Event.originalPointerX),Event.originalPointerY&&(Event.pointerY=Event.originalPointerY)},createGhost:function(){this._ghost=document.createElement("div"),this._ghost.id="tk_ghost",this._ghost.style.display="none",this.el.appendChild(this._ghost)},createMTGhost:function(){this._mtGhost=new Element("div",{id:"mt_ghost",style:"display: none;"}),this.container.parentNode.appendChild(this._mtGhost)},enableFileDrop:function(){var drop=MM.utils.File.Droppables.get(this.el.id);drop&&MM.utils.File.Droppables.enable(drop)},disableFileDrop:function(){var drop=MM.utils.File.Droppables.get(this.el.id);drop&&MM.utils.File.Droppables.disable(drop)},onFileDrop:function(element,data){var error,node=__WEBPACK_IMPORTED_MODULE_8_app_models_attachment__.default.dropWidget.getNode(element);node._listener.setLoadingOnDrop(),1===data.images.length&&data.images[0].type&&App.config.fileTypes.image.include(data.images[0].type)&&0===data.files.length?error=MM.utils.File.uploadImageFile([node],data.images[0],{successCallback:function(file,targets){Tree.utils.setImage(new IdeaImage(file),targets)}}):data.images.length>0||data.files.length>0?sideBar.attachments.upload(data.images.concat(data.files),!1,node)||node._listener.removeLoadingFromDrop():data.imageLinks.length>0?__WEBPACK_IMPORTED_MODULE_8_app_models_attachment__.default.dropWidget.uploadImageUrl(node,data.imageLinks[0]):data.links.length>0?__WEBPACK_IMPORTED_MODULE_8_app_models_attachment__.default.dropWidget.uploadLink(node,data.links[0]):error={error:I18n.t("js.unsupported_file_type")},error&&error.error&&(node._listener.removeLoadingFromDrop(),Message.show(error.error,Message.ERROR))},_onDblClick:function(event){var element=Event.element(event);if(element&&"text"!=element.type&&!hasClassName(element,"tk_title")&&!hasClassName(element,"tk_image")&&(!element.up||!element.up(".note_content"))){var point=this._getCursorPosition(event);this.root.node&&this.root.node.addChild([point.x-canvas.root.pcenter[0],point.y-canvas.root.pcenter[1]])}},__onSetMapProperties:function(properties){removeClassName(canvas.el,"layout_"+App.config.layout.name);var newLayout=App.Layouts.get(properties.layout);App.config.layout=newLayout,addClassName(canvas.el,"layout_"+App.config.layout.name),App.reloadViewSynchronously()},prepareExport:function(){if(App.config.editable&&App.config.persistent&&App.config.layout.elasticLayout){var chL=new ChangeList;chL.doAutoAlignedChanges("NonPersistentReposition"),ServerConnection.doChanges(chL)}},getCenter:function(){return[parseInt(this.size[0]/2),parseInt(this.size[1]/2)]},getScrollCenter:function(el,pos){return pos||(Position.prepare(),pos=el.cumulativeOffset()),[this._centerHorizontalPosition(el,pos[0]),this._centerVerticalPosition(el,pos[1])]},getScrollLeft:function(){return App.ui.Zoom.transformCssZoomCoordinate(this.container.scrollLeft,"x",!1)},getScrollTop:function(){return App.ui.Zoom.transformCssZoomCoordinate(this.container.scrollTop,"y",!1)},setScrollLeft:function(realPos){this.container.scrollLeft=App.ui.Zoom.transformCssZoomCoordinate(realPos,"x",!0)},setScrollTop:function(realPos){this.container.scrollTop=App.ui.Zoom.transformCssZoomCoordinate(realPos,"y",!0)},getContainerSize:function(){return{width:App.ui.Zoom.transformCssZoomValue(this.container.offsetWidth,!1),height:App.ui.Zoom.transformCssZoomValue(this.container.offsetHeight,!1)}},getElementOffset:function(element){var valueT=0,valueL=0;do{valueT+=element.offsetTop||0,valueL+=element.offsetLeft||0,element=element.offsetParent}while(element&&element!==canvas.el);return[valueL,valueT]},getNodesFromRectangle:function(rectangle){var nodes=[],_rectangle=canvas.root.dcontent.el.toRectangle();return rectangle.overlaps(_rectangle)&&nodes.push(canvas.root.node),canvas.root.children.map(function(child){return child.dcontainer}).findAll(function(container){var _rectangle=container.el.toRectangle();return rectangle.overlaps(_rectangle)}).each(function(container){descendants(container.el,function(element){return hasClassName(element,"tk_label")}).each(function(label){var _rectangle=label.toRectangle();rectangle.overlaps(_rectangle)&&nodes.push(tree.root.getChild(parseInt(label.id)))})}),nodes},getRectangleFromNodes:function(nodes){if(0===nodes.length)return null;var rectangles=nodes.map(function(node){return node._listener.dcontent.el.toRectangle()});return rectangles.inject(rectangles[0],function(currentRectangle,rectangle){return Rectangle.max(currentRectangle,rectangle)})},scrollTo:function(point,smooth,options){point[0]=point[0]||this.getScrollLeft(),point[1]=point[1]||this.getScrollTop(),smooth?(point[0]=App.ui.Zoom.transformCssZoomCoordinate(point[0],"x",!0),point[1]=App.ui.Zoom.transformCssZoomCoordinate(point[1],"y",!0),options=Object.extend({x:point[0],y:point[1],duration:Math.abs(point[0]-this.getScrollLeft())>200||Math.abs(point[1]-this.getScrollTop())>200?.5:.2},options||{}),new Effect.Scroll(this.container,options)):(this.setScrollLeft(point[0]),this.setScrollTop(point[1]))},scrollToElement:function(el,pos,smooth,fitsInViewport){pos=pos||el.cumulativeOffset(),null===smooth&&(smooth=!0);var x,y,scrollTop=this.getScrollTop(),scrollLeft=this.getScrollLeft(),oTop=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.top),oRight=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.right),oBottom=App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.bottom),oLeft=App.ui.Zoom.transformCssZoomValue(15),dim=el.getDimensions(),containerSize=this.getContainerSize();fitsInViewport&&(dim.height>containerSize.height-oTop-oBottom||dim.width>containerSize.width-oLeft-oRight)||(scrollLeft+oLeft>pos[0]?x=pos[0]-oLeft:scrollLeft+containerSize.width-oRight<pos[0]+dim.width&&(x=pos[0]-containerSize.width+dim.width+oRight+10),scrollTop+oTop>pos[1]?y=pos[1]-oTop-10:scrollTop+containerSize.height-oBottom<pos[1]+dim.height&&(y=pos[1]-containerSize.height+dim.height+oBottom+10),(x||y)&&this.scrollTo([x,y],smooth))},scrollToNode:function(vnode,smooth){if(vnode&&!vnode.isVisible()){var pos=this.getNodeCanvasOffset(vnode);!pos||0===pos[0]&&0===pos[1]||this.scrollToElement(vnode.dcontent.el,pos,smooth)}},liveUpdateHighlight:function(node){App.config.liveUpdate&&!ServerData.isLoggedIn&&tree.finishedInitialization&&["embedded","embedded_full","public"].include(App.config.viewMode)&&(canvas.scrollToNode(node._listener,!0),node._listener.highlight("#ffb347"))},_centerVerticalPosition:function(el,y){var containerSize=this.getContainerSize(),viewportOffset=UI.Registry.viewportOffset;return y+=el.offsetHeight/2,y-=(containerSize.height+App.ui.Zoom.transformCssZoomValue(viewportOffset.top-viewportOffset.bottom))/2},_centerHorizontalPosition:function(el,x){var containerSize=this.getContainerSize(),viewportOffset=UI.Registry.viewportOffset;return x+=el.offsetWidth/2,x-=(containerSize.width-App.ui.Zoom.transformCssZoomValue(viewportOffset.right))/2},centerOnElement:function(el,options){var pos=this.getScrollCenter(el);this.scrollTo(pos,!1,options)},enableScrollByDrag:function(){MM.ua.observeTouchSafe(this.el,"mousedown",this._onMD)},disableScrollByDrag:function(){MM.ua.stopObservingTouchSafe(this.el,"mousedown",this._onMD),MM.ua.stopObservingTouchSafe(document,"mousemove",this._onMM),MM.ua.stopObservingTouchSafe(document,"mouseup",this._onMU)},_onScrollMouseDown:function(event){var source=event.element();("svg"==source.tagName||Element.up(source,".popover")||Element.up(source,"#msg_popup")||Element.up(source,".tk_label.root"))&&"svg"!=source.tagName||(MM.ua.observeTouchSafe(document,"mousemove",this._onMM),MM.ua.observeTouchSafe(document,"mouseup",this._onMU),this._scrolling=!0,this._originalPosition=[event.clientX,event.clientY],this._scrollingData={velocity:[0,0],delta:[0,0],target:[0,0],amplitude:[0,0],timestamp:Date.now()},App.config.inertia_scroll&&(this._scrollingData.offset=[this.getScrollLeft(),this.getScrollTop()],clearInterval(this._scrollingData.ticker),this._scrollingData.ticker=setInterval(this._onScrollTrack.bind(this),100)))},_onScrollMouseMove:function(event){if(this._scrolled=!0,this._scrolling){event.preventDefault();var newPosition=Event.getTouchsafeCoordinates(event);this._scrollingData.delta=[App.ui.Zoom.transformCssZoomValue(this._originalPosition[0]-newPosition[0]),App.ui.Zoom.transformCssZoomValue(this._originalPosition[1]-newPosition[1])],this._scrollingData.offset=[this.getScrollLeft()+this._scrollingData.delta[0],this.getScrollTop()+this._scrollingData.delta[1]],this.scrollTo(this._scrollingData.offset),this._originalPosition=newPosition}},_onScrollMouseUp:function(event){if(this._scrolled=this._scrolling=!1,App.config.inertia_scroll){var d=this._scrollingData;clearInterval(d.ticker),[0,1].each(function(c){(d.velocity[c]>10||d.velocity[c]<-10)&&(d.amplitude[c]=.9*d.velocity[c],d.target[c]=Math.round(d.offset[c]+d.amplitude[c])),d.timestamp=Date.now()}.bind(this)),requestAnimationFrame(this._autoScroll.bind(this))}document.stopObserving(MM.ua.getEvent().mousemove,this._onMM),document.stopObserving(MM.ua.getEvent().mouseup,this._onMU)},_onScrollTrack:function(){var now=Date.now(),elapsed=now-this._scrollingData.timestamp;this._scrollingData.timestamp=now,[0,1].each(function(c){this._scrollingData.velocity[c]=1e3*this._scrollingData.delta[c]/(1+elapsed)*.8+.2*this._scrollingData.velocity[c]}.bind(this))},_autoScroll:function(){var exponent,delta=[],d=this._scrollingData;0==d.amplitude[0]&&0==d.amplitude[1]||(exponent=Math.exp(-(Date.now()-d.timestamp)/325),delta[0]=-d.amplitude[0]*exponent,delta[1]=-d.amplitude[1]*exponent,delta[0]>.5||delta[0]<-.5||delta[1]>.5||delta[1]<-.5?(this.scrollTo([d.target[0]+delta[0],d.target[1]+delta[1]]),requestAnimationFrame(this._autoScroll.bind(this))):this.scrollTo(d.target))},toEditMode:function($super){$super(),removeClassName(this.el,"viewonly"),this._onDC=this._onDblClick.bindAsEventListener(this),Element.observe(this.el,"dblclick",this._onDC)},toViewMode:function($super){$super(),addClassName(this.el,"viewonly"),this._onDC&&Element.stopObserving(this.el,"dblclick",this._onDC)},initEditMode:function($super){$super(),__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__.default.all.each(function(c){c.view.toEditMode()});var K=MM.utils.KeyEvent;this._navigationKeyMap.addBinding([{key:[K.TAB,K.INSERT],notCtrl:!0,fn:this.onAdd.bind(this)},{key:K.ENTER,notShift:!0,notCtrl:!0,fn:this.onAddSibling.bind(this)},{key:K.ENTER,shift:!0,fn:this.onAddSibling.bind(this,!0)},{key:K.ENTER,ctrl:!0,fn:this.onEdit},{key:K.F2,notCtrl:!0,fn:this.onEdit},{key:[K.DELETE,K.BACKSPACE],fn:this.onRemove.bind(this)},{key:"c",alt:!0,fn:this.onAddConnection.bind(this)},{key:[K.F1,K.QUESTION_MARK],fn:MM.ui.dialogs.dialogHelp},{key:[K.F6,K.HOME,K.END],notCtrl:!0,fn:this.onRecenter.bindAsEventListener(this,!0)},{key:K.LEFT,fn:this.onSelectLeft.bindAsEventListener(this),withEvent:!0},{key:K.RIGHT,fn:this.onSelectRight.bindAsEventListener(this),withEvent:!0},{key:K.UP,notCtrl:!0,notAlt:!0,fn:this.onSelectUp.bindAsEventListener(this),withEvent:!0},{key:K.DOWN,notCtrl:!0,notAlt:!0,fn:this.onSelectDown.bindAsEventListener(this),withEvent:!0},{key:K.UP,ctrl:!0,notShift:!0,fn:this.onMoveUpDown.bind(this,!1)},{key:K.DOWN,ctrl:!0,notShift:!0,fn:this.onMoveUpDown.bind(this,!0)},{key:K.UP,shift:!0,alt:!0,fn:this.onSetStyle.bind(this,"fontSize",1)},{key:K.DOWN,shift:!0,alt:!0,fn:this.onSetStyle.bind(this,"fontSize",-1)},{key:"a",ctrl:!0,fn:this.onSelectAll.bindAsEventListener(this),withEvent:!0},{key:K.F8,fn:function(){tree.autoCondense()}},{key:K.F8,shift:!0,fn:this.onBeautifyMap.bind(this)},{key:K.SPACE,notShift:!0,fn:this.onToggleClosed.bind(this)},{key:"v",ctrl:!0,shift:!0,fn:__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.onPasteStyle.bind(__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default)},{key:"z",ctrl:!0,fn:this.onUndo.bind(this)},{key:"y",ctrl:!0,fn:this.onRedo.bind(this)},{key:"f",ctrl:!0,fn:this.onFind.bind(this)},{key:"f",ctrl:!0,alt:!0,fn:this.onToggleFullscreen.bind(this)},{key:"o",fn:function(){App.mapsPopover&&App.mapsPopover.show()}},{key:"m",withEvent:!0,fn:function(event){__WEBPACK_IMPORTED_MODULE_13_app_ui_menu__.default.initialized&&canvas.selected&&__WEBPACK_IMPORTED_MODULE_13_app_ui_menu__.default.show(event,{opener:canvas.selected.dcontent.el})}},{key:"b",ctrl:!0,fn:this.onSetStyle.bind(this,"bold","toggle")},{key:"i",ctrl:!0,fn:this.onSetStyle.bind(this,"italic","toggle")},{key:"p",shift:!0,alt:!0,fn:this.onToggleSidebar.bind(this)},{key:"n",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"notes")},{key:229,shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"notes")},{key:"l",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"links")},{key:"t",shift:!0,alt:!0,fn:this.onShowDialog.bind(this,"tasks")},{key:"0",alt:!0,fn:this.onShowDetail.bind(this,99)},{key:"1",alt:!0,fn:this.onShowDetail.bind(this,1)},{key:"2",alt:!0,fn:this.onShowDetail.bind(this,2)},{key:"3",alt:!0,fn:this.onShowDetail.bind(this,3)},{key:"4",alt:!0,fn:this.onShowDetail.bind(this,4)},{key:K.NINE_FIX,alt:!0,fn:this.onShowDetail.bind(this,99)},{key:K.F2,ctrl:!0,fn:function(){sideBar.notes.focus()}},{key:K.PLUS,notCtrl:!0,fn:this.onZoomIn.bind(this)},{key:K.MINUS,notCtrl:!0,fn:this.onZoomOut.bind(this)},{key:K.ESC,notCtrl:!0,fn:this.onCancelConnection.bind(this)}]),this._editKeyMap.addBinding([{key:K.ENTER,notShift:!0,fn:function(){canvas.selected.select(null,null,!0)}},{key:K.ESC,fn:function(){canvas.selected.select()}},{key:[K.TAB,K.INSERT],notCtrl:!0,fn:function(){canvas.selected.select(null,null,!0),canvas.onAdd()}},{key:MM.ua.isBrowser("Internet Explorer")?[K.LEFT,K.RIGHT]:[],alt:!0,fn:Prototype.emptyFunction}]),Draggables.removeObserver(this.el),Draggables.addObserver({element:this.el,onStart:function(eventName,draggable,event){canvas.onStart(draggable.element,event)},onEnd:function(eventName,draggable,event){canvas.onEnd(draggable.element,event)},onDrag:function(eventName,draggable,event){canvas.onDrag(draggable.element,event)}}),this.shiftKeyPressListener=this.onShiftKeyPress.bindAsEventListener(this),this.shiftKeyReleaseListener=this.onShiftKeyRelease.bindAsEventListener(this),document.observe("keydown",this.shiftKeyPressListener),document.observe("keyup",this.shiftKeyReleaseListener),Modernizr.draganddrop&&this.enableFileDrop(),__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.enable(),this.contextMenu=new __WEBPACK_IMPORTED_MODULE_9__contextMenu__.default(onContextMenu,onCloseContextMenu)},initViewOnlyMode:function($super){$super(),__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__.default.all.each(function(c){c.view.toViewMode()});var K=MM.utils.KeyEvent;this._viewOnlyKeyMap.addBinding([{key:K.PLUS,notCtrl:!0,fn:this.onZoomIn.bind(this)},{key:K.MINUS,notCtrl:!0,fn:this.onZoomOut.bind(this)},{key:[K.F6,K.HOME,K.END],notCtrl:!0,fn:this.onRecenter.bindAsEventListener(this,!0)},{key:"0",alt:!0,fn:this.onShowDetail.bind(this,99)},{key:"1",alt:!0,fn:this.onShowDetail.bind(this,1)},{key:"2",alt:!0,fn:this.onShowDetail.bind(this,2)},{key:"3",alt:!0,fn:this.onShowDetail.bind(this,3)},{key:"4",alt:!0,fn:this.onShowDetail.bind(this,4)},{key:K.NINE_FIX,alt:!0,fn:this.onShowDetail.bind(this,99)}]),Modernizr.draganddrop&&this.disableFileDrop(),this._onDC&&this.el.stopObserving("dblclick",this._onDC),__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.disable()},disableEditMode:function(){this.el.stopObserving("dblclick",this._onDC),this._ghost&&mm$(this._ghost.id)&&Element.remove(this._ghost)},disableViewOnlyMode:function(){this.el.observe("dblclick",this._onDC)},onShiftKeyPress:function(event){if(!this.shiftPressed){16==(event.keyCode||event.charCode)&&(this.shiftPressed=!0,this.selected&&this.selected.image&&this.selected.image.dcontainer.onShiftPressed())}},onShiftKeyRelease:function(event){16===(event.keyCode||event.charCode)&&(this.shiftPressed=!1,this.selected&&this.selected.image&&this.selected.image.dcontainer.onShiftReleased())},checkBounds:function(){if(!tree.notPainted&&!App.config.fullScreenExport&&tree.finishedInitialization)for(var offset=App.config.layout.canvasBounds(),tries=0;(offset[0]>0||offset[1]>0)&&tries<5;){var offsetX=offset[0]+200,offsetY=offset[1]+200;this.size=Math.offset(this.size,[offsetX,offsetY]),this.changeSize(),this.container.scrollLeft+=offsetX/2,this.container.scrollTop+=offsetY/2,offset=App.config.layout.canvasBounds(),tries++}},getMapLeftSize:function(){for(var rootSize=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],rectangles=rectangleLayouter.rectangles(),minx=0,i=0,len=rectangles.length;i<len;i++){var r=rectangles[i];r.p1.x<minx&&(minx=r.p1.x)}return Math.max(-minx,rootSize[0]/2)},getMapRightSize:function(){for(var rootSize=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],rectangles=rectangleLayouter.rectangles(),maxx=0,i=0,len=rectangles.length;i<len;i++){var r=rectangles[i];r.p2.x>maxx&&(maxx=r.p2.x)}return Math.max(maxx,rootSize[0]/2)},getMapUpperSize:function(){for(var rootSize=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],rectangles=rectangleLayouter.rectangles(),miny=0,i=0,len=rectangles.length;i<len;i++){var r=rectangles[i];r.p1.y<miny&&(miny=r.p1.y)}return Math.max(-miny,rootSize[1]/2)},getMapLowerSize:function(){for(var rootSize=[canvas.root.dcontent.el.offsetWidth,canvas.root.dcontent.el.offsetHeight],rectangles=rectangleLayouter.rectangles(),maxy=0,i=0,len=rectangles.length;i<len;i++){var r=rectangles[i];r.p2.y>maxy&&(maxy=r.p2.y)}return Math.max(maxy,rootSize[1]/2)},getMapSizeAndOffset:function(centered){if(App.config.layout.autoAlign){var leftOffset=mm$("tk_map").offsetLeft,topOffset=mm$("tk_map").offsetTop,mapSize=App.config.layout.mapSize();if(centered){var centerOffset=mapSize.centerOffset;centerOffset[0]<mapSize.width/2?(leftOffset-=2*(mapSize.width-centerOffset[0])-mapSize.width,mapSize.width=2*(mapSize.width-centerOffset[0])):mapSize.width=2*centerOffset[0],centerOffset[1]<mapSize.height/2?(topOffset-=2*(mapSize.height-centerOffset[1])-mapSize.height,mapSize.height=2*(mapSize.height-centerOffset[1])):mapSize.height=2*centerOffset[1]}var sizes={left:leftOffset,top:topOffset,width:canvas.el.clientWidth,height:canvas.el.clientHeight,realWidth:mapSize.width,realHeight:mapSize.height}}else{var center=canvas.getCenter(),leftSize=canvas.getMapLeftSize(),rightSize=canvas.getMapRightSize(),upperSize=canvas.getMapUpperSize(),lowerSize=canvas.getMapLowerSize(),width=rightSize+leftSize,height=upperSize+lowerSize,leftOffset=center[0]-leftSize,topOffset=center[1]-upperSize;centered&&(leftSize<width/2?(leftOffset-=2*rightSize-width,width=2*rightSize):width=2*leftSize,upperSize<height/2?(topOffset-=2*lowerSize-height,height=2*lowerSize):height=2*upperSize);var sizes={left:leftOffset,top:topOffset,width:canvas.el.clientWidth,height:canvas.el.clientHeight,realWidth:width,realHeight:height}}var paths=[];__WEBPACK_IMPORTED_MODULE_2__views_graphics__.Graphics.connectionstack.values().each(function(connectionArray){connectionArray.each(function(pathEl){"path"===pathEl.type&&paths.push(pathEl.node)})}),__WEBPACK_IMPORTED_MODULE_2__views_graphics__.Graphics.allBoundaries.values().each(function(boundaryEl){paths.push(boundaryEl.node)}),paths.each(function(path){var bbox=path.getBBox();bbox.x<sizes.left&&(sizes.realWidth+=sizes.left-bbox.x+5,sizes.left=bbox.x-5),bbox.y<sizes.top&&(sizes.realHeight+=sizes.top-bbox.y+5,sizes.top=bbox.y-5),bbox.x+bbox.width>sizes.left+sizes.realWidth&&(sizes.realWidth+=bbox.x+bbox.width-sizes.left-sizes.realWidth+5),bbox.y+bbox.height>sizes.top+sizes.realHeight&&(sizes.realHeight+=bbox.y+bbox.height-sizes.top-sizes.realHeight+5)});for(var connectionLabels=document.getElementsByClassName("connection_label"),i=0,len=connectionLabels.length;i<len;i++){var connectionLabel=connectionLabels[i];connectionLabel.offsetLeft<sizes.left&&(sizes.realWidth+=sizes.left-connectionLabel.offsetLeft+5,sizes.left=connectionLabel.offsetLeft-5),connectionLabel.offsetTop<sizes.top&&(sizes.realHeight+=sizes.top-connectionLabel.offsetTop+5,sizes.top=connectionLabel.offsetTop-5),connectionLabel.offsetLeft+connectionLabel.clientWidth>sizes.left+sizes.realWidth&&(sizes.realWidth+=connectionLabel.offsetLeft+connectionLabel.clientWidth-sizes.left-sizes.realWidth+5),connectionLabel.offsetTop+connectionLabel.clientHeight>sizes.top+sizes.realHeight&&(sizes.realHeight+=connectionLabel.offsetTop+connectionLabel.clientHeight-sizes.top-sizes.realHeight+5)}return sizes},initSize:function(){this.width=this.size[0],this.height=this.size[1],(this.width<MM.ui.page.width||this.height<MM.ui.page.height)&&(this.width=MM.ui.page.width,this.height=MM.ui.page.height,this.size=[this.width,this.height]),this.el.style.width=this.width+"px",this.el.style.height=this.height+"px",__WEBPACK_IMPORTED_MODULE_2__views_graphics__.Graphics.resize(this.width,this.height)},changeSize:function(){this.initSize(),tree.notPainted||(canvas.root.reposition(),canvas.root.children.each(function(vnode){App.config.layout.rootChildrenPosition&&vnode.rc.reposition()}),rectangleLayouter.updateAll())},destroy:function($super){$super(),Draggables.removeObserver(this.el),this.disableConnections(),this.disableScrollByDrag(),this.disableCssZoom(),__WEBPACK_IMPORTED_MODULE_5__copyPaste__.default.disable(),this.contextMenu&&(this.contextMenu.stopObserving(),this.contextMenu=null),this.clearSelection(),this.disableSelections()},getNodeCanvasOffset:function(vnode){return this.getElementOffset(vnode.dcontent.el)},isSelected:function(vnode){return canvas.selected==vnode},onSelect:function(vnode,event,noScroll,noUnselect){if(!vnode.dcontent||document.body.contains(vnode.dcontent.el)){if(canvas.addFocus(),noScroll||this.scrollToNode(vnode),canvas.isSelected(vnode))return void(canvas.allSelected.indexOf(vnode)<0&&canvas.allSelected.push(vnode));var ctrl=!1,shift=!1;if(event&&(ctrl=MM.ua.isPlatform("Macintosh")?event.metaKey:event.ctrlKey,shift=event.shiftKey),vnode.image&&vnode.image.dcontainer.toSelected(),canvas.allSelected.length>0&&(ctrl||shift||noUnselect?canvas.allSelected.each(function(_vnode){vnode!=_vnode&&_vnode.dcontent.toPartiallySelected(!0)}):(canvas.allSelected.each(function(_vnode){vnode!=_vnode&&(_vnode.dcontent.toInactive(!0),_vnode.image&&_vnode.image.dcontainer.toInactive())}),canvas.allSelected=[])),shift&&canvas.selected&&vnode.node.parent&&canvas.selected.node.parent==vnode.node.parent&&!vnode.node.isRootC()){for(var children=canvas.selected.node.parent.children,minIndex=children.indexOf(canvas.selected.node),maxIndex=children.indexOf(vnode.node),toSelect=[],i=0,len=children.length;i<len;i++)i>Math.min(minIndex,maxIndex)&&i<Math.max(maxIndex,minIndex)&&toSelect.push(children[i]);minIndex>maxIndex&&toSelect.reverse(),toSelect.each(function(node){node._listener.dcontent.toPartiallySelected(!0),canvas.allSelected.push(node._listener)})}canvas.selected=vnode,canvas.allSelected.indexOf(vnode)<0&&canvas.allSelected.push(vnode),sideBar&&sideBar.onSelectNode(),canvas.selected.node.connections.each(function(conn){conn.view.showConnectionHandlers()})}},onUnselect:function(vnode){this.allSelected=this.allSelected.reject(function(vn){return vn.node==vnode.node}),vnode.node.connections.each(function(conn){conn.view.hideConnectionHandlers()})},onSelectAll:function(event){this.scrollToNode(canvas.root),canvas.selected=canvas.root,canvas.allSelected=[canvas.root],canvas.root.eachChild(function(vnode){canvas.allSelected.push(vnode),vnode!==canvas.root&&vnode.dcontent.toPartiallySelected(!0)}),canvas.root.dcontent.toSelected(event,!0,!0)},__onStopEdit:function($super){sideBar&&sideBar.onSelectNode(canvas.selected),$super()},editMode:function($super){$super(),this.disableScrollByDrag(),this._navigationKeyMap.disable(),this._editKeyMap.enable()},navigationMode:function($super){$super(),this.addFocus(),this.enableScrollByDrag(),App.config.editable&&App.config.currentlyEditable&&(this._editKeyMap&&this._editKeyMap.disable(),this._navigationKeyMap&&this._navigationKeyMap.enable())},markDropTarget:function(mark,index,instant,position,referenceNode){if(!instant){canvas._ghost&&!mm$(canvas._ghost.id)&&canvas.createGhost();var ret=mark.getGhostPosition(index,position,referenceNode);canvas._ghost.style.left=ret.pos[0]+"px",canvas._ghost.style.top=ret.pos[1]+"px",canvas._ghost.style.backgroundPosition=ret.offset[0]+"px "+ret.offset[1]+"px",Element.show(canvas._ghost)}canvas._index=index,canvas._marked!=mark&&(canvas._marked&&canvas._marked.unmark(),mark.mark(),canvas._marked=mark)},unmarkDropTarget:function(){canvas._marked&&(canvas._marked.unmark(),canvas._marked=null,canvas._index=null,Element.hide(canvas._ghost))},onToggleClosed:function(){this.selected.node.toggleClosed()},onSelectLeft:function(event){var selectedNodes=this.allSelected,shift=event.shiftKey;selectedNodes.each(function(selected){if(selected.node.isRoot()){if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up)return;if(shift){selected.getLeftChildren().each(function(vnode){vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)})}else{var vnode=canvas.root.getChildAtAngle(180);!vnode||vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)}}else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var vnode=null;selected.node.isRootC()?(node=selected.node.getPrevSibling())&&(vnode=node._listener):vnode=selected.getLeftCounterpart(),!vnode||vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)}else if(selected.rc.orientation==App.Layouts.orientation.left)if(shift)selected.children.each(function(vnode){vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event,selected.node.depth()+1)});else{var node=selected.node.getMiddleChild();!node||node._listener.dcontent.isPartiallySelected()||node._listener.dcontent.isSelected()||node._listener.select(event,selected.node.depth()+1)}else selected.parent?selected.parent.dcontent.isPartiallySelected()||selected.parent.dcontent.isSelected()||selected.parent.select(event,selected.node.depth()-1):canvas.root.dcontent.isPartiallySelected()||canvas.root.dcontent.isSelected()||canvas.root.select(event)})},onSelectRight:function(event){var selectedNodes=this.allSelected,shift=event.shiftKey;selectedNodes.each(function(selected){if(selected.node.isRoot()){if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up)return;if(shift){selected.getRightChildren().each(function(vnode){vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)})}else{var vnode=canvas.root.getChildAtAngle(0);!vnode||vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)}}else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var vnode=null;selected.node.isRootC()?(node=selected.node.getNextSibling())&&(vnode=node._listener):vnode=selected.getRightCounterpart(),!vnode||vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event)}else if(selected.rc.orientation==App.Layouts.orientation.right)if(shift)selected.children.each(function(vnode){vnode.dcontent.isPartiallySelected()||vnode.dcontent.isSelected()||vnode.select(event,selected.node.depth()+1)});else{var node=selected.node.getMiddleChild();!node||node._listener.dcontent.isPartiallySelected()||node._listener.dcontent.isSelected()||node._listener.select(event,selected.node.depth()+1)}else selected.parent?selected.parent.dcontent.isPartiallySelected()||selected.parent.dcontent.isSelected()||selected.parent.select(event,selected.node.depth()-1):canvas.root.dcontent.isPartiallySelected()||canvas.root.dcontent.isSelected()||canvas.root.select(event)})},onSelectUp:function(event){var selected=this.selected,tmp=null,toRemember=null;if(selected.node.isRoot())App.config.layout.orientation!==App.Layouts.orientation.down&&(tmp=canvas.root.getChildAtAngle(90),toRemember=null,tmp&&(tmp=tmp.node));else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var node=selected.node;if(node.isRootC())tmp=node.parent;else{var sibling=node.getPrevSibling();if(sibling)if(sibling.children.length>0){for(;sibling.children.length>0&&!sibling.isRootC();)sibling=sibling.children[sibling.children.length-1];tmp=sibling}else tmp=sibling;else tmp=node.parent}}else tmp=selected.node.getPrevSiblingExtended(canvas._rememberedDepth),tmp&&(tmp=tmp.getVisibleParent()),tmp&&canvas._rememberedDepth?toRemember=canvas._rememberedDepth:tmp&&selected.node.depth()>tmp.depth()&&(toRemember=selected.node.depth());tmp&&((tmp._listener.dcontent.isSelected()||tmp._listener.dcontent.isPartiallySelected())&&(selected.dcontent.toInactive(),tmp._listener.dcontent.toInactive()),tmp._listener.select(event,toRemember))},onSelectDown:function(event){var selected=this.selected,tmp=null,toRemember=null;if(selected.node.isRoot())App.config.layout.orientation!==App.Layouts.orientation.up&&(tmp=canvas.root.getChildAtAngle(270),toRemember=null,tmp&&(tmp=tmp.node));else if(App.config.layout.orientation===App.Layouts.orientation.down||App.config.layout.orientation===App.Layouts.orientation.up){var node=selected.node;if(node.children.length>0)tmp=node.children[0];else{var sibling=node.getNextSibling();if(sibling)tmp=sibling;else{for(var parent=node.parent;parent&&!parent.getNextSibling()&&!parent.isRootC();)parent=parent.parent;parent&&!parent.isRootC()&&(tmp=parent.getNextSibling())}}}else tmp=selected.node.getNextSiblingExtended(canvas._rememberedDepth),tmp&&(tmp=tmp.getVisibleParent()),tmp&&canvas._rememberedDepth?toRemember=canvas._rememberedDepth:tmp&&selected.node.depth()>tmp.depth()&&(toRemember=selected.node.depth());tmp&&((tmp._listener.dcontent.isSelected()||tmp._listener.dcontent.isPartiallySelected())&&(selected.dcontent.toInactive(),tmp._listener.dcontent.toInactive()),tmp._listener.select(event,toRemember))},onMoveUpDown:function(down){var selected=this.selected;if(!selected.node.isRoot()&&!selected.node.isRootC()){var sibling;(sibling=down?selected.node.getNextSibling():selected.node.getPrevSibling())&&Tree.utils.moveNodes([selected.node],selected.node.parent,selected.node.parent.indexOf(sibling)+(down?1:0))}},onAdd:function(vnode){vnode||(vnode=this.selected),vnode.node.addChild(App.config.layout.nextTopicPosition(vnode.node)),App.trigger(CustomEvents.CHILD_ADDED)},onAddSibling:function(above){if(this.selected.node.isRoot())this.selected.node.addChild();else if(this.selected.parent){var parent=this.selected.parent.node,pos=App.config.layout.nextTopicPosition(parent);above?parent.addChild(pos,parent.rank(this.selected.node),this.selected.node.style):parent.addChild(pos,parent.rank(this.selected.node)+1,this.selected.node.style)}else this.root.node.addChild(null,null,this.selected.node.style)},onAddFloating:function(){if(mm$("tk_openerghost")&&this.root.node){var offset=mm$("tk_openerghost").cumulativeOffset(),pos=[offset.left-this.root.pcenter[0],offset.top-this.root.pcenter[1]];this.root.node.addChild(pos,null,null,!0)}},onRemove:function(){var nodes=this.allSelected.map(function(vnode){return vnode.node}).reject(function(node){return node.isRoot()});nodes=nodes.reject(function(node){return nodes.any(function(n){return node.getAncestors().include(n)})}),Tree.utils.removeNodes(nodes)},onConnect:function(){var vNodes=canvas.allSelected,nodes=vNodes.map(function(vNode){return vNode.node}).reject(function(node){return!node.isRootC()||!node.isFloating()});Tree.utils.connect(nodes)},onDisconnect:function(){var vNodes=canvas.allSelected,nodes=[],positions={};vNodes.each(function(vNode){var node=vNode.node;if(!node.isRoot()&&!node.isFloating()&&(nodes.push(node),!node.isRootC())){var center=this.getCenter(),offset=this.getNodeCanvasOffset(vNode);positions[node.id]=[offset[0]-center[0]+(vNode.rc.orientation?15:-25),offset[1]-center[1]]}}.bind(this)),Tree.utils.disconnect(nodes,positions),this.scrollToNode(this.selected,!0)},onEdit:function(){canvas.selected.dcontent.toEditing(null,"rename")},highlightTopics:function(){this.allSelected.each(function(vnode){vnode.highlight("#ffb347")})},onSetGroupIcon:function(event,node,icon){Event.stop(event);var newIcon=icon.nextInGroup();newIcon&&(node._listener.select(),sideBar&&sideBar.icons.setIcon(newIcon.fullName()))},onSetIcon:function(icon){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setIcon(icon,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onRemoveIcon:function(icon){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.removeIcon(icon,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetStyle:function(key,value){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setStyle(key,value,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetFullStyle:function(style){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setFullStyle(style,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetBoundary:function(boundary){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setBoundary(boundary,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetVideo:function(video,node){if(canvas.allSelected.length>0){var nodes=node?[node]:canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setVideo(video,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetVote:function(vote){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.setVote(vote,nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onSetProperty:function(key,value,callbacks){if(canvas.selected){callbacks=_extends({onOk:function(){return null},onCancel:function(){return null}},callbacks);var nodes=canvas.allSelected.map(function(vnode){return vnode.node}),setProperty=function(){Tree.utils.setProperty(key,value,nodes),callbacks.onOk()};nodes.length>10?Dialog.confirm("<h2>"+I18n.t("js.edit_multiple")+"</h2><p>"+I18n.t("js.edit_multiple_text",{v0:nodes.length+1})+"</p>",{windowParameters:{height:120,width:400},ok:function(){setProperty(),this.close()},cancel:function(){callbacks.onCancel(),this.close()}}):setProperty()}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onRemoveTask:function(){if(canvas.selected){var nodes=canvas.allSelected.map(function(vnode){return vnode.node});Tree.utils.removeTask(nodes)}else Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE)},onAddConnection:function(event){event&&event.stop&&event.stop(),this._nodeToConnect=this.selected,document.observe("click",this._onConnectToListener),document.observe("mousemove",this._onConnectionDragListener)},initConnections:function(){this._onConnectToListener=this.onConnectTo.bind(this),this._onConnectionDragListener=this.onConnectionDrag.bind(this),this._dragConnectionCanvas=new __WEBPACK_IMPORTED_MODULE_1__views_vconnection__.default},disableConnections:function(){document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas&&this._dragConnectionCanvas.destroy()},onCancelConnection:function(){this._nodeToConnect&&(document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas.clear(),this._nodeToConnect=null)},onConnectTo:function(event){if(this._nodeToConnect){var el=event.findElement(".tk_label");if(el){document.stopObserving("click",this._onConnectToListener),document.stopObserving("mousemove",this._onConnectionDragListener),this._dragConnectionCanvas.clear();try{var from=this._nodeToConnect.node,to=el._listener.node;if(this._nodeToConnect=null,from===to)return Message.show(I18n.t("js.connect_node_to_itself"),Message.NOTICE);if(__WEBPACK_IMPORTED_MODULE_6_app_models_connectionModel__.default.get(from.id,to.id))return Message.show(I18n.t("js.connection_already_exists"),Message.NOTICE);from.connectTo(to)}catch(exception){MM.error.reportException({exception:exception,message:"Connection drawing problem in onConnectTo: ",details:{from:from,to:to,event:event}})}}}},onConnectionDrag:function(event){this.onConnectionDrag.start||(this.onConnectionDrag.start=this.onConnectionDrag.previous=[Event.pointerX(event),Event.pointerY(event)],this.onConnectionDrag.previousTs=new Date);var now=new Date;if(!(now-this.onConnectionDrag.previousTs<200)){this.onConnectionDrag.previousTs=now;var point=this._getCursorPosition(event),prev=this.onConnectionDrag.previous;this.onConnectionDrag.previous=point,Math.abs(point.x-prev.x)<3&&Math.abs(point.y-prev.y)<3||this._dragConnectionCanvas.drawTemporaryConnection(this._nodeToConnect,point)}},_getCursorPosition:function(event){var cursorX=0,cursorY=0;return event&&(cursorX=event.clientX,cursorY=event.clientY),new Point([App.ui.Zoom.transformCssZoomCoordinate(cursorX+this.container.scrollLeft,"x",!1),App.ui.Zoom.transformCssZoomCoordinate(cursorY+this.container.scrollTop,"y",!1)])},_findAffectedRootChild:function(element,point,position){var children,side=point[0]-this.getCenter()[0];children=this.root.children.filter(function(rc){var sameSide=rc.node.pos[0]*side>0&&rc!=element._listener;return sameSide&&(rc._positionOnCanvas=canvas.getNodeCanvasOffset(rc)),sameSide}),children.sort(function(a,b){var distanceA=a._positionOnCanvas[1]-point[1],distanceB=b._positionOnCanvas[1]-point[1];return Math.abs(distanceA)-Math.abs(distanceB)});var referenceNode=children[0];if(children.length>0){var otherNode=null;if(referenceNode._positionOnCanvas[1]<point[1]){for(var i=1;i<children.length;i++)if(point[1]<children[i]._positionOnCanvas[1]){otherNode=children[i];break}position[1]=otherNode?(otherNode.node.pos[1]-referenceNode.node.pos[1])/2:10+referenceNode.dcontent.size()[1]}else{for(var i=1;i<children.length;i++)if(point[1]>children[i]._positionOnCanvas[1]){otherNode=children[i];break}position[1]=otherNode?(otherNode.node.pos[1]-referenceNode.node.pos[1])/2:-25}}else position[0]=side>0?100:-100,position[1]=-50;return referenceNode},onStart:function(element){var vnode=element._listener;if(vnode){if(this.disableScrollByDrag(),addClassName(document.body,"unselectable"),addClassName(element,"dragging"),this._scrolling=!1,vnode.image&&vnode.image.dcontainer.toInactive(),vnode.video&&vnode.video.showPlaceholder(),canvas._originalPosition=canvas.getElementOffset(element),(vnode.isSelected()||vnode.isPartiallySelected())&&(vnode.dcontent.disableSelecting(),canvas.allSelected.length>1)){var originalWidth=element.offsetWidth,originalHeight=element.offsetHeight;addClassName(element,"multiple"),element.setStyle({width:originalWidth+"px",height:originalHeight+"px"})}vnode.dcontainer.oldZ=vnode.dcontainer.el.style.zIndex,vnode.dcontainer.el.style.zIndex=element.style.zIndex}},onDrag:function(element,event){var vnode=element._listener;if(vnode){canvas.disableScrollByDrag(),this._scrolling=!1,vnode.node.isRootC()||vnode._tempRc||(vnode._tempRc=new __WEBPACK_IMPORTED_MODULE_0__views_vrootChild__.default(vnode));var rootC=vnode._tempRc||vnode.rc;if(this._mtGhost||this.createMTGhost(),App.ui.Footer.activeBar&&"meistertask"===App.ui.Footer.activeBar&&MM.utils.Meistertask.overlapsFooter(event))return canvas._mt_drop=!0,canvas.unmarkDropTarget(),rootC.graphics.livePath&&(rootC.graphics.livePath.remove(),rootC.graphics.livePath=null),rootC.graphics.rootPath&&(rootC.graphics.rootPath.remove(),rootC.graphics.rootPath=null),element.style.opacity=0,MM.utils.Meistertask.onHover(vnode,event),void(vnode.node.isRootC()?(removeClassName(vnode.dcontent.el,"node"),addClassName(vnode.dcontent.el,"root_child")):(removeClassName(vnode.dcontent.el,"root_child"),addClassName(vnode.dcontent.el,"node")));canvas._mt_drop=!1,hide(this._mtGhost),element.style.opacity=1,(!vnode.dcontent.isSelected()&&!vnode.dcontent.isPartiallySelected()||(vnode.dcontent.isSelected()||vnode.dcontent.isPartiallySelected())&&1==canvas.allSelected.length)&&(canvas._canvasDrop||canvas._marked===canvas.root?(removeClassName(vnode.dcontent.el,"node"),addClassName(vnode.dcontent.el,"root_child"),rootC.redrawRootLine("live")):canvas._marked?canvas._marked.node.isRoot()&&App.config.layout.name.indexOf("aligned")>=0?(removeClassName(vnode.dcontent.el,"node"),addClassName(vnode.dcontent.el,"root_child"),rootC.redrawRootLine("live")):(rootC.redrawRootLine("live",!0),removeClassName(vnode.dcontent.el,"root_child"),addClassName(vnode.dcontent.el,"node")):(vnode._tempRc&&vnode._tempRc.redrawRootLine("live",!0),vnode.node.isRootC()?rootC.redrawRootLine("live"):(removeClassName(vnode.dcontent.el,"root_child"),addClassName(vnode.dcontent.el,"node"))))}},getDroppingNodes:function(element){if(removeClassName(element,"multiple"),element._listener.dcontent.isSelected()||element._listener.dcontent.isPartiallySelected())var vnodes=canvas.allSelected;else var vnodes=[element._listener];return vnodes=vnodes.reject(function(vnode){return vnode.node.isRoot()})},onEnd:function(element,e){var vnode=element._listener;if(vnode){if(canvas.enableScrollByDrag(),removeClassName(document.body,"unselectable"),removeClassName(element,"dragging"),element.style.opacity=1,vnode.node.isRootC()&&(removeClassName(element,"node"),addClassName(element,"root_child")),vnode._tempRc&&(vnode._tempRc.redrawRootLine("live",!0),vnode._tempRc=null),canvas._mt_drop){var vnodes=this.getDroppingNodes(element);vnodes.each(function(vnode){vnode.dcontainer.resetPosition(),vnode.dcontent.resetPosition(),vnode.node.isRootC()&&vnode.rc.redrawRootLine()}),MM.utils.Meistertask.onDrop(vnodes),canvas._mt_drop=!1,App.trigger(CustomEvents.EXTERNAL_TASK_CREATED)}else if(canvas._canvasDrop)this.onCanvasDrop(element);else if(canvas._marked)this.onLblDrop(element),App.trigger(CustomEvents.TOPIC_DROPPED);else{var vnodes=this.getDroppingNodes(element);vnodes.each(function(vnode){vnode.dcontent.resetPosition(),vnode.node.isRootC()&&vnode.rc.redrawRootLine()})}setTimeout(function(){vnode.isSelected()?vnode.dcontent.enableSelecting():vnode.select(e,null,null,!0,vnode.isPartiallySelected()),vnode.image&&vnode.image.dcontainer.toSelected(),vnode.video&&vnode.video.removePlaceholder()},0),vnode.dcontainer.el.style.zIndex=element._listener.dcontainer.oldZ}},onCanvasDrop:function(element){if(this._canvasDrop){var vnodes=this.getDroppingNodes(element),child=element._listener,offset=[parseInt(element.style.left),parseInt(element.style.top)];if(child.rc.orientation===App.Layouts.orientation.left&&(offset[0]-=child.dopener.size()[0]+6),"org_chart"===App.config.layout.name)return void this.reOrderRootChildren(vnodes,offset);var realPosition;if(child.node.isRootC())realPosition=Math.offset(child.node.pos,offset);else{var center=canvas.getCenter();realPosition=Math.negativeOffset(Math.offset(canvas._originalPosition,offset),center)}if(vnodes.each(function(vnode){vnode.dcontent.resetPosition()}),!child.node.isRootC()){if(Math.diagonal([offset[0]-element.offsetLeft,offset[1]-element.offsetTop])<12)return}var nodes=vnodes.map(function(vnode){return vnode.node});vnodes.each(function(vnode){vnode.rc.graphics&&vnode.rc.graphics.livePath&&vnode.rc.graphics.livePath.remove()}),Tree.utils.moveNodes(nodes,canvas.root.node,0,null,realPosition)}},onLblDrop:function(element){if(element&&removeClassName(element,"multiple"),element._listener.dcontent.isSelected()||element._listener.dcontent.isPartiallySelected())var vnodes=canvas.allSelected;else var vnodes=[element._listener];vnodes=vnodes.reject(function(vnode){return vnode.node.isRoot()}),vnodes.each(function(vnode){vnode.dcontent.resetPosition()});var nodes=vnodes.map(function(vnode){return vnode.node});canvas._marked.node.isRoot()?Tree.utils.moveNodes(nodes,canvas._marked.node,0,null,canvas._dropPosition):Tree.utils.moveNodes(nodes,canvas._marked.node,canvas._index),canvas.unmarkDropTarget()},findAffected:function(point,element){var cursorPos=this._getCursorPosition();point=Math.offset(point,[cursorPos.x,cursorPos.y]);var affected=this.root.findAffected(point);if(affected)return this._canvasDrop=!1,affected;if(App.config.layout.name.indexOf("aligned")>=0){this._canvasDrop=!1;var position=[0,0],referenceNode=this._findAffectedRootChild(element,point,position);return this.markDropTarget(this.root,null,null,position,referenceNode),this.root.el}return this._canvasDrop=!0,this.unmarkDropTarget(),this.el},onLblHover:function(element,drop,vOverlap){if(!canvas._mt_drop){var hoveredVnode=drop._listener,vnode=element._listener;if(hoveredVnode.node===vnode.node||hoveredVnode.node.isChild(vnode.node))return this._canvasDrop=!App.config.layout.autoAlign&&vnode.node.isRootC()&&(Math.abs(element.offsetTop)>20||Math.abs(element.offsetLeft)>20),void this.unmarkDropTarget();var mark,index,position;if(vOverlap=1-vOverlap,!hoveredVnode.node.isRootC()||App.config.layout.autoAlign&&"org_chart"!==App.config.layout.name){var hOverlap=1-Position.overlap("horizontal",drop);vOverlap>=0&&vOverlap<=1&&(hoveredVnode.rc.orientation==App.Layouts.orientation.left&&hOverlap<.4||hoveredVnode.rc.orientation==App.Layouts.orientation.right&&hOverlap>.6)?(mark=hoveredVnode,index=vOverlap>.5?hoveredVnode.node.children.length:0):(mark=hoveredVnode.parent,mark.node.isRoot()?(position=[0,0],position[1]+=vOverlap>.5?10+hoveredVnode.dcontent.size()[1]:-25):(index=mark.node.indexOf(hoveredVnode.node),vOverlap>.5&&index++))}else mark=hoveredVnode,index=vOverlap>.5?hoveredVnode.node.children.length:0;mark==canvas._marked&&index==canvas._index||canvas.markDropTarget(mark,index,null,position,hoveredVnode)}},reOrderRootChildren:function(vnodes,offset){vnodes.each(function(vnode){vnode.dcontent.resetPosition()}),offset[0]+=vnodes[0].rc.vnode.dcontainer.el.offsetLeft,offset[1]=vnodes[0].dcontent.el.cumulativeOffset()[1]-canvas.getCenter()[1];var rootChildren=canvas.root.children.sort(function(a,b){return a.dcontainer.el.offsetLeft-b.dcontainer.el.offsetLeft});rootChildren=rootChildren.reject(function(vnode){return vnodes.indexOf(vnode)>=0});var toMove=rootChildren.map(function(rootChild){return[rootChild,[rootChild.dcontainer.el.offsetLeft,rootChild.node.pos[1]]]}),nextChild=rootChildren.detect(function(vnode){return vnode.dcontainer.el.offsetLeft>offset[0]});if(nextChild)var index=rootChildren.indexOf(nextChild);else var index=rootChildren.length;vnodes.each(function(vnode){toMove.insert([vnode,[offset[0],offset[1]]],index)});var changes=[];toMove.each(function(move){var node=move[0].node;node.isRootC()?changes.push(new RepositionChange({idea_id:node.id,type:"Reposition",old_data:{pos:node.pos},new_data:{pos:move[1]}})):changes.push(new MoveChange({idea_id:node.id,type:"Move",old_data:{parent:node.parent.id,rank:node.parent.rank(node),pos:node.pos},new_data:{parent:canvas.root.node.id,rank:index+toMove.indexOf(move),pos:move[1]}}))}),ChangeList.layoutAlteringChangeset(changes)},onWheelScroll:function(e,wheel){e.preventDefault(),e.stopPropagation();var downsizeFactor=Math.max(App.ui.Zoom.getZoomFactor(),1)*App.ui.Zoom.getScaleAvg(),x=wheel.deltaX/downsizeFactor,y=wheel.deltaY/downsizeFactor;this.scrollTo([this.getScrollLeft()+x,this.getScrollTop()+y])},getZoomPosition:function(){return this.selected&&this.selected.isVisible()?this.selected.getCentralPosition():null},onZoomIn:function(){return App.ui.Zoom.zoomIn(!0,!0,this.getZoomPosition()),App.config.currentlyEditable||this.disableEditMode(),!1},onZoomOut:function(){return App.ui.Zoom.zoomOut(!0,!0,this.getZoomPosition()),App.config.currentlyEditable||this.disableEditMode(),!1},onFind:function(){__WEBPACK_IMPORTED_MODULE_14_app_ui_filter__.default.activate()},onToggleSidebar:function(){sideBar&&sideBar.toggle(!0)},onShowDetail:function(level,selectedTopic){(selectedTopic&&canvas.selected?canvas.selected:canvas.root).node.toggleClosedDetail(level)},onAlphabetize:function(){var chL=new ChangeList,children=canvas.selected.children.clone(),oldRanks=[];children.sort(__WEBPACK_IMPORTED_MODULE_3__views_vnode__.default.naturalCompare),children.each(function(vnode,i){var node=vnode.node,change=new RemoveChange({idea_id:node.id,type:"Delete"});oldRanks.push(node.parent.rank(node)),change.executeLocally()}),children.each(function(vnode,i){var node=vnode.node,oldPos=node.pos,rootSize=canvas.root.getSize();if(canvas.selected.node.isRoot())if(0===i)node.pos=[rootSize[0]/2+100,0];else{var prevNode=children[i-1].node,offset=prevNode._listener.dcontainer.el.offsetHeight+10;i>children.length/2-1&&App.config.layout.elasticLayout?node.pos=[-rootSize[0]/2-100,prevNode.pos[1]-offset]:node.pos=[rootSize[0]/2+100,prevNode.pos[1]+offset]}var change=new MoveChange({idea_id:node.id,type:"Move",old_data:{parent:canvas.selected.node.id,pos:oldPos,rank:oldRanks[i]},new_data:{parent:canvas.selected.node.id,rank:i,pos:node.pos}});change.executeLocally(),chL.changes.push(change)}),App.config.layout.elasticLayout&&chL.doNodeLayoutingChanges(canvas.selected.node),ServerConnection.doChanges(chL)},numberIt:function(clear,recurse){var chL=new ChangeList;canvas.selected.eachChildWithCounter(function(vnode,counter){if(0!=counter){var new_title,old=vnode.node.getRawTitle(),re=/^(\d)+\. ([\s\S]*)/,match=re.exec(old);new_title=clear?match?match[2]:old:match?counter+". "+match[2]:counter+". "+old,chL.changes.push(new RenameChange({idea_id:vnode.node.id,type:"Title",old_data:{title:old.title},new_data:{title:vnode.node.escapeTitle(new_title)}}))}},0,!1,!recurse),chL.changes.each(function(change){change.execute(),App.config.layout.elasticLayout&&chL.doNodeLayoutingChanges(change.node())}),ServerConnection.doChanges(chL)},onNumbering:function(){var numberingOn=!1;canvas.selected.eachChild(function(vnode){if(!numberingOn){/^(\d)+\. (.*)/.exec(vnode.node.title)&&(numberingOn=!0)}}),numberingOn?Dialog.confirm("<h2>"+I18n.t("js.numbering_heading")+'</h2><p class="hint">'+I18n.t("js.numbering_hint")+" "+I18n.t("js.what_to_do")+'</p><p class="clear nomargin"><input type="radio" value="true" name="renumber" id="renumber_nodes" class="radio" style="line-height:20px; margin:5px 5px 0 3px" checked="checked"/><label for="renumber_nodes" class="radio" style="line-height:20px">'+I18n.t("js.numbering_renumber")+'</label></p><p class="mb5"><input type="radio" value="false" name="renumber" id="clear_nodes" class="radio" style="line-height:20px; margin:5px 5px 0 3px"/><label for="clear_nodes" class="radio" style="line-height:20px">'+I18n.t("js.numbering_clear")+'</label></p><p><label for="number_recursive" class="radio" style="font-weight:normal;margin-left:3px"><input type="checkbox" id="number_recursive" class="checkbox" />Number all subtopics recursively</label></p>',{buttonClass:"button",okLabel:I18n.t("js.ok"),windowParameters:{height:160,width:280},ok:function(){canvas.numberIt(!mm$("renumber_nodes").checked,mm$("number_recursive").checked),Dialog.cancelCallback()}}):this.numberIt()},onSplit:function(splitTree){var toSplit,inserting=!1;canvas.selected.dcontent.isEditing()?(canvas.selected.dcontent._discardChanges=!0,toSplit=canvas.selected.dcontent.getWrappedValue(),inserting=canvas.selected.node.id<0):toSplit=canvas.selected.node.getRawTitle();var cleanUpRegEx=splitTree?/^[·•-]+/:/^[\s·•-]+/,lines=toSplit.split("\n").collect(function(line){return line.replace(cleanUpRegEx,"")});return lines=lines.reject(function(elem){return elem.empty()||elem.blank()}),{inserting:inserting,lines:lines}},onSplitLines:function(){var split=this.onSplit(!1),first=split.lines.shift(),nodes=[];split.inserting?nodes.push({title:first}):nodes.push({id:canvas.selected.node.id,title:first});for(var i=0;i<split.lines.length;i++)nodes.push({title:split.lines[i]});(canvas.selected.node.isRoot()?canvas.selected.node:canvas.selected.node.parent).addChildren(nodes),split.inserting&&canvas.selected.select()},onSplitTree:function(){var split=this.onSplit(!0),first=split.lines.shift(),nodes=[];split.inserting?nodes.push({id:--tree.uncommitedId,title:first,parent:canvas.selected.node.parent.id,indent:0}):nodes.push({id:canvas.selected.node.id,title:first});for(var i=0,length=split.lines.length;i<length;i++){for(var line=split.lines[i].replace(/\s+$/,"").gsub(/^\t/," "),title=line.replace(/^\s*/,""),indent=line.length-title.length,j=nodes.length,parent=(split.inserting||0===indent&&!canvas.selected.node.isRoot()?canvas.selected.node.parent:canvas.selected.node).id;j--;)if(nodes[j].indent<indent){parent=nodes[j].id;break}nodes.push({id:--tree.uncommitedId,title:title,parent:parent,indent:indent})}split.inserting&&canvas.selected.select(),Tree.utils.addChildrenAsTree(nodes)},onBeautifyMap:function(){__webpack_require__.e(55).then(__webpack_require__.bind(null,"boRQ")).then(function(){return MM.plugins.WunderMap.beautify()})},hasCustomStyles:function(){try{tree.root.eachChild(function(node){if(node.style)throw"Custom Style"})}catch(e){if("Custom Style"==e)return!0;throw e}return!1},onDoSetTheme:function(theme,override){var changes=[];if(changes.push(new MapThemeChange({idea_id:canvas.root.node.id,type:"MapTheme",new_data:theme.toJSON(),old_data:App.config.mapTheme.toJSON()})),override){canvas.root.node.style&&changes.push(new TextStyleChange({idea_id:canvas.root.node.id,type:"TextStyle",new_data:{style:null},old_data:{style:canvas.root.node.style.toJSON()}}));for(var children=canvas.root.children,i=children.length;i>0;)i--,children[i].node.style&&changes.push(new TextStyleChange({idea_id:children[i].node.id,type:"TextStyle",new_data:{style:null},old_data:{style:children[i].node.style.toJSON()}}));tree.root.eachChildWithoutSelf(function(node){node.isRootC()||node.style&&changes.push(new TextStyleChange({idea_id:node.id,type:"TextStyle",new_data:{style:null},old_data:{style:node.style.toJSON()}}))})}else tree.root.eachChild(function(node){if(node.style){var templateStyle=theme.styles.detect(function(style){return style.equals(node.style)}),equivalentStyle=null;templateStyle&&(equivalentStyle=theme.styles.detect(function(style){return style.name===templateStyle.name})),equivalentStyle&&changes.push(new TextStyleChange({idea_id:node.id,type:"TextStyle",new_data:{style:equivalentStyle.toJSON()},old_data:{style:node.style.toJSON()}}))}});tree.root.eachChild(function(node){if(node.boundary){var templateStyle=App.config.mapTheme.boundary_styles.detect(function(boundary_style){return node.boundary.style.equals(boundary_style)}),equivalentStyle=null;templateStyle&&(equivalentStyle=theme.boundary_styles.detect(function(boundary_style){return boundary_style.name===templateStyle.name})),equivalentStyle&&changes.push(new EditBoundaryChange({idea_id:node.id,type:"EditBoundary",new_data:equivalentStyle.toJSON(),old_data:node.boundary.toJSON()}))}}),ChangeList.layoutAlteringChangeset(changes),Amplitude.logEvent("change_map_theme",{theme:theme.name})},onSetTheme:function(theme){if(this.hasCustomStyles())return void canvas.checkOverrideTheme(theme);this.onDoSetTheme(theme)},checkOverrideTheme:function(theme){Dialog.confirm("<h2>"+I18n.t("js.override_theme")+"</h2><p>"+I18n.t("js.override_theme_text")+'</p><p class="hint" style="width:100%">'+I18n.t("js.you_can_undo_afterwards")+"</p>",{buttonClass:"button",okLabel:I18n.t("js.override"),cancelLabel:I18n.t("js.keep"),windowParameters:{height:120,width:400},ok:function(){this.close(),canvas.onDoSetTheme(theme,!0)},cancel:function(){this.close(),canvas.onDoSetTheme(theme)}})},applyThemeDetails:function(){var theme=App.config.mapTheme;if(theme.background.image){var themeBgUrl=theme.background.image.url;"phantomjs"===App.config.environment&&theme.background.image.url.indexOf("http")<0&&(themeBgUrl=ServerData.siteUrl+themeBgUrl),IdeaImage.downloadTokens&&(themeBgUrl+=(themeBgUrl.indexOf("?")>0?"&":"?")+IdeaImage.downloadTokens),this.el.style.backgroundImage="url("+themeBgUrl+")"}else this.el.style.backgroundImage="";theme.background.color&&""!==theme.background.color&&(this.el.style.backgroundColor="#"+theme.background.color),theme.background.repeat?this.el.style.backgroundRepeat="repeat":(this.el.style.backgroundRepeat="no-repeat",this.el.style.backgroundPosition="center center"),__WEBPACK_IMPORTED_MODULE_2__views_graphics__.VGraphics.COLOR="#"+theme.line.color},removeTheme:function(theme){this.el.removeClassName(theme.singleName()+(theme.is_template?"":theme.id)),!theme.is_template&&mm$("theme_css_"+theme.id)&&remove(mm$("theme_css_"+theme.id))},applyTheme:function(theme){if(App.config.mapTheme=theme,theme.is_template)this.loadThemeFonts(theme,this.finalizeTheme.bind(this));else{var style=mm$("theme_css_"+theme.id);style?this.loadThemeFonts(theme,this.finalizeTheme.bind(this)):(style=document.createElement("link"),style.setAttribute("id","theme_css_"+theme.id),style.setAttribute("type","text/css"),style.setAttribute("rel","stylesheet"),style.setAttribute("href","/themes/css/"+theme.id),style.setAttribute("media","screen"),document.head.appendChild(style),style.onload=this.loadThemeFonts.bind(this,theme,this.finalizeTheme.bind(this)))}return"undefined"==typeof sideBar||!sideBar||"undefined"!=typeof RevisionBrowser&&(RevisionBrowser.on||RevisionBrowser.painted)||(sideBar.styles.load(),sideBar.boundaries.load()),style},finalizeTheme:function(){if(this.el.addClassName(App.config.mapTheme.singleName()+(App.config.mapTheme.is_template?"":App.config.mapTheme.id)),this.applyThemeDetails(),tree&&!tree.notPainted)for(var children=this.root.children,i=0,len=children.length;i<len;i++)children[i].rc.redrawRootLine(),children[i].rc.redrawLines();MapTheme.closeActivity(500)},loadExternalFonts:function(callback){var externalFonts=App.config.mapTheme.externalFonts();"phantomjs"===App.config.environment&&(externalFonts=externalFonts.concat(Font.all.filter(function(f){return f.isExternal()})).uniqBy(function(font1,font2){return font1.id===font2.id})),0===externalFonts.length?callback():Font.loadExternal(externalFonts,callback)},loadThemeFonts:function(theme,callback){theme.hasExternalFonts()?Font.loadExternal(theme.externalFonts(),callback):callback()},onResize:function(){var _MM$ui$page=MM.ui.page,width=_MM$ui$page.width,height=_MM$ui$page.height;this.container.style.width=width+"px",this.container.style.height=height+"px"},centeringCoordinates:function(containerSize,nofit){var root=this.root.dcontent.el,rootPos=root.cumulativeOffset(),offset={top:App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.top,!1),right:App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.right,!1),bottom:App.ui.Zoom.transformCssZoomValue(UI.Registry.viewportOffset.bottom,!1),left:0},extraSpace=App.ui.Zoom.transformCssZoomValue(20,!1),viewableHeight=containerSize.height-offset.top-offset.bottom,viewableWidth=containerSize.width-offset.right-offset.left,mapSize=App.config.layout.mapSize(),mapWidth=mapSize.width,mapHeight=mapSize.height,rootSize=[root.offsetWidth,root.offsetHeight],transformLeft="center",transformTop="center",pos=[rootPos[0]-(containerSize.width+(offset.left-offset.right))/2+rootSize[0]/2,rootPos[1]-(containerSize.height+(offset.top-offset.bottom))/2+rootSize[1]/2];if(App.config.layout.orientation!==App.Layouts.orientation.down||nofit)if(App.config.layout.orientation!==App.Layouts.orientation.left||nofit)if(App.config.layout.orientation!==App.Layouts.orientation.right||nofit){if(mapWidth<=viewableWidth&&mapHeight<=viewableHeight&&!nofit){var size=canvas.getMapSizeAndOffset(!1);pos=[size.left-(viewableWidth-mapWidth)/2-offset.left,size.top-(viewableHeight-mapHeight)/2-offset.top]}}else pos[0]=mapWidth<=viewableWidth?rootPos[0]-(viewableWidth-mapWidth)/2:rootPos[0]-offset.left-extraSpace,transformLeft=pos[0]+extraSpace+"px";else pos[0]=mapWidth<=viewableWidth?rootPos[0]+rootSize[0]-mapWidth-(viewableWidth-mapWidth)/2:rootPos[0]-viewableWidth+rootSize[0]+extraSpace,transformLeft=pos[0]+viewableWidth+"px";else pos[1]=rootPos[1]-offset.top-extraSpace,mapHeight<=viewableHeight&&(pos[1]-=(viewableHeight-mapHeight)/2,pos[1]+=rootSize[1]/2),transformTop=pos[1]+extraSpace+"px";return{left:pos[0],top:pos[1],transformLeft:transformLeft,transformTop:transformTop}},onRecenter:function(event,smooth,nofit){var containerSize=this.getContainerSize();Position.prepare();var pos=this.centeringCoordinates(containerSize,nofit);this.scrollTo([pos.left,pos.top],smooth)},closeTemporarilyOpen:function(newSelected){if(this.tempOpen&&0!==this.tempOpen.length){var newTempOpen=[],ancestors=null;newSelected&&(ancestors=newSelected.getAncestors()),this.tempOpen.each(function(node){!ancestors||ancestors.indexOf(node)<0?node.toggleClosed(!0):newTempOpen.push(node)}),this.tempOpen=newTempOpen}},getSelectedNodes:function(){return canvas.allSelected.map(function(vNode){return vNode.node})},clearSelection:function(){this.selected=null,this.allSelected=[]},setupSelections:function(){"undefined"!=typeof Selections&&(Selections.setup("canvas"),Event.observe(this.el,"mousedown",this.onStartSelectionRectangleListener),Event.observe(this.el,"mouseup",this.onEndDragSelectionsListener))},disableSelections:function(){Event.stopObserving(this.el,"mousedown",this.onStartSelectionRectangleListener),Event.stopObserving(this.el,"mouseup",this.onEndDragSelectionsListener)},teardownSelections:function(){Selections.teardown(),this.disableSelections()},onStartSelectionRectangle:function(ev){(!ev||ev.ctrlKey||ev.metaKey)&&this.el.observe("mousemove",this.onDragSelectionRectangleListener)},onDragSelectionRectangle:function(ev){if(!this.selectionRectangle){var options={onStartDrag:this.disableScrollByDrag.bind(this),onDrag:Prototype.emptyFunction,onEndDrag:this.selectNodesFromSelectionRectangle.bind(this,ev),captureKeys:!1,displayOnInit:!0,label:!1,initialEvent:ev};this.selectionRectangle=new Selection.Base("canvas",options)}},onEndDragSelectionRectangle:function(){Event.stopObserving(this.el,"mousemove",this.onDragSelectionRectangleListener)},selectNodesFromSelectionRectangle:function(ev){canvas.enableScrollByDrag();var nodes=this.getNodesFromRectangle(new Rectangle(new Point(this.selectionRectangle.areaCoords.x1,this.selectionRectangle.areaCoords.y1),new Point(this.selectionRectangle.areaCoords.x2,this.selectionRectangle.areaCoords.y2)));if(nodes.length>0){canvas.allSelected.each(function(vnode){vnode.dcontent.toInactive(!0),vnode.image&&vnode.image.dcontainer.toInactive()}),canvas.allSelected=[];for(var i=nodes.length;i--;)nodes[i]._listener.select(ev)}this.selectionRectangle.remove(),delete this.selectionRectangle}});__webpack_exports__.default=Canvas},"i5N/":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__mediaSearch__=__webpack_require__("Z6lC"),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},VideoSearch=Class.create(__WEBPACK_IMPORTED_MODULE_0__mediaSearch__.default,{initialize:function($super,options){$super(_extends({type:"videos"},options))},query:function($super,_query,options){options=Object.extend({per_page:10},options),$super(_query,options)},queryVideoDetails:function(query,options){new Ajax.Request("/skoletube/video_title",{method:"get",parameters:{id:query},onSuccess:function(transport){var response=transport.responseText.evalJSON();response.error?Message.show(response.error,Message.ERROR):response.title?options.onComplete([{id:"",url:"",title:response.title}]):options.onComplete([])}})},transformResults:function(videos){return videos.map(function(video){var match=video.video_url.match(/(?:https?:\/\/(?:www\.)?|www\.|^).*(?:skoletube\.dk\/(?:video|e)\/)(?:(?:[\d]+\/([a-zA-Z0-9]{20}))|([a-zA-Z0-9]{20}|\d+))/),videoToken=match.last()||match[match.length-2];return{id:video.VID,url:videoToken,title:video.title}})}});__webpack_exports__.default=VideoSearch},iB8H:function(module,exports,__webpack_require__){var baseDifference=__webpack_require__("Ne51"),baseFlatten=__webpack_require__("jrlN"),baseRest=__webpack_require__("Gdal"),isArrayLikeObject=__webpack_require__("ybj2"),difference=baseRest(function(array,values){return isArrayLikeObject(array)?baseDifference(array,baseFlatten(values,1,isArrayLikeObject,!0)):[]});module.exports=difference},iXsu:function(module,__webpack_exports__,__webpack_require__){"use strict";__webpack_require__.d(__webpack_exports__,"a",function(){return stripEmojis});var __WEBPACK_IMPORTED_MODULE_0_emoji_regex__=__webpack_require__("ewQx"),__WEBPACK_IMPORTED_MODULE_0_emoji_regex___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_emoji_regex__),stripEmojis=function(){return(arguments.length>0&&void 0!==arguments[0]?arguments[0]:"").replace(__WEBPACK_IMPORTED_MODULE_0_emoji_regex___default()(),"")}},iy3A:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0_app_models_attachment__=__webpack_require__("j1ii"),__WEBPACK_IMPORTED_MODULE_1__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_popover__=__webpack_require__("aEw3"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_4_ui_core_dropboxPicker__=__webpack_require__("lfAS"),_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),AttachmentsWidget=Class.create(__WEBPACK_IMPORTED_MODULE_1__widget__.default,{initialize:function($super,sidebar,parent){$super("attachments",sidebar,parent),this.dropzone=mm$("file_dropzone"),this.list=mm$("attachment_list"),Modernizr.draganddrop?(addClassName(this.el,"droppable"),this.enableFileDrop()):hide(this.dropzone)},show:function($super,no_effect){__WEBPACK_IMPORTED_MODULE_4_ui_core_dropboxPicker__.a.init({onPick:this.onDropboxAttach.bind(this)}),$super(no_effect),this.visible&&this.buildPopover()},buildPopover:function(){var _this=this,sources=["local-file","dropbox","google-drive","evernote"];ServerData.isLoggedIn&&ServerData.user.unilogin&&sources.push("skoletube"),ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_popover__.a,{className:"h-flex-row ph-10 pt-15",onShow:function(){return App.trigger(CustomEvents.FILE_UPLOAD)},opener:React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_svgIcon__.a,{className:"tooltip",title:I18n.t("js.add_file")+"...",opts:{name:"plus",size:16,color:"blue"}})},sources.map(function(source,index){return React.createElement("div",{key:index,className:"mh-10 h-flex-column align-items-center ws-nowrap h-cp",onClick:_this.onPopoverSelect.bind(_this,source)},React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_svgIcon__.a,{className:"rad-15px h-overflow",opts:{name:"service-"+source,size:60}}),React.createElement("div",{className:"fs-13 mt-8"},I18n.t("js.from_"+source.gsub("-","_"))))})),mm$("attachments-menu-container"))},onPopoverSelect:function(source){var _this2=this;if(GeneralPopover.closeOpenPopover(),!App.hasFeature("attachments"))return void MM.ui.dialogs.dialogUpgrade("map_attachments");switch(source){case"local-file":var fileInput=new Element("input",{type:"file",multiple:"multiple"});fileInput.onchange=function(){return _this2.upload(fileInput.files,!0)},fileInput.click();break;case"google-drive":MM.ui.googlePicker.create();break;case"dropbox":__WEBPACK_IMPORTED_MODULE_4_ui_core_dropboxPicker__.a.create();break;case"evernote":MM.ui.dialogs.show("upload_evernote",{controller:"dialog",width:350,noHelp:!0});break;case"skoletube":Promise.all([__webpack_require__.e(53).then(__webpack_require__.bind(null,"PXir")),__webpack_require__.e(61).then(__webpack_require__.bind(null,"TMGa"))]).then(function(_ref){var _ref2=_slicedToArray(_ref,1),attachments=_ref2[0];_this2.skoletubeSearch=attachments.default,_this2.skoletubeSearch.init({onAttach:_this2.uploadFromUrl.bind(_this2)}),_this2.skoletubeSearch.showDialog()})}},updateListing:function(){var node=canvas.selected.node;this.list.innerHTML="",node.attachments.each(function(attachment){this.addAttachmentName(attachment)}.bind(this)),!Modernizr.draganddrop||node.attachments.length>0?hide(this.dropzone):show(this.dropzone)},reset:function(size){this.toUploadAttachments=[],this.failedAttachments=[],this.toUploadAttachmentsSize=size||0},beforeUpload:function(){_Element.visible(this.dropzone)&&hide(this.dropzone)},upload:function(files,progress,nodes){if(!App.hasFeature("attachments"))return void MM.ui.dialogs.dialogUpgrade("map_attachments");if(canvas.selected&&files&&0!==files.length){this.reset();var message="";nodes=nodes?Array.isArray(nodes)?nodes:[nodes]:canvas.getSelectedNodes(),this.beforeUpload();for(var i=0,len=files.length;i<len;i++){var file=files[i];if(progress)var progressBar=this.createProgressBar();var error=MM.utils.File.uploadAttachmentFile(nodes,file,{onProgress:this.updateProgress.bind(this,progressBar),timeoutDelay:60,onTimeOut:this.onAttachmentFailed.bind(this,nodes,file,progressBar),successCallback:this.onFileUploadSuccessful.bind(this,progressBar),errorCallback:this.onFileUploadFailed.bind(this,progressBar,file,nodes)});error&&error.error?(progressBar&&Element.remove(progressBar),message+=(message?"<br />":"")+error.error):this.toUploadAttachmentsSize++}return message&&Message.show(message,Message.ERROR),mm$("attachment_file")&&(mm$("attachment_file").value=""),this.toUploadAttachmentsSize}},uploadFromUrl:function(files){if(!canvas.selected)return void Message.show(I18n.t("js.please_select_an_idea_first"),Message.NOTICE);this.reset(files.length),files.each(function(file){var fileName=file.name+(file.extension?"."+file.extension:"");this.uploadExternalFile("generic_files/upload_from_url",file,{requestHeaders:{"X-File-Name":fileName.replace(/[^\x00-\xff]/g,"?")},parameters:{attachment_url:file.url,attachment_name:file.name,attachment_extension:file.extension}})}.bind(this))},tryAddAttachment:function(topics){this.toUploadAttachmentsSize===this.toUploadAttachments.length+this.failedAttachments.length&&(Tree.utils.addAttachments(this.toUploadAttachments,topics),this.showFailedAttachmentsMessage(),this.reset(),App.trigger(CustomEvents.ATTACHMENT_UPLOADED))},onFileUploadSuccessful:function(progressBar,file,targetTopics){this.addAttachment(targetTopics,new __WEBPACK_IMPORTED_MODULE_0_app_models_attachment__.default(file),progressBar)},onFileUploadFailed:function(progressBar,file,targetTopics){this.onAttachmentFailed(targetTopics,file,progressBar)},addAttachment:function(targetTopics,attachment,progressBar){this.changeProgressId(progressBar,attachment),this.toUploadAttachments.push(attachment),this.tryAddAttachment(targetTopics)},onAttachmentFailed:function(targetTopics,file,progressBar){progressBar&&Element.remove(progressBar),this.failedAttachments.push(file),this.tryAddAttachment(targetTopics)},showFailedAttachmentsMessage:function(){if(0!==this.failedAttachments.length){var msg="<br/>"+this.failedAttachments.map(function(file){return file.name}).join("<br/>");Message.show(I18n.t("js.the_following_files_failed_s",{v0:msg}),Message.ERROR,5)}},onAddAttachment:function(attachment){this.removeProgress(attachment),this.addAttachmentName(attachment)},addAttachmentName:function(attachment){if(canvas.selected.node.attachments.find(function(a){return a.id===attachment.id})){var el=new Element("div",{id:"attachment_"+attachment.id,className:"h-flex-row mb-5 h-hover-parent p-r"}),remove=new Element("a",{id:"remove_"+el.id,href:"#",className:"h-show-on-hover p-a ar-0",title:I18n.t("js.remove_attachment")}).insert(MM.ui.icon({name:"closer",size:12})),title=new Element("a",{href:"#",className:"ellipsis maxw-90% ml-10 c-grey-light",title:attachment.size.toHumanSize(1)}).update(attachment.filename);title.onclick=function(){return App.ui.Preview.showPopup(attachment.id,canvas.selected.node.id)},remove.onclick=function(){return canvas.selected.node.removeAttachment(attachment),!1},el.insert(MM.ui.icon({name:"file-format-"+attachment.getFileType(),size:20})),el.appendChild(title),el.appendChild(remove),this.list.appendChild(el)}},onRemoveAttachment:function(attachment){var el=mm$("attachment_"+attachment.id);el&&(Element.remove(el),0===canvas.selected.node.attachments.length&&show(this.dropzone))},createProgressBar:function(){var progressEl=new Element("progress",{min:0,max:100,value:0});return this.list.appendChild(progressEl),progressEl},changeProgressId:function(el,attachment){el&&(el.id=this.createProgressBarId(attachment))},createProgressBarId:function(attachment){return"attachment_progress_"+attachment.id},updateProgress:function(el,progress){el&&(progress-=5)>el.value&&(el.value=progress)},removeProgress:function(attachment){var progressEl=mm$(this.createProgressBarId(attachment));progressEl&&Element.remove(progressEl)},onSelectNode:function(){this.updateListing()},enableFileDrop:function(){this.el.addEventListener("dragover",function(event){event.preventDefault()},!1),this.el.addEventListener("drop",this.onFileDrop.bind(this),!1)},onFileDrop:function(event){var dataTransfer=event.dataTransfer;if(dataTransfer.files&&dataTransfer.files.length>0){var files=dataTransfer.files;this.upload(files,!0)}event.stopPropagation(),event.preventDefault()},onDropboxAttach:function(file){this.reset(1),this.uploadExternalFile("/external/dropbox/attachment",file,{parameters:{file:file.link,name:file.name}})},onGoogleDriveAttach:function(file){this.reset(1),this.uploadExternalFile("/external/drive/attachment",file,{parameters:{file_id:file.id}})},onEvernoteAttach:function(note,business){this.reset(1),this.uploadExternalFile("/external/evernote/attachment",note||business,{parameters:{guid:note.guid,business:business}})},uploadExternalFile:function(url,file,options){this.beforeUpload();var progressBar=this.createProgressBar(),nodes=canvas.getSelectedNodes(),options=Object.extend({onProgress:function(data){data.lengthComputable&&this.updateProgress(progressBar,100*data.loaded/data.total)}.bind(this),successCallback:this.onFileUploadSuccessful.bind(this,progressBar),errorCallback:this.onFileUploadFailed.bind(this,progressBar,file,nodes)},options);MM.utils.File.uploadAttachment(nodes,url,options)},onSkoletubeLogin:function(){MM.external.Skoletube.Groups&&MM.external.Skoletube.Groups.load("attachments",this.skoletubeSearch.doSearch.bind(this.skoletubeSearch))},onCancelSkoletubeLogin:function(){MM.ui.dialogs.close("skoletubelogin"),MM.ui.dialogs.close("upload_skoletube")}});__webpack_exports__.default=AttachmentsWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},izUU:function(module,exports){function noop(){}module.exports=noop},"j0/H":function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0__icon__=__webpack_require__("PlM2"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_2_lib_waypoint__=__webpack_require__("ky7I"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),IconLibrary=function(_React$Component){function IconLibrary(props){_classCallCheck(this,IconLibrary);var _this=_possibleConstructorReturn(this,(IconLibrary.__proto__||Object.getPrototypeOf(IconLibrary)).call(this,props));return _this.state={selectedIcons:[]},_this}return _inherits(IconLibrary,_React$Component),_createClass(IconLibrary,[{key:"update",value:function(newSelectedIcons){var _this2=this;this.state.selectedIcons.map(function(icon){_this2[icon.fullName()].setState({selected:!1})}),newSelectedIcons.map(function(icon){_this2[icon.fullName()].setState({selected:!0})}),this.setState({selectedIcons:newSelectedIcons})}},{key:"shouldComponentUpdate",value:function(){return!1}},{key:"render",value:function(){var _this3=this,icons=Icon.allInSection(this.props.library,this.props.section),iconNodes=icons.map(function(icon,i){return React.createElement(__WEBPACK_IMPORTED_MODULE_0__icon__.default,{ref:function(el){return _this3[icon.fullName()]=el},className:"lib_"+Icon.sectionToString(icon.library,icon.section),icon:icon,index:i,key:"iconWidgets_expanded_"+icon.id,onSelectIcon:_this3.props.onSelectIcon})});return React.createElement("div",{id:"lib_"+this.props.name},React.createElement(__WEBPACK_IMPORTED_MODULE_2_lib_waypoint__.a,{onEnter:function(_ref){var currentPosition=(_ref.previousPosition,_ref.currentPosition);_ref.event;currentPosition===__WEBPACK_IMPORTED_MODULE_2_lib_waypoint__.a.inside&&setTimeout(function(){_this3.props.onScrollTo(_this3.props.name)},50)},onLeave:function(_ref2){var currentPosition=(_ref2.previousPosition,_ref2.currentPosition);_ref2.event;currentPosition===__WEBPACK_IMPORTED_MODULE_2_lib_waypoint__.a.below&&_this3.props.onScrollTo(_this3.props.prevName)}}),React.createElement("div",{className:"mt-10 ml-18 pb-0 h-flex-row"},React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_svgIcon__.a,{className:"mr-14",opts:{name:this.props.icon,color:"grey-lighter",size:this.props.iconSize,clickable:!1}}),React.createElement("span",{className:"fw-500"},I18n.t("js.icons.library."+this.props.name))),React.createElement("grid",{className:"icon-grid grid g-7 p-10 pt-5"},iconNodes))}}]),IconLibrary}(React.Component);__webpack_exports__.default=IconLibrary}.call(__webpack_exports__,__webpack_require__("nakD"))},j1ii:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Attachment=Class.create({id:null,filename:null,url:null,contentType:null,size:null,createdAt:null,owner:null,initialize:function(data){this.id=data.id,this.filename=data.filename,this.url=data.url,this.contentType=data.contentType,this.size=data.size,this.createdAt=data.createdAt,this.owner=data.owner,Attachment.all.push(this)},equals:function(att){return this.id==att.id},isImage:function(format){return format?0===this.contentType.indexOf("image/"+format):App.config.fileTypes.image.include(this.contentType)},isSvg:function(){return 0===this.contentType.indexOf("image/svg")},isMusic:function(){return 0===this.contentType.indexOf("audio/")},isDocument:function(){return App.config.fileTypes.document.any(function(ext){return this.filename.match("."+ext+"$")}.bind(this))},isArchive:function(){return App.config.fileTypes.archive.any(function(ext){return this.filename.match("."+ext+"$")}.bind(this))},isHtml:function(){return App.config.fileTypes.html.include(this.contentType)},getFileType:function(){var mime=this.contentType;if(mime){if(/^image\/(jpeg|png|gif|bmp|svg|vnd.adobe.photoshop)/.test(mime))return"image";if(/^text\/(html|css|x-java-source|java|x-c\+\+|yaml|xul)|^application\/(javascript|json|xml|(xhtml|xslt)\+xml)/.test(mime))return"code";if(/^text\/(csv|tab)|^application\/(msword|vnd.openxmlformats\-|vnd.oasis.opendocument)/.test(mime))return"text";if(/^audio\//.test(mime))return"music";if(/^application\/(zip|x-.*zip.+|x-tar|.+-archive|.+-compressed|x-stuffitx?)/.test(mime))return"archive"}var extension=this.filename.replace(/^.+?(?:\.(\w+))?$/,"$1").toLowerCase();if(/^(png|jpe?g|gif|bmp|svg|psd|sketch|pages|jp2|jpx|jxr|webp)$/.test(extension))return"image";if(/^(htm|x?html|js|json|s?css|coffee|cson|xml|xslt?|xul|yaml|java|rb|c|cpp|h|hpp|php\d?)$/.test(extension))return"code";if(/^(txt|docx?|xlsx?|pdf|csv|tab|rtfd?|otf|ods|odg|odp|odf|md|markdown|ini|cfg)$/.test(extension))return"text";if(/^(mp3|flac|ogg|oga|m4a|aiff|wav|aac|amr|wma|mpc)$/.test(extension))return"music";if(/^(zip|tar|7z|rar|bzip2|iso|img|gz)/.test(extension))return"archive";if(mime){if(/^image\//.test(mime))return"image";if(/^text\//.test(mime))return"text"}return"generic"},isGoogleViewerSupported:function(){var extensions=["svg","eps","ps","ttf","xps","tiff","txt"],self=this,matches=extensions.any(function(ext){return self.filename.match("."+ext+"$")});return this.isImage("tif")||this.isDocument()||matches},isBoxViewerSupported:function(){var self=this;return["as","as3","asm","bat","c","cc","cmake","cpp","cs","css","csv","cxx","diff","doc","docx","erb","gdoc","groovy","gsheet","h","haml","hh","htm","html","java","js","less","m","make","ml","mm","msg","ods","odt","pdf","php","pl","properties","py","rb","rtf","sass","scala","scm","script","sh","sml","sql","txt","vi","vim","wpd","xls","xlsm","xlsx","xml","xsd","xsl","yaml","odp","ppt","pptx","ai","bmp","gif","eps","jpeg","jpg","png","ps","psd","svg","tif","tiff","dcm","dicm","dicom","svs","tga","aac","aifc","aiff","amr","au","flac","m4a","mp3","ogg","ra","wav","wma","3g2","3gp","avi","m2v","m2ts","m4v","mkv","mov","mp4","mpeg","mpg","ogg","mts","qt","wmv","flv","f4v","swf","obj","stl","fbx","3ds","dae","ply"].any(function(ext){return self.filename.match("."+ext+"$")})},downloadLink:function(){var url=this.url;return App.config.linkShare&&""!==App.config.linkShareToken&&(url+=(url.indexOf("?")>0?"&":"?")+"t="+App.config.linkShareToken),url},openAsDownload:function(){new Element("a",{href:this.downloadLink(),download:this.filename}).click()}});Attachment.all=[],Attachment.get=function(id){for(var i=Attachment.all.length;i>0;)if(Attachment.all[--i].id==id)return Attachment.all[i];return null},Attachment.dropWidget={getNode:function(element){if(!element.match)return canvas.selected.node;for(;element.parentNode&&(!element.className||!element.className.match(/(tk_label|tk_root)/));)element=element.parentNode;return element&&element.className&&element.className.match(/(tk_label|tk_root)/)?tree.root.getChild(parseInt(element.id)):canvas.selected.node},uploadImageUrl:function(target,url){MM.utils.File.uploadImage([target],{idea_image_url:url},{successCallback:function(file,targets){Tree.utils.setImage(new IdeaImage(file),targets)}})},uploadLink:function(target,url){Tree.utils.setProperty("link",url,[target]),target._listener.removeLoadingFromDrop(),sideBar&&sideBar.visible&&canvas.selected.node.id==target.id&&sideBar.links.onSelectNode()}},__webpack_exports__.default=Attachment},jMx0:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var tween=function(el,config,options){if(config){config.end=Object.extend(Object.clone(config.start),config.end);var duration=config.start[1]>config.end[1]?config.start[1]:config.end[1],start=options&&options.reverse?config.end:config.start,end=options&&options.reverse?config.start:config.end;el=$(el),el.setStyle(start[0]),setTimeout(function(){var styles=Object.extend(end[0],{transitionDuration:start[1]+"ms",transitionTimingFunction:start[2]});CSS.set(el,styles)},0),options&&options.done&&setTimeout(options.done,duration)}},animations=tween,uniqueId=__webpack_require__("5mMr"),uniqueId_default=__webpack_require__.n(uniqueId),SimpleView=Class.create({initialize:function(opts){this.opts=Object.extend(this.opts,opts),this.uniqueId=uniqueId_default()("simple-view-"),this._eventList=[],this._hotkeyList=[],this.$el=new Element("div",{class:(this.className||"")+" "+this.uniqueId}),this._bindEvents(),this._bindHotkeys()},destroy:function(opts){this._unbindEvents(),this._unbindHotkeys(),!1!==opts.destroyElement&&this.$el.remove(),this.$el=null,this.el=null,this.els=null,this.destroyed=!0},_bindEvents:function(){this.events&&Object.keys(this.events).forEach(function(key){var callbackName=this.events[key];if(!this[callbackName])return alert("Events - could not find callback "+callbackName);var handler=key.split(" "),event=handler[0],selector=handler[1];this._eventList.push(Event.on(document,event,"."+this.uniqueId+" "+selector,this[callbackName].bind(this)))}.bind(this))},_unbindEvents:function(){this._eventList.invoke("stop")},_bindHotkeys:function(){this.hotkeys&&(this.keymap&&this.keymap.disable(),Object.keys(this.hotkeys).forEach(function(key){var value=this.hotkeys[key],handler=value.split(" "),method=(handler[0],handler[1]),K=MM.utils.KeyEvent;this._hotkeyList.push({key:K[key.toUpperCase()],stopEvent:!1,fn:this[method].bind(this)})}.bind(this)),this.keymap=new MM.utils.KeyMap(document,this.uniqueId+"-keymap",this._hotkeyList))},_unbindHotkeys:function(){this.keymap.disable()}}),simpleView=SimpleView,View=Class.create(simpleView,{className:"p-a-full v-attachment-viewer",events:{"click .js-previous":"navigateLeft","click .js-next":"navigateRight","click .js-download":"downloadAttachment","click .js-open":"openAttachment","click .js-close":"close","click .js-image":"close"},hotkeys:{left:"this navigateLeft",right:"this navigateRight",esc:"this close"},animations:{overlay:{start:[{opacity:0},300,"in-out"],end:[{opacity:.9}]},content:{start:[{opacity:0},300,"easeOutExpo"],end:[{opacity:1},100]}},opts:{attachmentId:null,node:null,currentIndex:null,currentAttachment:null},els:{$content:null,$overlay:null},initialize:function($super,opts){$super(opts),this.opts.node=tree.root.getChild(this.opts.nodeId),this.getIndexAndAttachment()},getIndexAndAttachment:function(){this.opts.node.attachments.forEach(function(att,index){if(att.id===this.opts.attachmentId)return this.opts.currentIndex=index,this.opts.currentAttachment=att,!1}.bind(this))},render:function(){return this.renderOverlay(),this.renderContent(),this.hideSpinnerWhenLoaded(),this},renderOverlay:function(){this.els.$overlay=new Element("div",{class:"p-a-full bg-black js-close o-90"}),this.$el.update(this.els.$overlay)},renderContent:function(){var attachment=this.opts.currentAttachment,hasGoogleViewer=attachment.isGoogleViewerSupported(),hasBoxViewer=attachment.isBoxViewerSupported(),isImage=attachment.isImage()&&!attachment.isSvg(),rendered=new Element("div",{class:"us-none"});rendered.update(JST["app/ui/attachment_viewer/template"]({count:this.opts.node.attachments.length,index:this.opts.currentIndex,name:attachment.filename,url:attachment.downloadLink(),type:attachment.getFileType(),sizeReadable:attachment.size.toHumanSize(1),isImage:isImage,hasGoogleViewer:hasGoogleViewer,hasBoxViewer:hasBoxViewer,show_navigation:!0})),!isImage&&hasGoogleViewer?new Ajax.Request("/generic_files/get_file_token/"+attachment.id,{onSuccess:this.renderGoogleViewer.bind(this)}):!isImage&&hasBoxViewer&&new Ajax.Request("/generic_files/get_box_preview/"+attachment.id,{onSuccess:this.renderBoxViewer.bind(this)}),this.els.$content=rendered,this.$el.insert(this.els.$content)},renderGoogleViewer:function(transport){var response=transport.responseText.evalJSON();if(response.timestamp&&response.token){var attachment=this.opts.currentAttachment,full_url=encodeURIComponent(document.location.protocol+"//"+document.location.host+attachment.downloadLink()+"&key="+response.token+"&timestamp="+response.timestamp+"&filename="+attachment.filename);$(this.els.$content).select(".google-preview-container")[0].src="//docs.google.com/viewer?embedded=true&url="+full_url}},renderBoxViewer:function(transport){var response=transport.responseJSON;if(response.fileId){(new Box.Preview).show(response.fileId,ServerData.keys.box,{container:".box-preview-container",showDownload:!1,logoUrl:"https://www.meisterlabs.com/wp-content/themes/meisterlabs/images/logo-mindmeister.svg"})}},open:function(){canvas.removeFocus(),this.render(),document.body.insert(this.$el),animations(this.els.$overlay,this.animations.overlay),animations(this.els.$content,this.animations.content)},close:function(){canvas.addFocus(),animations(this.els.$overlay,this.animations.overlay,{reverse:!0}),animations(this.els.$content,this.animations.content,{reverse:!0,done:function(){this.destroy({destroyElement:!0})}.bind(this)})},hideSpinnerWhenLoaded:function(){var $img=this.$el.select("img")[0];if($img){var $spinner=this.$el.select(".loading-spinner-48")[0];Event.observeOnce($img,"load",function(){$spinner.remove()}),Event.observeOnce($img,"error",function(){$spinner.remove(),$img.addClassName("h-hidden")})}},downloadAttachment:function(){this.opts.currentAttachment.openAsDownload()},openAttachment:function(){window.open(this.opts.currentAttachment.get("url"))},navigate:function(offset){var newIndex=this.opts.currentIndex+offset,newAttachment=this.opts.node.attachments[newIndex];newAttachment&&(this.opts.currentIndex=newIndex,this.opts.currentAttachment=newAttachment,this.render())},navigateLeft:function(e){e&&e.preventDefault(),this.navigate(-1)},navigateRight:function(e){e&&e.preventDefault(),this.navigate(1)}});__webpack_exports__.default=View},jS0c:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_sectionHeader__=__webpack_require__("zISO"),__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_imageGrid_imageGrid__=__webpack_require__("+VMB"),__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_list_list__=__webpack_require__("worM"),__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_skimmableList_skimmableList__=__webpack_require__("jR5l"),__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_popover__=__webpack_require__("aEw3"),__WEBPACK_IMPORTED_MODULE_6_app_ui_header__=__webpack_require__("WGdr"),__WEBPACK_IMPORTED_MODULE_7_ui_components_generic_lazyLoadingImage__=__webpack_require__("MBgF"),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},getViewOnlyClassName=function(viewOnly){return viewOnly?" o-40":""},alignmentItem=function(layout){return{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{opts:{name:"layout-"+layout.name.replace("_","-"),size:16,consize:20,color:"blue",classes:"h-a-center",parentClasses:"p-r mr-8"}}),label:I18n.t("js.layout."+layout.name)}},renderAlignmentItems=function(_ref){var layouts=_ref.layouts,currentLayout=_ref.currentLayout,viewOnly=_ref.viewOnly,alignment=alignmentItem(currentLayout);return viewOnly||(alignment.subMenu={selectable:!0,items:layouts.map(function(layout){return _extends({},alignmentItem(layout),{onClick:__WEBPACK_IMPORTED_MODULE_6_app_ui_header__.default.changeLayout.bind(__WEBPACK_IMPORTED_MODULE_6_app_ui_header__.default,layout),selected:currentLayout===layout})})}),[alignment]},renderImportThemeButton=function(_ref2){var user=_ref2.user,viewOnly=_ref2.viewOnly;return[{icon:React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{opts:{name:"map-theme",size:20,color:"white",parentClasses:"mr-8"}}),label:I18n.t("js.import_theme")+"...",className:"to-ellipsis",onClick:function(){user.anonymous?MM.ui.dialogs.dialogLogin(user):viewOnly||MM.ui.dialogs.dialogUserMaps()}}]},renderThemeGrid=function(_ref3){var title=_ref3.title,items=_ref3.items,className=_ref3.className,header=title?{titleClassName:"c-grey fs-12 fw-100",title:title,className:"ml-5"}:null;return React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_generic_imageGrid_imageGrid__.a,{header:header,className:"w-220 ml-15 mt-10 map-themes image-grid-widget "+className,elementsInRow:3,items:items,tooltips:!0})},renderThemeItems=function(_ref4){var themes=_ref4.themes,viewOnly=_ref4.viewOnly;return themes.map(function(theme){var onClick=void 0,title=void 0;return viewOnly?(onClick=function(){},title=I18n.t("js.you_are_in_view_only_mode")):(onClick=function(){return canvas.onSetTheme(theme)},title=theme.displayName()),{element:React.createElement(__WEBPACK_IMPORTED_MODULE_7_ui_components_generic_lazyLoadingImage__.a,{width:"66",height:"66",className:"bg-grey4 rad-5px",image:theme.thumbnail_asset_url,placeholder:React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{opts:{name:"layout-right-aligned",parentClasses:"h-a-center",color:"grey-light",size:32}})}),title:title,onClick:onClick}})},renderThemeList=function(_ref5){var user=_ref5.user,teamTemplates=_ref5.teamTemplates,templates=_ref5.templates,viewOnly=_ref5.viewOnly,viewOnlyClassName=getViewOnlyClassName(viewOnly),teamThemeItems=renderThemeItems({themes:teamTemplates,viewOnly:viewOnly}),templateThemes=renderThemeGrid({title:teamThemeItems.length>0?I18n.t("js.default"):null,items:renderThemeItems({themes:templates,viewOnly:viewOnly}),className:viewOnlyClassName}),teamThemes=teamThemeItems.length>0?renderThemeGrid({title:I18n.t("js.saved"),items:teamThemeItems,className:"mt-10"+viewOnlyClassName}):React.createElement("div",null);return React.createElement("div",{style:{position:"relative",overflowY:"auto",maxHeight:240}},templateThemes,teamThemes,React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_list_list__.a,{className:"mt-20"+viewOnlyClassName,items:renderImportThemeButton({user:user,viewOnly:viewOnly})}))},openCustomizeThemeDialog=function(_ref6){var event=_ref6.event,viewOnly=_ref6.viewOnly;event.preventDefault(),viewOnly||(event.nativeEvent.closePopover=!0,MM.ui.dialogs.dialogCustomizeTheme({themeId:App.config.mapTheme.id}))},renderCustomizeThemeButton=function(_ref7){var isExternal=_ref7.isExternal,viewOnly=_ref7.viewOnly;return isExternal?null:React.createElement("a",{href:"#",className:"fs-12"+(viewOnly?" disabled":""),onClick:function(event){return openCustomizeThemeDialog({event:event,viewOnly:viewOnly})}},I18n.t("js.customize")+"...")},Component=function(props){var user=props.user,layouts=props.layouts,currentLayout=props.currentLayout,teamTemplates=props.teamTemplates,templates=props.templates,isExternal=props.isExternal,viewOnly=props.viewOnly;return React.createElement(__WEBPACK_IMPORTED_MODULE_5_ui_components_generic_popover__.a,{position:"bottom",canAutoPosition:!1,className:"sections bg-white w-260",opener:React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{id:"btn_properties",opts:{name:"information",size:12,consize:22,color:"white",parentClasses:"rad-100 b-1 bc-white"}})},React.createElement(__WEBPACK_IMPORTED_MODULE_4_ui_components_generic_skimmableList_skimmableList__.a,null,React.createElement(__WEBPACK_IMPORTED_MODULE_3_ui_components_generic_list_list__.a,{header:{title:I18n.t("js.alignment")},items:renderAlignmentItems({layouts:layouts,currentLayout:currentLayout,viewOnly:viewOnly}),className:"mt-10"+getViewOnlyClassName(viewOnly)}),React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_sectionHeader__.a,{title:I18n.t("js.themes"),className:"ph-20 mt-10",elementRight:renderCustomizeThemeButton({isExternal:isExternal,viewOnly:viewOnly})}),renderThemeList({user:user,teamTemplates:teamTemplates,templates:templates,viewOnly:viewOnly})))};__webpack_exports__.a=Component}).call(__webpack_exports__,__webpack_require__("nakD"))},jmhn:function(module,exports,__webpack_require__){var getNative=__webpack_require__("7jJu"),defineProperty=function(){try{var func=getNative(Object,"defineProperty");return func({},"",{}),func}catch(e){}}();module.exports=defineProperty},jmxU:function(module,__webpack_exports__,__webpack_require__){"use strict";function _objectWithoutProperties(obj,keys){var target={};for(var i in obj)keys.indexOf(i)>=0||Object.prototype.hasOwnProperty.call(obj,i)&&(target[i]=obj[i]);return target}Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__poller__=__webpack_require__("ahzF"),__WEBPACK_IMPORTED_MODULE_1__chatModel__=__webpack_require__("9Oqg"),__WEBPACK_IMPORTED_MODULE_2__buffer__=__webpack_require__("1cfn"),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj},IgnorableRequests=["/maps/undo_redo_status","/maps/poll","/maps/save_map_preferences","/maps/auto_note","/maps/toggle_closed","/maps/set_task_notify","/maps/paste_as_map","/maps/clone_revision","/external/drive/update","external/drive/sync"],SilentRequests=["/maps/get_tree"],Request=Class.create({id:null,url:null,data:null,response:null,responseHeaders:null,revision:null,timestamp:null,_customHandler:null,initialize:function(url,data,handler){this.id=Request.id++,this.url=url,this.data=data,this._customHandler=handler,this.responseHeaders="",this.timestamp=(new Date).toString()},handleResponse:function(response){this.response=response;try{var json=response.evalJSON()}catch(e){this.handleAjaxException(null,"Bad response ("+e.message+")")}if("object"!=(void 0===json?"undefined":_typeof(json))&&this.handleAjaxException(null,"Bad response"),json.revision&&(tree.revision=json.revision),void 0!==App.config.handleServerResponseRemote&&App.config.handleServerResponseRemote(json),json.error&&1==json.error.code&&(this.silentError()?Message.show(json.error.message,Message.ERROR):window.location="/"),this._customHandler)try{this._customHandler(json)}catch(exception){MM.error.reportMapException({exception:exception,message:"Exception handling response"})}},handleAjaxException:function(exception,message){if("localhost:3000"===document.location.host)throw exception;this.ignorable()||MM.error.reportMapException({exception:exception,message:message})},ignorable:function(){var self=this;return IgnorableRequests.any(function(u){return u==self.url})},silentError:function(){var self=this;return SilentRequests.any(function(u){return self.url.indexOf(u)>-1})},saveResponseDelay:function(){this.responseDelay=(new Date-new Date(this.timestamp))/1e3},toString:function(){return"Id: "+this.id+"\nUrl: "+this.url+"\nRevision: "+this.revision+"\nTimestamp: "+this.timestamp+"\nResponse delay: "+this.responseDelay+"\nData: "+Object.toJSON(this.data)+"\nResponse: "+this.response},setResponseHeaders:function(respHeaders){this.responseHeaders=respHeaders}});Request.id=0;var DoRequest=Class.create(Request,{changesets:null,append:function(changesets){this.changesets=this.changesets.concat(changesets);for(var json=[],i=0;i<changesets.length;i++)json[i]=changesets[i].toJSON();this.data.changelists=this.data.changelists.concat(json)},remove:function(changeset){var position=this.changesets.remove(changeset);this.data.changelists.splice(position,1)},countDos:function(){for(var count=0,i=0;i<this.data.changelists.length;i++)for(var changes=this.data.changelists[i],j=0;j<changes.length;j++)"NonPersistentReposition"!=changes[j].type&&(count+=1);return count}}),ServerConnection={protocolVersion:1,timeoutDelay:120,requestQueue:new __WEBPACK_IMPORTED_MODULE_2__buffer__.default,pendingCode:null,lastRequestTime:0,req_data:null,repeatedQueue:0,initialize:function(){this._onRequestSuccess=this.requestSuccess.bind(this),this._onRequestFailure=this.requestFailure.bind(this),this._onRequestException=this.requestException.bind(this),this._onRequestTimeout=this.requestTimeout.bind(this)},registerPendingCode:function(aFunction){this.isPending()?this.pendingCode=aFunction:aFunction()},_preRequest:function(request){App.busy(!0),App.requestLog&&App.requestLog.add(request),"/maps/do"===request.url&&(this.lastRequestTime=new Date)},_postRequest:function(){ServerConnection.requestQueue.shift(),App.busy(!1),ServerConnection.processQueue()},requestSuccess:function(transport){var r=this.requestQueue.first();if(r.saveResponseDelay(),0==transport.status)return this.requestTimeout(transport,"requestSuccess");ServerConnection.networkProblem&&(ServerConnection.networkProblem=!1,ServerConnection.wasEditMode&&(ServerConnection.wasEditMode=!1,App.toEditMode()),Message.hide()),ServerConnection.repeatedQueue=0,transport.responseText&&r.handleResponse(transport.responseText),r.setResponseHeaders(transport.getAllResponseHeaders()),this._postRequest(),ServerConnection.pendingCode&&(ServerConnection.pendingCode(),ServerConnection.pendingCode=null)},requestFailure:function(transport){if(this.requestQueue.first().saveResponseDelay(),408===transport.status||transport.status>12e3)return this.requestTimeout(transport,"requestFailure");if(this.requestQueue.first().ignorable())return this._postRequest();var url="",body="";void 0!==transport.request&&transport.request&&transport.request&&(url=transport.request.url,body=transport.request.body);var details={url:url,body:body,statusText:transport.status,responseText:transport.responseText};MM.error.reportMapException({message:"AJAX Request failure",details:details})},requestException:function(request,exception){if(this.requestQueue.first().saveResponseDelay(),this.requestQueue.first().ignorable())return this._postRequest();var transport=request.transport,url="",body="";void 0!==transport.request&&transport.request&&transport.request&&(url=transport.request.url,body=transport.request.body);var details={url:url,body:body,statusText:transport.status,responseText:transport.responseText};MM.error.reportMapException({exception:exception,message:"AJAX Request failure",details:details})},requestTimeout:function(transport,source){if(source||(source="requestTimeout"),!this._leavingPage){var self=this;this.requestQueue.first().saveResponseDelay(),ServerConnection.repeatedQueue>=3&&ServerConnection.networkIssues(),setTimeout(function(){ServerConnection.repeatedQueue++,self.processQueue()},1e4)}},initRequest:function(request){if(!App.config.persistent&&!App.config.liveUpdate)return this._postRequest();request.revision=tree.revision,this._preRequest(request),this.req_data={root:tree.root.id,rev:tree.revision,request_id:request.id,protocolVersion:ServerConnection.protocolVersion,data:Object.toJSON(request.data)},new Ajax.Request(request.url,{requestHeaders:{Accept:"application/json"},parameters:this.req_data,timeoutDelay:ServerConnection.timeoutDelay,onTimeOut:ServerConnection._onRequestTimeout,onSuccess:ServerConnection._onRequestSuccess,onFailure:ServerConnection._onRequestFailure,onException:ServerConnection._onRequestException})},processQueue:function(){this.isPending()&&setTimeout(function(){this.initRequest(this.requestQueue.first())}.bind(this),10)},queueRequest:function(request,highPriority){highPriority?this.requestQueue.unshift(request):this.requestQueue.add(request)},queueAndProcess:function(request){this.queueRequest(request),1===this.requestQueue.size()&&this.processQueue()},allQueuedDoRequests:function(){for(var requests=this.requestQueue.toArray(),doRequests=[],i=0,length=requests.length;i<length;i++)requests[i].constructor==DoRequest&&doRequests.push(requests[i]);return doRequests},allImportantQueued:function(type){for(var requests=this.allQueuedDoRequests(),changes=[],i=0,len=requests.length;i<len;i++)for(var changelists=requests[i].data.changelists,j=0,len2=changelists.length;j<len2;j++)changelists[j].each(function(change){change.type===type&&changes.push(change)});return changes},queuedDoRequest:function(){for(var requests=this.requestQueue.toArray(),i=1,length=requests.length;i<length;i++)if(requests[i].constructor==DoRequest)return requests[i];return null},isPending:function(){return!this.requestQueue.empty()},canQueueDoRequests:function(){var pending=this.requestQueue.first(),longTimeInQueue=!1;pending&&(longTimeInQueue=parseInt((new Date-new Date(pending.timestamp))/1e3)>60);var queuedDoRequest=this.queuedDoRequest(),numberOfChanges=queuedDoRequest?queuedDoRequest.countDos():0;return!ServerConnection.networkProblem&&!longTimeInQueue&&numberOfChanges<10},networkIssues:function(){Message.show(I18n.t("js.network_error",{v0:'<a href="#" onclick="MM.diagnostics.runDiagnostic(); return false">',v1:"</a>"}),Message.ERROR,-1),ServerConnection.networkProblem=!0,App.config.editable&&(ServerConnection.wasEditMode=!0,App.toViewMode())},fixQueuedChangesIds:function(oldId,newId){for(var requests=this.requestQueue.toArray(),changes=[],i=1,length=requests.length;i<length;i++)if(requests[i].data){var requestChanges=requests[i].data.changes||(requests[i].data.changelists?requests[i].data.changelists.flatten():null);requestChanges&&(changes=changes.concat(requestChanges))}for(var i=0,length=changes.length;i<length;i++){var change=changes[i];change.idea_id==oldId&&(change.idea_id=newId),change.new_data&&change.new_data.parent==oldId&&(change.new_data.parent=newId),change.new_data&&change.new_data.from_id==oldId&&(change.new_data.from_id=newId),change.new_data&&change.new_data.to_id==oldId&&(change.new_data.to_id=newId),change.old_data&&change.old_data.from_id==oldId&&(change.old_data.from_id=newId),change.old_data&&change.old_data.to_id==oldId&&(change.old_data.to_id=newId)}},setPreference:function(key,value){var data={key:key,value:value};this.queueAndProcess(new Request("/maps/save_map_preferences",data,null))},syncUndoRedo:function(){this.queueAndProcess(new Request("/maps/undo_redo_status",null,this.handleSyncUndoRedo))},handleSyncUndoRedo:function(response){response.hasUndo?MM.ui.enableButton("btn_undo"):MM.ui.disableButton("btn_undo"),response.hasRedo?MM.ui.enableButton("btn_redo"):MM.ui.disableButton("btn_redo")},poll:function(){if(!ServerConnection.isPending()){var param={};switch(mapView.hasMapFeature("selection")&&(param={idea_id:mapView.selected&&mapView.selected.node.id>0?mapView.selected.node.id:null,timestamp:this.timestamp}),App.config.shareMode){case App.SINGLE:if(!App.config.liveUpdate)return;param.with_data=!0,param.liveUpdate=!0,App.config.linkShare&&""!==App.config.linkShareToken&&(param.t=App.config.linkShareToken);break;case App.SHARED:break;case App.MULTI:if("undefined"!=typeof RevisionBrowser&&RevisionBrowser.on)return;"player"!==MM.utils.siteLocation.getLoc()&&(param.with_data=!0);break;default:return}if(!(param.with_data&&Math.round((new Date-this.lastRequestTime)/1e3)<5)){if("slideshow"===MM.utils.siteLocation.getLoc()&&(param.with_slides=1),"player"===MM.utils.siteLocation.getLoc()&&Presentation.on&&Presentation.presenter){var params=MM.utils.Url.getHashParams();if(params.hasOwnProperty("step")){var step=params.step;param.presentation_step=parseInt(step)}}this.queueAndProcess(new Request("/maps/poll",param,this.handlePoll))}}},handlePoll:function(response){if(response.error)2===response.error.code?App.toSingleMode():4===response.error.code&&MM.utils.reloadPage();else{if(response.current_users&&users&&users.updateAfterPoll(response),response.changes&&response.changes.length>0&&(__WEBPACK_IMPORTED_MODULE_0__poller__.default.resetInterval(),ServerConnection._checkQueuedChanges(function(){ChangeList.executeServerChanges(response.changes)})),users&&users.updateUserSelection(),!mapView.hasMapFeature("presentation")||!response.slides||void 0===App.ui.SlideShow||"undefined"!=typeof Presentation&&Presentation.on||App.ui.SlideShow.updateSlides(response.slides,response.updated_slides),response.drive_data&&(App.config.driveId=response.drive_data.gid,App.config.driveRevision=response.drive_data.drive_revision),response.chat&&response.chat.messages.map(function(message){__WEBPACK_IMPORTED_MODULE_1__chatModel__.default.receive(message)}),response.sharing){var _response$sharing$lin=response.sharing.link,linkShare=_response$sharing$lin.linkShare,url=_response$sharing$lin.url,token=_response$sharing$lin.token;App.changeLinkSharing(linkShare,url,token)}response.external_tasks&&response.external_tasks.each(function(externalTask){var idea_id=externalTask.idea_id,task=_objectWithoutProperties(externalTask,["idea_id"]),node=tree.root.getChild(idea_id);node&&node.__onSetProperty("externalTask",task)}),ServerConnection.timestamp=response.timestamp}App.config.previousVisit=new Date},doChange:function(change){var changeList=new ChangeList;changeList.changes.push(change),this.doChanges(changeList)},doChanges:function(changelist){this.doChangelists([changelist])},doChangelists:function(changelists){__WEBPACK_IMPORTED_MODULE_0__poller__.default.resetInterval(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(changelists.push(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null);var queuedDoRequest,json=[];if(queuedDoRequest=this.queuedDoRequest())return queuedDoRequest.append(changelists);for(var i=0;i<changelists.length;i++)json[i]=changelists[i].toJSON();var params={changelists:json};mapView.hasMapFeature("selection")&&mapView.selected&&(params=Object.extend(params,{idea_id:mapView.selected.node.id}));var request=new DoRequest("/maps/do",params,this.handleDoChanges.bind(this));request.changesets=changelists,this.queueAndProcess(request)},handleDoChanges:function(response){response.revision&&(tree.revision=response.revision),this._checkQueuedChanges(function(){var request=ServerConnection.requestQueue.first(),currentChangesets=request.changesets,undoneChanges=[];if(response.changes&&response.changes.length>0&&(response.changes.each(function(incomingChange){currentChangesets.each(function(changeset){changeset.changes.each(function(change){incomingChange.idea_id===change.change.idea_id&&undoneChanges.push(change)})})}),undoneChanges.each(function(change){change.undo("temporary")}),ChangeList.executeServerChanges(response.changes)),!response.error||10!==response.error.code&&11!==response.error.code){if(undoneChanges.each(function(change){change.redo()}),response.changelists){for(var i=0,len=currentChangesets.length;i<len;i++)response.changelists[i].error&&(currentChangesets[i].undo(),10===response.changelists[i].error.code&&Message.show(response.changelists[i].error.message,Message.ERROR)),currentChangesets[i].handleResponse(response.changelists[i]);App.config.shareMode!==App.MULTI&&0!==request.countDos()&&(MM.ui.enableButton("btn_undo"),MM.ui.disableButton("btn_redo"))}}else 10===response.error.code&&Message.show(response.error.message,Message.ERROR)})},_checkQueuedChanges:function(callback){for(var queuedDoRequest=this.queuedDoRequest(),queuedChangesets=queuedDoRequest?queuedDoRequest.changesets:[],i=queuedChangesets.length-1;i>=0;i--)queuedChangesets[i].undo("temporary");callback();for(var i=0;i<queuedChangesets.length;i++)try{queuedChangesets[i].redo()||queuedDoRequest.remove(queuedChangesets[i])}catch(e){queuedDoRequest.remove(queuedChangesets[i])}ChangeList.autoLayoutChangeset()},copyExternal:function(destination_id,nodesIds){nodesIds.each(function(id){this.queueAndProcess(new Request("/maps/get_tree/"+id,null,this.handleCopyExternal.bind(this,destination_id)))}.bind(this))},handleCopyExternal:function(destination_id,response){response.changes?setTimeout(function(){Tree.utils.copyNodesExternal(tree.root.getChild(destination_id),response.changes)},10):response.error&&Message.show(response.error.message,Message.ERROR)},pasteAsMap:function(idea,insertLink,preservePermissions,insertBackLink){for(var changeList=new ChangeList,i=0,len=idea.children.length;i<len;i++){var child=idea.children[i];changeList.changes.push(new RemoveChange({idea_id:child.id,type:"Delete",new_data:{pos:child.pos}}))}var options="?preserve_permissions="+!!preservePermissions+"&insert_back_link="+!!insertBackLink;this.queueAndProcess(new Request("/maps/paste_as_map/"+idea.id+options,{},this.handlePasteAsMap.bind(this,changeList,insertLink,idea)))},handlePasteAsMap:function(chL,insertLink,idea,response){if(response.error)Message.show(response.error.message,Message.ERROR);else if(response.location)window.location.href=response.location;else if(response.root_id){if(insertLink){var link="topic:"+response.root_id;chL.changes.push(Tree.utils.setPropertyChange("link",link,idea)),Tree.utils.setLinkedMapPreview([idea],link)}tree.notPainted=!0,chL.changes.each(function(_change,index){index===chL.changes.length-1&&(tree.notPainted=!1),_change.executeLocally()}),ServerConnection.doChanges(chL)}},toggleClosed:function(data){ChangeList.lastElasticChangeset&&(data.changes=ChangeList.lastElasticChangeset.toJSON(),ChangeList.lastElasticChangeset=null),this.queueAndProcess(new Request("/maps/toggle_closed",data,null))},undo:function(){this.queueAndProcess(new Request("/maps/undo",{},this.handleUndo.bind(this)))},handleUndo:function(response){if(response.error)switch(response.error.code){case 3:App.toMultiMode();break;case 10:Message.show(response.error.message,Message.ERROR),MM.ui.disableButton("btn_undo")}else App.config.shareMode!==App.MULTI&&(response.hasUndo?MM.ui.enableButton("btn_undo"):MM.ui.disableButton("btn_undo"),MM.ui.enableButton("btn_redo"),ChangeList.executeServerChanges(response.changes),ChangeList.autoLayoutChangeset(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(this.doChanges(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null))},redo:function(){this.queueAndProcess(new Request("/maps/redo",{},this.handleRedo.bind(this)))},handleRedo:function(response){if(response.error)switch(response.error.code){case 3:App.toMultiMode();break;case 10:Message.show(response.error.message,Message.ERROR),MM.ui.disableButton("btn_redo")}else App.config.shareMode!==App.MULTI&&(response.hasRedo?MM.ui.enableButton("btn_redo"):MM.ui.disableButton("btn_redo"),MM.ui.enableButton("btn_undo"),ChangeList.executeServerChanges(response.changes),ChangeList.autoLayoutChangeset(),ChangeList.lastElasticChangeset&&ChangeList.lastElasticChangeset.changes.length>0&&(this.doChanges(ChangeList.lastElasticChangeset),ChangeList.lastElasticChangeset=null))},historyRevert:function(revision){this.queueAndProcess(new Request("/maps/revert",{revision:revision},this.handleHistoryRevert))},handleHistoryRevert:function(response){response.error?10==response.error.code&&Message.show(response.error.message,Message.ERROR):(MM.ui.disableButton("btn_redo"),"undefined"!=typeof RevisionBrowser&&RevisionBrowser&&RevisionBrowser.revision===response.revision||ChangeList.executeServerChanges(response.changes),"undefined"!=typeof sideBar&&sideBar&&response.changes.filter(function(change){return"MapTheme"===change.type}).length>0&&(sideBar.styles.load(),sideBar.boundaries.load()),RevisionBrowser.changes=null)},cloneRevision:function(revision){this.queueAndProcess(new Request("/maps/clone_revision",{revision:revision}))},autoNote:function(data,callback){this.queueAndProcess(new Request("/maps/auto_note",data,callback))},setTaskNotify:function(idea_id,value){this.queueAndProcess(new Request("/maps/set_task_notify",{idea_id:idea_id,value:value},this.handleTaskNotify))},handleTaskNotify:function(response){response.error&&Message.show(response.error.message,Message.ERROR)},other:{saveExternalChanges:function(callback){new Ajax.Request("/external/save",{asynchronous:!0,parameters:{map_id:App.config.map_id,api_key:App.config.api_key},onSuccess:function(transport){var response=transport.responseText.evalJSON();Message.show(I18n.t("js.external_save_successful"),Message.INFO),App.config.externalMapRevision=response.map.revision},onFailure:function(transport){var response=transport.responseText.evalJSON(),message=response.message||I18n.t("js.external_save_failed");Message.show(message,Message.ERROR)},onComplete:function(){callback&&callback()}})},saveBoxFile:function(resourceId){new Ajax.Request("/external/box/save/"+resourceId,{asynchronous:!0,onSuccess:function(transport){var response=transport.responseText.evalJSON();response.error?Message.show(response.error,Message.ERROR):(Message.show(I18n.t("js.external_save_successful"),Message.INFO),App.config.externalMapRevision=response.map.revision)},onFailure:function(transport){var response=transport.responseText.evalJSON(),message=response.message||I18n.t("js.external_save_failed");Message.show(message,Message.ERROR)}})},saveExternalMap:function(){!ServerData.isLoggedIn||ServerData.user.isAnonymous?MM.utils.redirectToLogin():Message.show("The map is saved to your account.",Message.NOTICE)},cloneMap:function(map_id){new Ajax.Request("/maps/clone_map/"+map_id,{asynchronous:!0,onSuccess:function(transport){var resp=transport.responseText.evalJSON();resp.error?Message.show(resp.error.message,Message.ERROR):resp.location?window.location.href=resp.location:Message.show(resp.message,Message.INFO)}})},getMapDiff:function(id,params,callback){new Ajax.Request("/maps/get_map_diff/"+id,{parameters:params,onSuccess:function(transport){try{callback(transport.responseText.evalJSON().changes)}catch(exception){MM.error.reportException({exception:exception,message:"History changes initialization failed",details:{params:params}})}}})}}};ServerConnection.initialize(),ServerConnection.uncommittedChanges=function(){var inserts=ServerConnection.allImportantQueued("Insert"),notes=ServerConnection.allImportantQueued("Note"),textarea='<textarea style="width: 100%;" rows="11" cols="48" readonly="readonly">'+(inserts.length>0?I18n.t("js.new_topics")+":\n----------------\n"+inserts.map(function(insert){return insert.new_data.title}).join("\n")+"\n\n":"")+(notes.length>0?I18n.t("js.new_notes")+":\n----------------\n"+notes.map(function(note){return note.new_data.note}).join("\n"):"")+"\n\n</textarea>";(inserts.length>0||notes.length>0)&&Dialog.alert("<div><h2>"+I18n.t("js.error_committing_changes")+'</h2><p class="warning small text subtle">'+I18n.t("js.error_committing_changes_text")+'</p></div><div style="margin-top: 20px;">'+textarea+"</div>",{okLabel:I18n.t("js.close"),buttonClass:"button default",windowParameters:{width:480,height:400}})},window.onbeforeunload=function(){return"undefined"!=typeof ChangeList&&ServerConnection.isPending()&&ServerConnection.queuedDoRequest()&&!ServerConnection.forcedPageReload?(setTimeout(ServerConnection.uncommittedChanges,1e3),I18n.t("js.confirm_leave_page")+" "+I18n.t("js.confirm_leave_page_extra")):"external"===App.config.viewMode&&tree.revision!==App.config.externalMapRevision?I18n.t("js.confirm_leave_page_for_external"):App.googleDrive()&&App.config.driveRevision<tree.revision?I18n.t("js.confirm_leave_page_for_gdrive"):("undefined"!=typeof Presentation&&Presentation.on&&Presentation.presenter&&Presentation.togglePresenter(!0),void(ServerConnection._leavingPage=!0))},window.IgnorableRequests=IgnorableRequests,window.SilentRequests=SilentRequests,window.DoRequest=DoRequest,window.ServerConnection=ServerConnection},jrlN:function(module,exports,__webpack_require__){function baseFlatten(array,depth,predicate,isStrict,result){var index=-1,length=array.length;for(predicate||(predicate=isFlattenable),result||(result=[]);++index<length;){var value=array[index];depth>0&&predicate(value)?depth>1?baseFlatten(value,depth-1,predicate,isStrict,result):arrayPush(result,value):isStrict||(result[result.length]=value)}return result}var arrayPush=__webpack_require__("15Wi"),isFlattenable=__webpack_require__("rOv1");module.exports=baseFlatten},koC0:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var raphael=__webpack_require__("pTO5"),raphael_default=__webpack_require__.n(raphael),canvas=__webpack_require__("gp2O"),customEvents=(__webpack_require__("TEdV"),__webpack_require__("GgL9"),__webpack_require__("vQBY"),__webpack_require__("/t6o"),__webpack_require__("62Jj"),__webpack_require__("xUHV")),SelDraggable=Class.create(Draggable,{initialize:function(element){this.options=Object.extend({drawMethod:function(){}},arguments[1]||{}),this.element=$(element),this.handle=this.element,this.delta=this.currentDelta(),this.dragging=!1,this.eventMouseDown=this.initDrag.bindAsEventListener(this),Event.observe(this.handle,"mousedown",this.eventMouseDown),Draggables.register(this)},draw:function(point){var pos=Element.cumulativeOffset(this.element),d=this.currentDelta();pos[0]-=d[0],pos[1]-=d[1];var p=[0,1].map(function(i){return point[i]-pos[i]-this.offset[i]}.bind(this));this.options.drawMethod(p)}}),Selections={all:[],prefix:"sel_",setup:function(canvas){this.canvas=$(canvas);var insertPoint=this.canvas.parentNode;this.canvasWrap=new Element("div",{class:this.prefix+"wrap"}),this.canvasWrap.appendChild(this.canvas),insertPoint.appendChild(this.canvasWrap)},teardown:function(){void 0!==this.canvasWrap&&(this.canvasWrap.parentNode.insertBefore(this.canvas,this.canvasWrap),this.canvasWrap.parentNode.removeChild(this.canvasWrap),this.all.each(function(selection){selection.removeObservers(),selection.remove()}))},add:function(obj){this.all.push(obj)},remove:function(obj){this.all=this.all.reject(function(d){return d==obj})}},Selection={};Selection.Base=Class.create({initialize:function(element,options){if(this.options=Object.extend({ratioDim:{x:0,y:0},minWidth:0,minHeight:0,displayOnInit:!1,onStartDrag:Prototype.emptyFunction,onEndDrag:Prototype.emptyFunction,onUpdate:Prototype.emptyFunction,onRemove:Prototype.emptyFunction,captureKeys:!0,initialEvent:null,listener:null,allowMultiple:!0,useEffect:!1,onloadCoords:null,maxWidth:0,maxHeight:0,resize:!0,label:!0},options||{}),this.canvas=$(element),this.clickCoords={x:0,y:0},this.dragging=!1,this.resizing=!1,this.isWebKit=/Konqueror|Safari|KHTML/.test(navigator.userAgent),this.isIE=/MSIE/.test(navigator.userAgent),this.ratioX=0,this.ratioY=0,this.attached=!1,this.fixedWidth=this.options.maxWidth>0&&this.options.minWidth>=this.options.maxWidth,this.fixedHeight=this.options.maxHeight>0&&this.options.minHeight>=this.options.maxHeight,void 0!==this.canvas){if(this.options.ratioDim.x>0&&this.options.ratioDim.y>0){var gcd=this.getGCD(this.options.ratioDim.x,this.options.ratioDim.y);this.ratioX=this.options.ratioDim.x/gcd,this.ratioY=this.options.ratioDim.y/gcd}Selections.add(this),this.subInitialize(),this.onLoad(),this.removeObservers()}},getGCD:function(a,b){return 0===b?a:this.getGCD(b,a%b)},onLoad:function(){var cNamePrefix=Selections.prefix;this.canvasWrap=Selections.canvasWrap,this.north=new Element("div",{class:cNamePrefix+"overlay "+cNamePrefix+"north"}).insert(new Element("span")),this.east=new Element("div",{class:cNamePrefix+"overlay "+cNamePrefix+"east"}).insert(new Element("span")),this.south=new Element("div",{class:cNamePrefix+"overlay "+cNamePrefix+"south"}).insert(new Element("span")),this.west=new Element("div",{class:cNamePrefix+"overlay "+cNamePrefix+"west"}).insert(new Element("span"));var overlays=[this.north,this.east,this.south,this.west];this.dragArea=this.canvas,overlays.each(function(o){this.dragArea.insert(o)},this),this.options.resize&&(this.handleN=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleN"}),this.handleNE=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleNE"}),this.handleE=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleE"}),this.handleSE=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleSE"}),this.handleS=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleS"}),this.handleSW=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleSW"}),this.handleW=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleW"}),this.handleNW=new Element("div",{class:cNamePrefix+"handle "+cNamePrefix+"handleNW"})),this.selArea=new Element("div",{class:cNamePrefix+"selArea",style:"display:none"}),this.options.resize&&[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW].each(function(o){this.selArea.insert(o)},this),this.options.label&&(this.label=new Element("div",{class:cNamePrefix+"label"}),this.selArea.insert(new Element("div",{class:cNamePrefix+"innerArea"}).insert(this.label))),this.dragArea.appendChild(this.selArea),this.startDragBind=this.startDrag.bindAsEventListener(this),this.onDragBind=this.onDrag.bindAsEventListener(this),this.endDragBind=this.endDrag.bindAsEventListener(this),this.options.resize&&(this.resizeBind=this.startResize.bindAsEventListener(this)),this.keysBind=this.handleKeys.bindAsEventListener(this),this.stopEventBind=this.stopEvent.bindAsEventListener(this),Event.observe(this.selArea,"dblclick",this.stopEventBind),this.options.resize&&(this.handles=[this.handleN,this.handleNE,this.handleE,this.handleSE,this.handleS,this.handleSW,this.handleW,this.handleNW]),this.addObservers(),this.setParams(),this.options.initialEvent&&this.startDrag(this.options.initialEvent),this.visible=!0},addObservers:function(){this.observersActive||(this.observersActive=!0,this.options.initialEvent||this.options.displayOnInit||Event.observe(this.dragArea,"mousedown",this.startDragBind),this.options.captureKeys&&Event.observe(document,"keydown",this.keysBind),this.options.allowMultiple&&this.selectBind&&Event.stopObserving(this.selArea,"mousedown",this.selectBind),this.options.resize&&this.registerHandles(!0),new SelDraggable(this.selArea,{onDrag:this.onDragSelection.bind(this),onEnd:this.onEndDragSelection.bind(this),drawMethod:this.moveArea.bindAsEventListener(this)}))},removeObservers:function(){this.observersActive&&(this.observersActive=!1,this.options.initialEvent||this.options.displayOnInit||Event.stopObserving(this.dragArea,"mousedown",this.startDragBind),this.options.captureKeys&&Event.stopObserving(document,"keypress",this.keysBind),this.options.allowMultiple&&(this.selectBind=this.select.bindAsEventListener(this),Event.observe(this.selArea,"mousedown",this.selectBind)),this.options.resize&&this.registerHandles(!1))},registerHandles:function(registration){for(var i=0;i<this.handles.length;i++){var handle=$(this.handles[i]);if(registration){var hideHandle=!1;if(this.fixedWidth&&this.fixedHeight)hideHandle=!0;else if(this.fixedWidth||this.fixedHeight){var isCornerHandle=handle.className.match(/([S|N][E|W])$/),isWidthHandle=handle.className.match(/(E|W)$/),isHeightHandle=handle.className.match(/(N|S)$/);(isCornerHandle||this.fixedWidth&&isWidthHandle||this.fixedHeight&&isHeightHandle)&&(hideHandle=!0)}hideHandle?handle.hide():this.options.resize&&Event.observe(handle,"mousedown",this.resizeBind)}else handle.show(),this.options.resize&&Event.stopObserving(handle,"mousedown",this.resizeBind)}},stopEvent:function(e){Event.stop(e)},setParams:function(){this.canvasW=this.canvas.getWidth(),this.canvasH=this.canvas.getHeight(),$(this.north).setStyle({height:0}),$(this.east).setStyle({width:0,height:0}),$(this.south).setStyle({height:0}),$(this.west).setStyle({width:0,height:0}),$(this.canvasWrap).setStyle({width:this.canvasW+"px",height:this.canvasH+"px"}),$(this.selArea).hide();var startCoords={x1:0,y1:0,x2:0,y2:0},validCoordsSet=!1;null!==this.options.onloadCoords?(startCoords=this.cloneCoords(this.options.onloadCoords),validCoordsSet=!0):this.options.ratioDim.x>0&&this.options.ratioDim.y>0&&(startCoords.x1=Math.ceil((this.canvasW-this.options.ratioDim.x)/2),startCoords.y1=Math.ceil((this.canvasH-this.options.ratioDim.y)/2),startCoords.x2=startCoords.x1+this.options.ratioDim.x,startCoords.y2=startCoords.y1+this.options.ratioDim.y,validCoordsSet=!0),this.setAreaCoords(startCoords,!1,!1,1),this.options.displayOnInit&&validCoordsSet&&(this.options.useEffect?new Effect.Appear(this.selArea,{duration:.2}):this.selArea.show(),this.drawArea()),this.attached=!0},updateLabel:function(str){this.label&&this.label.update(str)},select:function(e){Selections.selected&&Selections.selected.deselect(),this.selArea.addClassName("selected"),this.selected=!0,Selections.selected=this,this.addObservers(),e&&this.options.listener&&this.options.listener.select()},deselect:function(e){this.selArea.removeClassName("selected"),this.selected=!1,Selections.selected=null,this.removeObservers(),e&&this.options.listener&&this.options.listener.deselect()},remove:function(){this.attached&&(this.attached=!1,this.removeObservers()),Selections.remove(this),this.selArea.remove(),this.north.remove(),this.east.remove(),this.south.remove(),this.west.remove(),this.options.resize&&(this.handleN.remove(),this.handleNE.remove(),this.handleE.remove(),this.handleSE.remove(),this.handleS.remove(),this.handleSW.remove(),this.handleW.remove(),this.handleNW.remove()),this.options.onRemove()},show:function(){this.selArea.show(),this.north.show(),this.east.show(),this.south.show(),this.west.show(),this.options.resize&&(this.handleN.show(),this.handleNE.show(),this.handleE.show(),this.handleSE.show(),this.handleS.show(),this.handleSW.show(),this.handleW.show(),this.handleNW.show()),this.visible=!0},hide:function(){this.selArea.hide(),this.north.hide(),this.east.hide(),this.south.hide(),this.west.hide(),this.options.resize&&(this.handleN.hide(),this.handleNE.hide(),this.handleE.hide(),this.handleSE.hide(),this.handleS.hide(),this.handleSW.hide(),this.handleW.hide(),this.handleNW.hide()),this.visible=!1},reset:function(){this.attached?this.setParams():this.onLoad(),this.endDrag()},handleKeys:function(e){var dir={x:0,y:0};if(!this.dragging){switch(e.keyCode){case 37:dir.x=-1;break;case 38:dir.y=-1;break;case 39:dir.x=1;break;case 40:dir.y=1}0===dir.x&&0===dir.y||(e.shiftKey&&(dir.x*=10,dir.y*=10),this.moveArea([this.areaCoords.x1+dir.x,this.areaCoords.y1+dir.y]),this.endDrag(),Event.stop(e))}},calcW:function(){return this.areaCoords.x2-this.areaCoords.x1},calcH:function(){return this.areaCoords.y2-this.areaCoords.y1},cloneCoords:function(coords){return{x1:coords.x1,y1:coords.y1,x2:coords.x2,y2:coords.y2}},setAreaCoords:function(coords,moving,square,direction,resizeHandle){if(moving){var targW=coords.x2-coords.x1,targH=coords.y2-coords.y1;coords.x1<0&&(coords.x1=0,coords.x2=targW),coords.y1<0&&(coords.y1=0,coords.y2=targH),coords.x2>this.canvasW&&(coords.x2=this.canvasW,coords.x1=this.canvasW-targW),coords.y2>this.canvasH&&(coords.y2=this.canvasH,coords.y1=this.canvasH-targH)}else if(coords.x1<0&&(coords.x1=0),coords.y1<0&&(coords.y1=0),coords.x2>this.canvasW&&(coords.x2=this.canvasW),coords.y2>this.canvasH&&(coords.y2=this.canvasH),null!==direction){this.ratioX>0?this.applyRatio(coords,{x:this.ratioX,y:this.ratioY},direction,resizeHandle):square&&this.applyRatio(coords,{x:1,y:1},direction,resizeHandle);var mins=[this.options.minWidth,this.options.minHeight],maxs=[this.options.maxWidth,this.options.maxHeight];if(mins[0]>0||mins[1]>0||maxs[0]>0||maxs[1]>0){var coordsTransX={a1:coords.x1,a2:coords.x2},coordsTransY={a1:coords.y1,a2:coords.y2},boundsX={min:0,max:this.canvasW},boundsY={min:0,max:this.canvasH};0===mins[0]&&0===mins[1]||!square||(mins[0]>0?mins[1]=mins[0]:mins[1]>0&&(mins[0]=mins[1])),0===maxs[0]&&0===maxs[0]||!square||(maxs[0]>0&&maxs[0]<=maxs[1]?maxs[1]=maxs[0]:maxs[1]>0&&maxs[1]<=maxs[0]&&(maxs[0]=maxs[1])),mins[0]>0&&this.applyDimRestriction(coordsTransX,mins[0],direction.x,boundsX,"min"),mins[1]>1&&this.applyDimRestriction(coordsTransY,mins[1],direction.y,boundsY,"min"),maxs[0]>0&&this.applyDimRestriction(coordsTransX,maxs[0],direction.x,boundsX,"max"),maxs[1]>1&&this.applyDimRestriction(coordsTransY,maxs[1],direction.y,boundsY,"max"),coords={x1:coordsTransX.a1,y1:coordsTransY.a1,x2:coordsTransX.a2,y2:coordsTransY.a2}}}this.areaCoords=coords},applyDimRestriction:function(coords,val,direction,bounds,type){var check;(check="min"==type?coords.a2-coords.a1<val:coords.a2-coords.a1>val)&&(1==direction?coords.a2=coords.a1+val:coords.a1=coords.a2-val,coords.a1<bounds.min?(coords.a1=bounds.min,coords.a2=val):coords.a2>bounds.max&&(coords.a1=bounds.max-val,coords.a2=bounds.max))},applyRatio:function(coords,ratio,direction,resizeHandle){var newCoords;"N"==resizeHandle||"S"==resizeHandle?(newCoords=this.applyRatioToAxis({a1:coords.y1,b1:coords.x1,a2:coords.y2,b2:coords.x2},{a:ratio.y,b:ratio.x},{a:direction.y,b:direction.x},{min:0,max:this.canvasW}),coords.x1=newCoords.b1,coords.y1=newCoords.a1,coords.x2=newCoords.b2,coords.y2=newCoords.a2):(newCoords=this.applyRatioToAxis({a1:coords.x1,b1:coords.y1,a2:coords.x2,b2:coords.y2},{a:ratio.x,b:ratio.y},{a:direction.x,b:direction.y},{min:0,max:this.canvasH}),coords.x1=newCoords.a1,coords.y1=newCoords.b1,coords.x2=newCoords.a2,coords.y2=newCoords.b2)},applyRatioToAxis:function(coords,ratio,direction,bounds){var newCoords=Object.extend(coords,{}),calcDimA=newCoords.a2-newCoords.a1,targDimB=Math.floor(calcDimA*ratio.b/ratio.a),targB=null,targDimA=null,calcDimB=null;return 1==direction.b?(targB=newCoords.b1+targDimB,targB>bounds.max&&(targB=bounds.max,calcDimB=targB-newCoords.b1),newCoords.b2=targB):(targB=newCoords.b2-targDimB,targB<bounds.min&&(targB=bounds.min,calcDimB=targB+newCoords.b2),newCoords.b1=targB),null!==calcDimB&&(targDimA=Math.floor(calcDimB*ratio.a/ratio.b),1==direction.a?newCoords.a2=newCoords.a1+targDimA:newCoords.a1=newCoords.a1=newCoords.a2-targDimA),newCoords},forceReRender:function(){if(this.isIE){var n=document.createTextNode(" ");fixEl=this.selArea,fixEl.appendChild(n),fixEl.removeChild(n)}},drawArea:function(){var areaWidth=this.calcW(),areaHeight=this.calcH(),px="px",params=[this.areaCoords.x1+px,this.areaCoords.y1+px,areaWidth+px,areaHeight+px,this.areaCoords.x2+px,this.areaCoords.y2+px,this.canvas.getWidth()-this.areaCoords.x2+px,this.canvas.getHeight()-this.areaCoords.y2+px],areaStyle=this.selArea.style;areaStyle.left=params[0],areaStyle.top=params[1],areaStyle.width=params[2],areaStyle.height=params[3];var horizHandlePos=Math.ceil((areaWidth-6)/2)+px,vertHandlePos=Math.ceil((areaHeight-6)/2)+px;this.options.resize&&(this.handleN.style.left=horizHandlePos,this.handleE.style.top=vertHandlePos,this.handleS.style.left=horizHandlePos,this.handleW.style.top=vertHandlePos),this.north.style.height=params[1];var eastStyle=this.east.style;eastStyle.top=params[1],eastStyle.height=params[3],eastStyle.left=params[4],eastStyle.width=params[6];var southStyle=this.south.style;southStyle.top=params[5],southStyle.height=params[7];var westStyle=this.west.style;westStyle.top=params[1],westStyle.height=params[3],westStyle.width=params[0],this.subDrawArea(),this.forceReRender()},transformCoords:function(curVal,baseVal,coords,axis){var newVals=[curVal,baseVal];curVal>baseVal&&newVals.reverse(),coords[axis+"1"]=newVals[0],coords[axis+"2"]=newVals[1]},getCurPos:function(e){var el=this.canvasWrap,wrapOffsets=Element.cumulativeOffset(el),scrollOffsets=Element.cumulativeScrollOffset(el);return wrapOffsets[0]-=scrollOffsets[0],wrapOffsets[1]-=scrollOffsets[1],{x:Event.pointerX(e)-wrapOffsets[0],y:Event.pointerY(e)-wrapOffsets[1]}},onDragSelection:function(draggable,e){this.options.onDrag(this)},onEndDragSelection:function(draggable,e){this.options.onEndDrag(this),this.update()},moveArea:function(point){this.setAreaCoords({x1:point[0],y1:point[1],x2:point[0]+this.calcW(),y2:point[1]+this.calcH()},!0,!1),this.drawArea()},startResize:function(e){this.startCoords=this.cloneCoords(this.areaCoords),this.resizing=!0,this.resizeHandle=Event.element(e).classNames().toString().replace(/([^N|NE|E|SE|S|SW|W|NW])+/,""),Event.observe(document,"mousemove",this.onDragBind),Event.observe(document,"mouseup",this.endDragBind),Event.stop(e)},startDrag:function(e){this.select(),this.selArea.show(),this.clickCoords=this.getCurPos(e),this.setAreaCoords({x1:this.clickCoords.x,y1:this.clickCoords.y,x2:this.clickCoords.x,y2:this.clickCoords.y},!1,!1,null),Event.observe(document,"mousemove",this.onDragBind),Event.observe(document,"mouseup",this.endDragBind),this.dragging=!0,this.onDrag(e),Event.stop(e),this.options.onStartDrag(this)},onDrag:function(e){if(this.dragging||this.resizing){var resizeHandle=null,curPos=this.getCurPos(e),newCoords=this.cloneCoords(this.areaCoords),direction={x:1,y:1};this.dragging?(curPos.x<this.clickCoords.x&&(direction.x=-1),curPos.y<this.clickCoords.y&&(direction.y=-1),this.transformCoords(curPos.x,this.clickCoords.x,newCoords,"x"),this.transformCoords(curPos.y,this.clickCoords.y,newCoords,"y")):this.resizing&&(resizeHandle=this.resizeHandle,resizeHandle.match(/E/)?(this.transformCoords(curPos.x,this.startCoords.x1,newCoords,"x"),curPos.x<this.startCoords.x1&&(direction.x=-1)):resizeHandle.match(/W/)&&(this.transformCoords(curPos.x,this.startCoords.x2,newCoords,"x"),curPos.x<this.startCoords.x2&&(direction.x=-1)),resizeHandle.match(/N/)?(this.transformCoords(curPos.y,this.startCoords.y2,newCoords,"y"),curPos.y<this.startCoords.y2&&(direction.y=-1)):resizeHandle.match(/S/)&&(this.transformCoords(curPos.y,this.startCoords.y1,newCoords,"y"),curPos.y<this.startCoords.y1&&(direction.y=-1))),this.setAreaCoords(newCoords,!1,e.shiftKey,direction,resizeHandle),this.drawArea(),Event.stop(e)}this.options.onDrag(this)},update:function(){this.options.onUpdate(this)},endDrag:function(){Event.stopObserving(document,"mousemove",this.onDragBind),Event.stopObserving(document,"mouseup",this.endDragBind),this.options.onEndDrag(this),this.update(),this.dragging=!1,this.resizing=!1},subInitialize:function(){},subDrawArea:function(){}}),Selection.Previewable=Class.create(Selection.Base,{subInitialize:function(){this.hasPreview=!1,void 0!==this.options.previewWrap&&this.options.minWidth>0&&this.options.minHeight>0&&(this.previewWrap=$(this.options.previewWrap),this.previewCanvas=this.canvas.cloneNode(!1),this.previewCanvas.id=Selections.prefix+this.previewCanvas.id,this.options.displayOnInit=!0,this.hasPreview=!0,this.previewWrap.addClassName(Selections.prefix+"previewWrap"),this.previewWrap.setStyle({width:this.options.minWidth+"px",height:this.options.minHeight+"px"}),this.previewWrap.appendChild(this.previewCanvas))},subDrawArea:function(){if(this.hasPreview){var calcWidth=this.calcW(),calcHeight=this.calcH(),dimRatio={x:this.canvasW/calcWidth,y:this.canvasH/calcHeight},posRatio={x:calcWidth/this.options.minWidth,y:calcHeight/this.options.minHeight},calcPos={w:Math.ceil(this.options.minWidth*dimRatio.x)+"px",h:Math.ceil(this.options.minHeight*dimRatio.y)+"px",x:"-"+Math.ceil(this.areaCoords.x1/posRatio.x)+"px",y:"-"+Math.ceil(this.areaCoords.y1/posRatio.y)+"px"},previewStyle=this.previewCanvas.style;previewStyle.width=calcPos.w,previewStyle.height=calcPos.h,previewStyle.left=calcPos.x,previewStyle.top=calcPos.y}}});var tree=(__webpack_require__("TKta"),__webpack_require__("fSlT")),mapTheme=__webpack_require__("r+xB"),font=(__webpack_require__("jmxU"),__webpack_require__("6bYh")),style=__webpack_require__("FKf5"),boundaryStyle=__webpack_require__("xfYt"),iconModel=__webpack_require__("q3Rn"),ideaImage=__webpack_require__("oMUV"),layouter=__webpack_require__("oxsE"),math=__webpack_require__("3Ox4");/*!
 * Raphael Path Methods Plugin 0.2
 *
 * Copyright (c) 2009 Dmitry Baranovskiy (http://raphaeljs.com)
 * Licensed under the MIT (http://www.opensource.org/licenses/mit-license.php) license.
 */
raphael_default.a.el.isAbsolute=!0,raphael_default.a.el.absolutely=function(){return this.isAbsolute=1,this},raphael_default.a.el.relatively=function(){return this.isAbsolute=0,this},raphael_default.a.el.moveTo=function(x,y){return this._last={x:x,y:y},this.attr({path:this.attrs.path+["m","M"][+this.isAbsolute]+parseFloat(x)+" "+parseFloat(y)})},raphael_default.a.el.lineTo=function(x,y){return this._last={x:x,y:y},this.attr({path:this.attrs.path+["l","L"][+this.isAbsolute]+parseFloat(x)+" "+parseFloat(y)})},raphael_default.a.el.arcTo=function(rx,ry,large_arc_flag,sweep_flag,x,y,angle){return this._last={x:x,y:y},this.attr({path:this.attrs.path+["a","A"][+this.isAbsolute]+[parseFloat(rx),parseFloat(ry),+angle,large_arc_flag,sweep_flag,parseFloat(x),parseFloat(y)].join(" ")})},raphael_default.a.el.curveTo=function(){var args=Array.prototype.splice.call(arguments,0,arguments.length),d=[0,0,0,0,"s",0,"c"][args.length]||"";return this.isAbsolute&&(d=d.toUpperCase()),this._last={x:args[args.length-2],y:args[args.length-1]},this.attr({path:this.attrs.path+d+args})},raphael_default.a.el.cplineTo=function(x,y,w){return this.attr({path:this.attrs.path+["C",this._last.x+w,this._last.y,x-w,y,x,y]}),this._last={x:x,y:y},this},raphael_default.a.el.qcurveTo=function(){var d=[0,1,"t",3,"q"][arguments.length],args=Array.prototype.splice.call(arguments,0,arguments.length);return this.isAbsolute&&(d=d.toUpperCase()),this._last={x:args[args.length-2],y:args[args.length-1]},this.attr({path:this.attrs.path+d+args})},raphael_default.a.el.addRoundedCorner=function(r,dir){var rollback=this.isAbsolute;return rollback&&this.relatively(),this._last={x:r*(2*!!(dir.indexOf("r")+1)-1),y:r*(2*!!(dir.indexOf("d")+1)-1)},this.arcTo(r,r,0,{lu:1,rd:1,ur:1,dl:1}[dir]||0,this._last.x,this._last.y),rollback&&this.absolutely(),this},raphael_default.a.el.andClose=function(){return this.attr({path:this.attrs.path+"z"})};var presentation=__webpack_require__("yj88"),zoom=__webpack_require__("sNkp");window.Raphael=raphael_default.a,window.Point=math.Point,window.Rectangle=math.Rectangle,window.rectangleLayouter=layouter.default,window.IdeaImage=ideaImage.default,window.BoundaryStyle=boundaryStyle.default,window.Icon=iconModel.default,window.Font=font.default,window.Style=style.default,window.MapTheme=mapTheme.default,window.Tree=tree.default,window.Canvas=canvas.default,window.CustomEvents=customEvents.default,window.Presentation=presentation.default,window.SelDraggable=SelDraggable,window.Selection=Selection,window.Selections=Selections,App.ui.Zoom=zoom.default},lfAS:function(module,__webpack_exports__,__webpack_require__){"use strict";var DropboxPicker={init:function(options){this.loaded||(MM.utils.loadScript("https://www.dropbox.com/static/api/2/dropins.js",null,null,{id:"dropboxjs","data-app-key":ServerData.keys.dropbox}),this.loaded=!0,this.options={linkType:"direct",success:function(files){var file=files[0];if(file.bytes>262144e3)return void Message.show(I18n.t("js.attachment_size_exceeded",{v0:file.name}),Message.NOTICE);options.onPick&&options.onPick({link:file.link,name:file.name,size:file.bytes})}})},create:function(){return Dropbox.choose(this.options),!1}};__webpack_exports__.a=DropboxPicker},lqP1:function(module,exports,__webpack_require__){function flatten(array){return(null==array?0:array.length)?baseFlatten(array,1):[]}var baseFlatten=__webpack_require__("jrlN");module.exports=flatten},mL1V:function(module,exports){function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&value<=MAX_SAFE_INTEGER}var MAX_SAFE_INTEGER=9007199254740991;module.exports=isLength},o72h:function(module,exports,__webpack_require__){var root=__webpack_require__("VjBI"),now=function(){return root.Date.now()};module.exports=now},oMUV:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var IdeaImage=Class.create({id:null,size:[null,null],createdAt:null,owner:null,locally_stored:!1,mm_default:!1,file_id:null,initialize:function(data){this.id=data.id||IdeaImage.generateFakeId(),this.download_link=data.url,this.secure_download_link=data.secure_url,"phantomjs"===App.config.environment&&data.secure_url.indexOf("http")<0&&(this.secure_download_link=ServerData.siteUrl+data.secure_url),"phantomjs"===App.config.environment&&data.url.indexOf("http")<0&&(this.download_link=ServerData.siteUrl+data.url),this.local_path=data.local_path,this.size=data.size?[data.size.width,data.size.height]:null,this.createdAt=data.createdAt,this.owner=data.owner,this.locally_stored=data.locally_stored,this.mm_default=data.mm_default,this.def_linked=data.def_linked,this.picture_file_id=data.picture_file_id,this.drawn=!!data.drawn&&data.drawn,this.id>0&&(IdeaImage.all[this.id]=this)},resize:function(width,height){for(var aspectRatio=this.width()/this.height(),w=this.width(),h=this.height();w>width||h>height;)w>width?(w-=1,h=parseInt(w/aspectRatio)):h>height&&(h-=1,w=parseInt(h*aspectRatio));return[w,h]},width:function(){return this.size[0]},height:function(){return this.size[1]},url:function(){if(this.locally_stored){var url=this.download_link;return IdeaImage.downloadTokens?url+=(url.indexOf("?")>0?"&":"?")+IdeaImage.downloadTokens:App.config.linkShare&&""!==App.config.linkShareToken&&(url+=(url.indexOf("?")>0?"&":"?")+"t="+App.config.linkShareToken),url}return IdeaImage.useSecureLink()?this.secure_download_link:this.download_link},equals:function(img){return this.id==img.id},isLinkedMapPreview:function(){return/\/image\/medium\/\d+\/.+\.png$/.test(this.download_link)}});IdeaImage.default_images=[],IdeaImage.user_images=[],IdeaImage.all=[],IdeaImage.get=function(id){return IdeaImage.all[id]||null},IdeaImage.createDummy=function(url,size){return!Object.isUndefined(size)&&size||(size=null),new IdeaImage({id:IdeaImage.generateFakeId(),picture_file_id:null,url:url,secure_url:"/images/download_url?url="+url,size:size,createdAt:null,owner:null,locally_stored:!1,mm_default:!1})},IdeaImage.initDefault=function(){if("undefined"!=typeof IMAGES)for(var i=0,len=IMAGES.length;i<len;i++)IdeaImage.default_images.push(new IdeaImage(IMAGES[i]))},IdeaImage.generateFakeId=function(){return this._fakeId?--this._fakeId:this._fakeId=-1},IdeaImage.useSecureLink=function(){return"https:"===document.location.protocol&&"phantomjs"!==App.config.environment},__webpack_exports__.default=IdeaImage},oxsE:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"RectangleLayouter",function(){return RectangleLayouter}),__webpack_require__.d(__webpack_exports__,"RCRectangle",function(){return RCRectangle});var __WEBPACK_IMPORTED_MODULE_0_app_utils_math__=__webpack_require__("3Ox4"),_RCRectangle={node:null,fixedInitialPosition:!1,initialize:function($super,p1,p2,node){$super(p1,p2),this.node=node||null}},RCRectangle=Class.create(__WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Rectangle,_RCRectangle);RCRectangle.fromRectangle=function(r,node){return Object.extend(r,_RCRectangle),node&&(r.node=node),r};var RectangleLayouter=Class.create({_rectangles:[],initialize:function(){this._rectangles=[]},rectangles:function(){return this._rectangles.reject(function(r){return r.node.hidden})},getRectangle:function(node){for(var i=this._rectangles.length;i>0;)if(this._rectangles[--i].node===node)return this._rectangles[i]},update:function(node){if(!node.isRoot()){var elastic,rootChild=node.getRootC(),sizes=rootChild._listener.getSizesForLayouter(!0),newRectangle=sizes.rectangle,rectangle=this.getRectangle(rootChild);if(rectangle){var oldRectangle=Object.clone(rectangle);rectangle.p1=newRectangle.p1,rectangle.p2=newRectangle.p2,canvas.checkBounds(),elastic=this.changeRectangle(rootChild,oldRectangle,rectangle)}else newRectangle=RCRectangle.fromRectangle(newRectangle,node),Point.isValid(node.pos)?(this.setPosition(newRectangle,node.pos,sizes.offsets,!0),elastic=rectangleLayouter.addPositioned(newRectangle)):(node.pos=null,elastic=rectangleLayouter.addUnpositioned(newRectangle,sizes.offsets));return elastic}},findPosition:function(newRectangle){if(null!==App.config.layout.orientation)return this.findPositionAligned();var leftRectangles=[],rightRectangles=[];this.rectangles().sort(function(r,r2){return r.p2.y-r2.p2.y}).each(function(rectangle){rectangle.p1.x>0?rightRectangles.unshift(rectangle):leftRectangles.unshift(rectangle)});var size=newRectangle.size(),offsetX=canvas.root.dcontent.size()[0]/2;return rightRectangles.length<2||rightRectangles.length<leftRectangles.length?[90+offsetX,rightRectangles[0]?rightRectangles[0].p2.y+75:-100]:[-90-offsetX-size.x,leftRectangles[0]?leftRectangles[0].p2.y+75:-100]},findPositionAligned:function(){var off=canvas.root.dcontent.size()[0]/2,rectangles=this.rectangles(),i=rectangles.length-1;return i<0?[90+off,-25]:[rectangles[i].p1.x,rectangles[i].p2.y]},addPositioned:function(newRectangle,dynamicInitialPosition){newRectangle.fixedInitialPosition=!dynamicInitialPosition,this._rectangles.push(newRectangle),canvas.checkBounds();var c=newRectangle.center();return this.changeRectangle(newRectangle.node,new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Rectangle(c,c),newRectangle)},addUnpositioned:function(newRectangle,offsets){return this.setPosition(newRectangle,this.findPosition(newRectangle),offsets),this.addPositioned(newRectangle,!0)},setPosition:function(rectangle,position,offsets,isContentPosition){var nodeCoords=isContentPosition?position:RectangleLayouter.rectanglePositionToNodeCoords(position,offsets),rectangleCoords=isContentPosition?RectangleLayouter.nodePositionToRectangleCoords(position,offsets):position;rectangle.node.pos=nodeCoords,rectangle.move(new Point(rectangleCoords))},updateAll:function(){for(var i=0,rectangles=this.rectangles(),len=rectangles.length;i<len;i++)this.update(rectangles[i].node)},remove:function(node){for(var removed,rectangles=this._rectangles,i=rectangles.length,newRectangles=[];i>0;)if(rectangles[--i].node.id!=node.id)newRectangles.push(rectangles[i]);else{removed=rectangles[i];var c=removed.center(),layoutChanges=this.changeRectangle(removed.node,removed,new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Rectangle(c,c))}return this._rectangles=newRectangles,layoutChanges},_horizontalArrange:function(r1,r2){return[r1,[-(r1.p2.x-r2.p1.x)-5,0]]},_verticalArrange:function(inTheWay,toMove){return[toMove,[0,inTheWay.center().y<toMove.center().y||inTheWay.p1.y===toMove.p1.y?Math.abs(toMove.p1.y-inTheWay.p2.y)+1:-Math.abs(inTheWay.p1.y-toMove.p2.y)-1]]},_arrange:function(r1,r2){return r1.center().x<0&&r2.center().x>=0?this._horizontalArrange(r1,r2):r1.center().x>=0&&r2.center().x<0?this._horizontalArrange(r2,r1):this._verticalArrange(r1,r2)},_getOverlapping:function(dirtySet,fullSet){var inTheWay,dirty=dirtySet.detect(function(r1){return inTheWay=fullSet.detect(function(r2){return r1!==r2&&r1.overlaps(r2)})});return dirty&&inTheWay?[dirty,inTheWay]:null},_getLayoutingChanges:function(dirtySet){for(var changes=[],rectangles=this.rectangles().slice(0).sortBy(function(r){return Math.abs(r.center().y)}),overlaps=0,overlappingPair=this._getOverlapping(dirtySet,rectangles);overlappingPair&&overlaps<100;){var result=this._arrange(overlappingPair[0],overlappingPair[1]);if(!result)return MM.error.reportException({message:"Layouter DEBUG: result is null,  r1: "+overlappingPair[0].toString()+" r2: "+overlappingPair[1].toString()+" dirtySet: "+Object.inspect(dirtySet)+" rectangles: "+Object.inspect(rectangles)}),[];var rectangle=result[0],offset=result[1];dirtySet.include(rectangle)||dirtySet.push(rectangle),changes.push([rectangle.node,offset]),rectangle.shift(new Point(offset)),overlappingPair=this._getOverlapping(dirtySet,rectangles),overlaps++}return changes},changeRectangleTidy:function(rectangle){return this._getLayoutingChanges([rectangle])},autoLayout:function(){return this._getLayoutingChanges(this.rectangles().slice(0).sortBy(function(el){return Math.abs(el.center().y)}))},autoCondense:function(){for(var rL=new RectangleLayouter,changes=[],i=0,len=this._rectangles.length;i<len;i++){var r=this._rectangles[i];r=new RCRectangle(new Point(0,0),r.size(),r.node),rL.addUnpositioned(r),changes.push([r.node,[0,0]])}return changes},changeRectangle:function(node,oldRectangle,newRectangle){if(this.elasticLayoutingEnabled&&!App.config.layout.autoAlign){var r,offset1=oldRectangle.p1.y-newRectangle.p1.y,offset2=oldRectangle.p2.y-newRectangle.p2.y;if(oldRectangle.p1.y-oldRectangle.p2.y===newRectangle.p1.y-newRectangle.p2.y)return null;for(var cause=this.getRectangle(node),changes=[],otherRectangles=this.rectangles().slice(0),i=0;i<otherRectangles.length;i++)if(r=otherRectangles[i],r.node.id===cause.node.id)changes.push([r.node,[0,0]]);else{var o=oldRectangle,n=newRectangle,oldStacked=r.p1.x<=o.p1.x&&o.p1.x<=r.p2.x||r.p1.x<=o.p2.x&&o.p2.x<=r.p2.x||o.p1.x<=r.p1.x&&r.p1.x<=o.p2.x||o.p1.x<=r.p2.x&&r.p2.x<=o.p2.x,newStacked=r.p1.x<=n.p1.x&&n.p1.x<=r.p2.x||r.p1.x<=n.p2.x&&n.p2.x<=r.p2.x||n.p1.x<=r.p1.x&&r.p1.x<=n.p2.x||n.p1.x<=r.p2.x&&r.p2.x<=n.p2.x;if(!newStacked&&!oldStacked)continue;if(r.center().y===cause.center().y)continue;var h=r.center().y>cause.center().y?offset2:offset1;0!==h&&changes.push([r.node,[0,-h]])}return changes}},getTotalSize:function(){for(var rectangles=this.rectangles(),rootSize=canvas.root.getSize(),maxRight=rootSize[0]/2,minLeft=-maxRight,maxBottom=rootSize[1]/2,minTop=-maxBottom,i=0;i<rectangles.length;i++){var r=rectangles[i];r.p1.x<minLeft&&(minLeft=r.p1.x),r.p1.y<minTop&&(minTop=r.p1.y),r.p2.x>maxRight&&(maxRight=r.p2.x),r.p2.y>maxBottom&&(maxBottom=r.p2.y)}return{width:maxRight-minLeft,height:maxBottom-minTop,centerOffset:[-minLeft,-minTop]}}});RectangleLayouter.rectanglePositionToNodeCoords=function(position,offsets){if(!offsets)return position;var newPosition=[position[0],position[1]+offsets[1]];return position[0]<0&&(newPosition[0]+=offsets[0]),newPosition},RectangleLayouter.nodePositionToRectangleCoords=function(position,offsets){if(!offsets)return position;var newPosition=[position[0],position[1]-offsets[1]];return position[0]<0&&(newPosition[0]-=offsets[0]),newPosition};var rectangleLayouter=new RectangleLayouter;__webpack_exports__.default=rectangleLayouter},pTO5:function(module,exports,__webpack_require__){(function(module){var __WEBPACK_AMD_DEFINE_FACTORY__,__WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__,_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj};!function(root,factory){"object"===_typeof(exports)&&"object"===_typeof(module)?module.exports=factory():(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_FACTORY__=factory,void 0!==(__WEBPACK_AMD_DEFINE_RESULT__="function"==typeof __WEBPACK_AMD_DEFINE_FACTORY__?__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__):__WEBPACK_AMD_DEFINE_FACTORY__)&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}(0,function(){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(1),__webpack_require__(3),__webpack_require__(4)],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(R){return R}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(2)],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(eve){function R(first){if(R.is(first,"function"))return loaded?first():eve.on("raphael.DOMload",first);if(R.is(first,array))return R._engine.create[apply](R,first.splice(0,3+R.is(first[0],nu))).add(first);var args=Array.prototype.slice.call(arguments,0);if(R.is(args[args.length-1],"function")){var f=args.pop();return loaded?f.call(R._engine.create[apply](R,args)):eve.on("raphael.DOMload",function(){f.call(R._engine.create[apply](R,args))})}return R._engine.create[apply](R,arguments)}function clone(obj){if("function"==typeof obj||Object(obj)!==obj)return obj;var res=new obj.constructor;for(var key in obj)obj[has](key)&&"prototype"!==key&&(res[key]=clone(obj[key]));return res}function repush(array,item){for(var i=0,ii=array.length;i<ii;i++)if(array[i]===item)return array.push(array.splice(i,1)[0])}function cacher(f,scope,postprocessor){function newf(){var arg=Array.prototype.slice.call(arguments,0),args=arg.join("␀"),cache=newf.cache=newf.cache||{},count=newf.count=newf.count||[];return cache[has](args)?(repush(count,args),postprocessor?postprocessor(cache[args]):cache[args]):(count.length>=1e3&&delete cache[count.shift()],count.push(args),cache[args]=f[apply](scope,arg),postprocessor?postprocessor(cache[args]):cache[args])}return newf}function clrToString(){return this.hex}function catmullRom2bezier(crp,z){for(var d=[],i=0,iLen=crp.length;iLen-2*!z>i;i+=2){var p=[{x:+crp[i-2],y:+crp[i-1]},{x:+crp[i],y:+crp[i+1]},{x:+crp[i+2],y:+crp[i+3]},{x:+crp[i+4],y:+crp[i+5]}];z?i?iLen-4==i?p[3]={x:+crp[0],y:+crp[1]}:iLen-2==i&&(p[2]={x:+crp[0],y:+crp[1]},p[3]={x:+crp[2],y:+crp[3]}):p[0]={x:+crp[iLen-2],y:+crp[iLen-1]}:iLen-4==i?p[3]=p[2]:i||(p[0]={x:+crp[i],y:+crp[i+1]}),d.push(["C",(-p[0].x+6*p[1].x+p[2].x)/6,(-p[0].y+6*p[1].y+p[2].y)/6,(p[1].x+6*p[2].x-p[3].x)/6,(p[1].y+6*p[2].y-p[3].y)/6,p[2].x,p[2].y])}return d}function base3(t,p1,p2,p3,p4){return t*(t*(-3*p1+9*p2-9*p3+3*p4)+6*p1-12*p2+6*p3)-3*p1+3*p2}function bezlen(x1,y1,x2,y2,x3,y3,x4,y4,z){null==z&&(z=1),z=z>1?1:z<0?0:z;for(var z2=z/2,Tvalues=[-.1252,.1252,-.3678,.3678,-.5873,.5873,-.7699,.7699,-.9041,.9041,-.9816,.9816],Cvalues=[.2491,.2491,.2335,.2335,.2032,.2032,.1601,.1601,.1069,.1069,.0472,.0472],sum=0,i=0;i<12;i++){var ct=z2*Tvalues[i]+z2,xbase=base3(ct,x1,x2,x3,x4),ybase=base3(ct,y1,y2,y3,y4),comb=xbase*xbase+ybase*ybase;sum+=Cvalues[i]*math.sqrt(comb)}return z2*sum}function getTatLen(x1,y1,x2,y2,x3,y3,x4,y4,ll){if(!(ll<0||bezlen(x1,y1,x2,y2,x3,y3,x4,y4)<ll)){var l,step=.5,t2=1-step;for(l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);abs(l-ll)>.01;)step/=2,t2+=(l<ll?1:-1)*step,l=bezlen(x1,y1,x2,y2,x3,y3,x4,y4,t2);return t2}}function intersect(x1,y1,x2,y2,x3,y3,x4,y4){if(!(mmax(x1,x2)<mmin(x3,x4)||mmin(x1,x2)>mmax(x3,x4)||mmax(y1,y2)<mmin(y3,y4)||mmin(y1,y2)>mmax(y3,y4))){var nx=(x1*y2-y1*x2)*(x3-x4)-(x1-x2)*(x3*y4-y3*x4),ny=(x1*y2-y1*x2)*(y3-y4)-(y1-y2)*(x3*y4-y3*x4),denominator=(x1-x2)*(y3-y4)-(y1-y2)*(x3-x4);if(denominator){var px=nx/denominator,py=ny/denominator,px2=+px.toFixed(2),py2=+py.toFixed(2);if(!(px2<+mmin(x1,x2).toFixed(2)||px2>+mmax(x1,x2).toFixed(2)||px2<+mmin(x3,x4).toFixed(2)||px2>+mmax(x3,x4).toFixed(2)||py2<+mmin(y1,y2).toFixed(2)||py2>+mmax(y1,y2).toFixed(2)||py2<+mmin(y3,y4).toFixed(2)||py2>+mmax(y3,y4).toFixed(2)))return{x:px,y:py}}}}function interHelper(bez1,bez2,justCount){var bbox1=R.bezierBBox(bez1),bbox2=R.bezierBBox(bez2);if(!R.isBBoxIntersect(bbox1,bbox2))return justCount?0:[];for(var l1=bezlen.apply(0,bez1),l2=bezlen.apply(0,bez2),n1=mmax(~~(l1/5),1),n2=mmax(~~(l2/5),1),dots1=[],dots2=[],xy={},res=justCount?0:[],i=0;i<n1+1;i++){var p=R.findDotsAtSegment.apply(R,bez1.concat(i/n1));dots1.push({x:p.x,y:p.y,t:i/n1})}for(i=0;i<n2+1;i++)p=R.findDotsAtSegment.apply(R,bez2.concat(i/n2)),dots2.push({x:p.x,y:p.y,t:i/n2});for(i=0;i<n1;i++)for(var j=0;j<n2;j++){var di=dots1[i],di1=dots1[i+1],dj=dots2[j],dj1=dots2[j+1],ci=abs(di1.x-di.x)<.001?"y":"x",cj=abs(dj1.x-dj.x)<.001?"y":"x",is=intersect(di.x,di.y,di1.x,di1.y,dj.x,dj.y,dj1.x,dj1.y);if(is){if(xy[is.x.toFixed(4)]==is.y.toFixed(4))continue;xy[is.x.toFixed(4)]=is.y.toFixed(4);var t1=di.t+abs((is[ci]-di[ci])/(di1[ci]-di[ci]))*(di1.t-di.t),t2=dj.t+abs((is[cj]-dj[cj])/(dj1[cj]-dj[cj]))*(dj1.t-dj.t);t1>=0&&t1<=1.001&&t2>=0&&t2<=1.001&&(justCount?res++:res.push({x:is.x,y:is.y,t1:mmin(t1,1),t2:mmin(t2,1)}))}}return res}function interPathHelper(path1,path2,justCount){path1=R._path2curve(path1),path2=R._path2curve(path2);for(var x1,y1,x2,y2,x1m,y1m,x2m,y2m,bez1,bez2,res=justCount?0:[],i=0,ii=path1.length;i<ii;i++){var pi=path1[i];if("M"==pi[0])x1=x1m=pi[1],y1=y1m=pi[2];else{"C"==pi[0]?(bez1=[x1,y1].concat(pi.slice(1)),x1=bez1[6],y1=bez1[7]):(bez1=[x1,y1,x1,y1,x1m,y1m,x1m,y1m],x1=x1m,y1=y1m);for(var j=0,jj=path2.length;j<jj;j++){var pj=path2[j];if("M"==pj[0])x2=x2m=pj[1],y2=y2m=pj[2];else{"C"==pj[0]?(bez2=[x2,y2].concat(pj.slice(1)),x2=bez2[6],y2=bez2[7]):(bez2=[x2,y2,x2,y2,x2m,y2m,x2m,y2m],x2=x2m,y2=y2m);var intr=interHelper(bez1,bez2,justCount);if(justCount)res+=intr;else{for(var k=0,kk=intr.length;k<kk;k++)intr[k].segment1=i,intr[k].segment2=j,intr[k].bez1=bez1,intr[k].bez2=bez2;res=res.concat(intr)}}}}}return res}function Matrix(a,b,c,d,e,f){null!=a?(this.a=+a,this.b=+b,this.c=+c,this.d=+d,this.e=+e,this.f=+f):(this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0)}function x_y_w_h(){return this.x+S+this.y+S+this.width+" × "+this.height}function CubicBezierAtTime(t,p1x,p1y,p2x,p2y,duration){function sampleCurveX(t){return((ax*t+bx)*t+cx)*t}function solveCurveX(x,epsilon){var t0,t1,t2,x2,d2,i;for(t2=x,i=0;i<8;i++){if(x2=sampleCurveX(t2)-x,abs(x2)<epsilon)return t2;if(d2=(3*ax*t2+2*bx)*t2+cx,abs(d2)<1e-6)break;t2-=x2/d2}if(t0=0,t1=1,(t2=x)<t0)return t0;if(t2>t1)return t1;for(;t0<t1;){if(x2=sampleCurveX(t2),abs(x2-x)<epsilon)return t2;x>x2?t0=t2:t1=t2,t2=(t1-t0)/2+t0}return t2}var cx=3*p1x,bx=3*(p2x-p1x)-cx,ax=1-cx-bx,cy=3*p1y,by=3*(p2y-p1y)-cy,ay=1-cy-by;return function(x,epsilon){var t=solveCurveX(x,epsilon);return((ay*t+by)*t+cy)*t}(t,1/(200*duration))}function Animation(anim,ms){var percents=[],newAnim={};if(this.ms=ms,this.times=1,anim){for(var attr in anim)anim[has](attr)&&(newAnim[toFloat(attr)]=anim[attr],percents.push(toFloat(attr)));percents.sort(sortByNumber)}this.anim=newAnim,this.top=percents[percents.length-1],this.percents=percents}function runAnimation(anim,element,percent,status,totalOrigin,times){percent=toFloat(percent);var params,isInAnim,isInAnimSet,next,prev,timestamp,ms=anim.ms,from={},to={},diff={};if(status)for(i=0,ii=animationElements.length;i<ii;i++){var e=animationElements[i];if(e.el.id==element.id&&e.anim==anim){e.percent!=percent?(animationElements.splice(i,1),isInAnimSet=1):isInAnim=e,element.attr(e.totalOrigin);break}}else status=+to;for(var i=0,ii=anim.percents.length;i<ii;i++){if(anim.percents[i]==percent||anim.percents[i]>status*anim.top){percent=anim.percents[i],prev=anim.percents[i-1]||0,ms=ms/anim.top*(percent-prev),next=anim.percents[i+1],params=anim.anim[percent];break}status&&element.attr(anim.anim[anim.percents[i]])}if(params){if(isInAnim)isInAnim.initstatus=status,isInAnim.start=new Date-isInAnim.ms*status;else{for(var attr in params)if(params[has](attr)&&(availableAnimAttrs[has](attr)||element.paper.customAttributes[has](attr)))switch(from[attr]=element.attr(attr),null==from[attr]&&(from[attr]=availableAttrs[attr]),to[attr]=params[attr],availableAnimAttrs[attr]){case nu:diff[attr]=(to[attr]-from[attr])/ms;break;case"colour":from[attr]=R.getRGB(from[attr]);var toColour=R.getRGB(to[attr]);diff[attr]={r:(toColour.r-from[attr].r)/ms,g:(toColour.g-from[attr].g)/ms,b:(toColour.b-from[attr].b)/ms};break;case"path":var pathes=path2curve(from[attr],to[attr]),toPath=pathes[1];for(from[attr]=pathes[0],diff[attr]=[],i=0,ii=from[attr].length;i<ii;i++){diff[attr][i]=[0];for(var j=1,jj=from[attr][i].length;j<jj;j++)diff[attr][i][j]=(toPath[i][j]-from[attr][i][j])/ms}break;case"transform":var _=element._,eq=equaliseTransform(_[attr],to[attr]);if(eq)for(from[attr]=eq.from,to[attr]=eq.to,diff[attr]=[],diff[attr].real=!0,i=0,ii=from[attr].length;i<ii;i++)for(diff[attr][i]=[from[attr][i][0]],j=1,jj=from[attr][i].length;j<jj;j++)diff[attr][i][j]=(to[attr][i][j]-from[attr][i][j])/ms;else{var m=element.matrix||new Matrix,to2={_:{transform:_.transform},getBBox:function(){return element.getBBox(1)}};from[attr]=[m.a,m.b,m.c,m.d,m.e,m.f],extractTransform(to2,to[attr]),to[attr]=to2._.transform,diff[attr]=[(to2.matrix.a-m.a)/ms,(to2.matrix.b-m.b)/ms,(to2.matrix.c-m.c)/ms,(to2.matrix.d-m.d)/ms,(to2.matrix.e-m.e)/ms,(to2.matrix.f-m.f)/ms]}break;case"csv":var values=Str(params[attr])[split](separator),from2=Str(from[attr])[split](separator);if("clip-rect"==attr)for(from[attr]=from2,diff[attr]=[],i=from2.length;i--;)diff[attr][i]=(values[i]-from[attr][i])/ms;to[attr]=values;break;default:for(values=[][concat](params[attr]),from2=[][concat](from[attr]),diff[attr]=[],i=element.paper.customAttributes[attr].length;i--;)diff[attr][i]=((values[i]||0)-(from2[i]||0))/ms}var easing=params.easing,easyeasy=R.easing_formulas[easing];if(!easyeasy)if((easyeasy=Str(easing).match(bezierrg))&&5==easyeasy.length){var curve=easyeasy;easyeasy=function(t){return CubicBezierAtTime(t,+curve[1],+curve[2],+curve[3],+curve[4],ms)}}else easyeasy=pipe;if(timestamp=params.start||anim.start||+new Date,e={anim:anim,percent:percent,timestamp:timestamp,start:timestamp+(anim.del||0),status:0,initstatus:status||0,stop:!1,ms:ms,easing:easyeasy,from:from,diff:diff,to:to,el:element,callback:params.callback,prev:prev,next:next,repeat:times||anim.times,origin:element.attr(),totalOrigin:totalOrigin},animationElements.push(e),status&&!isInAnim&&!isInAnimSet&&(e.stop=!0,e.start=new Date-ms*status,1==animationElements.length))return animation();isInAnimSet&&(e.start=new Date-e.ms*status),1==animationElements.length&&requestAnimFrame(animation)}eve("raphael.anim.start."+element.id,element,anim)}}function stopAnimation(paper){for(var i=0;i<animationElements.length;i++)animationElements[i].el.paper==paper&&animationElements.splice(i--,1)}R.version="2.2.0",R.eve=eve;var loaded,paperproto,separator=/[, ]+/,elements={circle:1,rect:1,path:1,ellipse:1,text:1,image:1},formatrg=/\{(\d+)\}/g,has="hasOwnProperty",g={doc:document,win:window},oldRaphael={was:Object.prototype[has].call(g.win,"Raphael"),is:g.win.Raphael},Paper=function(){this.ca=this.customAttributes={}},apply="apply",concat="concat",supportsTouch="ontouchstart"in g.win||g.win.DocumentTouch&&g.doc instanceof DocumentTouch,E="",S=" ",Str=String,split="split",events="click dblclick mousedown mousemove mouseout mouseover mouseup touchstart touchmove touchend touchcancel"[split](S),touchMap={mousedown:"touchstart",mousemove:"touchmove",mouseup:"touchend"},lowerCase=Str.prototype.toLowerCase,math=Math,mmax=math.max,mmin=math.min,abs=math.abs,pow=math.pow,PI=math.PI,nu="number",array="array",objectToString=Object.prototype.toString,colourRegExp=(R._ISURL=/^url\(['"]?(.+?)['"]?\)$/i,/^\s*((#[a-f\d]{6})|(#[a-f\d]{3})|rgba?\(\s*([\d\.]+%?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+%?(?:\s*,\s*[\d\.]+%?)?)\s*\)|hsba?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\)|hsla?\(\s*([\d\.]+(?:deg|\xb0|%)?\s*,\s*[\d\.]+%?\s*,\s*[\d\.]+(?:%?\s*,\s*[\d\.]+)?)%?\s*\))\s*$/i),isnan={NaN:1,Infinity:1,"-Infinity":1},bezierrg=/^(?:cubic-)?bezier\(([^,]+),([^,]+),([^,]+),([^\)]+)\)/,round=math.round,toFloat=parseFloat,toInt=parseInt,upperCase=Str.prototype.toUpperCase,availableAttrs=R._availableAttrs={"arrow-end":"none","arrow-start":"none",blur:0,"clip-rect":"0 0 1e9 1e9",cursor:"default",cx:0,cy:0,fill:"#fff","fill-opacity":1,font:'10px "Arial"',"font-family":'"Arial"',"font-size":"10","font-style":"normal","font-weight":400,gradient:0,height:0,href:"http://raphaeljs.com/","letter-spacing":0,opacity:1,path:"M0,0",r:0,rx:0,ry:0,src:"",stroke:"#000","stroke-dasharray":"","stroke-linecap":"butt","stroke-linejoin":"butt","stroke-miterlimit":0,"stroke-opacity":1,"stroke-width":1,target:"_blank","text-anchor":"middle",title:"Raphael",transform:"",width:0,x:0,y:0,class:""},availableAnimAttrs=R._availableAnimAttrs={blur:nu,"clip-rect":"csv",cx:nu,cy:nu,fill:"colour","fill-opacity":nu,"font-size":nu,height:nu,opacity:nu,path:"path",r:nu,rx:nu,ry:nu,stroke:"colour","stroke-opacity":nu,"stroke-width":nu,transform:"transform",width:nu,x:nu,y:nu},commaSpaces=/[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/,hsrg={hs:1,rg:1},p2s=/,?([achlmqrstvxz]),?/gi,pathCommand=/([achlmrqstvz])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,tCommand=/([rstm])[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029,]*((-?\d*\.?\d*(?:e[\-+]?\d+)?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*)+)/gi,pathValues=/(-?\d*\.?\d*(?:e[\-+]?\d+)?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,?[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*/gi,eldata=(R._radial_gradient=/^r(?:\(([^,]+?)[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*,[\x09\x0a\x0b\x0c\x0d\x20\xa0\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000\u2028\u2029]*([^\)]+?)\))?/,{}),sortByNumber=function(a,b){return toFloat(a)-toFloat(b)},pipe=function(x){return x},rectPath=R._rectPath=function(x,y,w,h,r){return r?[["M",x+r,y],["l",w-2*r,0],["a",r,r,0,0,1,r,r],["l",0,h-2*r],["a",r,r,0,0,1,-r,r],["l",2*r-w,0],["a",r,r,0,0,1,-r,-r],["l",0,2*r-h],["a",r,r,0,0,1,r,-r],["z"]]:[["M",x,y],["l",w,0],["l",0,h],["l",-w,0],["z"]]},ellipsePath=function(x,y,rx,ry){return null==ry&&(ry=rx),[["M",x,y],["m",0,-ry],["a",rx,ry,0,1,1,0,2*ry],["a",rx,ry,0,1,1,0,-2*ry],["z"]]},getPath=R._getPath={path:function(el){return el.attr("path")},circle:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.r)},ellipse:function(el){var a=el.attrs;return ellipsePath(a.cx,a.cy,a.rx,a.ry)},rect:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height,a.r)},image:function(el){var a=el.attrs;return rectPath(a.x,a.y,a.width,a.height)},text:function(el){var bbox=el._getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height)},set:function(el){var bbox=el._getBBox();return rectPath(bbox.x,bbox.y,bbox.width,bbox.height)}},mapPath=R.mapPath=function(path,matrix){if(!matrix)return path;var x,y,i,j,ii,jj,pathi;for(path=path2curve(path),i=0,ii=path.length;i<ii;i++)for(pathi=path[i],j=1,jj=pathi.length;j<jj;j+=2)x=matrix.x(pathi[j],pathi[j+1]),y=matrix.y(pathi[j],pathi[j+1]),pathi[j]=x,pathi[j+1]=y;return path};if(R._g=g,R.type=g.win.SVGAngle||g.doc.implementation.hasFeature("http://www.w3.org/TR/SVG11/feature#BasicStructure","1.1")?"SVG":"VML","VML"==R.type){var b,d=g.doc.createElement("div");if(d.innerHTML='<v:shape adj="1"/>',b=d.firstChild,b.style.behavior="url(#default#VML)",!b||"object"!=_typeof(b.adj))return R.type=E;d=null}R.svg=!(R.vml="VML"==R.type),R._Paper=Paper,R.fn=paperproto=Paper.prototype=R.prototype,R._id=0,R.is=function(o,type){return type=lowerCase.call(type),"finite"==type?!isnan[has](+o):"array"==type?o instanceof Array:"null"==type&&null===o||type==(void 0===o?"undefined":_typeof(o))&&null!==o||"object"==type&&o===Object(o)||"array"==type&&Array.isArray&&Array.isArray(o)||objectToString.call(o).slice(8,-1).toLowerCase()==type},R.angle=function(x1,y1,x2,y2,x3,y3){if(null==x3){var x=x1-x2,y=y1-y2;return x||y?(180+180*math.atan2(-y,-x)/PI+360)%360:0}return R.angle(x1,y1,x3,y3)-R.angle(x2,y2,x3,y3)},R.rad=function(deg){return deg%360*PI/180},R.deg=function(rad){return Math.round(180*rad/PI%360*1e3)/1e3},R.snapTo=function(values,value,tolerance){if(tolerance=R.is(tolerance,"finite")?tolerance:10,R.is(values,array)){for(var i=values.length;i--;)if(abs(values[i]-value)<=tolerance)return values[i]}else{values=+values;var rem=value%values;if(rem<tolerance)return value-rem;if(rem>values-tolerance)return value-rem+values}return value};R.createUUID=function(uuidRegEx,uuidReplacer){return function(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(uuidRegEx,uuidReplacer).toUpperCase()}}(/[xy]/g,function(c){var r=16*math.random()|0;return("x"==c?r:3&r|8).toString(16)});R.setWindow=function(newwin){eve("raphael.setWindow",R,g.win,newwin),g.win=newwin,g.doc=g.win.document,R._engine.initWin&&R._engine.initWin(g.win)};var _toHex=function(color){if(R.vml){var bod,trim=/^\s+|\s+$/g;try{var docum=new ActiveXObject("htmlfile");docum.write("<body>"),docum.close(),bod=docum.body}catch(e){bod=createPopup().document.body}var range=bod.createTextRange();_toHex=cacher(function(color){try{bod.style.color=Str(color).replace(trim,E);var value=range.queryCommandValue("ForeColor");return value=(255&value)<<16|65280&value|(16711680&value)>>>16,"#"+("000000"+value.toString(16)).slice(-6)}catch(e){return"none"}})}else{var i=g.doc.createElement("i");i.title="Raphaël Colour Picker",i.style.display="none",g.doc.body.appendChild(i),_toHex=cacher(function(color){return i.style.color=color,g.doc.defaultView.getComputedStyle(i,E).getPropertyValue("color")})}return _toHex(color)},hsbtoString=function(){return"hsb("+[this.h,this.s,this.b]+")"},hsltoString=function(){return"hsl("+[this.h,this.s,this.l]+")"},rgbtoString=function(){return this.hex},prepareRGB=function(r,g,b){if(null==g&&R.is(r,"object")&&"r"in r&&"g"in r&&"b"in r&&(b=r.b,g=r.g,r=r.r),null==g&&R.is(r,"string")){var clr=R.getRGB(r);r=clr.r,g=clr.g,b=clr.b}return(r>1||g>1||b>1)&&(r/=255,g/=255,b/=255),[r,g,b]},packageRGB=function(r,g,b,o){r*=255,g*=255,b*=255;var rgb={r:r,g:g,b:b,hex:R.rgb(r,g,b),toString:rgbtoString};return R.is(o,"finite")&&(rgb.opacity=o),rgb};R.color=function(clr){var rgb;return R.is(clr,"object")&&"h"in clr&&"s"in clr&&"b"in clr?(rgb=R.hsb2rgb(clr),clr.r=rgb.r,clr.g=rgb.g,clr.b=rgb.b,clr.hex=rgb.hex):R.is(clr,"object")&&"h"in clr&&"s"in clr&&"l"in clr?(rgb=R.hsl2rgb(clr),clr.r=rgb.r,clr.g=rgb.g,clr.b=rgb.b,clr.hex=rgb.hex):(R.is(clr,"string")&&(clr=R.getRGB(clr)),R.is(clr,"object")&&"r"in clr&&"g"in clr&&"b"in clr?(rgb=R.rgb2hsl(clr),clr.h=rgb.h,clr.s=rgb.s,clr.l=rgb.l,rgb=R.rgb2hsb(clr),clr.v=rgb.b):(clr={hex:"none"},clr.r=clr.g=clr.b=clr.h=clr.s=clr.v=clr.l=-1)),clr.toString=rgbtoString,clr},R.hsb2rgb=function(h,s,v,o){this.is(h,"object")&&"h"in h&&"s"in h&&"b"in h&&(v=h.b,s=h.s,o=h.o,h=h.h),h*=360;var R,G,B,X,C;return h=h%360/60,C=v*s,X=C*(1-abs(h%2-1)),R=G=B=v-C,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],packageRGB(R,G,B,o)},R.hsl2rgb=function(h,s,l,o){this.is(h,"object")&&"h"in h&&"s"in h&&"l"in h&&(l=h.l,s=h.s,h=h.h),(h>1||s>1||l>1)&&(h/=360,s/=100,l/=100),h*=360;var R,G,B,X,C;return h=h%360/60,C=2*s*(l<.5?l:1-l),X=C*(1-abs(h%2-1)),R=G=B=l-C/2,h=~~h,R+=[C,X,0,0,X,C][h],G+=[X,C,C,X,0,0][h],B+=[0,0,X,C,C,X][h],packageRGB(R,G,B,o)},R.rgb2hsb=function(r,g,b){b=prepareRGB(r,g,b),r=b[0],g=b[1],b=b[2];var H,S,V,C;return V=mmax(r,g,b),C=V-mmin(r,g,b),H=0==C?null:V==r?(g-b)/C:V==g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,S=0==C?0:C/V,{h:H,s:S,b:V,toString:hsbtoString}},R.rgb2hsl=function(r,g,b){b=prepareRGB(r,g,b),r=b[0],g=b[1],b=b[2];var H,S,L,M,m,C;return M=mmax(r,g,b),m=mmin(r,g,b),C=M-m,H=0==C?null:M==r?(g-b)/C:M==g?(b-r)/C+2:(r-g)/C+4,H=(H+360)%6*60/360,L=(M+m)/2,S=0==C?0:L<.5?C/(2*L):C/(2-2*L),{h:H,s:S,l:L,toString:hsltoString}},R._path2string=function(){return this.join(",").replace(p2s,"$1")};R._preload=function(src,f){var img=g.doc.createElement("img");img.style.cssText="position:absolute;left:-9999em;top:-9999em",img.onload=function(){f.call(this),this.onload=null,g.doc.body.removeChild(this)},img.onerror=function(){g.doc.body.removeChild(this)},g.doc.body.appendChild(img),img.src=src};R.getRGB=cacher(function(colour){if(!colour||(colour=Str(colour)).indexOf("-")+1)return{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString};if("none"==colour)return{r:-1,g:-1,b:-1,hex:"none",toString:clrToString};!(hsrg[has](colour.toLowerCase().substring(0,2))||"#"==colour.charAt())&&(colour=_toHex(colour));var red,green,blue,opacity,t,values,rgb=colour.match(colourRegExp);return rgb?(rgb[2]&&(blue=toInt(rgb[2].substring(5),16),green=toInt(rgb[2].substring(3,5),16),red=toInt(rgb[2].substring(1,3),16)),rgb[3]&&(blue=toInt((t=rgb[3].charAt(3))+t,16),green=toInt((t=rgb[3].charAt(2))+t,16),red=toInt((t=rgb[3].charAt(1))+t,16)),rgb[4]&&(values=rgb[4][split](commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red*=2.55),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green*=2.55),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue*=2.55),"rgba"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100)),rgb[5]?(values=rgb[5][split](commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red*=2.55),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green*=2.55),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue*=2.55),("deg"==values[0].slice(-3)||"°"==values[0].slice(-1))&&(red/=360),"hsba"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100),R.hsb2rgb(red,green,blue,opacity)):rgb[6]?(values=rgb[6][split](commaSpaces),red=toFloat(values[0]),"%"==values[0].slice(-1)&&(red*=2.55),green=toFloat(values[1]),"%"==values[1].slice(-1)&&(green*=2.55),blue=toFloat(values[2]),"%"==values[2].slice(-1)&&(blue*=2.55),("deg"==values[0].slice(-3)||"°"==values[0].slice(-1))&&(red/=360),"hsla"==rgb[1].toLowerCase().slice(0,4)&&(opacity=toFloat(values[3])),values[3]&&"%"==values[3].slice(-1)&&(opacity/=100),R.hsl2rgb(red,green,blue,opacity)):(rgb={r:red,g:green,b:blue,toString:clrToString},rgb.hex="#"+(16777216|blue|green<<8|red<<16).toString(16).slice(1),R.is(opacity,"finite")&&(rgb.opacity=opacity),rgb)):{r:-1,g:-1,b:-1,hex:"none",error:1,toString:clrToString}},R),R.hsb=cacher(function(h,s,b){return R.hsb2rgb(h,s,b).hex}),R.hsl=cacher(function(h,s,l){return R.hsl2rgb(h,s,l).hex}),R.rgb=cacher(function(r,g,b){function round(x){return x+.5|0}return"#"+(16777216|round(b)|round(g)<<8|round(r)<<16).toString(16).slice(1)}),R.getColor=function(value){var start=this.getColor.start=this.getColor.start||{h:0,s:1,b:value||.75},rgb=this.hsb2rgb(start.h,start.s,start.b);return start.h+=.075,start.h>1&&(start.h=0,start.s-=.2,start.s<=0&&(this.getColor.start={h:0,s:1,b:start.b})),rgb.hex},R.getColor.reset=function(){delete this.start},R.parsePathString=function(pathString){if(!pathString)return null;var pth=paths(pathString);if(pth.arr)return pathClone(pth.arr);var paramCounts={a:7,c:6,h:1,l:2,m:2,r:4,q:4,s:4,t:2,v:1,z:0},data=[];return R.is(pathString,array)&&R.is(pathString[0],array)&&(data=pathClone(pathString)),data.length||Str(pathString).replace(pathCommand,function(a,b,c){var params=[],name=b.toLowerCase();if(c.replace(pathValues,function(a,b){b&&params.push(+b)}),"m"==name&&params.length>2&&(data.push([b][concat](params.splice(0,2))),name="l",b="m"==b?"l":"L"),"r"==name)data.push([b][concat](params));else for(;params.length>=paramCounts[name]&&(data.push([b][concat](params.splice(0,paramCounts[name]))),paramCounts[name]););}),data.toString=R._path2string,pth.arr=pathClone(data),data},R.parseTransformString=cacher(function(TString){if(!TString)return null;var data=[];return R.is(TString,array)&&R.is(TString[0],array)&&(data=pathClone(TString)),data.length||Str(TString).replace(tCommand,function(a,b,c){var params=[];lowerCase.call(b);c.replace(pathValues,function(a,b){b&&params.push(+b)}),data.push([b][concat](params))}),data.toString=R._path2string,data});var paths=function paths(ps){var p=paths.ps=paths.ps||{};return p[ps]?p[ps].sleep=100:p[ps]={sleep:100},setTimeout(function(){for(var key in p)p[has](key)&&key!=ps&&!--p[key].sleep&&delete p[key]}),p[ps]};R.findDotsAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t,t13=pow(t1,3),t12=pow(t1,2),t2=t*t,t3=t2*t,x=t13*p1x+3*t12*t*c1x+3*t1*t*t*c2x+t3*p2x,y=t13*p1y+3*t12*t*c1y+3*t1*t*t*c2y+t3*p2y,mx=p1x+2*t*(c1x-p1x)+t2*(c2x-2*c1x+p1x),my=p1y+2*t*(c1y-p1y)+t2*(c2y-2*c1y+p1y),nx=c1x+2*t*(c2x-c1x)+t2*(p2x-2*c2x+c1x),ny=c1y+2*t*(c2y-c1y)+t2*(p2y-2*c2y+c1y),ax=t1*p1x+t*c1x,ay=t1*p1y+t*c1y,cx=t1*c2x+t*p2x,cy=t1*c2y+t*p2y,alpha=90-180*math.atan2(mx-nx,my-ny)/PI;return(mx>nx||my<ny)&&(alpha+=180),{x:x,y:y,m:{x:mx,y:my},n:{x:nx,y:ny},start:{x:ax,y:ay},end:{x:cx,y:cy},alpha:alpha}},R.bezierBBox=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){R.is(p1x,"array")||(p1x=[p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y]);var bbox=curveDim.apply(null,p1x);return{x:bbox.min.x,y:bbox.min.y,x2:bbox.max.x,y2:bbox.max.y,width:bbox.max.x-bbox.min.x,height:bbox.max.y-bbox.min.y}},R.isPointInsideBBox=function(bbox,x,y){return x>=bbox.x&&x<=bbox.x2&&y>=bbox.y&&y<=bbox.y2},R.isBBoxIntersect=function(bbox1,bbox2){var i=R.isPointInsideBBox;return i(bbox2,bbox1.x,bbox1.y)||i(bbox2,bbox1.x2,bbox1.y)||i(bbox2,bbox1.x,bbox1.y2)||i(bbox2,bbox1.x2,bbox1.y2)||i(bbox1,bbox2.x,bbox2.y)||i(bbox1,bbox2.x2,bbox2.y)||i(bbox1,bbox2.x,bbox2.y2)||i(bbox1,bbox2.x2,bbox2.y2)||(bbox1.x<bbox2.x2&&bbox1.x>bbox2.x||bbox2.x<bbox1.x2&&bbox2.x>bbox1.x)&&(bbox1.y<bbox2.y2&&bbox1.y>bbox2.y||bbox2.y<bbox1.y2&&bbox2.y>bbox1.y)},R.pathIntersection=function(path1,path2){return interPathHelper(path1,path2)},R.pathIntersectionNumber=function(path1,path2){return interPathHelper(path1,path2,1)},R.isPointInsidePath=function(path,x,y){var bbox=R.pathBBox(path);return R.isPointInsideBBox(bbox,x,y)&&interPathHelper(path,[["M",x,y],["H",bbox.x2+10]],1)%2==1},R._removedFactory=function(methodname){return function(){eve("raphael.log",null,"Raphaël: you are calling to method “"+methodname+"” of removed object",methodname)}};var pathDimensions=R.pathBBox=function(path){var pth=paths(path);if(pth.bbox)return clone(pth.bbox);if(!path)return{x:0,y:0,width:0,height:0,x2:0,y2:0};path=path2curve(path);for(var p,x=0,y=0,X=[],Y=[],i=0,ii=path.length;i<ii;i++)if(p=path[i],"M"==p[0])x=p[1],y=p[2],X.push(x),Y.push(y);else{var dim=curveDim(x,y,p[1],p[2],p[3],p[4],p[5],p[6]);X=X[concat](dim.min.x,dim.max.x),Y=Y[concat](dim.min.y,dim.max.y),x=p[5],y=p[6]}var xmin=mmin[apply](0,X),ymin=mmin[apply](0,Y),xmax=mmax[apply](0,X),ymax=mmax[apply](0,Y),width=xmax-xmin,height=ymax-ymin,bb={x:xmin,y:ymin,x2:xmax,y2:ymax,width:width,height:height,cx:xmin+width/2,cy:ymin+height/2};return pth.bbox=clone(bb),bb},pathClone=function(pathArray){var res=clone(pathArray);return res.toString=R._path2string,res},pathToRelative=R._pathToRelative=function(pathArray){var pth=paths(pathArray);if(pth.rel)return pathClone(pth.rel);R.is(pathArray,array)&&R.is(pathArray&&pathArray[0],array)||(pathArray=R.parsePathString(pathArray));var res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=pathArray[0][1],y=pathArray[0][2],mx=x,my=y,start++,res.push(["M",x,y]));for(var i=start,ii=pathArray.length;i<ii;i++){var r=res[i]=[],pa=pathArray[i];if(pa[0]!=lowerCase.call(pa[0]))switch(r[0]=lowerCase.call(pa[0]),r[0]){case"a":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+(pa[6]-x).toFixed(3),r[7]=+(pa[7]-y).toFixed(3);break;case"v":r[1]=+(pa[1]-y).toFixed(3);break;case"m":mx=pa[1],my=pa[2];default:for(var j=1,jj=pa.length;j<jj;j++)r[j]=+(pa[j]-(j%2?x:y)).toFixed(3)}else{r=res[i]=[],"m"==pa[0]&&(mx=pa[1]+x,my=pa[2]+y);for(var k=0,kk=pa.length;k<kk;k++)res[i][k]=pa[k]}var len=res[i].length;switch(res[i][0]){case"z":x=mx,y=my;break;case"h":x+=+res[i][len-1];break;case"v":y+=+res[i][len-1];break;default:x+=+res[i][len-2],y+=+res[i][len-1]}}return res.toString=R._path2string,pth.rel=pathClone(res),res},pathToAbsolute=R._pathToAbsolute=function(pathArray){var pth=paths(pathArray);if(pth.abs)return pathClone(pth.abs);if(R.is(pathArray,array)&&R.is(pathArray&&pathArray[0],array)||(pathArray=R.parsePathString(pathArray)),!pathArray||!pathArray.length)return[["M",0,0]];var res=[],x=0,y=0,mx=0,my=0,start=0;"M"==pathArray[0][0]&&(x=+pathArray[0][1],y=+pathArray[0][2],mx=x,my=y,start++,res[0]=["M",x,y]);for(var r,pa,crz=3==pathArray.length&&"M"==pathArray[0][0]&&"R"==pathArray[1][0].toUpperCase()&&"Z"==pathArray[2][0].toUpperCase(),i=start,ii=pathArray.length;i<ii;i++){if(res.push(r=[]),pa=pathArray[i],pa[0]!=upperCase.call(pa[0]))switch(r[0]=upperCase.call(pa[0]),r[0]){case"A":r[1]=pa[1],r[2]=pa[2],r[3]=pa[3],r[4]=pa[4],r[5]=pa[5],r[6]=+(pa[6]+x),r[7]=+(pa[7]+y);break;case"V":r[1]=+pa[1]+y;break;case"H":r[1]=+pa[1]+x;break;case"R":for(var dots=[x,y][concat](pa.slice(1)),j=2,jj=dots.length;j<jj;j++)dots[j]=+dots[j]+x,dots[++j]=+dots[j]+y;res.pop(),res=res[concat](catmullRom2bezier(dots,crz));break;case"M":mx=+pa[1]+x,my=+pa[2]+y;default:for(j=1,jj=pa.length;j<jj;j++)r[j]=+pa[j]+(j%2?x:y)}else if("R"==pa[0])dots=[x,y][concat](pa.slice(1)),res.pop(),res=res[concat](catmullRom2bezier(dots,crz)),r=["R"][concat](pa.slice(-2));else for(var k=0,kk=pa.length;k<kk;k++)r[k]=pa[k];switch(r[0]){case"Z":x=mx,y=my;break;case"H":x=r[1];break;case"V":y=r[1];break;case"M":mx=r[r.length-2],my=r[r.length-1];default:x=r[r.length-2],y=r[r.length-1]}}return res.toString=R._path2string,pth.abs=pathClone(res),res},l2c=function(x1,y1,x2,y2){return[x1,y1,x2,y2,x2,y2]},q2c=function(x1,y1,ax,ay,x2,y2){return[1/3*x1+2/3*ax,1/3*y1+2/3*ay,1/3*x2+2/3*ax,1/3*y2+2/3*ay,x2,y2]},a2c=function a2c(x1,y1,rx,ry,angle,large_arc_flag,sweep_flag,x2,y2,recursive){var xy,_120=120*PI/180,rad=PI/180*(+angle||0),res=[],rotate=cacher(function(x,y,rad){return{x:x*math.cos(rad)-y*math.sin(rad),y:x*math.sin(rad)+y*math.cos(rad)}});if(recursive)f1=recursive[0],f2=recursive[1],cx=recursive[2],cy=recursive[3];else{xy=rotate(x1,y1,-rad),x1=xy.x,y1=xy.y,xy=rotate(x2,y2,-rad),x2=xy.x,y2=xy.y;var x=(math.cos(PI/180*angle),math.sin(PI/180*angle),(x1-x2)/2),y=(y1-y2)/2,h=x*x/(rx*rx)+y*y/(ry*ry);h>1&&(h=math.sqrt(h),rx*=h,ry*=h);var rx2=rx*rx,ry2=ry*ry,k=(large_arc_flag==sweep_flag?-1:1)*math.sqrt(abs((rx2*ry2-rx2*y*y-ry2*x*x)/(rx2*y*y+ry2*x*x))),cx=k*rx*y/ry+(x1+x2)/2,cy=k*-ry*x/rx+(y1+y2)/2,f1=math.asin(((y1-cy)/ry).toFixed(9)),f2=math.asin(((y2-cy)/ry).toFixed(9));f1=x1<cx?PI-f1:f1,f2=x2<cx?PI-f2:f2,f1<0&&(f1=2*PI+f1),f2<0&&(f2=2*PI+f2),sweep_flag&&f1>f2&&(f1-=2*PI),!sweep_flag&&f2>f1&&(f2-=2*PI)}var df=f2-f1;if(abs(df)>_120){var f2old=f2,x2old=x2,y2old=y2;f2=f1+_120*(sweep_flag&&f2>f1?1:-1),x2=cx+rx*math.cos(f2),y2=cy+ry*math.sin(f2),res=a2c(x2,y2,rx,ry,angle,0,sweep_flag,x2old,y2old,[f2,f2old,cx,cy])}df=f2-f1;var c1=math.cos(f1),s1=math.sin(f1),c2=math.cos(f2),s2=math.sin(f2),t=math.tan(df/4),hx=4/3*rx*t,hy=4/3*ry*t,m1=[x1,y1],m2=[x1+hx*s1,y1-hy*c1],m3=[x2+hx*s2,y2-hy*c2],m4=[x2,y2];if(m2[0]=2*m1[0]-m2[0],m2[1]=2*m1[1]-m2[1],recursive)return[m2,m3,m4][concat](res);res=[m2,m3,m4][concat](res).join()[split](",");for(var newres=[],i=0,ii=res.length;i<ii;i++)newres[i]=i%2?rotate(res[i-1],res[i],rad).y:rotate(res[i],res[i+1],rad).x;return newres},findDotAtSegment=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t){var t1=1-t;return{x:pow(t1,3)*p1x+3*pow(t1,2)*t*c1x+3*t1*t*t*c2x+pow(t,3)*p2x,y:pow(t1,3)*p1y+3*pow(t1,2)*t*c1y+3*t1*t*t*c2y+pow(t,3)*p2y}},curveDim=cacher(function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y){var dot,a=c2x-2*c1x+p1x-(p2x-2*c2x+c1x),b=2*(c1x-p1x)-2*(c2x-c1x),c=p1x-c1x,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,y=[p1y,p2y],x=[p1x,p2x];return abs(t1)>"1e12"&&(t1=.5),abs(t2)>"1e12"&&(t2=.5),t1>0&&t1<1&&(dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1),x.push(dot.x),y.push(dot.y)),t2>0&&t2<1&&(dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2),x.push(dot.x),y.push(dot.y)),a=c2y-2*c1y+p1y-(p2y-2*c2y+c1y),b=2*(c1y-p1y)-2*(c2y-c1y),c=p1y-c1y,t1=(-b+math.sqrt(b*b-4*a*c))/2/a,t2=(-b-math.sqrt(b*b-4*a*c))/2/a,abs(t1)>"1e12"&&(t1=.5),abs(t2)>"1e12"&&(t2=.5),t1>0&&t1<1&&(dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t1),x.push(dot.x),y.push(dot.y)),t2>0&&t2<1&&(dot=findDotAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,t2),x.push(dot.x),y.push(dot.y)),{min:{x:mmin[apply](0,x),y:mmin[apply](0,y)},max:{x:mmax[apply](0,x),y:mmax[apply](0,y)}}}),path2curve=R._path2curve=cacher(function(path,path2){var pth=!path2&&paths(path);if(!path2&&pth.curve)return pathClone(pth.curve);for(var p=pathToAbsolute(path),p2=path2&&pathToAbsolute(path2),attrs={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},attrs2={x:0,y:0,bx:0,by:0,X:0,Y:0,qx:null,qy:null},processPath=(function(path,d,pcom){var nx,ny,tq={T:1,Q:1};if(!path)return["C",d.x,d.y,d.x,d.y,d.x,d.y];switch(!(path[0]in tq)&&(d.qx=d.qy=null),path[0]){case"M":d.X=path[1],d.Y=path[2];break;case"A":path=["C"][concat](a2c[apply](0,[d.x,d.y][concat](path.slice(1))));break;case"S":"C"==pcom||"S"==pcom?(nx=2*d.x-d.bx,ny=2*d.y-d.by):(nx=d.x,ny=d.y),path=["C",nx,ny][concat](path.slice(1));break;case"T":"Q"==pcom||"T"==pcom?(d.qx=2*d.x-d.qx,d.qy=2*d.y-d.qy):(d.qx=d.x,d.qy=d.y),path=["C"][concat](q2c(d.x,d.y,d.qx,d.qy,path[1],path[2]));break;case"Q":d.qx=path[1],d.qy=path[2],path=["C"][concat](q2c(d.x,d.y,path[1],path[2],path[3],path[4]));break;case"L":path=["C"][concat](l2c(d.x,d.y,path[1],path[2]));break;case"H":path=["C"][concat](l2c(d.x,d.y,path[1],d.y));break;case"V":path=["C"][concat](l2c(d.x,d.y,d.x,path[1]));break;case"Z":path=["C"][concat](l2c(d.x,d.y,d.X,d.Y))}return path}),fixArc=function(pp,i){if(pp[i].length>7){pp[i].shift();for(var pi=pp[i];pi.length;)pcoms1[i]="A",p2&&(pcoms2[i]="A"),pp.splice(i++,0,["C"][concat](pi.splice(0,6)));pp.splice(i,1),ii=mmax(p.length,p2&&p2.length||0)}},fixM=function(path1,path2,a1,a2,i){path1&&path2&&"M"==path1[i][0]&&"M"!=path2[i][0]&&(path2.splice(i,0,["M",a2.x,a2.y]),a1.bx=0,a1.by=0,a1.x=path1[i][1],a1.y=path1[i][2],ii=mmax(p.length,p2&&p2.length||0))},pcoms1=[],pcoms2=[],pfirst="",pcom="",i=0,ii=mmax(p.length,p2&&p2.length||0);i<ii;i++){p[i]&&(pfirst=p[i][0]),"C"!=pfirst&&(pcoms1[i]=pfirst,i&&(pcom=pcoms1[i-1])),p[i]=processPath(p[i],attrs,pcom),"A"!=pcoms1[i]&&"C"==pfirst&&(pcoms1[i]="C"),fixArc(p,i),p2&&(p2[i]&&(pfirst=p2[i][0]),"C"!=pfirst&&(pcoms2[i]=pfirst,i&&(pcom=pcoms2[i-1])),p2[i]=processPath(p2[i],attrs2,pcom),"A"!=pcoms2[i]&&"C"==pfirst&&(pcoms2[i]="C"),fixArc(p2,i)),fixM(p,p2,attrs,attrs2,i),fixM(p2,p,attrs2,attrs,i);var seg=p[i],seg2=p2&&p2[i],seglen=seg.length,seg2len=p2&&seg2.length;attrs.x=seg[seglen-2],attrs.y=seg[seglen-1],attrs.bx=toFloat(seg[seglen-4])||attrs.x,attrs.by=toFloat(seg[seglen-3])||attrs.y,attrs2.bx=p2&&(toFloat(seg2[seg2len-4])||attrs2.x),attrs2.by=p2&&(toFloat(seg2[seg2len-3])||attrs2.y),attrs2.x=p2&&seg2[seg2len-2],attrs2.y=p2&&seg2[seg2len-1]}return p2||(pth.curve=pathClone(p)),p2?[p,p2]:p},null,pathClone),tear=(R._parseDots=cacher(function(gradient){for(var dots=[],i=0,ii=gradient.length;i<ii;i++){var dot={},par=gradient[i].match(/^([^:]*):?([\d\.]*)/);if(dot.color=R.getRGB(par[1]),dot.color.error)return null;dot.opacity=dot.color.opacity,dot.color=dot.color.hex,par[2]&&(dot.offset=par[2]+"%"),dots.push(dot)}for(i=1,ii=dots.length-1;i<ii;i++)if(!dots[i].offset){for(var start=toFloat(dots[i-1].offset||0),end=0,j=i+1;j<ii;j++)if(dots[j].offset){end=dots[j].offset;break}end||(end=100,j=ii),end=toFloat(end);for(var d=(end-start)/(j-i+1);i<j;i++)start+=d,dots[i].offset=start+"%"}return dots}),R._tear=function(el,paper){el==paper.top&&(paper.top=el.prev),el==paper.bottom&&(paper.bottom=el.next),el.next&&(el.next.prev=el.prev),el.prev&&(el.prev.next=el.next)}),toMatrix=(R._tofront=function(el,paper){paper.top!==el&&(tear(el,paper),el.next=null,el.prev=paper.top,paper.top.next=el,paper.top=el)},R._toback=function(el,paper){paper.bottom!==el&&(tear(el,paper),el.next=paper.bottom,el.prev=null,paper.bottom.prev=el,paper.bottom=el)},R._insertafter=function(el,el2,paper){tear(el,paper),el2==paper.top&&(paper.top=el),el2.next&&(el2.next.prev=el),el.next=el2.next,el.prev=el2,el2.next=el},R._insertbefore=function(el,el2,paper){tear(el,paper),el2==paper.bottom&&(paper.bottom=el),el2.prev&&(el2.prev.next=el),el.prev=el2.prev,el2.prev=el,el.next=el2},R.toMatrix=function(path,transform){var bb=pathDimensions(path),el={_:{transform:E},getBBox:function(){return bb}};return extractTransform(el,transform),el.matrix}),extractTransform=(R.transformPath=function(path,transform){return mapPath(path,toMatrix(path,transform))},R._extractTransform=function(el,tstr){if(null==tstr)return el._.transform;tstr=Str(tstr).replace(/\.{3}|\u2026/g,el._.transform||E);var tdata=R.parseTransformString(tstr),deg=0,dx=0,dy=0,sx=1,sy=1,_=el._,m=new Matrix;if(_.transform=tdata||[],tdata)for(var i=0,ii=tdata.length;i<ii;i++){var x1,y1,x2,y2,bb,t=tdata[i],tlen=t.length,command=Str(t[0]).toLowerCase(),absolute=t[0]!=command,inver=absolute?m.invert():0;"t"==command&&3==tlen?absolute?(x1=inver.x(0,0),y1=inver.y(0,0),x2=inver.x(t[1],t[2]),y2=inver.y(t[1],t[2]),m.translate(x2-x1,y2-y1)):m.translate(t[1],t[2]):"r"==command?2==tlen?(bb=bb||el.getBBox(1),m.rotate(t[1],bb.x+bb.width/2,bb.y+bb.height/2),deg+=t[1]):4==tlen&&(absolute?(x2=inver.x(t[2],t[3]),y2=inver.y(t[2],t[3]),m.rotate(t[1],x2,y2)):m.rotate(t[1],t[2],t[3]),deg+=t[1]):"s"==command?2==tlen||3==tlen?(bb=bb||el.getBBox(1),m.scale(t[1],t[tlen-1],bb.x+bb.width/2,bb.y+bb.height/2),sx*=t[1],sy*=t[tlen-1]):5==tlen&&(absolute?(x2=inver.x(t[3],t[4]),y2=inver.y(t[3],t[4]),m.scale(t[1],t[2],x2,y2)):m.scale(t[1],t[2],t[3],t[4]),sx*=t[1],sy*=t[2]):"m"==command&&7==tlen&&m.add(t[1],t[2],t[3],t[4],t[5],t[6]),_.dirtyT=1,el.matrix=m}el.matrix=m,_.sx=sx,_.sy=sy,_.deg=deg,_.dx=dx=m.e,_.dy=dy=m.f,1==sx&&1==sy&&!deg&&_.bbox?(_.bbox.x+=+dx,_.bbox.y+=+dy):_.dirtyT=1}),getEmpty=function(item){var l=item[0];switch(l.toLowerCase()){case"t":return[l,0,0];case"m":return[l,1,0,0,1,0,0];case"r":return 4==item.length?[l,0,item[2],item[3]]:[l,0];case"s":return 5==item.length?[l,1,1,item[3],item[4]]:3==item.length?[l,1,1]:[l,1]}},equaliseTransform=R._equaliseTransform=function(t1,t2){t2=Str(t2).replace(/\.{3}|\u2026/g,t1),t1=R.parseTransformString(t1)||[],t2=R.parseTransformString(t2)||[];for(var j,jj,tt1,tt2,maxlength=mmax(t1.length,t2.length),from=[],to=[],i=0;i<maxlength;i++){if(tt1=t1[i]||getEmpty(t2[i]),tt2=t2[i]||getEmpty(tt1),tt1[0]!=tt2[0]||"r"==tt1[0].toLowerCase()&&(tt1[2]!=tt2[2]||tt1[3]!=tt2[3])||"s"==tt1[0].toLowerCase()&&(tt1[3]!=tt2[3]||tt1[4]!=tt2[4]))return;for(from[i]=[],to[i]=[],j=0,jj=mmax(tt1.length,tt2.length);j<jj;j++)j in tt1&&(from[i][j]=tt1[j]),j in tt2&&(to[i][j]=tt2[j])}return{from:from,to:to}};R._getContainer=function(x,y,w,h){var container;if(null!=(container=null!=h||R.is(x,"object")?x:g.doc.getElementById(x)))return container.tagName?null==y?{container:container,width:container.style.pixelWidth||container.offsetWidth,height:container.style.pixelHeight||container.offsetHeight}:{container:container,width:y,height:w}:{container:1,x:x,y:y,width:w,height:h}},R.pathToRelative=pathToRelative,R._engine={},R.path2curve=path2curve,R.matrix=function(a,b,c,d,e,f){return new Matrix(a,b,c,d,e,f)},function(matrixproto){function norm(a){return a[0]*a[0]+a[1]*a[1]}function normalize(a){var mag=math.sqrt(norm(a));a[0]&&(a[0]/=mag),a[1]&&(a[1]/=mag)}matrixproto.add=function(a,b,c,d,e,f){var x,y,z,res,out=[[],[],[]],m=[[this.a,this.c,this.e],[this.b,this.d,this.f],[0,0,1]],matrix=[[a,c,e],[b,d,f],[0,0,1]];for(a&&a instanceof Matrix&&(matrix=[[a.a,a.c,a.e],[a.b,a.d,a.f],[0,0,1]]),x=0;x<3;x++)for(y=0;y<3;y++){for(res=0,z=0;z<3;z++)res+=m[x][z]*matrix[z][y];out[x][y]=res}this.a=out[0][0],this.b=out[1][0],this.c=out[0][1],this.d=out[1][1],this.e=out[0][2],this.f=out[1][2]},matrixproto.invert=function(){var me=this,x=me.a*me.d-me.b*me.c;return new Matrix(me.d/x,-me.b/x,-me.c/x,me.a/x,(me.c*me.f-me.d*me.e)/x,(me.b*me.e-me.a*me.f)/x)},matrixproto.clone=function(){return new Matrix(this.a,this.b,this.c,this.d,this.e,this.f)},matrixproto.translate=function(x,y){this.add(1,0,0,1,x,y)},matrixproto.scale=function(x,y,cx,cy){null==y&&(y=x),(cx||cy)&&this.add(1,0,0,1,cx,cy),this.add(x,0,0,y,0,0),(cx||cy)&&this.add(1,0,0,1,-cx,-cy)},matrixproto.rotate=function(a,x,y){a=R.rad(a),x=x||0,y=y||0;var cos=+math.cos(a).toFixed(9),sin=+math.sin(a).toFixed(9);this.add(cos,sin,-sin,cos,x,y),this.add(1,0,0,1,-x,-y)},matrixproto.x=function(x,y){return x*this.a+y*this.c+this.e},matrixproto.y=function(x,y){return x*this.b+y*this.d+this.f},matrixproto.get=function(i){return+this[Str.fromCharCode(97+i)].toFixed(4)},matrixproto.toString=function(){return R.svg?"matrix("+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)].join()+")":[this.get(0),this.get(2),this.get(1),this.get(3),0,0].join()},matrixproto.toFilter=function(){return"progid:DXImageTransform.Microsoft.Matrix(M11="+this.get(0)+", M12="+this.get(2)+", M21="+this.get(1)+", M22="+this.get(3)+", Dx="+this.get(4)+", Dy="+this.get(5)+", sizingmethod='auto expand')"},matrixproto.offset=function(){return[this.e.toFixed(4),this.f.toFixed(4)]},matrixproto.split=function(){var out={};out.dx=this.e,out.dy=this.f;var row=[[this.a,this.c],[this.b,this.d]];out.scalex=math.sqrt(norm(row[0])),normalize(row[0]),out.shear=row[0][0]*row[1][0]+row[0][1]*row[1][1],row[1]=[row[1][0]-row[0][0]*out.shear,row[1][1]-row[0][1]*out.shear],out.scaley=math.sqrt(norm(row[1])),normalize(row[1]),out.shear/=out.scaley;var sin=-row[0][1],cos=row[1][1];return cos<0?(out.rotate=R.deg(math.acos(cos)),sin<0&&(out.rotate=360-out.rotate)):out.rotate=R.deg(math.asin(sin)),out.isSimple=!(+out.shear.toFixed(9)||out.scalex.toFixed(9)!=out.scaley.toFixed(9)&&out.rotate),out.isSuperSimple=!+out.shear.toFixed(9)&&out.scalex.toFixed(9)==out.scaley.toFixed(9)&&!out.rotate,out.noRotation=!+out.shear.toFixed(9)&&!out.rotate,out},matrixproto.toTransformString=function(shorter){var s=shorter||this[split]();return s.isSimple?(s.scalex=+s.scalex.toFixed(4),s.scaley=+s.scaley.toFixed(4),s.rotate=+s.rotate.toFixed(4),(s.dx||s.dy?"t"+[s.dx,s.dy]:E)+(1!=s.scalex||1!=s.scaley?"s"+[s.scalex,s.scaley,0,0]:E)+(s.rotate?"r"+[s.rotate,0,0]:E)):"m"+[this.get(0),this.get(1),this.get(2),this.get(3),this.get(4),this.get(5)]}}(Matrix.prototype);for(var preventDefault=function(){this.returnValue=!1},preventTouch=function(){return this.originalEvent.preventDefault()},stopPropagation=function(){this.cancelBubble=!0},stopTouch=function(){return this.originalEvent.stopPropagation()},getEventPosition=function(e){var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft;return{x:e.clientX+scrollX,y:e.clientY+scrollY}},addEvent=function(){return g.doc.addEventListener?function(obj,type,fn,element){var f=function(e){var pos=getEventPosition(e);return fn.call(element,e,pos.x,pos.y)};if(obj.addEventListener(type,f,!1),supportsTouch&&touchMap[type]){var _f=function(e){for(var pos=getEventPosition(e),olde=e,i=0,ii=e.targetTouches&&e.targetTouches.length;i<ii;i++)if(e.targetTouches[i].target==obj){e=e.targetTouches[i],e.originalEvent=olde,e.preventDefault=preventTouch,e.stopPropagation=stopTouch;break}return fn.call(element,e,pos.x,pos.y)};obj.addEventListener(touchMap[type],_f,!1)}return function(){return obj.removeEventListener(type,f,!1),supportsTouch&&touchMap[type]&&obj.removeEventListener(touchMap[type],_f,!1),!0}}:g.doc.attachEvent?function(obj,type,fn,element){var f=function(e){e=e||g.win.event;var scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,x=e.clientX+scrollX,y=e.clientY+scrollY;return e.preventDefault=e.preventDefault||preventDefault,e.stopPropagation=e.stopPropagation||stopPropagation,fn.call(element,e,x,y)};return obj.attachEvent("on"+type,f),function(){return obj.detachEvent("on"+type,f),!0}}:void 0}(),drag=[],dragMove=function(e){for(var dragi,x=e.clientX,y=e.clientY,scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft,j=drag.length;j--;){if(dragi=drag[j],supportsTouch&&e.touches){for(var touch,i=e.touches.length;i--;)if(touch=e.touches[i],touch.identifier==dragi.el._drag.id){x=touch.clientX,y=touch.clientY,(e.originalEvent?e.originalEvent:e).preventDefault();break}}else e.preventDefault();var o,node=dragi.el.node,next=node.nextSibling,parent=node.parentNode,display=node.style.display;g.win.opera&&parent.removeChild(node),node.style.display="none",o=dragi.el.paper.getElementByPoint(x,y),node.style.display=display,g.win.opera&&(next?parent.insertBefore(node,next):parent.appendChild(node)),o&&eve("raphael.drag.over."+dragi.el.id,dragi.el,o),x+=scrollX,y+=scrollY,eve("raphael.drag.move."+dragi.el.id,dragi.move_scope||dragi.el,x-dragi.el._drag.x,y-dragi.el._drag.y,x,y,e)}},dragUp=function dragUp(e){R.unmousemove(dragMove).unmouseup(dragUp);for(var dragi,i=drag.length;i--;)dragi=drag[i],dragi.el._drag={},eve("raphael.drag.end."+dragi.el.id,dragi.end_scope||dragi.start_scope||dragi.move_scope||dragi.el,e);drag=[]},elproto=R.el={},i=events.length;i--;)!function(eventName){R[eventName]=elproto[eventName]=function(fn,scope){return R.is(fn,"function")&&(this.events=this.events||[],this.events.push({name:eventName,f:fn,unbind:addEvent(this.shape||this.node||g.doc,eventName,fn,scope||this)})),this},R["un"+eventName]=elproto["un"+eventName]=function(fn){for(var events=this.events||[],l=events.length;l--;)events[l].name!=eventName||!R.is(fn,"undefined")&&events[l].f!=fn||(events[l].unbind(),events.splice(l,1),!events.length&&delete this.events);return this}}(events[i]);elproto.data=function(key,value){var data=eldata[this.id]=eldata[this.id]||{};if(0==arguments.length)return data;if(1==arguments.length){if(R.is(key,"object")){for(var i in key)key[has](i)&&this.data(i,key[i]);return this}return eve("raphael.data.get."+this.id,this,data[key],key),data[key]}return data[key]=value,eve("raphael.data.set."+this.id,this,value,key),this},elproto.removeData=function(key){return null==key?eldata[this.id]={}:eldata[this.id]&&delete eldata[this.id][key],this},elproto.getData=function(){return clone(eldata[this.id]||{})},elproto.hover=function(f_in,f_out,scope_in,scope_out){return this.mouseover(f_in,scope_in).mouseout(f_out,scope_out||scope_in)},elproto.unhover=function(f_in,f_out){return this.unmouseover(f_in).unmouseout(f_out)};var draggable=[];elproto.drag=function(onmove,onstart,onend,move_scope,start_scope,end_scope){function start(e){(e.originalEvent||e).preventDefault();var x=e.clientX,y=e.clientY,scrollY=g.doc.documentElement.scrollTop||g.doc.body.scrollTop,scrollX=g.doc.documentElement.scrollLeft||g.doc.body.scrollLeft;if(this._drag.id=e.identifier,supportsTouch&&e.touches)for(var touch,i=e.touches.length;i--;)if(touch=e.touches[i],this._drag.id=touch.identifier,touch.identifier==this._drag.id){x=touch.clientX,y=touch.clientY;break}this._drag.x=x+scrollX,this._drag.y=y+scrollY,!drag.length&&R.mousemove(dragMove).mouseup(dragUp),drag.push({el:this,move_scope:move_scope,start_scope:start_scope,end_scope:end_scope}),onstart&&eve.on("raphael.drag.start."+this.id,onstart),onmove&&eve.on("raphael.drag.move."+this.id,onmove),onend&&eve.on("raphael.drag.end."+this.id,onend),eve("raphael.drag.start."+this.id,start_scope||move_scope||this,e.clientX+scrollX,e.clientY+scrollY,e)}return this._drag={},draggable.push({el:this,start:start}),this.mousedown(start),this},elproto.onDragOver=function(f){f?eve.on("raphael.drag.over."+this.id,f):eve.unbind("raphael.drag.over."+this.id)},elproto.undrag=function(){for(var i=draggable.length;i--;)draggable[i].el==this&&(this.unmousedown(draggable[i].start),draggable.splice(i,1),eve.unbind("raphael.drag.*."+this.id));!draggable.length&&R.unmousemove(dragMove).unmouseup(dragUp),drag=[]},paperproto.circle=function(x,y,r){var out=R._engine.circle(this,x||0,y||0,r||0);return this.__set__&&this.__set__.push(out),out},paperproto.rect=function(x,y,w,h,r){var out=R._engine.rect(this,x||0,y||0,w||0,h||0,r||0);return this.__set__&&this.__set__.push(out),out},paperproto.ellipse=function(x,y,rx,ry){var out=R._engine.ellipse(this,x||0,y||0,rx||0,ry||0);return this.__set__&&this.__set__.push(out),out},paperproto.path=function(pathString){pathString&&!R.is(pathString,"string")&&!R.is(pathString[0],array)&&(pathString+=E);var out=R._engine.path(R.format[apply](R,arguments),this);return this.__set__&&this.__set__.push(out),out},paperproto.image=function(src,x,y,w,h){var out=R._engine.image(this,src||"about:blank",x||0,y||0,w||0,h||0);return this.__set__&&this.__set__.push(out),out},paperproto.text=function(x,y,text){var out=R._engine.text(this,x||0,y||0,Str(text));return this.__set__&&this.__set__.push(out),out},paperproto.set=function(itemsArray){!R.is(itemsArray,"array")&&(itemsArray=Array.prototype.splice.call(arguments,0,arguments.length));var out=new Set(itemsArray);return this.__set__&&this.__set__.push(out),out.paper=this,out.type="set",out},paperproto.setStart=function(set){this.__set__=set||this.set()},paperproto.setFinish=function(set){var out=this.__set__;return delete this.__set__,out},paperproto.getSize=function(){var container=this.canvas.parentNode;return{width:container.offsetWidth,height:container.offsetHeight}},paperproto.setSize=function(width,height){return R._engine.setSize.call(this,width,height)},paperproto.setViewBox=function(x,y,w,h,fit){return R._engine.setViewBox.call(this,x,y,w,h,fit)},paperproto.top=paperproto.bottom=null,paperproto.raphael=R;var getOffset=function(elem){var box=elem.getBoundingClientRect(),doc=elem.ownerDocument,body=doc.body,docElem=doc.documentElement,clientTop=docElem.clientTop||body.clientTop||0,clientLeft=docElem.clientLeft||body.clientLeft||0;return{y:box.top+(g.win.pageYOffset||docElem.scrollTop||body.scrollTop)-clientTop,x:box.left+(g.win.pageXOffset||docElem.scrollLeft||body.scrollLeft)-clientLeft}};paperproto.getElementByPoint=function(x,y){var paper=this,svg=paper.canvas,target=g.doc.elementFromPoint(x,y);if(g.win.opera&&"svg"==target.tagName){var so=getOffset(svg),sr=svg.createSVGRect();sr.x=x-so.x,sr.y=y-so.y,sr.width=sr.height=1;var hits=svg.getIntersectionList(sr,null);hits.length&&(target=hits[hits.length-1])}if(!target)return null;for(;target.parentNode&&target!=svg.parentNode&&!target.raphael;)target=target.parentNode;return target==paper.canvas.parentNode&&(target=svg),target=target&&target.raphael?paper.getById(target.raphaelid):null},paperproto.getElementsByBBox=function(bbox){var set=this.set();return this.forEach(function(el){R.isBBoxIntersect(el.getBBox(),bbox)&&set.push(el)}),set},paperproto.getById=function(id){for(var bot=this.bottom;bot;){if(bot.id==id)return bot;bot=bot.next}return null},paperproto.forEach=function(callback,thisArg){for(var bot=this.bottom;bot;){if(!1===callback.call(thisArg,bot))return this;bot=bot.next}return this},paperproto.getElementsByPoint=function(x,y){var set=this.set();return this.forEach(function(el){el.isPointInside(x,y)&&set.push(el)}),set},elproto.isPointInside=function(x,y){var rp=this.realPath=getPath[this.type](this);return this.attr("transform")&&this.attr("transform").length&&(rp=R.transformPath(rp,this.attr("transform"))),R.isPointInsidePath(rp,x,y)},elproto.getBBox=function(isWithoutTransform){if(this.removed)return{};var _=this._;return isWithoutTransform?(!_.dirty&&_.bboxwt||(this.realPath=getPath[this.type](this),_.bboxwt=pathDimensions(this.realPath),_.bboxwt.toString=x_y_w_h,_.dirty=0),_.bboxwt):((_.dirty||_.dirtyT||!_.bbox)&&(!_.dirty&&this.realPath||(_.bboxwt=0,this.realPath=getPath[this.type](this)),_.bbox=pathDimensions(mapPath(this.realPath,this.matrix)),_.bbox.toString=x_y_w_h,_.dirty=_.dirtyT=0),_.bbox)},elproto.clone=function(){if(this.removed)return null;var out=this.paper[this.type]().attr(this.attr());return this.__set__&&this.__set__.push(out),out},elproto.glow=function(glow){if("text"==this.type)return null;glow=glow||{};var s={width:(glow.width||10)+(+this.attr("stroke-width")||1),fill:glow.fill||!1,opacity:null==glow.opacity?.5:glow.opacity,offsetx:glow.offsetx||0,offsety:glow.offsety||0,color:glow.color||"#000"},c=s.width/2,r=this.paper,out=r.set(),path=this.realPath||getPath[this.type](this);path=this.matrix?mapPath(path,this.matrix):path;for(var i=1;i<c+1;i++)out.push(r.path(path).attr({stroke:s.color,fill:s.fill?s.color:"none","stroke-linejoin":"round","stroke-linecap":"round","stroke-width":+(s.width/c*i).toFixed(3),opacity:+(s.opacity/c).toFixed(3)}));return out.insertBefore(this).translate(s.offsetx,s.offsety)};var getPointAtSegmentLength=function(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length){return null==length?bezlen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y):R.findDotsAtSegment(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,getTatLen(p1x,p1y,c1x,c1y,c2x,c2y,p2x,p2y,length))},getLengthFactory=function(istotal,subpath){return function(path,length,onlystart){path=path2curve(path);for(var x,y,p,l,point,sp="",subpaths={},len=0,i=0,ii=path.length;i<ii;i++){if(p=path[i],"M"==p[0])x=+p[1],y=+p[2];else{if(l=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6]),len+l>length){if(subpath&&!subpaths.start){if(point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len),sp+=["C"+point.start.x,point.start.y,point.m.x,point.m.y,point.x,point.y],onlystart)return sp;subpaths.start=sp,sp=["M"+point.x,point.y+"C"+point.n.x,point.n.y,point.end.x,point.end.y,p[5],p[6]].join(),len+=l,x=+p[5],y=+p[6];continue}if(!istotal&&!subpath)return point=getPointAtSegmentLength(x,y,p[1],p[2],p[3],p[4],p[5],p[6],length-len),{x:point.x,y:point.y,alpha:point.alpha}}len+=l,x=+p[5],y=+p[6]}sp+=p.shift()+p}return subpaths.end=sp,point=istotal?len:subpath?subpaths:R.findDotsAtSegment(x,y,p[0],p[1],p[2],p[3],p[4],p[5],1),point.alpha&&(point={x:point.x,y:point.y,alpha:point.alpha}),point}},getTotalLength=getLengthFactory(1),getPointAtLength=getLengthFactory(),getSubpathsAtLength=getLengthFactory(0,1);R.getTotalLength=getTotalLength,R.getPointAtLength=getPointAtLength,R.getSubpath=function(path,from,to){if(this.getTotalLength(path)-to<1e-6)return getSubpathsAtLength(path,from).end;var a=getSubpathsAtLength(path,to,1);return from?getSubpathsAtLength(a,from).end:a},elproto.getTotalLength=function(){var path=this.getPath();if(path)return getTotalLength(path)},elproto.getPointAtLength=function(length){var path=this.getPath();if(path)return getPointAtLength(path,length)},elproto.getPath=function(){var path,getPath=R._getPath[this.type];if("text"!=this.type&&"set"!=this.type)return getPath&&(path=getPath(this)),path},elproto.getSubpath=function(from,to){var path=this.getPath();if(path)return R.getSubpath(path,from,to)};var ef=R.easing_formulas={linear:function(n){return n},"<":function(n){return pow(n,1.7)},">":function(n){return pow(n,.48)},"<>":function(n){var q=.48-n/1.04,Q=math.sqrt(.1734+q*q),x=Q-q,X=pow(abs(x),1/3)*(x<0?-1:1),y=-Q-q,Y=pow(abs(y),1/3)*(y<0?-1:1),t=X+Y+.5;return 3*(1-t)*t*t+t*t*t},backIn:function(n){var s=1.70158;return n*n*((s+1)*n-s)},backOut:function(n){n-=1;var s=1.70158;return n*n*((s+1)*n+s)+1},elastic:function(n){return n==!!n?n:pow(2,-10*n)*math.sin(2*PI*(n-.075)/.3)+1},bounce:function(n){var l,s=7.5625,p=2.75;return n<1/p?l=s*n*n:n<2/p?(n-=1.5/p,l=s*n*n+.75):n<2.5/p?(n-=2.25/p,l=s*n*n+.9375):(n-=2.625/p,l=s*n*n+.984375),l}};ef.easeIn=ef["ease-in"]=ef["<"],ef.easeOut=ef["ease-out"]=ef[">"],ef.easeInOut=ef["ease-in-out"]=ef["<>"],ef["back-in"]=ef.backIn,ef["back-out"]=ef.backOut;var animationElements=[],requestAnimFrame=window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(callback){setTimeout(callback,16)},animation=function animation(){for(var Now=+new Date,l=0;l<animationElements.length;l++){var e=animationElements[l];if(!e.el.removed&&!e.paused){var now,key,time=Now-e.start,ms=e.ms,easing=e.easing,from=e.from,diff=e.diff,to=e.to,that=(e.t,e.el),set={},init={};if(e.initstatus?(time=(e.initstatus*e.anim.top-e.prev)/(e.percent-e.prev)*ms,e.status=e.initstatus,delete e.initstatus,e.stop&&animationElements.splice(l--,1)):e.status=(e.prev+(e.percent-e.prev)*(time/ms))/e.anim.top,!(time<0))if(time<ms){var pos=easing(time/ms);for(var attr in from)if(from[has](attr)){switch(availableAnimAttrs[attr]){case nu:now=+from[attr]+pos*ms*diff[attr];break;case"colour":now="rgb("+[upto255(round(from[attr].r+pos*ms*diff[attr].r)),upto255(round(from[attr].g+pos*ms*diff[attr].g)),upto255(round(from[attr].b+pos*ms*diff[attr].b))].join(",")+")";break;case"path":now=[];for(var i=0,ii=from[attr].length;i<ii;i++){now[i]=[from[attr][i][0]];for(var j=1,jj=from[attr][i].length;j<jj;j++)now[i][j]=+from[attr][i][j]+pos*ms*diff[attr][i][j];now[i]=now[i].join(S)}now=now.join(S);break;case"transform":if(diff[attr].real)for(now=[],i=0,ii=from[attr].length;i<ii;i++)for(now[i]=[from[attr][i][0]],j=1,jj=from[attr][i].length;j<jj;j++)now[i][j]=from[attr][i][j]+pos*ms*diff[attr][i][j];else{var get=function(i){return+from[attr][i]+pos*ms*diff[attr][i]};now=[["m",get(0),get(1),get(2),get(3),get(4),get(5)]]}break;case"csv":if("clip-rect"==attr)for(now=[],i=4;i--;)now[i]=+from[attr][i]+pos*ms*diff[attr][i];break;default:var from2=[][concat](from[attr]);for(now=[],i=that.paper.customAttributes[attr].length;i--;)now[i]=+from2[i]+pos*ms*diff[attr][i]}set[attr]=now}that.attr(set),function(id,that,anim){setTimeout(function(){eve("raphael.anim.frame."+id,that,anim)})}(that.id,that,e.anim)}else{if(function(f,el,a){setTimeout(function(){eve("raphael.anim.frame."+el.id,el,a),eve("raphael.anim.finish."+el.id,el,a),R.is(f,"function")&&f.call(el)})}(e.callback,that,e.anim),that.attr(to),animationElements.splice(l--,1),e.repeat>1&&!e.next){for(key in to)to[has](key)&&(init[key]=e.totalOrigin[key]);e.el.attr(init),runAnimation(e.anim,e.el,e.anim.percents[0],null,e.totalOrigin,e.repeat-1)}e.next&&!e.stop&&runAnimation(e.anim,e.el,e.next,null,e.totalOrigin,e.repeat)}}}animationElements.length&&requestAnimFrame(animation)},upto255=function(color){return color>255?255:color<0?0:color};elproto.animateWith=function(el,anim,params,ms,easing,callback){var element=this;if(element.removed)return callback&&callback.call(element),element;var a=params instanceof Animation?params:R.animation(params,ms,easing,callback);runAnimation(a,element,a.percents[0],null,element.attr());for(var i=0,ii=animationElements.length;i<ii;i++)if(animationElements[i].anim==anim&&animationElements[i].el==el){animationElements[ii-1].start=animationElements[i].start;break}return element},elproto.onAnimation=function(f){return f?eve.on("raphael.anim.frame."+this.id,f):eve.unbind("raphael.anim.frame."+this.id),this},Animation.prototype.delay=function(delay){var a=new Animation(this.anim,this.ms);return a.times=this.times,a.del=+delay||0,a},Animation.prototype.repeat=function(times){var a=new Animation(this.anim,this.ms);return a.del=this.del,a.times=math.floor(mmax(times,0))||1,a},R.animation=function(params,ms,easing,callback){if(params instanceof Animation)return params;!R.is(easing,"function")&&easing||(callback=callback||easing||null,easing=null),params=Object(params),ms=+ms||0;var json,attr,p={};for(attr in params)params[has](attr)&&toFloat(attr)!=attr&&toFloat(attr)+"%"!=attr&&(json=!0,p[attr]=params[attr]);if(json)return easing&&(p.easing=easing),callback&&(p.callback=callback),new Animation({100:p},ms);if(callback){var lastKey=0;for(var i in params){var percent=toInt(i);params[has](i)&&percent>lastKey&&(lastKey=percent)}lastKey+="%",!params[lastKey].callback&&(params[lastKey].callback=callback)}return new Animation(params,ms)},elproto.animate=function(params,ms,easing,callback){var element=this;if(element.removed)return callback&&callback.call(element),element;var anim=params instanceof Animation?params:R.animation(params,ms,easing,callback);return runAnimation(anim,element,anim.percents[0],null,element.attr()),element},elproto.setTime=function(anim,value){return anim&&null!=value&&this.status(anim,mmin(value,anim.ms)/anim.ms),this},elproto.status=function(anim,value){var len,e,out=[],i=0;if(null!=value)return runAnimation(anim,this,-1,mmin(value,1)),this;for(len=animationElements.length;i<len;i++)if(e=animationElements[i],e.el.id==this.id&&(!anim||e.anim==anim)){if(anim)return e.status;out.push({anim:e.anim,status:e.status})}return anim?0:out},elproto.pause=function(anim){for(var i=0;i<animationElements.length;i++)animationElements[i].el.id!=this.id||anim&&animationElements[i].anim!=anim||!1!==eve("raphael.anim.pause."+this.id,this,animationElements[i].anim)&&(animationElements[i].paused=!0);return this},elproto.resume=function(anim){for(var i=0;i<animationElements.length;i++)if(animationElements[i].el.id==this.id&&(!anim||animationElements[i].anim==anim)){var e=animationElements[i];!1!==eve("raphael.anim.resume."+this.id,this,e.anim)&&(delete e.paused,this.status(e.anim,e.status))}return this},elproto.stop=function(anim){for(var i=0;i<animationElements.length;i++)animationElements[i].el.id!=this.id||anim&&animationElements[i].anim!=anim||!1!==eve("raphael.anim.stop."+this.id,this,animationElements[i].anim)&&animationElements.splice(i--,1);return this},eve.on("raphael.remove",stopAnimation),eve.on("raphael.clear",stopAnimation),elproto.toString=function(){return"Raphaël’s object"};var Set=function Set(items){if(this.items=[],this.length=0,this.type="set",items)for(var i=0,ii=items.length;i<ii;i++)!items[i]||items[i].constructor!=elproto.constructor&&items[i].constructor!=Set||(this[this.items.length]=this.items[this.items.length]=items[i],this.length++)},setproto=Set.prototype;setproto.push=function(){for(var item,len,i=0,ii=arguments.length;i<ii;i++)!(item=arguments[i])||item.constructor!=elproto.constructor&&item.constructor!=Set||(len=this.items.length,this[len]=this.items[len]=item,this.length++);return this},setproto.pop=function(){return this.length&&delete this[this.length--],this.items.pop()},setproto.forEach=function(callback,thisArg){for(var i=0,ii=this.items.length;i<ii;i++)if(!1===callback.call(thisArg,this.items[i],i))return this;return this};for(var method in elproto)elproto[has](method)&&(setproto[method]=function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname][apply](el,arg)})}}(method));return setproto.attr=function(name,value){if(name&&R.is(name,array)&&R.is(name[0],"object"))for(var j=0,jj=name.length;j<jj;j++)this.items[j].attr(name[j]);else for(var i=0,ii=this.items.length;i<ii;i++)this.items[i].attr(name,value);return this},setproto.clear=function(){for(;this.length;)this.pop()},setproto.splice=function(index,count,insertion){index=index<0?mmax(this.length+index,0):index,count=mmax(0,mmin(this.length-index,count));var i,tail=[],todel=[],args=[];for(i=2;i<arguments.length;i++)args.push(arguments[i]);for(i=0;i<count;i++)todel.push(this[index+i]);for(;i<this.length-index;i++)tail.push(this[index+i]);var arglen=args.length;for(i=0;i<arglen+tail.length;i++)this.items[index+i]=this[index+i]=i<arglen?args[i]:tail[i-arglen];for(i=this.items.length=this.length-=count-arglen;this[i];)delete this[i++];return new Set(todel)},setproto.exclude=function(el){for(var i=0,ii=this.length;i<ii;i++)if(this[i]==el)return this.splice(i,1),!0},setproto.animate=function(params,ms,easing,callback){(R.is(easing,"function")||!easing)&&(callback=easing||null);var item,collector,len=this.items.length,i=len,set=this;if(!len)return this;callback&&(collector=function(){!--len&&callback.call(set)}),easing=R.is(easing,"string")?easing:collector;var anim=R.animation(params,ms,easing,collector);for(item=this.items[--i].animate(anim);i--;)this.items[i]&&!this.items[i].removed&&this.items[i].animateWith(item,anim,anim),this.items[i]&&!this.items[i].removed||len--;return this},setproto.insertAfter=function(el){for(var i=this.items.length;i--;)this.items[i].insertAfter(el);return this},setproto.getBBox=function(){for(var x=[],y=[],x2=[],y2=[],i=this.items.length;i--;)if(!this.items[i].removed){var box=this.items[i].getBBox();x.push(box.x),y.push(box.y),x2.push(box.x+box.width),y2.push(box.y+box.height)}return x=mmin[apply](0,x),y=mmin[apply](0,y),x2=mmax[apply](0,x2),y2=mmax[apply](0,y2),{x:x,y:y,x2:x2,y2:y2,width:x2-x,height:y2-y}},setproto.clone=function(s){s=this.paper.set();for(var i=0,ii=this.items.length;i<ii;i++)s.push(this.items[i].clone());return s},setproto.toString=function(){return"Raphaël‘s set"},setproto.glow=function(glowConfig){var ret=this.paper.set();return this.forEach(function(shape,index){var g=shape.glow(glowConfig);null!=g&&g.forEach(function(shape2,index2){ret.push(shape2)})}),ret},setproto.isPointInside=function(x,y){var isPointInside=!1;return this.forEach(function(el){if(el.isPointInside(x,y))return isPointInside=!0,!1}),isPointInside},R.registerFont=function(font){if(!font.face)return font;this.fonts=this.fonts||{};var fontcopy={w:font.w,face:{},glyphs:{}},family=font.face["font-family"];for(var prop in font.face)font.face[has](prop)&&(fontcopy.face[prop]=font.face[prop]);if(this.fonts[family]?this.fonts[family].push(fontcopy):this.fonts[family]=[fontcopy],!font.svg){fontcopy.face["units-per-em"]=toInt(font.face["units-per-em"],10);for(var glyph in font.glyphs)if(font.glyphs[has](glyph)){var path=font.glyphs[glyph];if(fontcopy.glyphs[glyph]={w:path.w,k:{},d:path.d&&"M"+path.d.replace(/[mlcxtrv]/g,function(command){return{l:"L",c:"C",x:"z",t:"m",r:"l",v:"c"}[command]||"M"})+"z"},path.k)for(var k in path.k)path[has](k)&&(fontcopy.glyphs[glyph].k[k]=path.k[k])}}return font},paperproto.getFont=function(family,weight,style,stretch){if(stretch=stretch||"normal",style=style||"normal",weight=+weight||{normal:400,bold:700,lighter:300,bolder:800}[weight]||400,R.fonts){var font=R.fonts[family];if(!font){var name=new RegExp("(^|\\s)"+family.replace(/[^\w\d\s+!~.:_-]/g,E)+"(\\s|$)","i");for(var fontName in R.fonts)if(R.fonts[has](fontName)&&name.test(fontName)){font=R.fonts[fontName];break}}var thefont;if(font)for(var i=0,ii=font.length;i<ii&&(thefont=font[i],thefont.face["font-weight"]!=weight||thefont.face["font-style"]!=style&&thefont.face["font-style"]||thefont.face["font-stretch"]!=stretch);i++);return thefont}},paperproto.print=function(x,y,string,font,size,origin,letter_spacing,line_spacing){origin=origin||"middle",letter_spacing=mmax(mmin(letter_spacing||0,1),-1),line_spacing=mmax(mmin(line_spacing||1,3),1);var scale,letters=Str(string)[split](E),shift=0,notfirst=0,path=E;if(R.is(font,"string")&&(font=this.getFont(font)),font){scale=(size||16)/font.face["units-per-em"];for(var bb=font.face.bbox[split](separator),top=+bb[0],lineHeight=bb[3]-bb[1],shifty=0,height=+bb[1]+("baseline"==origin?lineHeight+ +font.face.descent:lineHeight/2),i=0,ii=letters.length;i<ii;i++){if("\n"==letters[i])shift=0,curr=0,notfirst=0,shifty+=lineHeight*line_spacing;else{var prev=notfirst&&font.glyphs[letters[i-1]]||{},curr=font.glyphs[letters[i]];shift+=notfirst?(prev.w||font.w)+(prev.k&&prev.k[letters[i]]||0)+font.w*letter_spacing:0,notfirst=1}curr&&curr.d&&(path+=R.transformPath(curr.d,["t",shift*scale,shifty*scale,"s",scale,scale,top,height,"t",(x-top)/scale,(y-height)/scale]))}}return this.path(path).attr({fill:"#000",stroke:"none"})},paperproto.add=function(json){if(R.is(json,"array"))for(var j,res=this.set(),i=0,ii=json.length;i<ii;i++)j=json[i]||{},elements[has](j.type)&&res.push(this[j.type]().attr(j));return res},R.format=function(token,params){var args=R.is(params,array)?[0][concat](params):arguments;return token&&R.is(token,"string")&&args.length-1&&(token=token.replace(formatrg,function(str,i){return null==args[++i]?E:args[i]})),token||E},R.fullfill=function(){var tokenRegex=/\{([^\}]+)\}/g,objNotationRegex=/(?:(?:^|\.)(.+?)(?=\[|\.|$|\()|\[('|")(.+?)\2\])(\(\))?/g,replacer=function(all,key,obj){var res=obj;return key.replace(objNotationRegex,function(all,name,quote,quotedName,isFunc){name=name||quotedName,res&&(name in res&&(res=res[name]),"function"==typeof res&&isFunc&&(res=res()))}),res=(null==res||res==obj?all:res)+""};return function(str,obj){return String(str).replace(tokenRegex,function(all,key){return replacer(all,key,obj)})}}(),R.ninja=function(){if(oldRaphael.was)g.win.Raphael=oldRaphael.is;else{window.Raphael=void 0;try{delete window.Raphael}catch(e){}}return R},R.st=setproto,eve.on("raphael.DOMload",function(){loaded=!0}),function(doc,loaded,_f2){function isLoaded(){/in/.test(doc.readyState)?setTimeout(isLoaded,9):R.eve("raphael.DOMload")}null==doc.readyState&&doc.addEventListener&&(doc.addEventListener("DOMContentLoaded",_f2=function(){doc.removeEventListener("DOMContentLoaded",_f2,!1),doc.readyState="complete"},!1),doc.readyState="loading"),isLoaded()}(document),R}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;!function(glob){var current_event,stop,has="hasOwnProperty",separator=/[\.\/]/,comaseparator=/\s*,\s*/,numsort=function(a,b){return a-b},events={n:{}},firstDefined=function(){for(var i=0,ii=this.length;i<ii;i++)if(void 0!==this[i])return this[i]},lastDefined=function(){for(var i=this.length;--i;)if(void 0!==this[i])return this[i]},objtos=Object.prototype.toString,Str=String,isArray=Array.isArray||function(ar){return ar instanceof Array||"[object Array]"==objtos.call(ar)},eve=function eve(name,scope){var l,oldstop=stop,args=Array.prototype.slice.call(arguments,2),listeners=eve.listeners(name),z=0,indexed=[],queue={},out=[],ce=current_event;out.firstDefined=firstDefined,out.lastDefined=lastDefined,current_event=name,stop=0;for(var i=0,ii=listeners.length;i<ii;i++)"zIndex"in listeners[i]&&(indexed.push(listeners[i].zIndex),listeners[i].zIndex<0&&(queue[listeners[i].zIndex]=listeners[i]));for(indexed.sort(numsort);indexed[z]<0;)if(l=queue[indexed[z++]],out.push(l.apply(scope,args)),stop)return stop=oldstop,out;for(i=0;i<ii;i++)if("zIndex"in(l=listeners[i]))if(l.zIndex==indexed[z]){if(out.push(l.apply(scope,args)),stop)break;do{if(z++,l=queue[indexed[z]],l&&out.push(l.apply(scope,args)),stop)break}while(l)}else queue[l.zIndex]=l;else if(out.push(l.apply(scope,args)),stop)break;return stop=oldstop,current_event=ce,out};eve._events=events,eve.listeners=function(name){var item,items,k,i,ii,j,jj,nes,names=isArray(name)?name:name.split(separator),e=events,es=[e],out=[];for(i=0,ii=names.length;i<ii;i++){for(nes=[],j=0,jj=es.length;j<jj;j++)for(e=es[j].n,items=[e[names[i]],e["*"]],k=2;k--;)(item=items[k])&&(nes.push(item),out=out.concat(item.f||[]));es=nes}return out},eve.separator=function(sep){sep?(sep=Str(sep).replace(/(?=[\.\^\]\[\-])/g,"\\"),sep="["+sep+"]",separator=new RegExp(sep)):separator=/[\.\/]/},eve.on=function(name,f){if("function"!=typeof f)return function(){};for(var names=isArray(name)?isArray(name[0])?name:[name]:Str(name).split(comaseparator),i=0,ii=names.length;i<ii;i++)!function(name){for(var exist,names=isArray(name)?name:Str(name).split(separator),e=events,i=0,ii=names.length;i<ii;i++)e=e.n,e=e.hasOwnProperty(names[i])&&e[names[i]]||(e[names[i]]={n:{}});for(e.f=e.f||[],i=0,ii=e.f.length;i<ii;i++)if(e.f[i]==f){exist=!0;break}!exist&&e.f.push(f)}(names[i]);return function(zIndex){+zIndex==+zIndex&&(f.zIndex=+zIndex)}},eve.f=function(event){var attrs=[].slice.call(arguments,1);return function(){eve.apply(null,[event,null].concat(attrs).concat([].slice.call(arguments,0)))}},eve.stop=function(){stop=1},eve.nt=function(subname){var cur=isArray(current_event)?current_event.join("."):current_event;return subname?new RegExp("(?:\\.|\\/|^)"+subname+"(?:\\.|\\/|$)").test(cur):cur},eve.nts=function(){return isArray(current_event)?current_event:current_event.split(separator)},eve.off=eve.unbind=function(name,f){if(!name)return void(eve._events=events={n:{}});var names=isArray(name)?isArray(name[0])?name:[name]:Str(name).split(comaseparator);if(names.length>1)for(var i=0,ii=names.length;i<ii;i++)eve.off(names[i],f);else{names=isArray(name)?name:Str(name).split(separator);var e,key,splice,i,ii,j,jj,cur=[events];for(i=0,ii=names.length;i<ii;i++)for(j=0;j<cur.length;j+=splice.length-2){if(splice=[j,1],e=cur[j].n,"*"!=names[i])e[names[i]]&&splice.push(e[names[i]]);else for(key in e)e[has](key)&&splice.push(e[key]);cur.splice.apply(cur,splice)}for(i=0,ii=cur.length;i<ii;i++)for(e=cur[i];e.n;){if(f){if(e.f){for(j=0,jj=e.f.length;j<jj;j++)if(e.f[j]==f){e.f.splice(j,1);break}!e.f.length&&delete e.f}for(key in e.n)if(e.n[has](key)&&e.n[key].f){var funcs=e.n[key].f;for(j=0,jj=funcs.length;j<jj;j++)if(funcs[j]==f){funcs.splice(j,1);break}!funcs.length&&delete e.n[key].f}}else{delete e.f;for(key in e.n)e.n[has](key)&&e.n[key].f&&delete e.n[key].f}e=e.n}}},eve.once=function(name,f){return eve.on(name,function f2(){return eve.off(name,f2),f.apply(this,arguments)})},eve.version="0.5.0",eve.toString=function(){return"You are running Eve 0.5.0"},void 0!==module&&module.exports?module.exports=eve:(__WEBPACK_AMD_DEFINE_ARRAY__=[],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(){return eve}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__))}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(1)],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(R){if(!R||R.svg){var has="hasOwnProperty",Str=String,toFloat=parseFloat,toInt=parseInt,math=Math,mmax=math.max,abs=math.abs,pow=math.pow,separator=/[, ]+/,eve=R.eve,E="",S=" ",xlink="http://www.w3.org/1999/xlink",markers={block:"M5,0 0,2.5 5,5z",classic:"M5,0 0,2.5 5,5 3.5,3 3.5,2z",diamond:"M2.5,0 5,2.5 2.5,5 0,2.5z",open:"M6,1 1,3.5 6,6",oval:"M2.5,0A2.5,2.5,0,0,1,2.5,5 2.5,2.5,0,0,1,2.5,0z"},markerCounter={};R.toString=function(){return"Your browser supports SVG.\nYou are running Raphaël "+this.version};var $=function $(el,attr){if(attr){"string"==typeof el&&(el=$(el));for(var key in attr)attr[has](key)&&("xlink:"==key.substring(0,6)?el.setAttributeNS(xlink,key.substring(6),Str(attr[key])):el.setAttribute(key,Str(attr[key])))}else el=R._g.doc.createElementNS("http://www.w3.org/2000/svg",el),el.style&&(el.style.webkitTapHighlightColor="rgba(0,0,0,0)");return el},addGradientFill=function(element,gradient){var type="linear",id=element.id+gradient,fx=.5,fy=.5,o=element.node,SVG=element.paper,s=o.style,el=R._g.doc.getElementById(id);if(!el){if(gradient=Str(gradient).replace(R._radial_gradient,function(all,_fx,_fy){if(type="radial",_fx&&_fy){fx=toFloat(_fx),fy=toFloat(_fy);var dir=2*(fy>.5)-1;pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*dir+.5)&&.5!=fy&&(fy=fy.toFixed(5)-1e-5*dir)}return E}),gradient=gradient.split(/\s*\-\s*/),"linear"==type){var angle=gradient.shift();if(angle=-toFloat(angle),isNaN(angle))return null;var vector=[0,0,math.cos(R.rad(angle)),math.sin(R.rad(angle))],max=1/(mmax(abs(vector[2]),abs(vector[3]))||1);vector[2]*=max,vector[3]*=max,vector[2]<0&&(vector[0]=-vector[2],vector[2]=0),vector[3]<0&&(vector[1]=-vector[3],vector[3]=0)}var dots=R._parseDots(gradient);if(!dots)return null;if(id=id.replace(/[\(\)\s,\xb0#]/g,"_"),element.gradient&&id!=element.gradient.id&&(SVG.defs.removeChild(element.gradient),delete element.gradient),!element.gradient){el=$(type+"Gradient",{id:id}),element.gradient=el,$(el,"radial"==type?{fx:fx,fy:fy}:{x1:vector[0],y1:vector[1],x2:vector[2],y2:vector[3],gradientTransform:element.matrix.invert()}),SVG.defs.appendChild(el);for(var i=0,ii=dots.length;i<ii;i++)el.appendChild($("stop",{offset:dots[i].offset?dots[i].offset:i?"100%":"0%","stop-color":dots[i].color||"#fff","stop-opacity":isFinite(dots[i].opacity)?dots[i].opacity:1}))}}return $(o,{fill:fillurl(id),opacity:1,"fill-opacity":1}),s.fill=E,s.opacity=1,s.fillOpacity=1,1},isIE9or10=function(){var mode=document.documentMode;return mode&&(9===mode||10===mode)},fillurl=function(id){if(isIE9or10())return"url('#"+id+"')";var location=document.location;return"url('"+location.protocol+"//"+location.host+location.pathname+location.search+"#"+id+"')"},updatePosition=function(o){var bbox=o.getBBox(1);$(o.pattern,{patternTransform:o.matrix.invert()+" translate("+bbox.x+","+bbox.y+")"})},addArrow=function(o,value,isEnd){if("path"==o.type){for(var from,to,dx,refX,attr,values=Str(value).toLowerCase().split("-"),p=o.paper,se=isEnd?"end":"start",node=o.node,attrs=o.attrs,stroke=attrs["stroke-width"],i=values.length,type="classic",w=3,h=3,t=5;i--;)switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":h=5;break;case"narrow":h=2;break;case"long":w=5;break;case"short":w=2}if("open"==type?(w+=2,h+=2,t+=2,dx=1,refX=isEnd?4:1,attr={fill:"none",stroke:attrs.stroke}):(refX=dx=w/2,attr={fill:attrs.stroke,stroke:"none"}),o._.arrows?isEnd?(o._.arrows.endPath&&markerCounter[o._.arrows.endPath]--,o._.arrows.endMarker&&markerCounter[o._.arrows.endMarker]--):(o._.arrows.startPath&&markerCounter[o._.arrows.startPath]--,o._.arrows.startMarker&&markerCounter[o._.arrows.startMarker]--):o._.arrows={},"none"!=type){var pathId="raphael-marker-"+type,markerId="raphael-marker-"+se+type+w+h+"-obj"+o.id;R._g.doc.getElementById(pathId)?markerCounter[pathId]++:(p.defs.appendChild($($("path"),{"stroke-linecap":"round",d:markers[type],id:pathId})),markerCounter[pathId]=1);var use,marker=R._g.doc.getElementById(markerId);marker?(markerCounter[markerId]++,use=marker.getElementsByTagName("use")[0]):(marker=$($("marker"),{id:markerId,markerHeight:h,markerWidth:w,orient:"auto",refX:refX,refY:h/2}),use=$($("use"),{"xlink:href":"#"+pathId,transform:(isEnd?"rotate(180 "+w/2+" "+h/2+") ":E)+"scale("+w/t+","+h/t+")","stroke-width":(1/((w/t+h/t)/2)).toFixed(4)}),marker.appendChild(use),p.defs.appendChild(marker),markerCounter[markerId]=1),$(use,attr);var delta=dx*("diamond"!=type&&"oval"!=type);isEnd?(from=o._.arrows.startdx*stroke||0,to=R.getTotalLength(attrs.path)-delta*stroke):(from=delta*stroke,to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0)),attr={},attr["marker-"+se]="url(#"+markerId+")",(to||from)&&(attr.d=R.getSubpath(attrs.path,from,to)),$(node,attr),o._.arrows[se+"Path"]=pathId,o._.arrows[se+"Marker"]=markerId,o._.arrows[se+"dx"]=delta,o._.arrows[se+"Type"]=type,o._.arrows[se+"String"]=value}else isEnd?(from=o._.arrows.startdx*stroke||0,to=R.getTotalLength(attrs.path)-from):(from=0,to=R.getTotalLength(attrs.path)-(o._.arrows.enddx*stroke||0)),o._.arrows[se+"Path"]&&$(node,{d:R.getSubpath(attrs.path,from,to)}),delete o._.arrows[se+"Path"],delete o._.arrows[se+"Marker"],delete o._.arrows[se+"dx"],delete o._.arrows[se+"Type"],delete o._.arrows[se+"String"];for(attr in markerCounter)if(markerCounter[has](attr)&&!markerCounter[attr]){var item=R._g.doc.getElementById(attr);item&&item.parentNode.removeChild(item)}}},dasharray={"-":[3,1],",":[1.1,1.1],".":[1,1],"-.":[3,1,1,1],"-..":[3,1,1,1,1,1],". ":[1,3],"- ":[4,3],"--":[8,3],"- .":[4,3,1,3],"--.":[8,3,1,3],"--..":[8,3,1,3,1,3]},addDashes=function(o,value,params){if(value=dasharray[Str(value).toLowerCase()]){for(var width=o.attrs["stroke-width"]||"1",butt={round:width,square:width,butt:0}[o.attrs["stroke-linecap"]||params["stroke-linecap"]]||0,dashes=[],i=value.length;i--;)dashes[i]=value[i]*width+(i%2?1:-1)*butt;$(o.node,{"stroke-dasharray":dashes.join(",")})}else $(o.node,{"stroke-dasharray":"none"})},setFillAndStroke=function(o,params){var node=o.node,attrs=o.attrs,vis=node.style.visibility;node.style.visibility="hidden";for(var att in params)if(params[has](att)){if(!R._availableAttrs[has](att))continue;var value=params[att];switch(attrs[att]=value,att){case"blur":o.blur(value);break;case"title":var title=node.getElementsByTagName("title");if(title.length&&(title=title[0]))title.firstChild.nodeValue=value;else{title=$("title");var val=R._g.doc.createTextNode(value);title.appendChild(val),node.appendChild(title)}break;case"href":case"target":var pn=node.parentNode;if("a"!=pn.tagName.toLowerCase()){var hl=$("a");pn.insertBefore(hl,node),hl.appendChild(node),pn=hl}"target"==att?pn.setAttributeNS(xlink,"show","blank"==value?"new":value):pn.setAttributeNS(xlink,att,value);break;case"cursor":node.style.cursor=value;break;case"transform":o.transform(value);break;case"arrow-start":addArrow(o,value);break;case"arrow-end":addArrow(o,value,1);break;case"clip-rect":var rect=Str(value).split(separator);if(4==rect.length){o.clip&&o.clip.parentNode.parentNode.removeChild(o.clip.parentNode);var el=$("clipPath"),rc=$("rect");el.id=R.createUUID(),$(rc,{x:rect[0],y:rect[1],width:rect[2],height:rect[3]}),el.appendChild(rc),o.paper.defs.appendChild(el),$(node,{"clip-path":"url(#"+el.id+")"}),o.clip=rc}if(!value){var path=node.getAttribute("clip-path");if(path){var clip=R._g.doc.getElementById(path.replace(/(^url\(#|\)$)/g,E));clip&&clip.parentNode.removeChild(clip),$(node,{"clip-path":E}),delete o.clip}}break;case"path":"path"==o.type&&($(node,{d:value?attrs.path=R._pathToAbsolute(value):"M0,0"}),o._.dirty=1,o._.arrows&&("startString"in o._.arrows&&addArrow(o,o._.arrows.startString),"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1)));break;case"width":if(node.setAttribute(att,value),o._.dirty=1,!attrs.fx)break;att="x",value=attrs.x;case"x":attrs.fx&&(value=-attrs.x-(attrs.width||0));case"rx":if("rx"==att&&"rect"==o.type)break;case"cx":node.setAttribute(att,value),o.pattern&&updatePosition(o),o._.dirty=1;break;case"height":if(node.setAttribute(att,value),o._.dirty=1,!attrs.fy)break;att="y",value=attrs.y;case"y":attrs.fy&&(value=-attrs.y-(attrs.height||0));case"ry":if("ry"==att&&"rect"==o.type)break;case"cy":node.setAttribute(att,value),o.pattern&&updatePosition(o),o._.dirty=1;break;case"r":"rect"==o.type?$(node,{rx:value,ry:value}):node.setAttribute(att,value),o._.dirty=1;break;case"src":"image"==o.type&&node.setAttributeNS(xlink,"href",value);break;case"stroke-width":1==o._.sx&&1==o._.sy||(value/=mmax(abs(o._.sx),abs(o._.sy))||1),node.setAttribute(att,value),attrs["stroke-dasharray"]&&addDashes(o,attrs["stroke-dasharray"],params),o._.arrows&&("startString"in o._.arrows&&addArrow(o,o._.arrows.startString),"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1));break;case"stroke-dasharray":addDashes(o,value,params);break;case"fill":var isURL=Str(value).match(R._ISURL);if(isURL){el=$("pattern");var ig=$("image");el.id=R.createUUID(),$(el,{x:0,y:0,patternUnits:"userSpaceOnUse",height:1,width:1}),$(ig,{x:0,y:0,"xlink:href":isURL[1]}),el.appendChild(ig),function(el){R._preload(isURL[1],function(){var w=this.offsetWidth,h=this.offsetHeight;$(el,{width:w,height:h}),$(ig,{width:w,height:h})})}(el),o.paper.defs.appendChild(el),$(node,{fill:"url(#"+el.id+")"}),o.pattern=el,o.pattern&&updatePosition(o);break}var clr=R.getRGB(value);if(clr.error){if(("circle"==o.type||"ellipse"==o.type||"r"!=Str(value).charAt())&&addGradientFill(o,value)){if("opacity"in attrs||"fill-opacity"in attrs){var gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E));if(gradient){var stops=gradient.getElementsByTagName("stop");$(stops[stops.length-1],{"stop-opacity":("opacity"in attrs?attrs.opacity:1)*("fill-opacity"in attrs?attrs["fill-opacity"]:1)})}}attrs.gradient=value,attrs.fill="none";break}}else delete params.gradient,delete attrs.gradient,!R.is(attrs.opacity,"undefined")&&R.is(params.opacity,"undefined")&&$(node,{opacity:attrs.opacity}),!R.is(attrs["fill-opacity"],"undefined")&&R.is(params["fill-opacity"],"undefined")&&$(node,{"fill-opacity":attrs["fill-opacity"]});clr[has]("opacity")&&$(node,{"fill-opacity":clr.opacity>1?clr.opacity/100:clr.opacity});case"stroke":clr=R.getRGB(value),node.setAttribute(att,clr.hex),"stroke"==att&&clr[has]("opacity")&&$(node,{"stroke-opacity":clr.opacity>1?clr.opacity/100:clr.opacity}),"stroke"==att&&o._.arrows&&("startString"in o._.arrows&&addArrow(o,o._.arrows.startString),"endString"in o._.arrows&&addArrow(o,o._.arrows.endString,1));break;case"gradient":("circle"==o.type||"ellipse"==o.type||"r"!=Str(value).charAt())&&addGradientFill(o,value);break;case"opacity":attrs.gradient&&!attrs[has]("stroke-opacity")&&$(node,{"stroke-opacity":value>1?value/100:value});case"fill-opacity":if(attrs.gradient){gradient=R._g.doc.getElementById(node.getAttribute("fill").replace(/^url\(#|\)$/g,E)),gradient&&(stops=gradient.getElementsByTagName("stop"),$(stops[stops.length-1],{"stop-opacity":value}));break}default:"font-size"==att&&(value=toInt(value,10)+"px");var cssrule=att.replace(/(\-.)/g,function(w){return w.substring(1).toUpperCase()});node.style[cssrule]=value,o._.dirty=1,node.setAttribute(att,value)}}tuneText(o,params),node.style.visibility=vis},tuneText=function(el,params){if("text"==el.type&&(params[has]("text")||params[has]("font")||params[has]("font-size")||params[has]("x")||params[has]("y"))){var a=el.attrs,node=el.node,fontSize=node.firstChild?toInt(R._g.doc.defaultView.getComputedStyle(node.firstChild,E).getPropertyValue("font-size"),10):10;if(params[has]("text")){for(a.text=params.text;node.firstChild;)node.removeChild(node.firstChild);for(var tspan,texts=Str(params.text).split("\n"),tspans=[],i=0,ii=texts.length;i<ii;i++)tspan=$("tspan"),i&&$(tspan,{dy:1.2*fontSize,x:a.x}),tspan.appendChild(R._g.doc.createTextNode(texts[i])),node.appendChild(tspan),tspans[i]=tspan}else for(tspans=node.getElementsByTagName("tspan"),i=0,ii=tspans.length;i<ii;i++)i?$(tspans[i],{dy:1.2*fontSize,x:a.x}):$(tspans[0],{dy:0});$(node,{x:a.x,y:a.y}),el._.dirty=1;var bb=el._getBBox(),dif=a.y-(bb.y+bb.height/2);dif&&R.is(dif,"finite")&&$(tspans[0],{dy:dif})}},getRealNode=function(node){return node.parentNode&&"a"===node.parentNode.tagName.toLowerCase()?node.parentNode:node},Element=function(node,svg){this[0]=this.node=node,node.raphael=!0,this.id=function(){return("0000"+(Math.random()*Math.pow(36,5)<<0).toString(36)).slice(-5)}(),node.raphaelid=this.id,this.matrix=R.matrix(),this.realPath=null,this.paper=svg,this.attrs=this.attrs||{},this._={transform:[],sx:1,sy:1,deg:0,dx:0,dy:0,dirty:1},!svg.bottom&&(svg.bottom=this),this.prev=svg.top,svg.top&&(svg.top.next=this),svg.top=this,this.next=null},elproto=R.el;Element.prototype=elproto,elproto.constructor=Element,R._engine.path=function(pathString,SVG){var el=$("path");SVG.canvas&&SVG.canvas.appendChild(el);var p=new Element(el,SVG);return p.type="path",setFillAndStroke(p,{fill:"none",stroke:"#000",path:pathString}),p},elproto.rotate=function(deg,cx,cy){if(this.removed)return this;if(deg=Str(deg).split(separator),deg.length-1&&(cx=toFloat(deg[1]),cy=toFloat(deg[2])),deg=toFloat(deg[0]),null==cy&&(cx=cy),null==cx||null==cy){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2,cy=bbox.y+bbox.height/2}return this.transform(this._.transform.concat([["r",deg,cx,cy]])),this},elproto.scale=function(sx,sy,cx,cy){if(this.removed)return this;if(sx=Str(sx).split(separator),sx.length-1&&(sy=toFloat(sx[1]),cx=toFloat(sx[2]),cy=toFloat(sx[3])),sx=toFloat(sx[0]),null==sy&&(sy=sx),null==cy&&(cx=cy),null==cx||null==cy)var bbox=this.getBBox(1);return cx=null==cx?bbox.x+bbox.width/2:cx,cy=null==cy?bbox.y+bbox.height/2:cy,this.transform(this._.transform.concat([["s",sx,sy,cx,cy]])),this},elproto.translate=function(dx,dy){return this.removed?this:(dx=Str(dx).split(separator),dx.length-1&&(dy=toFloat(dx[1])),dx=toFloat(dx[0])||0,dy=+dy||0,this.transform(this._.transform.concat([["t",dx,dy]])),this)},elproto.transform=function(tstr){var _=this._;if(null==tstr)return _.transform;if(R._extractTransform(this,tstr),this.clip&&$(this.clip,{transform:this.matrix.invert()}),this.pattern&&updatePosition(this),this.node&&$(this.node,{transform:this.matrix}),1!=_.sx||1!=_.sy){var sw=this.attrs[has]("stroke-width")?this.attrs["stroke-width"]:1;this.attr({"stroke-width":sw})}return this},elproto.hide=function(){return this.removed||(this.node.style.display="none"),this},elproto.show=function(){return this.removed||(this.node.style.display=""),this},elproto.remove=function(){var node=getRealNode(this.node);if(!this.removed&&node.parentNode){var paper=this.paper;paper.__set__&&paper.__set__.exclude(this),eve.unbind("raphael.*.*."+this.id),this.gradient&&paper.defs.removeChild(this.gradient),R._tear(this,paper),node.parentNode.removeChild(node),this.removeData();for(var i in this)this[i]="function"==typeof this[i]?R._removedFactory(i):null;this.removed=!0}},elproto._getBBox=function(){if("none"==this.node.style.display){this.show();var hide=!0}var containerStyle,canvasHidden=!1;this.paper.canvas.parentElement?containerStyle=this.paper.canvas.parentElement.style:this.paper.canvas.parentNode&&(containerStyle=this.paper.canvas.parentNode.style),containerStyle&&"none"==containerStyle.display&&(canvasHidden=!0,containerStyle.display="");var bbox={};try{bbox=this.node.getBBox()}catch(e){bbox={x:this.node.clientLeft,y:this.node.clientTop,width:this.node.clientWidth,height:this.node.clientHeight}}finally{bbox=bbox||{},canvasHidden&&(containerStyle.display="none")}return hide&&this.hide(),bbox},elproto.attr=function(name,value){if(this.removed)return this;if(null==name){var res={};for(var a in this.attrs)this.attrs[has](a)&&(res[a]=this.attrs[a]);return res.gradient&&"none"==res.fill&&(res.fill=res.gradient)&&delete res.gradient,res.transform=this._.transform,res}if(null==value&&R.is(name,"string")){if("fill"==name&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;if("transform"==name)return this._.transform;for(var names=name.split(separator),out={},i=0,ii=names.length;i<ii;i++)name=names[i],name in this.attrs?out[name]=this.attrs[name]:R.is(this.paper.customAttributes[name],"function")?out[name]=this.paper.customAttributes[name].def:out[name]=R._availableAttrs[name];return ii-1?out:out[names[0]]}if(null==value&&R.is(name,"array")){for(out={},i=0,ii=name.length;i<ii;i++)out[name[i]]=this.attr(name[i]);return out}if(null!=value){var params={};params[name]=value}else null!=name&&R.is(name,"object")&&(params=name);for(var key in params)eve("raphael.attr."+key+"."+this.id,this,params[key]);for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)par[has](subkey)&&(params[subkey]=par[subkey])}return setFillAndStroke(this,params),this},elproto.toFront=function(){if(this.removed)return this;var node=getRealNode(this.node);node.parentNode.appendChild(node);var svg=this.paper;return svg.top!=this&&R._tofront(this,svg),this},elproto.toBack=function(){if(this.removed)return this;var node=getRealNode(this.node),parentNode=node.parentNode;parentNode.insertBefore(node,parentNode.firstChild),R._toback(this,this.paper);this.paper;return this},elproto.insertAfter=function(element){if(this.removed||!element)return this;var node=getRealNode(this.node),afterNode=getRealNode(element.node||element[element.length-1].node);return afterNode.nextSibling?afterNode.parentNode.insertBefore(node,afterNode.nextSibling):afterNode.parentNode.appendChild(node),R._insertafter(this,element,this.paper),this},elproto.insertBefore=function(element){if(this.removed||!element)return this;var node=getRealNode(this.node),beforeNode=getRealNode(element.node||element[0].node);return beforeNode.parentNode.insertBefore(node,beforeNode),R._insertbefore(this,element,this.paper),this},elproto.blur=function(size){var t=this;if(0!=+size){var fltr=$("filter"),blur=$("feGaussianBlur");t.attrs.blur=size,fltr.id=R.createUUID(),$(blur,{stdDeviation:+size||1.5}),fltr.appendChild(blur),t.paper.defs.appendChild(fltr),t._blur=fltr,$(t.node,{filter:"url(#"+fltr.id+")"})}else t._blur&&(t._blur.parentNode.removeChild(t._blur),delete t._blur,delete t.attrs.blur),t.node.removeAttribute("filter");return t},R._engine.circle=function(svg,x,y,r){var el=$("circle");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);return res.attrs={cx:x,cy:y,r:r,fill:"none",stroke:"#000"},res.type="circle",$(el,res.attrs),res},R._engine.rect=function(svg,x,y,w,h,r){var el=$("rect");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);return res.attrs={x:x,y:y,width:w,height:h,rx:r||0,ry:r||0,fill:"none",stroke:"#000"},res.type="rect",$(el,res.attrs),res},R._engine.ellipse=function(svg,x,y,rx,ry){var el=$("ellipse");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);return res.attrs={cx:x,cy:y,rx:rx,ry:ry,fill:"none",stroke:"#000"},res.type="ellipse",$(el,res.attrs),res},R._engine.image=function(svg,src,x,y,w,h){var el=$("image");$(el,{x:x,y:y,width:w,height:h,preserveAspectRatio:"none"}),el.setAttributeNS(xlink,"href",src),svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);return res.attrs={x:x,y:y,width:w,height:h,src:src},res.type="image",res},R._engine.text=function(svg,x,y,text){var el=$("text");svg.canvas&&svg.canvas.appendChild(el);var res=new Element(el,svg);return res.attrs={x:x,y:y,"text-anchor":"middle",text:text,"font-family":R._availableAttrs["font-family"],"font-size":R._availableAttrs["font-size"],stroke:"none",fill:"#000"},res.type="text",setFillAndStroke(res,res.attrs),res},R._engine.setSize=function(width,height){return this.width=width||this.width,this.height=height||this.height,this.canvas.setAttribute("width",this.width),this.canvas.setAttribute("height",this.height),this._viewBox&&this.setViewBox.apply(this,this._viewBox),this},R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con&&con.container,x=con.x,y=con.y,width=con.width,height=con.height;if(!container)throw new Error("SVG container not found.");var isFloating,cnvs=$("svg"),css="overflow:hidden;";return x=x||0,y=y||0,width=width||512,height=height||342,$(cnvs,{height:height,version:1.1,width:width,xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink"}),1==container?(cnvs.style.cssText=css+"position:absolute;left:"+x+"px;top:"+y+"px",R._g.doc.body.appendChild(cnvs),isFloating=1):(cnvs.style.cssText=css+"position:relative",container.firstChild?container.insertBefore(cnvs,container.firstChild):container.appendChild(cnvs)),container=new R._Paper,container.width=width,container.height=height,container.canvas=cnvs,container.clear(),container._left=container._top=0,isFloating&&(container.renderfix=function(){}),container.renderfix(),container},R._engine.setViewBox=function(x,y,w,h,fit){eve("raphael.setViewBox",this,this._viewBox,[x,y,w,h,fit]);var vb,sw,paperSize=this.getSize(),size=mmax(w/paperSize.width,h/paperSize.height),top=this.top,aspectRatio=fit?"xMidYMid meet":"xMinYMin";for(null==x?(this._vbSize&&(size=1),delete this._vbSize,vb="0 0 "+this.width+S+this.height):(this._vbSize=size,vb=x+S+y+S+w+S+h),$(this.canvas,{viewBox:vb,preserveAspectRatio:aspectRatio});size&&top;)sw="stroke-width"in top.attrs?top.attrs["stroke-width"]:1,top.attr({"stroke-width":sw}),top._.dirty=1,top._.dirtyT=1,top=top.prev;return this._viewBox=[x,y,w,h,!!fit],this},R.prototype.renderfix=function(){var pos,cnvs=this.canvas,s=cnvs.style;try{pos=cnvs.getScreenCTM()||cnvs.createSVGMatrix()}catch(e){pos=cnvs.createSVGMatrix()}var left=-pos.e%1,top=-pos.f%1;(left||top)&&(left&&(this._left=(this._left+left)%1,s.left=this._left+"px"),top&&(this._top=(this._top+top)%1,s.top=this._top+"px"))},R.prototype.clear=function(){R.eve("raphael.clear",this);for(var c=this.canvas;c.firstChild;)c.removeChild(c.firstChild);this.bottom=this.top=null,(this.desc=$("desc")).appendChild(R._g.doc.createTextNode("Created with Raphaël "+R.version)),c.appendChild(this.desc),c.appendChild(this.defs=$("defs"))},R.prototype.remove=function(){eve("raphael.remove",this),this.canvas.parentNode&&this.canvas.parentNode.removeChild(this.canvas);for(var i in this)this[i]="function"==typeof this[i]?R._removedFactory(i):null};var setproto=R.st;for(var method in elproto)elproto[has](method)&&!setproto[has](method)&&(setproto[method]=function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg)})}}(method))}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;__WEBPACK_AMD_DEFINE_ARRAY__=[__webpack_require__(1)],void 0!==(__WEBPACK_AMD_DEFINE_RESULT__=function(R){if(!R||R.vml){var has="hasOwnProperty",Str=String,toFloat=parseFloat,math=Math,round=math.round,mmax=math.max,mmin=math.min,abs=math.abs,separator=/[, ]+/,eve=R.eve,S=" ",E="",map={M:"m",L:"l",C:"c",Z:"x",m:"t",l:"r",c:"v",z:"x"},bites=/([clmz]),?([^clmz]*)/gi,blurregexp=/ progid:\S+Blur\([^\)]+\)/g,val=/-?[^,\s-]+/g,cssDot="position:absolute;left:0;top:0;width:1px;height:1px;behavior:url(#default#VML)",zoom=21600,pathTypes={path:1,rect:1,image:1},ovalTypes={circle:1,ellipse:1},path2vml=function(path){var total=/[ahqstv]/gi,command=R._pathToAbsolute;if(Str(path).match(total)&&(command=R._path2curve),total=/[clmz]/g,command==R._pathToAbsolute&&!Str(path).match(total)){var res=Str(path).replace(bites,function(all,command,args){var vals=[],isMove="m"==command.toLowerCase(),res=map[command];return args.replace(val,function(value){isMove&&2==vals.length&&(res+=vals+map["m"==command?"l":"L"],vals=[]),vals.push(round(value*zoom))}),res+vals});return res}var p,r,pa=command(path);res=[];for(var i=0,ii=pa.length;i<ii;i++){p=pa[i],r=pa[i][0].toLowerCase(),"z"==r&&(r="x");for(var j=1,jj=p.length;j<jj;j++)r+=round(p[j]*zoom)+(j!=jj-1?",":E);res.push(r)}return res.join(S)},compensation=function(deg,dx,dy){var m=R.matrix();return m.rotate(-deg,.5,.5),{dx:m.x(dx,dy),dy:m.y(dx,dy)}},setCoords=function(p,sx,sy,dx,dy,deg){var _=p._,m=p.matrix,fillpos=_.fillpos,o=p.node,s=o.style,y=1,flip="",kx=zoom/sx,ky=zoom/sy;if(s.visibility="hidden",sx&&sy){if(o.coordsize=abs(kx)+S+abs(ky),s.rotation=deg*(sx*sy<0?-1:1),deg){var c=compensation(deg,dx,dy);dx=c.dx,dy=c.dy}if(sx<0&&(flip+="x"),sy<0&&(flip+=" y")&&(y=-1),s.flip=flip,o.coordorigin=dx*-kx+S+dy*-ky,fillpos||_.fillsize){var fill=o.getElementsByTagName("fill");fill=fill&&fill[0],o.removeChild(fill),fillpos&&(c=compensation(deg,m.x(fillpos[0],fillpos[1]),m.y(fillpos[0],fillpos[1])),fill.position=c.dx*y+S+c.dy*y),_.fillsize&&(fill.size=_.fillsize[0]*abs(sx)+S+_.fillsize[1]*abs(sy)),o.appendChild(fill)}s.visibility="visible"}};R.toString=function(){return"Your browser doesn’t support SVG. Falling down to VML.\nYou are running Raphaël "+this.version};var addArrow=function(o,value,isEnd){for(var values=Str(value).toLowerCase().split("-"),se=isEnd?"end":"start",i=values.length,type="classic",w="medium",h="medium";i--;)switch(values[i]){case"block":case"classic":case"oval":case"diamond":case"open":case"none":type=values[i];break;case"wide":case"narrow":h=values[i];break;case"long":case"short":w=values[i]}var stroke=o.node.getElementsByTagName("stroke")[0];stroke[se+"arrow"]=type,stroke[se+"arrowlength"]=w,stroke[se+"arrowwidth"]=h},setFillAndStroke=function(o,params){o.attrs=o.attrs||{};var node=o.node,a=o.attrs,s=node.style,newpath=pathTypes[o.type]&&(params.x!=a.x||params.y!=a.y||params.width!=a.width||params.height!=a.height||params.cx!=a.cx||params.cy!=a.cy||params.rx!=a.rx||params.ry!=a.ry||params.r!=a.r),isOval=ovalTypes[o.type]&&(a.cx!=params.cx||a.cy!=params.cy||a.r!=params.r||a.rx!=params.rx||a.ry!=params.ry),res=o;for(var par in params)params[has](par)&&(a[par]=params[par]);if(newpath&&(a.path=R._getPath[o.type](o),o._.dirty=1),params.href&&(node.href=params.href),params.title&&(node.title=params.title),params.target&&(node.target=params.target),params.cursor&&(s.cursor=params.cursor),"blur"in params&&o.blur(params.blur),(params.path&&"path"==o.type||newpath)&&(node.path=path2vml(~Str(a.path).toLowerCase().indexOf("r")?R._pathToAbsolute(a.path):a.path),o._.dirty=1,"image"==o.type&&(o._.fillpos=[a.x,a.y],o._.fillsize=[a.width,a.height],setCoords(o,1,1,0,0,0))),"transform"in params&&o.transform(params.transform),isOval){var cx=+a.cx,cy=+a.cy,rx=+a.rx||+a.r||0,ry=+a.ry||+a.r||0;node.path=R.format("ar{0},{1},{2},{3},{4},{1},{4},{1}x",round((cx-rx)*zoom),round((cy-ry)*zoom),round((cx+rx)*zoom),round((cy+ry)*zoom),round(cx*zoom)),o._.dirty=1}if("clip-rect"in params){var rect=Str(params["clip-rect"]).split(separator);if(4==rect.length){rect[2]=+rect[2]+ +rect[0],rect[3]=+rect[3]+ +rect[1];var div=node.clipRect||R._g.doc.createElement("div"),dstyle=div.style;dstyle.clip=R.format("rect({1}px {2}px {3}px {0}px)",rect),node.clipRect||(dstyle.position="absolute",dstyle.top=0,dstyle.left=0,dstyle.width=o.paper.width+"px",dstyle.height=o.paper.height+"px",node.parentNode.insertBefore(div,node),div.appendChild(node),node.clipRect=div)}params["clip-rect"]||node.clipRect&&(node.clipRect.style.clip="auto")}if(o.textpath){var textpathStyle=o.textpath.style;params.font&&(textpathStyle.font=params.font),params["font-family"]&&(textpathStyle.fontFamily='"'+params["font-family"].split(",")[0].replace(/^['"]+|['"]+$/g,E)+'"'),params["font-size"]&&(textpathStyle.fontSize=params["font-size"]),params["font-weight"]&&(textpathStyle.fontWeight=params["font-weight"]),params["font-style"]&&(textpathStyle.fontStyle=params["font-style"])}if("arrow-start"in params&&addArrow(res,params["arrow-start"]),"arrow-end"in params&&addArrow(res,params["arrow-end"],1),null!=params.opacity||null!=params.fill||null!=params.src||null!=params.stroke||null!=params["stroke-width"]||null!=params["stroke-opacity"]||null!=params["fill-opacity"]||null!=params["stroke-dasharray"]||null!=params["stroke-miterlimit"]||null!=params["stroke-linejoin"]||null!=params["stroke-linecap"]){var fill=node.getElementsByTagName("fill");if(fill=fill&&fill[0],!fill&&(fill=createNode("fill")),"image"==o.type&&params.src&&(fill.src=params.src),params.fill&&(fill.on=!0),null!=fill.on&&"none"!=params.fill&&null!==params.fill||(fill.on=!1),fill.on&&params.fill){var isURL=Str(params.fill).match(R._ISURL);if(isURL){fill.parentNode==node&&node.removeChild(fill),fill.rotate=!0,fill.src=isURL[1],fill.type="tile";var bbox=o.getBBox(1);fill.position=bbox.x+S+bbox.y,o._.fillpos=[bbox.x,bbox.y],R._preload(isURL[1],function(){o._.fillsize=[this.offsetWidth,this.offsetHeight]})}else fill.color=R.getRGB(params.fill).hex,fill.src=E,fill.type="solid",R.getRGB(params.fill).error&&(res.type in{circle:1,ellipse:1}||"r"!=Str(params.fill).charAt())&&addGradientFill(res,params.fill,fill)&&(a.fill="none",a.gradient=params.fill,fill.rotate=!1)}if("fill-opacity"in params||"opacity"in params){var opacity=((+a["fill-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+R.getRGB(params.fill).o+1||2)-1);opacity=mmin(mmax(opacity,0),1),fill.opacity=opacity,fill.src&&(fill.color="none")}node.appendChild(fill);var stroke=node.getElementsByTagName("stroke")&&node.getElementsByTagName("stroke")[0],newstroke=!1;!stroke&&(newstroke=stroke=createNode("stroke")),(params.stroke&&"none"!=params.stroke||params["stroke-width"]||null!=params["stroke-opacity"]||params["stroke-dasharray"]||params["stroke-miterlimit"]||params["stroke-linejoin"]||params["stroke-linecap"])&&(stroke.on=!0),("none"==params.stroke||null===params.stroke||null==stroke.on||0==params.stroke||0==params["stroke-width"])&&(stroke.on=!1);var strokeColor=R.getRGB(params.stroke);stroke.on&&params.stroke&&(stroke.color=strokeColor.hex),opacity=((+a["stroke-opacity"]+1||2)-1)*((+a.opacity+1||2)-1)*((+strokeColor.o+1||2)-1);var width=.75*(toFloat(params["stroke-width"])||1);if(opacity=mmin(mmax(opacity,0),1),null==params["stroke-width"]&&(width=a["stroke-width"]),params["stroke-width"]&&(stroke.weight=width),width&&width<1&&(opacity*=width)&&(stroke.weight=1),stroke.opacity=opacity,params["stroke-linejoin"]&&(stroke.joinstyle=params["stroke-linejoin"]||"miter"),stroke.miterlimit=params["stroke-miterlimit"]||8,params["stroke-linecap"]&&(stroke.endcap="butt"==params["stroke-linecap"]?"flat":"square"==params["stroke-linecap"]?"square":"round"),"stroke-dasharray"in params){var dasharray={",":"minidot","-":"shortdash",".":"shortdot","-.":"shortdashdot","-..":"shortdashdotdot",". ":"dot","- ":"dash","--":"longdash","- .":"dashdot","--.":"longdashdot","--..":"longdashdotdot"};stroke.dashstyle=dasharray[has](params["stroke-dasharray"])?dasharray[params["stroke-dasharray"]]:E}newstroke&&node.appendChild(stroke)}if("text"==res.type){res.paper.canvas.style.display=E;var span=res.paper.span,fontSize=a.font&&a.font.match(/\d+(?:\.\d*)?(?=px)/);s=span.style,a.font&&(s.font=a.font),a["font-family"]&&(s.fontFamily=a["font-family"]),a["font-weight"]&&(s.fontWeight=a["font-weight"]),a["font-style"]&&(s.fontStyle=a["font-style"]),fontSize=toFloat(a["font-size"]||fontSize&&fontSize[0])||10,s.fontSize=100*fontSize+"px",res.textpath.string&&(span.innerHTML=Str(res.textpath.string).replace(/</g,"&#60;").replace(/&/g,"&#38;").replace(/\n/g,"<br>"));var brect=span.getBoundingClientRect();res.W=a.w=(brect.right-brect.left)/100,res.H=a.h=(brect.bottom-brect.top)/100,res.X=a.x,res.Y=a.y+res.H/2,("x"in params||"y"in params)&&(res.path.v=R.format("m{0},{1}l{2},{1}",round(a.x*zoom),round(a.y*zoom),round(a.x*zoom)+1));for(var dirtyattrs=["x","y","text","font","font-family","font-weight","font-style","font-size"],d=0,dd=dirtyattrs.length;d<dd;d++)if(dirtyattrs[d]in params){res._.dirty=1;break}switch(a["text-anchor"]){case"start":res.textpath.style["v-text-align"]="left",res.bbx=res.W/2;break;case"end":res.textpath.style["v-text-align"]="right",res.bbx=-res.W/2;break;default:res.textpath.style["v-text-align"]="center",res.bbx=0}res.textpath.style["v-text-kern"]=!0}},addGradientFill=function(o,gradient,fill){o.attrs=o.attrs||{};var pow=(o.attrs,Math.pow),type="linear",fxfy=".5 .5";if(o.attrs.gradient=gradient,gradient=Str(gradient).replace(R._radial_gradient,function(all,fx,fy){return type="radial",fx&&fy&&(fx=toFloat(fx),fy=toFloat(fy),pow(fx-.5,2)+pow(fy-.5,2)>.25&&(fy=math.sqrt(.25-pow(fx-.5,2))*(2*(fy>.5)-1)+.5),fxfy=fx+S+fy),E}),gradient=gradient.split(/\s*\-\s*/),"linear"==type){var angle=gradient.shift();if(angle=-toFloat(angle),isNaN(angle))return null}var dots=R._parseDots(gradient);if(!dots)return null;if(o=o.shape||o.node,dots.length){o.removeChild(fill),fill.on=!0,fill.method="none",fill.color=dots[0].color,fill.color2=dots[dots.length-1].color;for(var clrs=[],i=0,ii=dots.length;i<ii;i++)dots[i].offset&&clrs.push(dots[i].offset+S+dots[i].color);fill.colors=clrs.length?clrs.join():"0% "+fill.color,"radial"==type?(fill.type="gradientTitle",fill.focus="100%",fill.focussize="0 0",fill.focusposition=fxfy,fill.angle=0):(fill.type="gradient",fill.angle=(270-angle)%360),o.appendChild(fill)}return 1},Element=function(node,vml){this[0]=this.node=node,node.raphael=!0,this.id=R._oid++,node.raphaelid=this.id,this.X=0,this.Y=0,this.attrs={},this.paper=vml,this.matrix=R.matrix(),this._={transform:[],sx:1,sy:1,dx:0,dy:0,deg:0,dirty:1,dirtyT:1},!vml.bottom&&(vml.bottom=this),this.prev=vml.top,vml.top&&(vml.top.next=this),vml.top=this,this.next=null},elproto=R.el;Element.prototype=elproto,elproto.constructor=Element,elproto.transform=function(tstr){if(null==tstr)return this._.transform;var oldt,vbs=this.paper._viewBoxShift,vbt=vbs?"s"+[vbs.scale,vbs.scale]+"-1-1t"+[vbs.dx,vbs.dy]:E;vbs&&(oldt=tstr=Str(tstr).replace(/\.{3}|\u2026/g,this._.transform||E)),R._extractTransform(this,vbt+tstr);var split,matrix=this.matrix.clone(),skew=this.skew,o=this.node,isGrad=~Str(this.attrs.fill).indexOf("-"),isPatt=!Str(this.attrs.fill).indexOf("url(");if(matrix.translate(1,1),isPatt||isGrad||"image"==this.type)if(skew.matrix="1 0 0 1",skew.offset="0 0",split=matrix.split(),isGrad&&split.noRotation||!split.isSimple){o.style.filter=matrix.toFilter();var bb=this.getBBox(),bbt=this.getBBox(1),dx=bb.x-bbt.x,dy=bb.y-bbt.y;o.coordorigin=dx*-zoom+S+dy*-zoom,setCoords(this,1,1,dx,dy,0)}else o.style.filter=E,setCoords(this,split.scalex,split.scaley,split.dx,split.dy,split.rotate);else o.style.filter=E,skew.matrix=Str(matrix),skew.offset=matrix.offset();return null!==oldt&&(this._.transform=oldt,R._extractTransform(this,oldt)),this},elproto.rotate=function(deg,cx,cy){if(this.removed)return this;if(null!=deg){if(deg=Str(deg).split(separator),deg.length-1&&(cx=toFloat(deg[1]),cy=toFloat(deg[2])),deg=toFloat(deg[0]),null==cy&&(cx=cy),null==cx||null==cy){var bbox=this.getBBox(1);cx=bbox.x+bbox.width/2,cy=bbox.y+bbox.height/2}return this._.dirtyT=1,this.transform(this._.transform.concat([["r",deg,cx,cy]])),this}},elproto.translate=function(dx,dy){return this.removed?this:(dx=Str(dx).split(separator),dx.length-1&&(dy=toFloat(dx[1])),dx=toFloat(dx[0])||0,dy=+dy||0,this._.bbox&&(this._.bbox.x+=dx,this._.bbox.y+=dy),this.transform(this._.transform.concat([["t",dx,dy]])),this)},elproto.scale=function(sx,sy,cx,cy){if(this.removed)return this;if(sx=Str(sx).split(separator),sx.length-1&&(sy=toFloat(sx[1]),cx=toFloat(sx[2]),cy=toFloat(sx[3]),isNaN(cx)&&(cx=null),isNaN(cy)&&(cy=null)),sx=toFloat(sx[0]),null==sy&&(sy=sx),null==cy&&(cx=cy),null==cx||null==cy)var bbox=this.getBBox(1);return cx=null==cx?bbox.x+bbox.width/2:cx,cy=null==cy?bbox.y+bbox.height/2:cy,this.transform(this._.transform.concat([["s",sx,sy,cx,cy]])),this._.dirtyT=1,this},elproto.hide=function(){return!this.removed&&(this.node.style.display="none"),this},elproto.show=function(){return!this.removed&&(this.node.style.display=E),this},elproto.auxGetBBox=R.el.getBBox,elproto.getBBox=function(){var b=this.auxGetBBox();if(this.paper&&this.paper._viewBoxShift){var c={},z=1/this.paper._viewBoxShift.scale;return c.x=b.x-this.paper._viewBoxShift.dx,c.x*=z,c.y=b.y-this.paper._viewBoxShift.dy,c.y*=z,c.width=b.width*z,c.height=b.height*z,c.x2=c.x+c.width,c.y2=c.y+c.height,c}return b},elproto._getBBox=function(){return this.removed?{}:{x:this.X+(this.bbx||0)-this.W/2,y:this.Y-this.H,width:this.W,height:this.H}},elproto.remove=function(){if(!this.removed&&this.node.parentNode){this.paper.__set__&&this.paper.__set__.exclude(this),R.eve.unbind("raphael.*.*."+this.id),R._tear(this,this.paper),this.node.parentNode.removeChild(this.node),this.shape&&this.shape.parentNode.removeChild(this.shape);for(var i in this)this[i]="function"==typeof this[i]?R._removedFactory(i):null;this.removed=!0}},elproto.attr=function(name,value){if(this.removed)return this;if(null==name){var res={};for(var a in this.attrs)this.attrs[has](a)&&(res[a]=this.attrs[a]);return res.gradient&&"none"==res.fill&&(res.fill=res.gradient)&&delete res.gradient,res.transform=this._.transform,res}if(null==value&&R.is(name,"string")){if("fill"==name&&"none"==this.attrs.fill&&this.attrs.gradient)return this.attrs.gradient;for(var names=name.split(separator),out={},i=0,ii=names.length;i<ii;i++)name=names[i],name in this.attrs?out[name]=this.attrs[name]:R.is(this.paper.customAttributes[name],"function")?out[name]=this.paper.customAttributes[name].def:out[name]=R._availableAttrs[name];return ii-1?out:out[names[0]]}if(this.attrs&&null==value&&R.is(name,"array")){for(out={},i=0,ii=name.length;i<ii;i++)out[name[i]]=this.attr(name[i]);return out}var params;null!=value&&(params={},params[name]=value),null==value&&R.is(name,"object")&&(params=name);for(var key in params)eve("raphael.attr."+key+"."+this.id,this,params[key]);if(params){for(key in this.paper.customAttributes)if(this.paper.customAttributes[has](key)&&params[has](key)&&R.is(this.paper.customAttributes[key],"function")){var par=this.paper.customAttributes[key].apply(this,[].concat(params[key]));this.attrs[key]=params[key];for(var subkey in par)par[has](subkey)&&(params[subkey]=par[subkey])}params.text&&"text"==this.type&&(this.textpath.string=params.text),setFillAndStroke(this,params)}return this},elproto.toFront=function(){return!this.removed&&this.node.parentNode.appendChild(this.node),this.paper&&this.paper.top!=this&&R._tofront(this,this.paper),this},elproto.toBack=function(){return this.removed?this:(this.node.parentNode.firstChild!=this.node&&(this.node.parentNode.insertBefore(this.node,this.node.parentNode.firstChild),R._toback(this,this.paper)),this)},elproto.insertAfter=function(element){return this.removed?this:(element.constructor==R.st.constructor&&(element=element[element.length-1]),element.node.nextSibling?element.node.parentNode.insertBefore(this.node,element.node.nextSibling):element.node.parentNode.appendChild(this.node),R._insertafter(this,element,this.paper),this)},elproto.insertBefore=function(element){return this.removed?this:(element.constructor==R.st.constructor&&(element=element[0]),element.node.parentNode.insertBefore(this.node,element.node),R._insertbefore(this,element,this.paper),this)},elproto.blur=function(size){var s=this.node.runtimeStyle,f=s.filter;return f=f.replace(blurregexp,E),0!=+size?(this.attrs.blur=size,s.filter=f+S+" progid:DXImageTransform.Microsoft.Blur(pixelradius="+(+size||1.5)+")",s.margin=R.format("-{0}px 0 0 -{0}px",round(+size||1.5))):(s.filter=f,s.margin=0,delete this.attrs.blur),this},R._engine.path=function(pathString,vml){var el=createNode("shape");el.style.cssText=cssDot,el.coordsize=zoom+S+zoom,el.coordorigin=vml.coordorigin;var p=new Element(el,vml),attr={fill:"none",stroke:"#000"};pathString&&(attr.path=pathString),p.type="path",p.path=[],p.Path=E,setFillAndStroke(p,attr),vml.canvas&&vml.canvas.appendChild(el);var skew=createNode("skew");return skew.on=!0,el.appendChild(skew),p.skew=skew,p.transform(E),p},R._engine.rect=function(vml,x,y,w,h,r){var path=R._rectPath(x,y,w,h,r),res=vml.path(path),a=res.attrs;return res.X=a.x=x,res.Y=a.y=y,res.W=a.width=w,res.H=a.height=h,a.r=r,a.path=path,res.type="rect",res},R._engine.ellipse=function(vml,x,y,rx,ry){var res=vml.path();res.attrs;return res.X=x-rx,res.Y=y-ry,res.W=2*rx,res.H=2*ry,res.type="ellipse",setFillAndStroke(res,{cx:x,cy:y,rx:rx,ry:ry}),res},R._engine.circle=function(vml,x,y,r){var res=vml.path();res.attrs;return res.X=x-r,res.Y=y-r,res.W=res.H=2*r,res.type="circle",setFillAndStroke(res,{cx:x,cy:y,r:r}),res},R._engine.image=function(vml,src,x,y,w,h){var path=R._rectPath(x,y,w,h),res=vml.path(path).attr({stroke:"none"}),a=res.attrs,node=res.node,fill=node.getElementsByTagName("fill")[0];return a.src=src,res.X=a.x=x,res.Y=a.y=y,res.W=a.width=w,res.H=a.height=h,a.path=path,res.type="image",fill.parentNode==node&&node.removeChild(fill),fill.rotate=!0,fill.src=src,fill.type="tile",res._.fillpos=[x,y],res._.fillsize=[w,h],node.appendChild(fill),setCoords(res,1,1,0,0,0),res},R._engine.text=function(vml,x,y,text){var el=createNode("shape"),path=createNode("path"),o=createNode("textpath");x=x||0,y=y||0,text=text||"",path.v=R.format("m{0},{1}l{2},{1}",round(x*zoom),round(y*zoom),round(x*zoom)+1),path.textpathok=!0,o.string=Str(text),o.on=!0,el.style.cssText=cssDot,el.coordsize=zoom+S+zoom,el.coordorigin="0 0";var p=new Element(el,vml),attr={fill:"#000",stroke:"none",font:R._availableAttrs.font,text:text};p.shape=el,p.path=path,p.textpath=o,p.type="text",p.attrs.text=Str(text),p.attrs.x=x,p.attrs.y=y,p.attrs.w=1,p.attrs.h=1,setFillAndStroke(p,attr),el.appendChild(o),el.appendChild(path),vml.canvas.appendChild(el);var skew=createNode("skew");return skew.on=!0,el.appendChild(skew),p.skew=skew,p.transform(E),p},R._engine.setSize=function(width,height){var cs=this.canvas.style;return this.width=width,this.height=height,width==+width&&(width+="px"),height==+height&&(height+="px"),cs.width=width,cs.height=height,cs.clip="rect(0 "+width+" "+height+" 0)",this._viewBox&&R._engine.setViewBox.apply(this,this._viewBox),this},R._engine.setViewBox=function(x,y,w,h,fit){R.eve("raphael.setViewBox",this,this._viewBox,[x,y,w,h,fit]);var H,W,paperSize=this.getSize(),width=paperSize.width,height=paperSize.height;return fit&&(H=height/h,W=width/w,w*H<width&&(x-=(width-w*H)/2/H),h*W<height&&(y-=(height-h*W)/2/W)),this._viewBox=[x,y,w,h,!!fit],this._viewBoxShift={dx:-x,dy:-y,scale:paperSize},this.forEach(function(el){el.transform("...")}),this};var createNode;R._engine.initWin=function(win){var doc=win.document;doc.styleSheets.length<31?doc.createStyleSheet().addRule(".rvml","behavior:url(#default#VML)"):doc.styleSheets[0].addRule(".rvml","behavior:url(#default#VML)");try{!doc.namespaces.rvml&&doc.namespaces.add("rvml","urn:schemas-microsoft-com:vml"),createNode=function(tagName){return doc.createElement("<rvml:"+tagName+' class="rvml">')}}catch(e){createNode=function(tagName){return doc.createElement("<"+tagName+' xmlns="urn:schemas-microsoft.com:vml" class="rvml">')}}},R._engine.initWin(R._g.win),R._engine.create=function(){var con=R._getContainer.apply(0,arguments),container=con.container,height=con.height,width=con.width,x=con.x,y=con.y;if(!container)throw new Error("VML container not found.");var res=new R._Paper,c=res.canvas=R._g.doc.createElement("div"),cs=c.style;return x=x||0,y=y||0,width=width||512,height=height||342,res.width=width,res.height=height,width==+width&&(width+="px"),height==+height&&(height+="px"),res.coordsize=216e5+S+216e5,res.coordorigin="0 0",res.span=R._g.doc.createElement("span"),res.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;",c.appendChild(res.span),cs.cssText=R.format("top:0;left:0;width:{0};height:{1};display:inline-block;position:relative;clip:rect(0 {0} {1} 0);overflow:hidden",width,height),1==container?(R._g.doc.body.appendChild(c),cs.left=x+"px",cs.top=y+"px",cs.position="absolute"):container.firstChild?container.insertBefore(c,container.firstChild):container.appendChild(c),res.renderfix=function(){},res},R.prototype.clear=function(){R.eve("raphael.clear",this),this.canvas.innerHTML=E,this.span=R._g.doc.createElement("span"),this.span.style.cssText="position:absolute;left:-9999em;top:-9999em;padding:0;margin:0;line-height:1;display:inline;",this.canvas.appendChild(this.span),this.bottom=this.top=null},R.prototype.remove=function(){R.eve("raphael.remove",this),this.canvas.parentNode.removeChild(this.canvas);for(var i in this)this[i]="function"==typeof this[i]?R._removedFactory(i):null;return!0};var setproto=R.st;for(var method in elproto)elproto[has](method)&&!setproto[has](method)&&(setproto[method]=function(methodname){return function(){var arg=arguments;return this.forEach(function(el){el[methodname].apply(el,arg)})}}(method))}}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__))&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)}])})}).call(exports,__webpack_require__("E4vQ")(module))},q3Rn:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var Icon=Class.create({id:null,library:null,section:null,team:null,initialize:function(data){this.id=data.id,this.library=data.library,this.section=data.section,this.team=data.team?data.team:null,Icon.all[this.fullName()]=this},isDefault:function(){return"default"===this.library},isInLibraryAndSection:function(library,section){return this.library===library&&this.section===section},name:function(){return(this.section?this.section+"-":"")+this.id},fullName:function(){return(this.isDefault()?"":this.library+"/")+(this.section?this.section+"-":"")+this.id},equals:function(otherIcon){return this.fullName()===otherIcon.fullName()},url:function(){return Icon.libraries[this.library].paths[this.name()]},group:function(){if(!Icon.libraries[this.library].hasGroups)return null;var group=this.id.substring(0,this.id.indexOf("_"));return""!=group?group:null},nextInGroup:function(){if(!this.group())return null;var allIcons=Icon.allInGroup(this.library,this.group());if(0===allIcons.length)return null;var index=allIcons.indexOf(this);return index===allIcons.length-1?allIcons[0]:allIcons[index+1]},getTitle:function(){if("task"===this.group()){return 25*Number(this.id.charAt(5)-1)+"% "+I18n.t("js.done_lower")}return"priority"===this.group()?I18n.t("js.priority_s",{v0:this.id.charAt(10)}):this.id.split("_").map(function(word){return word.capitalize()}).join(" ")},getElement:function(opts){return opts=Object.extend({src:this.url()},opts),new Element("img",opts)},getSpritePosition:function(){return Icon.allInSection(this.library,this.section).indexOf(this)},getSpriteElement:function(tagName){var index=this.getSpritePosition();return new Element(tagName||"a",{href:"#",style:"background-position: 0 "+24*-index+"px"})}});Icon.all={},Icon.get=function(fullName){return Icon.all.hasOwnProperty(fullName)?Icon.all[fullName]:null},Icon.fromFullName=function(fullName){if(fullName.split("/").length>1)var library=fullName.split("/")[0],iconName=fullName.split("/")[1];else var library="default",iconName=fullName;var section=null;iconName.split("-").length>1&&(section=iconName.split("-")[0],iconName=iconName.split("-")[1]);try{if(Icon.libraries[library]&&Icon.libraries[library].icons&&(Array.isArray(Icon.libraries[library].icons)&&Icon.libraries[library].icons.indexOf(iconName)>=0||!Array.isArray(Icon.libraries[library].icons)&&Icon.libraries[library].icons[section].indexOf(iconName)>=0)){var icon=Icon.get(fullName);return icon||(icon=new Icon({id:iconName,library:library,section:section})),icon}return null}catch(e){return null}},Icon.allInGroup=function(library,group){if(!Icon.libraries[library].hasGroups)return[];var icons=Icon.allInLibrary(library),iconObjects=[];return icons.each(function(icon){icon.group()===group&&iconObjects.push(icon)}),iconObjects},Icon.allInSection=function(library,section){if(!Icon.libraries[library])return[];var icons=Icon.libraries[library].icons;return null===section||Array.isArray(icons)||!icons.hasOwnProperty(section)?Icon.allInLibrary(library):icons[section].map(function(iconString){return Icon.findOrInit({id:iconString,library:library,section:section})})},Icon.getSections=function(library){var icons=Icon.libraries[library].icons;return Array.isArray(icons)?null:Object.keys(icons)},Icon.allInLibrary=function(library){if(!Icon.libraries[library])return[];var icons=Icon.libraries[library].icons,iconObjects=[];return Array.isArray(icons)?icons.each(function(iconString){iconObjects.push(Icon.findOrInit({id:iconString,library:library,section:null}))}):Object.keys(icons).each(function(section){icons[section].each(function(iconString){iconObjects.push(Icon.findOrInit({id:iconString,library:library,section:section}))})}),iconObjects},Icon.libraryElements=function(library,callback){if(!Icon.libraries[library])return[];for(var icons=Icon.libraries[library].icons,i=0,len=icons.length;i<len;i++){Icon.findOrInit({id:icons[i],library:library,section:null});ret.push(element)}return 0},Icon.sectionToString=function(library,section){return library!==section&&section?library+"_"+section:library},Icon.getByDetails=function(details){for(var keys=Object.keys(Icon.all),icon=null,i=keys.length;i--&&!icon;)Icon.all[keys[i]].id===details.id&&Icon.all[keys[i]].section===details.section&&Icon.all[keys[i]].library===details.library&&(icon=Icon.all[keys[i]]);return icon},Icon.findOrInit=function(data){var iconObject=Icon.getByDetails({id:data.id,library:data.library,section:data.section});return iconObject||(iconObject=new Icon({id:data.id,library:data.library,section:data.section})),iconObject},Icon.compactAndOrder=function(icons){var newIcons=[];return icons.each(function(icon){icon&&(icon.isDefault()&&"priority"===icon.group()?newIcons.unshift(icon):icon.isDefault()&&"task"===icon.group()?newIcons.insert(icon,newIcons[0]&&newIcons[0].id.match("priority")?1:0):newIcons.push(icon))}),newIcons=newIcons.uniqBy(function(icon1,icon2){return icon1.equals(icon2)})},__webpack_exports__.default=Icon},qmQO:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__sidebar_formatWidget__=__webpack_require__("6B3d"),__WEBPACK_IMPORTED_MODULE_1__sidebar_tabbedWidgetContainer__=__webpack_require__("twRW"),__WEBPACK_IMPORTED_MODULE_2__sidebar_boundariesWidget__=__webpack_require__("49TO"),__WEBPACK_IMPORTED_MODULE_3__sidebar_colorsWidget__=__webpack_require__("zDP6"),__WEBPACK_IMPORTED_MODULE_4__sidebar_stylesWidget__=__webpack_require__("YQ4/"),__WEBPACK_IMPORTED_MODULE_5__sidebar_iconsWidget__=__webpack_require__("3sJ7"),__WEBPACK_IMPORTED_MODULE_6__sidebar_imagesWidget__=__webpack_require__("ZjT+"),__WEBPACK_IMPORTED_MODULE_7__sidebar_videosWidget__=__webpack_require__("cdGT"),__WEBPACK_IMPORTED_MODULE_8__sidebar_notesWidget__=__webpack_require__("G8SJ"),__WEBPACK_IMPORTED_MODULE_9__sidebar_commentsWidget__=__webpack_require__("L/YL"),__WEBPACK_IMPORTED_MODULE_10__sidebar_linksWidget__=__webpack_require__("079/"),__WEBPACK_IMPORTED_MODULE_11__sidebar_attachmentsWidget__=__webpack_require__("iy3A"),__WEBPACK_IMPORTED_MODULE_12__sidebar_tasksWidget__=__webpack_require__("UWmw"),SideBar=Class.create({el:null,scaleFactor:1,visible:!1,viewportSpace:{right:0},defaults:{effectDuration:500,toolbar:null,animationShow:CSS.scale(1),animationHide:CSS.scale(0),animationFunction:"cubic-bezier(1, 0, 0, 1)"},initialize:function(){var _this=this;this.el=$("sidebar"),this.toggleBtn=mm$("btn-show-sidebar"),this.defaults.toolbar=mm$("toolbar_sidebar"),this.expandedElement=this.defaults.toolbar,this.widgets=[],this.sections=[],this.format=new __WEBPACK_IMPORTED_MODULE_0__sidebar_formatWidget__.default(this),this.widgets.push(this.format),this.sections.push(this.format);var design=new __WEBPACK_IMPORTED_MODULE_1__sidebar_tabbedWidgetContainer__.default("design",[__WEBPACK_IMPORTED_MODULE_3__sidebar_colorsWidget__.default,__WEBPACK_IMPORTED_MODULE_4__sidebar_stylesWidget__.default,__WEBPACK_IMPORTED_MODULE_2__sidebar_boundariesWidget__.default],this),media=new __WEBPACK_IMPORTED_MODULE_1__sidebar_tabbedWidgetContainer__.default("media",[__WEBPACK_IMPORTED_MODULE_5__sidebar_iconsWidget__.default,__WEBPACK_IMPORTED_MODULE_6__sidebar_imagesWidget__.default,__WEBPACK_IMPORTED_MODULE_7__sidebar_videosWidget__.default],this),extras=new __WEBPACK_IMPORTED_MODULE_1__sidebar_tabbedWidgetContainer__.default("extras",[__WEBPACK_IMPORTED_MODULE_8__sidebar_notesWidget__.default,__WEBPACK_IMPORTED_MODULE_9__sidebar_commentsWidget__.default,__WEBPACK_IMPORTED_MODULE_10__sidebar_linksWidget__.default,__WEBPACK_IMPORTED_MODULE_11__sidebar_attachmentsWidget__.default,__WEBPACK_IMPORTED_MODULE_12__sidebar_tasksWidget__.default],this);this.sections.push(design),this.sections.push(media),this.sections.push(extras),Element.bindOnClick(this.toggleBtn,function(){return _this.show(!0,!0)}),Element.bindOnClick("btn-hide-sidebar",function(){return _this.hide(!0,!0)}),UI.Registry.add(this),this.tooltips=MM.ui.ToolTips.touchSafe({el:this.el})},show:function(useEffect,fromUserAction){var _this2=this,animation=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.defaults.animationShow,animationFunction=arguments.length>3&&void 0!==arguments[3]?arguments[3]:this.defaults.animationFunction,_App$config=App.config,viewMode=_App$config.viewMode,editable=_App$config.editable,hide_sidebar=_App$config.hide_sidebar,sidebar_extended=_App$config.sidebar_extended,currentlyEditable=_App$config.currentlyEditable;if(!("external"===viewMode&&!editable||hide_sidebar&&!fromUserAction||this.visible&&currentlyEditable)){var cssOptions={right:App.SCROLLBAR_SIZE+15+"px",opacity:1,transitionTimingFunction:animationFunction};useEffect&&(cssOptions.transitionDuration=this.defaults.effectDuration+"ms");var activeWidget=this.widgets.find(function(widget){return widget.id===sidebar_extended});if(activeWidget&&activeWidget!==this.expandedWidget&&activeWidget.expand(),CSS.set(this.expandedElement,cssOptions),this.onResize(),this.visible=!0,this._doAnimation(animation),useEffect){var transitionEvent=CSS.whichTransitionEvent();Event.observeOnce(this.expandedElement,transitionEvent,function(){UI.Registry.notify(_this2,"show")})}else UI.Registry.notify(this,"show");this.hideToggleBtn(),this.sections.each(function(section){section.show()},this),this.onSelectNode(),App.SIDEBAR_WIDTH=this.expandedElement.getWidth()+parseInt(this.expandedElement.getStyle("right")),App.SIDEBAR_HEIGHT=this.expandedElement.getHeight(),fromUserAction&&App.setPreference("hide_sidebar",!1)}},hide:function(use_effect,fromUserAction,animation,animationFunction){if(this.visible){var timer=use_effect?this.defaults.effectDuration:0;animationFunction=animationFunction||this.defaults.animationFunction,CSS.set(this.expandedElement,{transitionDuration:timer+"ms",opacity:0,transform:animation,transitionTimingFunction:animationFunction}),animation=animation||this.defaults.animationHide,this._doAnimation(animation),this.visible=!1,this.showToggleBtn(),App.SIDEBAR_WIDTH=0,App.SIDEBAR_HEIGHT=0,fromUserAction&&App.setPreference("hide_sidebar",!0),UI.Registry.notify(this,"hide"),this._updateViewportSpace()}},toggle:function(fromUserAction){this.visible?this.hide(!0,fromUserAction):this.show(!0,fromUserAction)},showToggleBtn:function(){removeClassName(this.toggleBtn,"hidden")},hideToggleBtn:function(){addClassName(this.toggleBtn,"hidden")},toViewMode:function(){this.toggleBtn.addClassName("h-hidden"),this.hide(!0)},toEditMode:function(){this.show(!0),this.toggleBtn.removeClassName("h-hidden")},onSelectNode:function(){canvas.selected&&this.visible&&this.widgets.each(function(widget){(widget.visible||widget.expanded)&&widget.onSelectNode()})},onResize:function(){var _UI$Registry$viewport=UI.Registry.viewportOffset,top=_UI$Registry$viewport.top,bottom=_UI$Registry$viewport.bottom,availableHeight=MM.ui.page.height-(top+bottom+30),sidebarHeight=this.expandedElement.getHeight(),factor=availableHeight<sidebarHeight?Math.max(.75,availableHeight/sidebarHeight):1;this.scaleTo(factor),this._updateViewportSpace()},scaleTo:function(factor){this.scaleFactor!==factor&&(this.scaleFactor=factor,this._doAnimation(CSS.scale(factor)))},_doAnimation:function(animation){CSS.set(this.expandedElement,{transform:animation})},_updateViewportSpace:function(){var space=parseInt(this.expandedElement.style.right),viewportSpace=(this.expandedElement.getWidth()+space)*this.scaleFactor;viewportSpace!==this.viewportSpace.right&&(this.viewportSpace={right:viewportSpace})}});__webpack_exports__.default=SideBar},qzqB:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){var Button=function(props){var className="input flyout "+(props.className||"");return React.createElement("a",{href:"#",className:className,style:props.style},props.icon,React.createElement("span",null,props.label))};__webpack_exports__.a=Button}).call(__webpack_exports__,__webpack_require__("nakD"))},rOv1:function(module,exports,__webpack_require__){function isFlattenable(value){return isArray(value)||isArguments(value)||!!(spreadableSymbol&&value&&value[spreadableSymbol])}var Symbol=__webpack_require__("S8m2"),isArguments=__webpack_require__("Qziv"),isArray=__webpack_require__("zOp4"),spreadableSymbol=Symbol?Symbol.isConcatSpreadable:void 0;module.exports=isFlattenable},rP4o:function(module,exports,__webpack_require__){var basePropertyOf=__webpack_require__("Xxf7"),htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"},escapeHtmlChar=basePropertyOf(htmlEscapes);module.exports=escapeHtmlChar},rX76:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_graphics__=__webpack_require__("t8zp"),VRootC=Class.create({vnode:null,angle:null,orientation:null,graphics:null,initialize:function(vnode){this.vnode=vnode,this.graphics=this.graphics||new __WEBPACK_IMPORTED_MODULE_0_app_canvas_views_graphics__.VGraphics(this)},getOrientation:function(){return this.vnode.node.pos[0]>0?App.Layouts.orientation.right:App.Layouts.orientation.left},paint:function(atMapInit){return App.config.layout.paintRootChild(this,atMapInit)},domCoords:function(){return Math.offset(this.vnode.node.pos,Math.negativeOffset(canvas.getCenter(),this.vnode.dcontent.pos))},reposition:function(uid){App.config.layout.repositionRootChild(this,uid)},refreshLayout:function(){App.config.layout.refreshRootChildLayout(this)},calculateLinePoints:function(){this.vnode.eachChild(function(c){c.calculateLinePoints(),c.offsetLinePoints()},!0)},redrawLines:function(skipInvisibleConnections){this.vnode.node.pos&&!tree.notPainted&&this.graphics&&(this.calculateLinePoints(),this.redrawBoundaries(),this.graphics.redrawLines(),tree.readyForConnections&&this.redrawConnections(skipInvisibleConnections))},redrawRootLine:function(type,disconnect){this.calculateLinePoints(),this.graphics.redrawRootLine(type,disconnect),"live"!==type&&tree.readyForConnections&&this.redrawConnections()},redrawBoundaries:function(){this.vnode.eachChild(function(c){c.node.boundary&&(c.node.isVisible()?c.node.boundary.view.redraw():c.node.boundary.view.destroy())})},translateBoundaries:function(offset){this.vnode.eachChild(function(c){c.node.boundary&&c.node.isVisible()&&c.node.boundary.view.translate(offset)})},translateOrgChildNodes:function(offset){this.redrawRootLine();for(var rootChildSibling=this.vnode.node.getNextSibling();rootChildSibling;)rootChildSibling._listener.rc.redrawRootLine(),rootChildSibling._listener.rc.translateBoundaries({x:offset,y:0}),rootChildSibling._listener.rc.graphics.childrenPath.translate(offset,0),rootChildSibling=rootChildSibling.getNextSibling()},redrawConnections:function(skipInvisibleConnections){this.vnode.eachChild(function(c){skipInvisibleConnections&&!c.isVisible()||c.node.connections.forEach(function(conn){conn.isDrawable()&&conn.view.redraw()})})},destroyLines:function(){this.graphics&&(this.graphics.destroy(),this.graphics=null)},destroy:function(){this.destroyLines(),this.vnode=null}});__webpack_exports__.default=VRootC},sNkp:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_lodash_throttle__=__webpack_require__("MbB6"),__WEBPACK_IMPORTED_MODULE_0_lodash_throttle___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_lodash_throttle__),__WEBPACK_IMPORTED_MODULE_1_lodash_debounce__=__webpack_require__("dnTF"),__WEBPACK_IMPORTED_MODULE_1_lodash_debounce___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_1_lodash_debounce__),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},DEFAULTS={transitionDuration:300,zoomFactor:1.45,minZoom:.2,maxZoom:6},getFractionalDigits=function(val){return+val.toFixed(10).replace(/^(\-)?(.*)\./,"$10.")},Transformation=function(originX,originY,translateX,translateY,scale){this.originX=originX,this.originY=originY,this.translateX=translateX,this.translateY=translateY,this.scale=+scale.toFixed(1)},updateTransformation=function(t){currentTransformation=t},updateContainerScrolling=function(el,t){el.scrollLeft-=t.translateX-currentTransformation.translateX,el.scrollTop-=t.translateY-currentTransformation.translateY},updateZoomConfig=function(index){currentZoomIndex=index},resetOrigin=function(el,container,t){var scrollFactor=1-t.scale,originFactor=t.scale-1||1;scrollX=t.originX*scrollFactor,scrollY=t.originY*scrollFactor;var scrollingX=container.scrollLeft-scrollX,scrollingY=container.scrollTop-scrollY;origin.x=getFractionalDigits(scrollingX)/originFactor,origin.y=getFractionalDigits(scrollingY)/originFactor,CSS.set(el,{transformOrigin:origin.x+"px "+origin.y+"px"}),container.scrollLeft=scrollingX,container.scrollTop=scrollingY,moved=!0},saveZoomConfig=__WEBPACK_IMPORTED_MODULE_1_lodash_debounce___default()(function(index){ServerConnection.setPreference("zoom_factor",zoomLevels[index])},250),applyTransformation=function(el,container,t,animated){clearTimeout(transformOriginTimer),moved&&(container.scrollLeft+=scrollX,container.scrollTop+=scrollY,moved=!1);var transformOrigin=t.originX+"px "+t.originY+"px",duration=animated?DEFAULTS.transitionDuration:0;origin.x=t.originX,origin.y=t.originY,CSS.set(el,{transformOrigin:transformOrigin,transform:"scale("+t.scale.toFixed(2)+")",transition:(MM.ua.isBrowser("Safari")?browserPrefix():"")+"transform "+duration+"ms linear 0s"}),t.scale>=1&&(transformOriginTimer=setTimeout(resetOrigin.bind(null,el,container,t),duration+200))},zoom=function(el,scrollingContainer,mouseX,mouseY,scale,animated,persist,opts){var t=wheelZoom(el,currentTransformation,mouseX,mouseY,el.offsetLeft,el.offsetTop,scale,opts.minScale,opts.maxScale);if(t!==currentTransformation){var newZoomIndex=zoomLevels.indexOf(+t.scale.toFixed(1));applyTransformation(el,scrollingContainer,t,animated),updateContainerScrolling(scrollingContainer,t),updateTransformation(t),updateZoomConfig(newZoomIndex),App.config.persistent&&App.config.editable&&persist&&saveZoomConfig(currentZoomIndex)}},wheelZoom=function(el,current,mouseX,mouseY,offsetLeft,offsetTop,scale,minScale,maxScale){var previousScale=current.scale,newScale=previousScale+scale/10;newScale<minScale?newScale=minScale:newScale>maxScale&&(newScale=maxScale);var rect=el.getBoundingClientRect(),imageX=mouseX-offsetLeft-rect.left,imageY=mouseY-offsetTop-rect.top,newOriginX=imageX/previousScale,newOriginY=imageY/previousScale;if(previousScale===newScale||newOriginX===current.originX&&newOriginY===current.originY&&(newScale===maxScale||newScale===minScale))return current;var prevOriginX=current.originX*previousScale,prevOriginY=current.originY*previousScale,translateX=current.translateX,translateY=current.translateY;return(Math.abs(imageX-prevOriginX)>1||Math.abs(imageY-prevOriginY)>1)&&previousScale<=maxScale?(translateX+=(imageX-prevOriginX)*(1-1/previousScale),translateY+=(imageY-prevOriginY)*(1-1/previousScale)):(1!==previousScale||imageX!==prevOriginX&&imageY!==prevOriginY)&&(newOriginX=prevOriginX/previousScale,newOriginY=prevOriginY/previousScale),new Transformation(newOriginX,newOriginY,translateX,translateY,newScale)},wheelZoomThrottled=__WEBPACK_IMPORTED_MODULE_0_lodash_throttle___default()(zoom,50),zoomThrottled=__WEBPACK_IMPORTED_MODULE_0_lodash_throttle___default()(zoom,DEFAULTS.transitionDuration+100),transformOriginTimer=void 0,zoomLevels=[],currentTransformation=void 0,currentZoomIndex=void 0,scrollX=0,scrollY=0,origin={x:0,y:0},moved=!1;__webpack_exports__.default={init:function(el,scrollingContainer,opts){this.el=el,this.scrollingContainer=scrollingContainer,this.opts=_extends({minScale:DEFAULTS.minZoom,maxScale:DEFAULTS.maxZoom},opts);for(var scale=this.opts.minScale;scale<=this.opts.maxScale;scale+=.1)zoomLevels.push(+scale.toFixed(1));currentZoomIndex=this.getZoomIndex(1),updateTransformation(new Transformation(0,0,0,0,1)),this.initialized=!0},canZoomOut:function(){return currentZoomIndex>0},canZoomIn:function(){return currentZoomIndex<zoomLevels.length-1},zoomIn:function(persist,animated,position){if(this.canZoomIn()){var index=Math.ceil(currentZoomIndex*DEFAULTS.zoomFactor)||1;this.zoomTo(index,persist,animated,position)}},zoomOut:function(persist,animated,position){if(this.canZoomOut()){var index=Math.floor(currentZoomIndex/DEFAULTS.zoomFactor);this.zoomTo(index,persist,animated,position)}},getScaleAvg:function(){return(this.opts.minScale+this.opts.maxScale)/2},getZoomFactor:function(index){return zoomLevels[index||currentZoomIndex]},getCurrentZoomIndex:function(){return currentZoomIndex},getZoomIndex:function(zoomFactor){return zoomLevels.indexOf(zoomFactor)},zoomTo:function(index,persist,animated,position){if(!position){var viewport=document.body.getBoundingClientRect(),viewportOffset=UI.Registry.viewportOffset;position={left:(viewport.width-viewportOffset.left-viewportOffset.right)/2,top:viewport.height/2}}animated?zoomThrottled(this.el,this.scrollingContainer,position.left,position.top,index-currentZoomIndex,animated,persist,this.opts):zoom(this.el,this.scrollingContainer,position.left,position.top,index-currentZoomIndex,animated,persist,this.opts)},onWheel:function(e,scale){e.preventDefault(),e.stopPropagation();var scaleFactor=this.getZoomFactor()>1?this.getZoomFactor():1;wheelZoomThrottled(this.el,this.scrollingContainer,e.pageX,e.pageY,scale*scaleFactor,!1,!0,this.opts)},zoomToFit:function(){if(tree.finishedInitialization){var zoomFactor=Math.max(.2,Math.min(1,parseFloat((MM.ui.page.width/App.config.layout.mapSize().width).toFixed(1))));this.getZoomIndex(zoomFactor)>=0&&this.zoomTo(this.getZoomIndex(zoomFactor),!1,!1)}},transformCssZoomValue:function(value,toVirtual){return toVirtual?value*this.getZoomFactor():value/this.getZoomFactor()},transformCssZoomCoordinate:function(value,axis,toVirtual){var reference=origin[axis],toOffset=value-reference;return reference+this.transformCssZoomValue(toOffset,toVirtual)}}},sfIr:function(module,exports,__webpack_require__){function arrayIncludes(array,value){return!!(null==array?0:array.length)&&baseIndexOf(array,value,0)>-1}var baseIndexOf=__webpack_require__("350u");module.exports=arrayIncludes},t6QJ:function(module,exports){function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){var args=arguments;switch(args.length){case 0:return!predicate.call(this);case 1:return!predicate.call(this,args[0]);case 2:return!predicate.call(this,args[0],args[1]);case 3:return!predicate.call(this,args[0],args[1],args[2])}return!predicate.apply(this,args)}}var FUNC_ERROR_TEXT="Expected a function";module.exports=negate},tCwE:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var _doSelect=function(el){addClassName(el,"selected"),addClassName(el,"current")},_doPartialSelect=function(el){addClassName(el,"selected"),removeClassName(el,"current")},_doUnselect=function(el){removeClassName(el,"selected"),removeClassName(el,"current")},_updateEventListener=function(handler){this.el.stopObserving("click",this.eventClickObserver),handler&&(this.eventClickObserver=handler,this.el.observe("click",this.eventClickObserver))};__webpack_exports__.default={enabled:!0,state:null,_editingAction:null,eventClickObserver:null,isSelected:function(){return 2===this.state},isPartiallySelected:function(){return 5===this.state},isEditing:function(){return 3===this.state},toInactive:function(doCommit){switch(this.state){case 1:return;case 2:case 4:case 5:break;case 3:this.leaveEditMode(doCommit)}this.el.stopObserving("click",this.eventClickObserver);var vnode=this.el._listener;this.eventClickObserver=vnode.select.bindAsEventListener(vnode),this.enableSelecting(),this.state=1,_doUnselect(this.el),canvas.onUnselect(this.el._listener)},toPartiallySelected:function(doCommit){switch(this.state){case 5:return;case 1:case 2:case 4:break;case 3:this.leaveEditMode(doCommit)}var vnode=this.el._listener;_updateEventListener.call(this,vnode.select.bindAsEventListener(vnode)),this.state=5,_doPartialSelect(this.el)},toSelected:function(event,doCommit,noScroll,noUnselect){var ctrl=!1,shift=!1;if(event){if(canvas._imageResizing)return;ctrl=MM.ua.isPlatform("Macintosh")?event.metaKey:event.ctrlKey,shift=event.shiftKey}switch(this.state){case 5:if(ctrl||shift)return void this.toInactive();break;case 2:return;case 1:case 4:break;case 3:this.leaveEditMode(doCommit)}_updateEventListener.call(this,this.toEditing.bindAsEventListener(this,"rename")),canvas.onSelect(this.el._listener,event,noScroll,noUnselect),this.state=2,_doSelect(this.el)},toEditing:function(event,action){if((!event||!canvas._imageResizing&&!event.target.href)&&this.enabled){switch(this._editingAction=action,this.state){case 3:case 4:return}_updateEventListener.call(this),this.state=3;var vnode=this.el._listener;canvas.onSelect(vnode,event),this.enterEditMode(),_doSelect(this.el)}},toResizing:function(){switch(this.state){case 3:this.leaveEditMode(!0);break;case 1:case 2:case 5:break;case 4:return}_updateEventListener.call(this),this.state=4},disableSelecting:function(){this.enabled=!1,this.el.stopObserving("click",this.eventClickObserver)},enableSelecting:function(){this.enabled=!0,this.el.observe("click",this.eventClickObserver)}}},tZex:function(module,exports,__webpack_require__){function baseAssignValue(object,key,value){"__proto__"==key&&defineProperty?defineProperty(object,key,{configurable:!0,enumerable:!0,value:value,writable:!0}):object[key]=value}var defineProperty=__webpack_require__("jmhn");module.exports=baseAssignValue},twRW:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),TabbedWidgetContainer=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,id,tabs,sidebar){$super(id,sidebar),this.tabs=[],this.widgets={},tabs.each(function(tab){var newTab=new tab(sidebar,this);sidebar[newTab.id]=newTab,this.tabs.push(newTab.id),this.widgets[newTab.id]=newTab,sidebar.widgets.push(newTab),this.el.select("#btn_"+newTab.id)[0].observe("click",this.handleTabClick.bindAsEventListener(this,newTab.id))}.bind(this)),this.showWidget(this.activeTab())},handleTabClick:function(e,tab){e.stop(),this.showWidget(this.widgets[tab]);var tabIndex=this.tabs.indexOf(tab);App.setPreference("tab_"+this.el.id,tabIndex),App.trigger(CustomEvents["WIDGET_"+tab.toUpperCase()+"_SELECTED"])},showWidget:function(widget){widget.visible||(this.hidePreviousWidget(widget),this.setWidget(widget),widget.show())},hidePreviousWidget:function(widget){if(this.active&&this.active!==widget){this.active.hide();this.el.select("#btn_"+this.active.id)[0].removeClassName("selected")}},setWidget:function(widget){this.el.select("#btn_"+widget.id)[0].addClassName("selected"),this.active=widget},show:function($super){$super();var params=MM.utils.Url.getHashParams();this.tabs.each(function(tab){params.hasOwnProperty(tab)&&App.setPreference("tab_"+this.id,this.tabs.indexOf(tab))}.bind(this)),this.activeTab().show()},onShow:function(widget){this.hidePreviousWidget(widget),this.setWidget(widget)},hide:function($super){$super(),this.activeTab().hide()},toggle:function($super){$super(),ServerConnection.setPreference("bar_"+this.id,!this.visible)},activeTab:function(){return this.active||this.sidebar[this.tabs[App.config["tab_"+this.id]]||this.tabs[0]]}});__webpack_exports__.default=TabbedWidgetContainer},ugn0:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(React,ReactDOM){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0__iconLibrary__=__webpack_require__("j0/H"),__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),__WEBPACK_IMPORTED_MODULE_2_ui_components_tabs_tabs__=__webpack_require__("InUJ"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),IconsWidgetExpanded=function(_React$Component){function IconsWidgetExpanded(props){_classCallCheck(this,IconsWidgetExpanded);var _this=_possibleConstructorReturn(this,(IconsWidgetExpanded.__proto__||Object.getPrototypeOf(IconsWidgetExpanded)).call(this,props));return _this.goToLibrary=_this.goToLibrary.bind(_this),_this.onScroll=_this.onScroll.bind(_this),_this}return _inherits(IconsWidgetExpanded,_React$Component),_createClass(IconsWidgetExpanded,[{key:"onScroll",value:function(libName){this.tabs&&!this.animating&&this.tabs.setActiveTab(libName)}},{key:"goToLibrary",value:function(lib){var _this2=this;this.animating=!0,Effect.ScrollToContext(ReactDOM.findDOMNode(this.libraries[lib]),{target:ReactDOM.findDOMNode(this.icons),duration:"0.5",offset:-115,afterFinish:function(){return _this2.animating=!1}})}},{key:"update",value:function(){var _this3=this;if(canvas.selected){var newSelectedIcons=canvas.selected.node.icons;this.props.libs.map(function(library){var name=Icon.sectionToString(library.lib,library.section),icons=newSelectedIcons.filter(function(icon){return icon.isInLibraryAndSection(library.lib,library.section)});_this3.libraries[name].update(icons)})}}},{key:"componentWillMount",value:function(){this.libraries={}}},{key:"componentDidMount",value:function(){this._tooltips=MM.ui.ToolTips.touchSafe({el:this.container})}},{key:"componentWillUnmount",value:function(){MM.ui.ToolTips.destroyTouchSafe(this._tooltips)}},{key:"render",value:function(){var _this4=this,prevName=void 0,libraryNodes=this.props.libs.map(function(library){var name=Icon.sectionToString(library.lib,library.section),icon="lib-"+name.replace("_","-"),libraryComponent=React.createElement(__WEBPACK_IMPORTED_MODULE_0__iconLibrary__.default,{prevName:prevName||name,onScrollTo:_this4.onScroll,icon:icon,iconSize:16,library:library.lib,ref:function(el){return _this4.libraries[name]=el},section:library.section,onSelectIcon:_this4.props.onSelectIcon,name:name,key:"library_"+name});return prevName=name,libraryComponent}),tabNames=this.props.libs.map(function(library){return Icon.sectionToString(library.lib,library.section)});return React.createElement("div",{ref:function(el){return _this4.container=el}},React.createElement("div",{className:"h-flex-row bb-1 bc-grey5 p-10"},React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_svgIcon__.a,{opts:{name:"arrow-left",color:"grey-lighter",size:12},onClick:this.props.onBack}),React.createElement("div",{className:"h-flex-row h-flex-grow justify-center fw-500 "},"Icons"),React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_generic_svgIcon__.a,{opts:{name:"close",color:"grey-lighter",size:10},onClick:this.props.onClose})),React.createElement("div",{ref:function(el){return _this4.icons=el},id:"icon_libraries",className:"maxh-500 h-overflow-y p-r"},libraryNodes),React.createElement(__WEBPACK_IMPORTED_MODULE_2_ui_components_tabs_tabs__.a,{ref:function(el){return _this4.tabs=el},onClick:this.goToLibrary,libs:tabNames,classes:"bt-1 bc-grey5 p-10 h-flex-row justify-sb"}))}}]),IconsWidgetExpanded}(React.Component);__webpack_exports__.default=IconsWidgetExpanded}.call(__webpack_exports__,__webpack_require__("nakD"),__webpack_require__("x9tB"))},uwez:function(module,exports,__webpack_require__){function uniq(array){return array&&array.length?baseUniq(array):[]}var baseUniq=__webpack_require__("aaAh");module.exports=uniq},vLs6:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"GoogleSearch",function(){return GoogleSearch}),__webpack_require__.d(__webpack_exports__,"GoogleWebSearch",function(){return GoogleWebSearch});var GoogleSearch=Class.create({type:null,supported:["ImageSearch","WebSearch"],requestLimit:4,requestLimitCookie:"google_cse",initialize:function(options){if(this.engineId="production"===ServerData.env||"production_new"===ServerData.env?"015429506454637695210:3pbowazuebg":"007810728781113314522:euuaxd-rpc8",this.apiKey="production"===ServerData.env||"production_new"===ServerData.env?"AIzaSyBwCN1sb2dpT-LTh40UrJb48dC1sIYU9Xo":"AIzaSyDHKj0GxzU5NdnIpCVzO1Bbgyy7CfOCK6k",!(options.type&&this.supported.indexOf(options.type)>-1))throw"Unsupported or missing Google Search Engine";this.type=options.type,this.options=Object.extend({resultCount:20,maxResults:60},options);var limitCount=parseInt(MM.utils.getCookie(this.requestLimitCookie));this.index=1,this.results=[],this.requestCount=isNaN(limitCount)?0:limitCount},query:function(_query,fields,options){if(_query){if(options=options||{},this.options.limitRequests&&this.requestCount>=this.requestLimit)return this.queryText=null,this.searchComplete(this.results,options.onComplete),void MM.ui.dialogs.dialogUpgrade("map_google_cse");var params={q:_query,alt:"json",cx:this.engineId,key:this.apiKey,start:options.index||1};"ImageSearch"===this.type&&(params.searchType="image");var queryString=Object.toQueryString(params)+(fields?"&fields="+fields:""),url="https://www.googleapis.com/customsearch/v1?"+queryString,xhr=new XMLHttpRequest;MM.utils.setCookie(this.requestLimitCookie,++this.requestCount,1),xhr.open("GET",url,!0),xhr.onreadystatechange=function(){if(4===xhr.readyState){var response=JSON.parse(xhr.responseText);if(200===xhr.status){this.results=this.results.concat(response.items||[]);var nextPage=response.queries.nextPage;nextPage&&(this.index=nextPage[0].startIndex),nextPage&&this.results.length<this.options.resultCount&&!this.options.disablePages?(options.index=this.index,this.query(_query,options)):this.searchComplete(this.results,options.onComplete)}else response.error&&403===response.error.code&&new Ajax.Request("/images/notify_google_rate"),Windows.windows.length>0?MM.ui.dialogs.showError(I18n.t("js.s_could_not_be_contacted",{v0:"Google"})):Message.show(I18n.t("js.s_could_not_be_contacted",{v0:"Google"}),Message.ERROR),options.onError&&options.onError()}}.bind(this),xhr.send()}},searchComplete:function(results,callback){this.results=[],callback&&callback(results)}}),GoogleWebSearch=Class.create(GoogleSearch,{initialize:function($super,options){$super(Object.extend({type:"WebSearch"},options))},query:function($super,_query2,options){var fieldsEncoded=encodeURIComponent("queries,items")+"("+encodeURIComponent("title,link,snippet")+")";this.queryText=_query2,$super(_query2,fieldsEncoded,options)},searchComplete:function($super,results,callback){results=results.collect(function(result){return{title:result.title,link:result.link,description:result.snippet}}),$super(results,callback)}})},vQBY:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_lodash_debounce__=__webpack_require__("dnTF"),__WEBPACK_IMPORTED_MODULE_0_lodash_debounce___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_lodash_debounce__),_extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},_opts=void 0,_wheeling=!1,_shallZoom=!1,stopWheeling=__WEBPACK_IMPORTED_MODULE_0_lodash_debounce___default()(function(){_wheeling=!1},250),onScroll=function(e){var ctrl=e.metaKey||e.ctrlKey,isKeyToZoomPressed=ctrl||e.shiftKey||e.altKey;_shallZoom=_wheeling?_shallZoom&&isKeyToZoomPressed:isKeyToZoomPressed,_wheeling=!0,stopWheeling();var normalizedDelta=Event.wheel(e,_opts.container);if(_shallZoom)var scale=-(normalizedDelta.deltaY||normalizedDelta.deltaX)>=1?1:-1;else if(MM.ua.touchEvents())var scale=e.scale>=1?1:-1;void 0!==scale?_opts.onZoom(e,scale):MM.ua.isPlatform("Macintosh")&&_opts.onScroll(e,normalizedDelta)};__webpack_exports__.default={init:function(opts){_opts=_extends({container:document.body,onZoom:function(){return null},onScroll:function(){return null}},opts)},enable:function(){_opts.container.observe(MM.ua.getEvent().mousewheel,onScroll)},disable:function(){stopWheeling.cancel(),_opts.container.stopObserving(MM.ua.getEvent().mousewheel,onScroll)}}},vxEF:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"COLORS",function(){return COLORS}),__webpack_require__.d(__webpack_exports__,"Editor",function(){return Editor});var COLORS={red:"d93651",orange:"ff9f1a",grassGreen:"8acc47",turquoise:"30bfbf",blue:"00aaff",lightPurple:"dfcef2",greyDark:"98aab3",greyLight:"e0e4e6"},Editor=Class.create({el:null,pos:null,connection:null,initialize:function(pos,connection,onMouseOver,onMouseOut){this.pos={x:pos.x-6,y:pos.y-6},this.connection=connection,this.el=new Element("div",{id:"edit_"+this.connection.raphael_id,className:"connection_edit",style:"border: 2px solid #"+this.connection.color}),this._onclickListener=this._onClick.bind(this),this._onMouseOverListener=onMouseOver,this._onMouseOutListener=onMouseOut,this.toEditMode(),this.hide(),this.move(this.pos),canvas.el.appendChild(this.el)},_onClick:function(event){event.stop(),this.connection.from._listener.select(),App.connectionPopover&&this.destroyPopover(),App.connectionPopover=new Popover("connection",this.doActions.bind(this),{opener:this.el});var elements=[],subItem=new Element("a",{href:"#",className:"subitem"}).update(I18n.t("js.connection_color")),subMenu=new Element("ul",{className:"popover menu submenu",style:"display: none"});for(var key in COLORS){var hexColor=COLORS[key],element=new Element("a",{href:"#",className:"color",id:"btn_menu_connection_color_"+hexColor}).insert(new Element("span",{style:"background-color: #"+hexColor}));subMenu.insert(new Element("li").insert(element))}subItem.insert(subMenu),elements.push(subItem),elements.push(new Element("a",{href:"#",id:"btn_menu_connection_label"}).update(this.connection.label?I18n.t("js.connection_label_edit"):I18n.t("js.connection_label_add"))),this.connection.label&&elements.push(new Element("a",{href:"#",id:"btn_menu_connection_label_delete"}).update(I18n.t("js.connection_label_delete"))),elements.push(new Element("a",{href:"#",id:"btn_menu_connection_delete"}).update(I18n.t("js.connection_delete"))),App.connectionPopover.addElements(elements),App.connectionPopover.show()},doActions:function(value){switch(value=value.replace("btn_menu_","")){case"connection_label":this.connection.view.updateLabel(),this.connection.view.label.toEditing();break;case"connection_label_delete":this.connection.view.deleteLabel();break;case"connection_delete":this.connection.from.disconnectFrom(this.connection.to);break;default:var color=value.replace("connection_color_","");color&&this.connection.setProperties({color:color})}},move:function(point){this.pos=point,this.el.style.left=point.x+"px",this.el.style.top=point.y+"px"},show:function(){this.el.removeClassName("hidden")},hide:function(){this.el.addClassName("hidden")},toEditMode:function(){removeClassName(this.el,"h-hidden"),this.el.observe("click",this._onclickListener),this.el.observe("mouseover",this._onMouseOverListener),this.el.observe("mouseout",this._onMouseOutListener)},toViewMode:function(){addClassName(this.el,"h-hidden"),this.el.stopObserving("click",this._onclickListener),this.el.stopObserving("mouseover",this._onMouseOverListener),this.el.stopObserving("mouseout",this._onMouseOutListener)},destroyPopover:function(){App.connectionPopover.removeElements(),App.connectionPopover.destroy(),App.connectionPopover=null},destroy:function(){this.toViewMode(),Element.discard(this.el),this.connection=this.pos=null,App.connectionPopover&&(App.connectionPopover.close(),this.destroyPopover())}})},wQol:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"_Draggable",function(){return _Draggable}),__webpack_require__.d(__webpack_exports__,"_Droppable",function(){return _Droppable});var lblDraggableOpt={ghosting:!0,revert:!1,reverteffect:null,starteffect:null,endeffect:null,scroll:"canvas_container",positionLazy:!0,initialDelta:[0,0],customFindAffected:function(point,element){return canvas.findAffected(point,element)}},_Draggable={draggable:null,enableDragging:function(force){force&&this.draggable&&this.disableDragging(),this.draggable||(this.draggable=new Draggable(this.el,lblDraggableOpt))},disableDragging:function(){this.draggable&&(this.draggable.destroy(),this.draggable=null)}},lblDroppableOpt={accept:"tk_label",overlap:"vertical",positionLazy:!0,onHover:function(element,drop,vOverlap){return canvas.onLblHover(element,drop,vOverlap)},scroll:"canvas_container"},_Droppable={enableDropping:function(){Droppables.add(this.el,lblDroppableOpt)},disableDropping:function(){Droppables.remove(this.el)}}},wgYI:function(module,__webpack_exports__,__webpack_require__){"use strict";var CHANGE_EVENTS=["fullscreenchange","webkitfullscreenchange","mozfullscreenchange","MSFullscreenChange"],Fullscreen={enter:function(){var options=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this.options=options,this.onChangeListener=this.onChange.bind(this),Modernizr.fullscreen&&!this.options.skipBrowserUI&&this.hideBrowserUI(),this.options.skipAppUI||(this.hideAppUI(),!this.options.skipBrowserUI&&this.browserUIHidden&&(this.uberInterval=setInterval(function(){this.isFullScreen()&&!this.options.skipFullScreenCheck&&(this.interval=setInterval(this.checkFullScreen.bind(this),500),clearInterval(this.uberInterval))}.bind(this),200))),void 0===this.keyMap){var K=MM.utils.KeyEvent;this.keyMap=new MM.utils.KeyMap(document,"fullscreen_keymap",[{key:K.ESC,fn:this.exit.bind(this)}])}if(this.keyMap.enable(),MM.ua.touchEvents())if(mm$("btn_close_fullscreen"))show(mm$("btn_close_fullscreen"));else{var btn=new Element("div",{id:"btn_close_fullscreen",className:"p-a at-20 ar-15 bg-white bs-small p-8 rad-5px"}).update(MM.ui.icon({name:"arrows-diagonal-closer",size:16,color:"blue"}));Element.bindOnClick(btn,this.exit.bind(this)),canvas.container.parentNode.appendChild(btn)}this.fullScreen=!0},onChange:function(){this.options&&"function"==typeof this.options.onChange&&this.options.onChange(),this.isFullScreen()||this.exit()},exit:function(){var _this=this;this.fullScreen&&(this.options.skipBrowserUI||this.showBrowserUI(),this.options.skipAppUI||this.showAppUI(),this.keyMap.disable(),MM.ua.touchEvents()&&hide(mm$("btn_close_fullscreen")),this.fullScreen=!1,this.options&&"function"==typeof this.options.onExit&&this.options.onExit(),CHANGE_EVENTS.each(function(event){return document.removeEventListener(event,_this.onChangeListener)}))},toggle:function(options){this.fullScreen?this.exit(options):this.enter(options)},isFullScreen:function(){return document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement},checkFullScreen:function(){this.isFullScreen()||(this.exit(),clearInterval(this.interval))},hideBrowserUI:function(){var _this2=this,doc=document.documentElement;doc.requestFullscreen?(doc.requestFullscreen(),this.browserUIHidden=!0):doc.mozRequestFullScreen?(doc.mozRequestFullScreen(),this.browserUIHidden=!0):doc.webkitRequestFullScreen?(doc.webkitRequestFullScreen(),this.browserUIHidden=!0):doc.msRequestFullscreen&&(doc.msRequestFullscreen(),this.browserUIHidden=!0),CHANGE_EVENTS.each(function(event){return document.addEventListener(event,_this2.onChangeListener)})},showBrowserUI:function(){var doc=document;doc.exitFullscreen?doc.exitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitCancelFullScreen?doc.webkitCancelFullScreen():doc.msExitFullscreen&&doc.msExitFullscreen(),this.browserUIHidden=!1},hideAppUI:function(){UI.Registry.toggleFullScreen(!0);var postIt=$$(".postit")[0];postIt&&addClassName(postIt,"hidden")},showAppUI:function(){UI.Registry.toggleFullScreen(!1);var postIt=$$(".postit")[0];postIt&&removeClassName(postIt,"hidden")}};__webpack_exports__.a=Fullscreen},wvK4:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var SearchWrapper=Class.create({searcher:null,items:[],initialize:function(options){this.options=Object.extend({onSearch:Prototype.emptyFunction,caching:!0},options),this.ui=!options.hasOwnProperty("ui")||options.ui,this.ui&&this.options.element&&this.observeSearchField()},observeSearchField:function(){this.options.keyMap=new MM.utils.KeyMap(document,this.options.searcher+"_"+this.options.type+"_keymap",[{key:MM.utils.KeyEvent.ENTER,fn:function(){this.options.element.value!=this.search.queryText&&(this.options.element.blur(),this.query(this.options.element.value))}.bind(this)},{key:MM.utils.KeyEvent.ESC,fn:function(){this.options.element.blur()}.bind(this)}]),this.options.keyMap.disable(),this.options.element.observe("focus",this.options.keyMap.enable.bind(this.options.keyMap)),this.options.element.observe("blur",this.options.keyMap.disable.bind(this.options.keyMap))},query:function(_query,options){(this.options.element&&!_query||this.search.queryText===_query.toLowerCase())&&this.options.caching||(this.ui&&(this.options.element&&(this.options.element.value=_query),this.onSearchStarted()),this.items=[],this.search.query(_query.toLowerCase(),this.getDefaultCallbacks(options)))},queryMore:function(linkEl){linkEl.appendChild(MM.ui.LoadingSpinner(12,{className:"h-iblock ml-5"})),this.search.queryMore(this.getDefaultCallbacks())},getDefaultCallbacks:function(options){return Object.extend({onComplete:this.onSearchCompleted.bind(this),onError:this.onSearchError.bind(this)},options)},onSearchStarted:function(){this.options.loadingSpinner||(this.options.loadingSpinner=MM.ui.LoadingSpinner(64)),mm$(this.options.searcher+"_"+this.options.type+"_container").update(this.options.loadingSpinner),$(this.options.searcher+"_"+this.options.type).select(".paging")[0]&&$(this.options.searcher+"_"+this.options.type).select(".paging")[0].update(""),this.options.onSearch()},onSearchCompleted:function(items,pages,currentPage){if(this.__removeLoadingSpinner(),items.length>0){removeClassName(mm$(this.options.searcher+"_"+this.options.type+"_container"),"empty");for(var i=0,len=items.length;i<len;i++){var item=items[i];this.items.push(item),this.insertListElement(item,i)}this.updatePagination(pages,currentPage),this.updateItemListInfo&&this.updateItemListInfo(),this.options.handler&&this.options.handler(this.items)}else this.onNoResultsFound()},onSearchError:function(){this.__removeLoadingSpinner(),this.onNoResultsFound()},insertListElement:function(item,index){},updatePagination:function(pages,currentPage){var container=$(this.options.searcher+"_"+this.options.type);if(container){var list=container.select(".paging")[0];if(list&&pages>1){list.innerHTML="";var container=new Element("div",{class:"l-table-col text-center"}),previous=new Element("span",{class:"previous"}),current=new Element("span").update(I18n.t("js.page_d_of_d",{v0:currentPage,v1:pages})),next=new Element("span",{class:"next"});currentPage>1&&previous.update(I18n.t("js.previous")).observe("click",this.showPage.bind(this,currentPage-1)),currentPage<pages&&next.update(I18n.t("js.next")).observe("click",this.showPage.bind(this,currentPage+1)),list.appendChild(container.update(previous)),list.appendChild(container.clone().update(current)),list.appendChild(container.clone().update(next))}}},showPage:function(page){isNaN(page)||page<=0||(this.onSearchStarted(),this.items=[],this.search.nextPage(page))},__removeLoadingSpinner:function(){this.ui&&this.options.loadingSpinner&&(this.options.loadingSpinner.remove(),this.options.loadingSpinner=null)}});__webpack_exports__.default=SearchWrapper},xAzy:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),__webpack_require__.d(__webpack_exports__,"VConnection",function(){return VConnection}),__webpack_require__.d(__webpack_exports__,"DEFAULT_COLOR",function(){return DEFAULT_COLOR});var __WEBPACK_IMPORTED_MODULE_0_app_utils_math__=__webpack_require__("3Ox4"),__WEBPACK_IMPORTED_MODULE_1__graphics__=__webpack_require__("t8zp"),__WEBPACK_IMPORTED_MODULE_2__editableBlock__=__webpack_require__("fGk7"),__WEBPACK_IMPORTED_MODULE_3__vconnectionHandler__=__webpack_require__("VQwZ"),__WEBPACK_IMPORTED_MODULE_4__vconnectionEditor__=__webpack_require__("vxEF"),_slicedToArray=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=arr[Symbol.iterator]();!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i.return&&_i.return()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;if(Symbol.iterator in Object(arr))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),DEFAULT_COLOR=__WEBPACK_IMPORTED_MODULE_4__vconnectionEditor__.COLORS.grassGreen,VConnection=Class.create({connection:null,start:null,end:null,visible:!1,visibleHandlers:!1,labelPoint:{x:0,y:0,angle:0},initialize:function(connection){this.connection=connection},redraw:function(activate){var vfrom=this.connection.from._listener,vto=this.connection.to._listener,fromnode=vfrom.node.id,tonode=vto.node.id,activate=activate||this.shallSelect();if(vfrom.node.isVisible()&&vto.node.isVisible()){var r1=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(vfrom)),new Point(vfrom.dcontent.size())),r2=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(vto)),new Point(vto.dcontent.size())),rRoot=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(canvas.root)),new Point(canvas.root.dcontent.size()));this.toViewMode();var coords=null;coords=canvas.root==vfrom?this._getBezierCoordinatesToRoot(rRoot,r2):canvas.root==vto?this._getBezierCoordinatesToRoot(r1,rRoot):this._getBezierCoordinates(rRoot,r1,r2),coords.p1&&coords.p2&&coords.cp1&&coords.cp2&&(this.drawConnection(coords,!1,fromnode,tonode,this.connection.color,activate),this.connection.label?this.updateLabel():this.label&&this.deleteLabel())}},shallSelect:function(){var vNodeFrom=this.connection.from._listener,vNodeTo=this.connection.to._listener;return vNodeFrom.isEditing()||vNodeTo.isEditing()||vNodeFrom.isSelected()||vNodeTo.isSelected()||vNodeFrom.isPartiallySelected()||vNodeTo.isPartiallySelected()},updateLabel:function(){this.label||(this.label=new __WEBPACK_IMPORTED_MODULE_2__editableBlock__.default("connection_label",{onEnterEditMode:function(){canvas.removeFocus(),canvas.disableScrollByDrag()},onLeaveEditMode:function(){canvas.addFocus(),canvas.enableScrollByDrag()},saveCallback:this.saveLabel.bind(this)}),canvas.el.appendChild(this.label.el)),this.connection.label&&this.label.setValue(this.connection.label),this.positionLabel()},positionLabel:function(){var pos=Object.clone(this.labelPoint);pos.x-=this.label.getWidth()/2,pos.y-=this.label.getHeight()/2,this.label.el.setStyle({top:pos.y+"px",left:pos.x+"px",backgroundColor:"#"+this.connection.color})},saveLabel:function(value){this.connection.setProperties({label:value})},deleteLabel:function(){this.connection.label&&this.saveLabel(""),this.__onDeleteLabel()},__onDeleteLabel:function(){this.label&&(this.label.el.remove(),this.label=null)},_getBezierCoordinates:function(root,r1,r2){var d1,d2,points,p1,p2,cp1,cp2,cRoot=root.center(),cR1=r1.center(),cR2=r2.center(),lRootR1=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(cRoot,cR1),lRootR2=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(cRoot,cR2),lR1R2=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(cR1,cR2);if(!root.isValid()||!r1.isValid()||!r2.isValid())return{};try{d1=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(cR1,lRootR2.slope()),points=r1.intersection(d1),p1=points.find(function(p){return lR1R2.onOppositeSides(cRoot,p)}),p1||(p1=points[0]),points=d1.pointsAtDistance(p1,100),cp1=points.find(function(p){return lR1R2.onOppositeSides(cRoot,p)}),d2=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(cR2,lRootR1.slope()),points=r2.intersection(d2),p2=points.find(function(p){return lR1R2.onOppositeSides(cRoot,p)}),p2||(p2=points[0]),points=d2.pointsAtDistance(p2,100),cp2=points.find(function(p){return lR1R2.onOppositeSides(cRoot,p)})}catch(exception){MM.error.reportException({exception:exception,message:"Connection drawing problem"})}return{p1:p1,p2:p2,cp1:cp1,cp2:cp2}},_getBezierCoordinatesToRoot:function(r1,r2){var p1=r1.radialIntersection(r2.center()),p2=r2.radialIntersection(r1.center()),line=new __WEBPACK_IMPORTED_MODULE_0_app_utils_math__.Line(p1,p2),middlePoint=new Point((p1.x+p2.x)/2,(p1.y+p2.y)/2),_line$pointsAtDistanc=line.pointsAtDistance(middlePoint,10),_line$pointsAtDistanc2=_slicedToArray(_line$pointsAtDistanc,2);return{p1:p1,p2:p2,cp1:_line$pointsAtDistanc2[0],cp2:_line$pointsAtDistanc2[1]}},_overrideControlPoints:function(){this.coords.cp1.x=this.coords.p1.x+this.connection.cp_from_x,this.coords.cp1.y=this.coords.p1.y+this.connection.cp_from_y,this.coords.cp2.x=this.coords.p2.x+this.connection.cp_to_x,this.coords.cp2.y=this.coords.p2.y+this.connection.cp_to_y},_deleteLinesForConnection:function(uid){var paths=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(uid);if(paths){for(var i=paths.length-1;i>=0;i--)if("set"==paths[i].type)for(var sub=paths[i],j=0;j<=sub.length;j++)sub[j]&&sub[j].remove();else paths[i].remove();__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.unset(uid)}},drawTemporaryConnection:function(vnode,p){var r1=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(vnode)),new Point(vnode.dcontent.size())),rRoot=Rectangle.fromPosSize(new Point(canvas.getNodeCanvasOffset(canvas.root)),new Point(canvas.root.dcontent.size())),r2=Rectangle.fromPosSize(new Point(p.x-25,p.y-25),new Point(50,50)),coords=null;coords=vnode==canvas.root?this._getBezierCoordinatesToRoot(rRoot,r2):this._getBezierCoordinates(rRoot,r1,r2),coords.p1&&coords.p2&&coords.cp1&&coords.cp2&&this.drawConnection(coords,!0)},drawConnection:function(coords,temporary,fromnode,tonode){var color=arguments.length>4&&void 0!==arguments[4]?arguments[4]:DEFAULT_COLOR,activate=arguments[5];this.coords=coords;var raphael_id=temporary?"0-0":this.connection.raphael_id;__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(raphael_id)&&this._deleteLinesForConnection(raphael_id),!temporary&&this.connection.cp_to_x&&this._overrideControlPoints(),this.labelPoint=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.drawConnection(this.coords.cp1.x,this.coords.cp1.y,this.coords.cp2.x,this.coords.cp2.y,this.coords.p1.x,this.coords.p1.y,this.coords.p2.x,this.coords.p2.y,raphael_id,color);var connection=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(raphael_id);connection&&connection[1][3].updateAbsolute(this.coords.cp2.x,this.coords.cp2.y),this.visible=!0,App.config.editable&&App.config.currentlyEditable&&!temporary&&(this.toEditMode(),activate&&this.showConnectionHandlers())},toViewMode:function(){this._editIcon&&this._editIcon.toViewMode(),this.visibleHandlers&&this.hideConnectionHandlers()},toEditMode:function(){this.visible&&(this.coords.p1.x&&this.coords.p1.y&&(this._editIcon&&this._editIcon.destroy(),this._editIcon=new __WEBPACK_IMPORTED_MODULE_4__vconnectionEditor__.Editor(this.coords.p1,this.connection,this._onMouseOver.bind(this),this._onMouseOut.bind(this))),this.coords.cp1.x&&this.coords.cp1.y&&this.coords.cp2.x&&this.coords.cp2.y&&(this._handlerIcon1&&this._handlerIcon1.destroy(),this._handlerIcon2&&this._handlerIcon2.destroy(),this._handlerIcon1=new __WEBPACK_IMPORTED_MODULE_3__vconnectionHandler__.default(this.coords.cp1,2,this.connection),this._handlerIcon2=new __WEBPACK_IMPORTED_MODULE_3__vconnectionHandler__.default(this.coords.cp2,3,this.connection)))},_getRootPosition:function(fromid,toid){if(__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.keys().length>0){var curr=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(fromid+"-"+toid);return{x:curr[1][1].attrs.cx,y:curr[1][1].attrs.cy}}},destroy:function(){this.connection&&(this._deleteLinesForConnection(this.connection.raphael_id),this._handlerIcon1&&this._handlerIcon1.destroy(),this._handlerIcon2&&this._handlerIcon2.destroy(),this._editIcon&&this._editIcon.destroy()),this.label&&this.__onDeleteLabel()},clear:function(){this.toViewMode(),this.start=this.end=null,this.visible=!1,this._deleteLinesForConnection("0-0"),this.destroy()},showConnectionHandlers:function(){if(this.visible){if(__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(this.connection.raphael_id)){var controls=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(this.connection.raphael_id)[1];controls[0].show(),controls[2].show(),controls[3].show();var pos1={x:controls[2].attrs.cx,y:controls[2].attrs.cy},pos2={x:controls[3].attrs.cx,y:controls[3].attrs.cy}}this._handlerIcon1&&this._handlerIcon2&&pos1&&pos2?(this._handlerIcon1.move(pos1),this._handlerIcon2.move(pos2),this._handlerIcon1.show(),this._handlerIcon2.show()):this.toEditMode(),this.visibleHandlers=!0}},hideConnectionHandlers:function(){if(this.visibleHandlers&&!this.shallSelect()&&!this._handlerIcon1.dragging&&!this._handlerIcon2.dragging){if(__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(this.connection.raphael_id)){var controls=__WEBPACK_IMPORTED_MODULE_1__graphics__.Graphics.connectionstack.get(this.connection.raphael_id)[1];controls[0].hide(),controls[2].hide(),controls[3].hide()}this._handlerIcon1.hide(),this._handlerIcon2.hide(),this.visibleHandlers=!1}},_onMouseOver:function(){this._editIcon.show()},_onMouseOut:function(){this._editIcon.hide()}});__webpack_exports__.default=VConnection},xOlx:function(module,exports,__webpack_require__){function isFunction(value){if(!isObject(value))return!1;var tag=baseGetTag(value);return tag==funcTag||tag==genTag||tag==asyncTag||tag==proxyTag}var baseGetTag=__webpack_require__("r1rA"),isObject=__webpack_require__("xwKO"),asyncTag="[object AsyncFunction]",funcTag="[object Function]",genTag="[object GeneratorFunction]",proxyTag="[object Proxy]";module.exports=isFunction},yDlx:function(module,exports,__webpack_require__){function pickBy(object,predicate){if(null==object)return{};var props=arrayMap(getAllKeysIn(object),function(prop){return[prop]});return predicate=baseIteratee(predicate),basePickBy(object,props,function(value,path){return predicate(value,path[0])})}var arrayMap=__webpack_require__("eKAY"),baseIteratee=__webpack_require__("EAyW"),basePickBy=__webpack_require__("TIa6"),getAllKeysIn=__webpack_require__("yXac");module.exports=pickBy},yXac:function(module,exports){function nativeKeysIn(object){var result=[];if(null!=object)for(var key in Object(object))result.push(key);return result}module.exports=nativeKeysIn},ybj2:function(module,exports,__webpack_require__){function isArrayLikeObject(value){return isObjectLike(value)&&isArrayLike(value)}var isArrayLike=__webpack_require__("K2yx"),isObjectLike=__webpack_require__("7Zib");module.exports=isArrayLikeObject},yiO2:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__=__webpack_require__("YmTu"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),TabNode=function(_React$Component){function TabNode(props){_classCallCheck(this,TabNode);var _this=_possibleConstructorReturn(this,(TabNode.__proto__||Object.getPrototypeOf(TabNode)).call(this,props));return _this.state={selected:_this.props.selected},_this.handleClick=_this.handleClick.bind(_this),_this}return _inherits(TabNode,_React$Component),_createClass(TabNode,[{key:"handleClick",value:function(){this.props.handleClick(this),this.setState({selected:!0})}},{key:"render",value:function(){var color=this.state.selected?this.props.selectedColor:this.props.defaultColor;return React.createElement("div",{className:"bg-grey5-hover w-24px h-24px rad-3 h-flex-row justify-center",onClick:this.handleClick},React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_svgIcon__.a,{opts:{name:this.props.icon,color:color,size:this.props.iconSize}}))}}]),TabNode}(React.Component);__webpack_exports__.a=TabNode}).call(__webpack_exports__,__webpack_require__("nakD"))},yj88:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0});var __WEBPACK_IMPORTED_MODULE_0_app_models_poller__=__webpack_require__("ahzF"),__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__=__webpack_require__("wgYI"),__WEBPACK_IMPORTED_MODULE_2_models_linkedList__=__webpack_require__("kLIQ"),__WEBPACK_IMPORTED_MODULE_3_utils_imageQueue__=__webpack_require__("pNvO"),onSlidesPreviewLoaded=function(popover,spinner,img){spinner.remove();var thumbnail=new Element("img",{src:img.src,className:"w-150px h-auto"});popover.parent.insert(thumbnail),popover.sizeAndPosition()},Presentation={on:!1,presenter:!1,viewer:!1,togglePresenter:function(sync){this.on?ServerData.isLoggedIn?new Ajax.Request("/presentation/present/",{asynchronous:!sync,parameters:{map_id:App.config.map_id,presenter:"off"},onSuccess:function(transport){transport.responseText.evalJSON().error||Presentation.onRemotePresenterEnd()}}):this.onRemotePresenterEnd():(App.config.shareMode===App.MULTI?Dialog.confirm("<h2>"+I18n.t("js.broadcast_presentation")+"</h2><p>"+I18n.t("js.broadcast_presentation_text")+"</p>",{buttonClass:"button",okLabel:I18n.t("js.si"),cancelLabel:I18n.t("js.njet"),ok:this.startPresenterShared.bind(this,sync),cancel:this.startPresenterSingle.bind(this),windowParameters:{height:100,width:360}}):this.startPresenterSingle(),Amplitude.logEvent("play_slideshow"),App.trigger(CustomEvents.PRESENTATION_STARTED))},startPresenterSingle:function(){this.on=!0,this.presenter=!1,this.viewer=!1,Dialog.closeInfo(),Presentation.Slideshow.play({editable:!0,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:void 0===App.ui.SlideShow?null:App.ui.SlideShow.selectedSlide})},startPresenterShared:function(sync){Dialog.closeInfo();var presentationStep=null;void 0!==App.ui.SlideShow&&App.ui.SlideShow.list&&App.ui.SlideShow.list.first&&(presentationStep=App.ui.SlideShow.list.indexOf(App.ui.SlideShow.selectedSlide)),new Ajax.Request("/presentation/present/",{asynchronous:!sync,parameters:{map_id:App.config.map_id,presenter:"on",presentation_step:presentationStep},onSuccess:function(transport){transport.responseText.evalJSON().error||(__WEBPACK_IMPORTED_MODULE_0_app_models_poller__.default.resetInterval(),Presentation.onRemotePresenterStart())}})},onRemotePresenterStart:function(){this.on=!0,this.presenter=!0,this.viewer=!1,Presentation.Slideshow.play({editable:!0,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:void 0===App.ui.SlideShow?null:App.ui.SlideShow.selectedSlide})},onRemotePresenterEnd:function(){this.on=!1,this.presenter=!1},toggleViewer:function(presenter){if(this.presenter=!1,this.on)this.on=!1,this.viewer=!1,Message.hideSticky(),App.player.exit();else{this.on=!0,this.viewer=!0,presenter||(presenter=users.currentUsers.find(function(user){return user.presenter})),__WEBPACK_IMPORTED_MODULE_0_app_models_poller__.default.resetInterval(),Presentation.Slideshow.play({editable:!1,toolbar:["player","slideshow"].include(MM.utils.siteLocation.getLoc())?"slideshow":null,startAt:presenter.presentation_step,onEnd:this.updateViewerMode.bind(this,presenter)});var html='<div row><div id="btn_toggleslideshow" class="icon-svg mh-20" data-icon="presentation-mode" data-color="blue" data-size="24"></div><div class="content" style="padding: 10px 20px">'+I18n.t("js.presentation_by",{v0:presenter.name})+"</div></div>";Message.showSticky(html)}},updateViewerMode:function(presenter){if(this.on&&!this.presenter&&void 0!==App.player){presenter&&void 0!==presenter||(presenter=users.currentUsers.find(function(user){return user.presenter}));var step=presenter.presentation_step,params=MM.utils.Url.getHashParams();if(params.hasOwnProperty("step"))var currentStep=params.step;step!=currentStep&&(App.player.gotoStep(step),MM.ui.Notification.show({title:I18n.t("js.new_presentation_slide"),type:"title"}))}}};Presentation.Slideshow={previews:[],getSlides:function(options){new Ajax.Request("/presentation/slides",{asynchronous:!1,parameters:{map_id:App.config.map_id},onSuccess:function(transport){try{var response=transport.responseText.evalJSON();response.error?options.onFailure&&options.onFailure():this.buildSlidesList(response.slides,options.onSuccess,options)}catch(e){options.onFailure&&options.onFailure()}}.bind(this),onFailure:function(){options.onFailure&&options.onFailure()}.bind(null)})},buildSlidesList:function(slides,callback,options){var list=new __WEBPACK_IMPORTED_MODULE_2_models_linkedList__.a.Doubly;slides.each(function(slide){var data={id:slide.id,position:slide.position,nodes:slide.nodes.map(function(node){return tree.root.getChild(node.id)}),padding:slide.padding,transition:slide.transition};options.ui?list.insertEnd(new App.ui.VSlide(data)):list.insertEnd(new App.ui.Slide(data))}.bind(null)),callback&&callback(list)},initControls:function(){App.ui.PlayerControls.init(),Presentation.Slideshow.showControls(null,"hidden"),Presentation.Slideshow.controlEnter=function(){mm$("map_controls")._hovered=!0},Presentation.Slideshow.controlLeave=function(){mm$("map_controls")._hovered=!1},Event.observe("map_controls","mouseenter",Presentation.Slideshow.controlEnter),Event.observe("map_controls","mouseleave",Presentation.Slideshow.controlLeave),mm$("branded-logo").onclick=__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a.exit.bind(__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a)},prepare:function(viewOnly){"public"!==App.config.viewMode&&(UI.Registry.toggleMode("view"),App.config.currentlyEditable=!1),canvas.disableMobileFullScreen(),viewOnly||App.ui.SlideShow.init(App.ui.Footer.enable.bind(App.ui.Footer))},exit:function(){void 0!==App.ui.SlideShow&&App.ui.SlideShow.teardown(),"undefined"!=typeof Selections&&(Selections.teardown(),canvas.setupSelections()),canvas.enableMobileFullScreen(),App.config.editable&&(App.config.currentlyEditable=!0,UI.Registry.toggleMode("edit"))},showControls:function(event,hide_class){if(event){if(Event.stop(event),this.lastX==event.clientX||this.lastY==event.clientY)return;this.lastX=event.clientX,this.lastY=event.clientY}App.ui.PlayerControls.show(!0,hide_class||"faded"),Presentation.Slideshow.controlsTimeout=setTimeout(Presentation.Slideshow.hideControls,4e3),Event.stopObserving(document,"mousemove",Presentation.Slideshow.showControls)},hideControls:function(){if(mm$("map_controls")._hovered)return void Presentation.Slideshow.showControls();App.ui.PlayerControls.hide(!0,"faded"),Event.observe(document,"mousemove",Presentation.Slideshow.showControls)},handleFullScreenChange:function(){setTimeout(function(){canvas.onRecenter(null,!1,!0)},500)},play:function(options){__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a.enter({skipFullScreenCheck:!MM.ua.touchEvents(),onChange:this.handleFullScreenChange.bind(this),skipBrowserUI:MM.utils.Url.getHashParams().hasOwnProperty("player")||"public"===App.config.viewMode,skipAppUI:!0}),options=Object.extend({toolbar:null},options),options.toolbar&&options.toolbar===App.ui.Footer.activeBar||App.ui.Footer.activeBar&&App.ui.Footer.hideBar(App.ui.Footer.activeBar,!0),void 0!==App.ui.SlideShow&&App.ui.SlideShow.list&&App.ui.SlideShow.list.first?this.doPlay(options,App.ui.SlideShow.list):this.getSlides({ui:!1,onSuccess:this.doPlay.bind(this,options)})},doPlay:function(options,list){var _this=this;Presentation.Slideshow.prepare(!0),addClassName(canvas.el,"presentation_play"),canvas.disableMobileFullScreen();var currentZoomIndex=App.ui.Zoom.getCurrentZoomIndex();canvas.root.eachChild(function(vnode){vnode.dcontent.el._title=vnode.dcontent.el.title,vnode.dcontent.el.title=""}),canvas.onResize(),users&&users.currentUsers&&users.currentUsers.each(function(user){if(user.idea_id){var node=tree.root.getChild(user.idea_id);node&&node._listener.unSelectByUser(user)}}.bind(null)),App.ui.Zoom.zoomTo(App.ui.Zoom.getZoomIndex(1),!1),__webpack_require__.e(149).then(__webpack_require__.bind(null,"fRon")).then(function(){App.player=App.ui.Player(null,{onExit:function(){removeClassName(canvas.el,"presentation_play"),options.editable&&(App.ui.PlayerControls.hide(!0,"hidden"),clearTimeout(Presentation.Slideshow.controlsTimeout),Event.stopObserving("map_controls","mouseenter",Presentation.Slideshow.controlEnter),Event.stopObserving("map_controls","mouseleave",Presentation.Slideshow.controlLeave),Event.stopObserving(document,"mousemove",Presentation.Slideshow.showControls)),options.toolbar?MM.utils.siteLocation.setLoc(options.toolbar):(MM.utils.siteLocation.reset(),Presentation.Slideshow.exit()),__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a.exit(),__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a.showAppUI(),canvas.closeTemporarilyOpen(),Presentation.on?Presentation.presenter?Presentation.togglePresenter():Presentation.viewer?(Presentation.on=!1,Presentation.viewer=!1):Presentation.on=!1:canvas.enableMobileFullScreen(),list.each(function(slide){slide.onExitPlay()}),$("slideshow_steps").remove(),void 0!==App.ui.SlideShow&&App.ui.SlideShow.keyMap&&App.ui.SlideShow.keyMap.enable(),App.ui.Zoom.zoomTo(currentZoomIndex,!1),App.ui.Preview.popover&&CSS.set(App.ui.Preview.popover.parent,{transform:CSS.scale(1)}),canvas.root.eachChild(function(vnode){vnode.dcontent.el.title=vnode.dcontent.el._title}),_this.previews.each(function(preview){preview.parent.remove(),preview.destroy()}),_this.previews=[],_this.handleFullScreenChange(),App.trigger(CustomEvents.PRESENTATION_STOPPED)},width:MM.ui.page.width,height:MM.ui.page.height}),__WEBPACK_IMPORTED_MODULE_1_ui_fullscreen__.a.hideAppUI(),setTimeout(function(){void 0!==App.ui.SlideShow&&App.ui.SlideShow.keyMap&&App.ui.SlideShow.keyMap.disable(),App.player.init(list,{startAt:options.startAt?options.startAt:list.first}),MM.utils.siteLocation.setLoc("player"),options.editable||App.ui.Player.keyMap.disable()},1e3),_this.buildSlideShowSteps(options,list),options.editable&&(mm$("map_controls")?Presentation.Slideshow.initControls():new Ajax.Request("/toolbar/slideshow_play/"+App.config.map_id)),options.onEnd&&options.onEnd()})},buildSlideShowSteps:function(options,list){var _this2=this,slidesListParent=new Element("div",{id:"slideshow_steps"}),slidesList=new Element("ul");slidesListParent.appendChild(slidesList),canvas.container.parentNode.appendChild(slidesListParent);var mapSize=canvas.getMapSizeAndOffset();list.each(function(slide,index){var step=new Element("li",{id:"slideshow_step"+slide.id});if(step.innerHTML=options.editable?'<a href="#" onclick="App.player.gotoStep('+(index+1)+'); return false;"></a>':'<a href="#" onclick="return false;"></a>',"embedded"!==App.config.viewMode){var spinner=new Element("div",{className:"w-150px p-r ta-center"}).insert(MM.ui.LoadingSpinner(32,{className:"h-iblock"})),popoverEl=new Element("div",{id:"popover_slidespreview_"+slide.id,className:"popover",style:"display: none"}).insert(spinner);canvas.container.parentNode.appendChild(popoverEl);var popover=new Popover("slidespreview_"+slide.id,null,{opener:step,observeEvent:"mouseover"});__WEBPACK_IMPORTED_MODULE_3_utils_imageQueue__.a.add({image:{src:slide.getPreviewImageSrc(mapSize)},onLoad:onSlidesPreviewLoaded.bind(_this2,popover,spinner)}),_this2.previews.push(popover)}slidesList.appendChild(step)})}},__webpack_exports__.default=Presentation},ylcm:function(module,exports,__webpack_require__){function baseSet(object,path,value,customizer){if(!isObject(object))return object;path=castPath(path,object);for(var index=-1,length=path.length,lastIndex=length-1,nested=object;null!=nested&&++index<length;){var key=toKey(path[index]),newValue=value;if(index!=lastIndex){var objValue=nested[key];newValue=customizer?customizer(objValue,key,nested):void 0,void 0===newValue&&(newValue=isObject(objValue)?objValue:isIndex(path[index+1])?[]:{})}assignValue(nested,key,newValue),nested=nested[key]}return object}var assignValue=__webpack_require__("5cCM"),castPath=__webpack_require__("Hnr2"),isIndex=__webpack_require__("U8js"),isObject=__webpack_require__("xwKO"),toKey=__webpack_require__("4dmE");module.exports=baseSet},zDP6:function(module,__webpack_exports__,__webpack_require__){"use strict";Object.defineProperty(__webpack_exports__,"__esModule",{value:!0}),function(ReactDOM,React){var __WEBPACK_IMPORTED_MODULE_0__widget__=__webpack_require__("A9ap"),__WEBPACK_IMPORTED_MODULE_1_ui_components_colorPalette__=__webpack_require__("zOua"),__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__=__webpack_require__("h7V/"),ColorsWidget=Class.create(__WEBPACK_IMPORTED_MODULE_0__widget__.default,{initialize:function($super,sidebar,parent){$super("colors",sidebar,parent)},load:function($super){var _this=this;this.list=this.el.select("div")[0],this.renderColors(),this.initTabs(),__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__.a.get("colors_widget_tab",function(preference){_this.selectTab(preference?preference.value:_this.tabs[0])}),$super()},initTabs:function(){this.tabs=["color","backgroundColor"],this.tabs.each(function(tab){Element.bindOnClick(mm$("btn-"+tab.toLowerCase()),this.selectTab.bind(this,tab))}.bind(this))},selectTab:function(tab){this.selectedTab!==tab&&this.tabs.include(tab)&&(this.selectedTab&&removeClassName(mm$("btn-"+this.selectedTab.toLowerCase()),"selected"),this.selectedTab=tab,__WEBPACK_IMPORTED_MODULE_2_utils_userPreferences__.a.save({name:"colors_widget_tab",value:this.selectedTab}),addClassName(mm$("btn-"+this.selectedTab.toLowerCase()),"selected"),this.onSelectNode())},setValue:function(color){canvas.onSetStyle(this.selectedTab,color)},renderColors:function(color){ReactDOM.render(React.createElement(__WEBPACK_IMPORTED_MODULE_1_ui_components_colorPalette__.a,{selectedColor:color,onItemClick:this.setValue.bind(this)}),this.list)},onSelectNode:function(){if(canvas.selected){var style=canvas.selected.node.currentStyle();this.renderColors(style[this.selectedTab])}}});__webpack_exports__.default=ColorsWidget}.call(__webpack_exports__,__webpack_require__("x9tB"),__webpack_require__("nakD"))},zOua:function(module,__webpack_exports__,__webpack_require__){"use strict";(function(React){function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}var __WEBPACK_IMPORTED_MODULE_0_ui_components_generic_imageGrid_imageGrid__=__webpack_require__("+VMB"),__WEBPACK_IMPORTED_MODULE_1_app_utils_constants__=__webpack_require__("67vC"),_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ColorPalette=function(_React$Component){function ColorPalette(props){_classCallCheck(this,ColorPalette);var _this=_possibleConstructorReturn(this,(ColorPalette.__proto__||Object.getPrototypeOf(ColorPalette)).call(this,props));return _this.state={selectedColor:_this.props.selectedColor},_this}return _inherits(ColorPalette,_React$Component),_createClass(ColorPalette,[{key:"_handleClick",value:function(color){this.setState({selectedColor:color}),this.props.onItemClick&&this.props.onItemClick(color)}},{key:"componentWillReceiveProps",value:function(nextProps){this.setState({selectedColor:nextProps.selectedColor})}},{key:"render",value:function(){var _this2=this;return React.createElement(__WEBPACK_IMPORTED_MODULE_0_ui_components_generic_imageGrid_imageGrid__.a,{elementsInRow:this.props.elementsInRow,items:__WEBPACK_IMPORTED_MODULE_1_app_utils_constants__.COLORS.map(function(color){return{element:React.createElement("span",{style:{backgroundColor:"#"+color}}),className:"color"+(_this2.state.selectedColor===color?" selected":""),onClick:function(){return _this2._handleClick(color)}}})})}}]),ColorPalette}(React.Component);ColorPalette.defaultProps={elementsInRow:8},__webpack_exports__.a=ColorPalette}).call(__webpack_exports__,__webpack_require__("nakD"))}},["koC0"]);