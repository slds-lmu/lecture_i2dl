var Builder={NODEMAP:{AREA:"map",CAPTION:"table",COL:"table",COLGROUP:"table",LEGEND:"fieldset",OPTGROUP:"select",OPTION:"select",PARAM:"object",TBODY:"table",TD:"table",TFOOT:"table",TH:"table",THEAD:"table",TR:"table"},node:function(e){e=e.toUpperCase();var t=this.NODEMAP[e]||"div",i=document.createElement(t);try{i.innerHTML="<"+e+"></"+e+">"}catch(r){}var n=i.firstChild||null;if(n&&n.tagName.toUpperCase()!=e&&(n=n.getElementsByTagName(e)[0]),n||(n=document.createElement(e)),n){if(arguments[1])if(this._isStringOrNumber(arguments[1])||arguments[1]instanceof Array||arguments[1].tagName)this._children(n,arguments[1]);else{var a=this._attributes(arguments[1]);if(a.length){try{i.innerHTML="<"+e+" "+a+"></"+e+">"}catch(r){}if(n=i.firstChild||null,!n){n=document.createElement(e);for(attr in arguments[1])n["class"==attr?"className":attr]=arguments[1][attr]}n.tagName.toUpperCase()!=e&&(n=i.getElementsByTagName(e)[0])}}return arguments[2]&&this._children(n,arguments[2]),n}},_text:function(e){return document.createTextNode(e)},ATTR_MAP:{className:"class",htmlFor:"for"},_attributes:function(e){var t=[];for(attribute in e)t.push((attribute in this.ATTR_MAP?this.ATTR_MAP[attribute]:attribute)+'="'+e[attribute].toString().escapeHTML().gsub(/"/,"&quot;")+'"');return t.join(" ")},_children:function(e,t){return t.tagName?void e.appendChild(t):void("object"==typeof t?t.flatten().each(function(t){"object"==typeof t?e.appendChild(t):Builder._isStringOrNumber(t)&&e.appendChild(Builder._text(t))}):Builder._isStringOrNumber(t)&&e.appendChild(Builder._text(t)))},_isStringOrNumber:function(e){return"string"==typeof e||"number"==typeof e},build:function(e){var t=this.node("div");return $(t).update(e.strip()),t.down()},dump:function(e){"object"!=typeof e&&"function"!=typeof e&&(e=window);var t="A ABBR ACRONYM ADDRESS APPLET AREA B BASE BASEFONT BDO BIG BLOCKQUOTE BODY BR BUTTON CAPTION CENTER CITE CODE COL COLGROUP DD DEL DFN DIR DIV DL DT EM FIELDSET FONT FORM FRAME FRAMESET H1 H2 H3 H4 H5 H6 HEAD HR HTML I IFRAME IMG INPUT INS ISINDEX KBD LABEL LEGEND LI LINK MAP MENU META NOFRAMES NOSCRIPT OBJECT OL OPTGROUP OPTION P PARAM PRE Q S SAMP SCRIPT SELECT SMALL SPAN STRIKE STRONG STYLE SUB SUP TABLE TBODY TD TEXTAREA TFOOT TH THEAD TITLE TR TT U UL VAR".split(/\s+/);t.each(function(t){e[t]=function(){return Builder.node.apply(Builder,[t].concat($A(arguments)))}})}},DatePicker=Class.create();DatePicker.prototype={Version:"0.9.2",_relative:null,_div:null,_zindex:1,_keepFieldEmpty:!1,_daysInMonth:[31,28,31,30,31,30,31,31,30,31,30,31],_callback:null,_ignoreElements:[],_language:"en",_language_month:$H({fr:["Janvier","F&#233;vrier","Mars","Avril","Mai","Juin","Juillet","Aout","Septembre","Octobre","Novembre","D&#233;cembre"],en:["January","February","March","April","May","June","July","August","September","October","November","December"],es:["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"],it:["Gennaio","Febbraio","Marzo","Aprile","Maggio","Giugno","Luglio","Agosto","Settembre","Ottobre","Novembre","Dicembre"],de:["Januar","Februar","M&#228;rz","April","Mai","Juni","Juli","August","September","Oktober","November","Dezember"],pt:["Janeiro","Fevereiro","Mar&#231;o","Abril","Maio","Junho","Julho","Agosto","Setembro","Outubro","Novembro","Dezembro"],ja:["\u5e741\u6708","\u5e742\u6708","\u5e743\u6708","\u5e744\u6708","\u5e745\u6708","\u5e746\u6708","\u5e747\u6708","\u5e748\u6708","\u5e749\u6708","\u5e7410\u6708","\u5e7411\u6708","\u5e7412\u6708"]}),_language_day:$H({fr:["Lun","Mar","Mer","Jeu","Ven","Sam","Dim"],en:["Mon","Tue","Wed","Thu","Fri","Sat","Sun"],es:["Lun","Mar","Mie","Jue","Vie","S&#224;b","Dom"],it:["Lun","Mar","Mer","Gio","Ven","Sab","Dom"],de:["Mon","Die","Mit","Don","Fre","Sam","Son"],pt:["Seg","Ter","Qua","Qui","Sex","S&#225;","Dom"],ja:["\u6708","\u706b","\u6c34","\u6728","\u91d1","\u571f","\u65e5"]}),_language_close:$H({fr:"fermer",en:"close",es:"cierre",it:"fine",de:"schliessen",pt:"fim",ja:"\u9589\u3058\u308b"}),_languages_reverse_m_y:["ja"],_todayDate:new Date,_date_regexp:/^(\d{1,2})(\/|\.|\-)(\d{1,2})(?:\/|\.|\-)(\d{4})$/,_current_date:null,_clickCallback:Prototype.emptyFunction,_cellCallback:Prototype.emptyFunction,_date_separator:"/",_id_datepicker:null,_topOffset:16,_leftOffset:-73,_isPositionned:!1,_relativePosition:!0,getMonthLocale:function(e){return this._language_month.get(this._language)[e]},getMonthYearOrder:function(e,t,i){return this._languages_reverse_m_y.include(this._language)?t+i+e:e+i+t},getLocaleClose:function(){return this._language_close.get(this._language)},_initCurrentDate:function(){var e=$(this._relative).getAttribute("date");if(e&&""!=e?this._current_date=e:this._startDate?(this._current_date=this._startDate,$(this._relative).setAttribute("date",this._current_date)):this._current_date=null,!this._date_regexp.test(this._current_date)){var t=new Date,i=this._leftpad_zero(t.getDate(),2),r=this._leftpad_zero(t.getMonth()+1,2);this._current_date?(this._current_date=r+"/"+i+"/"+t.getFullYear(),$(this._relative).setAttribute("date",this._current_date)):this._current_date=r+"/"+i+"/"+t.getFullYear(),this._keepFieldEmpty||$(this._relative).setAttribute("value",this._current_date)}var n=this._current_date.match(this._date_regexp);this._date_separator=String(n[2]),this._saved_mon=this._current_mon=Number(n[1])-1,this._saved_day=this._current_day=Number(n[3]),this._saved_year=this._current_year=Number(n[4])},initialize:function(e){this._relative=e.relative,e.language&&(this._language=e.language),e.opener&&(this._opener=e.opener),e.parent&&(this._parent=e.parent),this._zindex=e.zindex?parseInt(Number(e.zindex)):1,"undefined"!=typeof e.keepFieldEmpty&&(this._keepFieldEmpty=e.keepFieldEmpty),"function"==typeof e.clickCallback&&(this._clickCallback=e.clickCallback),Object.isFunction(e.cellCallback)&&(this._cellCallback=e.cellCallback),"undefined"!=typeof e.leftOffset&&(this._leftOffset=parseInt(e.leftOffset)),"undefined"!=typeof e.topOffset&&(this._topOffset=parseInt(["topOffset"])),"undefined"!=typeof e.relativePosition&&(this._relativePosition=e.relativePosition),"undefined"!=typeof e.startDate&&(this._startDate=e.startDate),"undefined"!=typeof e.ignore&&(this._ignoreElements=e.ignore),this._id_datepicker="datepicker-"+this._relative,this._id_datepicker_prev=this._id_datepicker+"-prev",this._id_datepicker_next=this._id_datepicker+"-next",this._id_datepicker_hdr=this._id_datepicker+"-header",this._id_datepicker_ftr=this._id_datepicker+"-footer",this._div=Builder.node("div",{id:this._id_datepicker,className:"datepicker",style:"z-index: "+this._zindex},[Builder.node("div",{className:"h-flex-row justify-sb datepicker-header"},[Builder.node("div",{id:this._id_datepicker_prev},""),Builder.node("div",{id:this._id_datepicker_hdr}),Builder.node("div",{id:this._id_datepicker_next},"")]),Builder.node("div",{className:"datepicker-calendar"},[Builder.node("table",{id:this._id_datepicker+"-table"})]),Builder.node("div",{id:this._id_datepicker_ftr,className:"datepicker-footer"},I18n.t("js.remove"))]),this.clickListener=this.click.bindAsEventListener(this),Event.observe(this._opener,"click",this.clickListener),this.blurListener=this.hide.bindAsEventListener(this),this._language_month.get(this._language)||(this._language_month.set(this._language,[I18n.t("js.january"),I18n.t("js.february"),I18n.t("js.march"),I18n.t("js.april"),I18n.t("js.may"),I18n.t("js.june"),I18n.t("js.july"),I18n.t("js.august"),I18n.t("js.september"),I18n.t("js.october"),I18n.t("js.november"),I18n.t("js.december")]),this._language_day.set(this._language,[I18n.t("js.monday_short"),I18n.t("js.tuesday_short"),I18n.t("js.wednesday_short"),I18n.t("js.thursday_short"),I18n.t("js.friday_short"),I18n.t("js.saturday_short"),I18n.t("js.sunday_short")]))},load:function(){var e=$(this._parent)||document.getElementsByTagName("body").item(0);e&&(this._arrow=new Element("span",{"class":"arrow"}),e.appendChild(this._arrow),e.appendChild(this._div),e.style.opacity=0),$(this._id_datepicker_prev).update(MM.ui.icon({name:"arrow-left",size:14,color:"grey3"})),$(this._id_datepicker_next).update(MM.ui.icon({name:"arrow-right",size:14,color:"grey3"})),this._initCurrentDate(),Event.observe(this._id_datepicker_prev,"click",this.prevMonth.bindAsEventListener(this),!1),Event.observe(this._id_datepicker_next,"click",this.nextMonth.bindAsEventListener(this),!1),Event.observe(this._id_datepicker_ftr,"click",this.removeDate.bindAsEventListener(this),!1)},show:function(){clearTimeout(this._hideTimer),$(this._opener)&&$(this._opener).addClassName("selected"),$(this._relative)&&$(this._relative).addClassName("selected");var e=$(this._parent);e.show(),this._initCurrentDate(),this._redrawCalendar(),!this._isPositionned&&this._relativePosition&&this.position(),document.observe("click",this.blurListener),e.style.opacity=1,"undefined"!=typeof GeneralPopover&&GeneralPopover.closeOpenPopover()},position:function(e){MM.ui.positionPopover({parent:$(this._parent),opener:$(this._opener),arrow:$(this._arrow),options:{}})},click:function(e){$(this._parent).visible()?this.close():this.show(),eval(this._clickCallback()),Event.stop(e)},disable:function(){$(this._opener)&&Event.stopObserving(this._opener,"click",this.clickListener)},enable:function(){$(this._opener)&&Event.observe(this._opener,"click",this.clickListener)},hide:function(e){for(var t=Event.element(e);t.id!=this._id_datepicker&&t.id!=this._opener&&t.parentNode&&!this._ignoreElements.include(t.id);)t=t.parentNode;t.id==this._id_datepicker||t.id==this._opener||this._ignoreElements.include(t.id)||this.close(),Event.stop(e)},close:function(){$(this._opener)&&$(this._opener).removeClassName("selected"),$(this._relative)&&$(this._relative).removeClassName("selected"),document.stopObserving("click",this.blurListener);var e=$(this._parent);e.style.opacity=0,this._hideTimer=setTimeout(Element.hide.bind(null,e),300)},removeDate:function(){$(this._relative).setAttribute("date",""),$(this._relative).setAttribute("value",""),this._cellCallback&&this._cellCallback(),this.close()},setPosition:function(e,t){var i={top:"0px",left:"0px"};"undefined"!=typeof e&&(i.top=Number(e)+this._topOffset+"px"),"undefined"!=typeof t&&(i.left=Number(t)+this._leftOffset+"px"),$(this._id_datepicker).setStyle(i),this._isPositionned=!0},_leftpad_zero:function(e,t){for(var i="",r=0;r<t-String(e).length;r++)i+="0";return i+e},_getMonthDays:function(e,t){return 0!=e%4||0==e%100&&0!=e%400||1!=t?this._daysInMonth[t]:29},_buildCalendar:function(){var e=this,t=document.createElement("tbody"),i=document.createElement("tr");this._language_day.get(this._language).each(function(e){var t=document.createElement("td");t.innerHTML=e,t.className="wday",i.appendChild(t)}),t.appendChild(i);for(var r=[[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0],[0,0,0,0,0,0,0]],n=new Date(this._current_year,this._current_mon,1,12),a=n.getDay()?n.getDay()-1:6,s=this._getMonthDays(this._current_year,this._current_mon),o=1,_=a;7>_;_++)r[0][_]={d:o,m:this._current_mon,y:this._current_year,c:o==this._todayDate.getDate()&&this._current_mon==this._todayDate.getMonth()&&this._current_year==this._todayDate.getFullYear()?"today":o==this._saved_day&&this._current_mon==this._saved_mon&&this._current_year==this._saved_year?"selday":null},o++;for(var d=this._prevMonthYear(),l=this._getMonthDays(d[1],d[0]),_=0;a>_;_++)r[0][_]={d:Number(l-a+_+1),m:Number(d[0]),y:d[1],c:"outbound"};for(var h=!1,c=this._current_mon,u=this._current_year,p=1;6>p;p++)for(var _=0;7>_;_++)r[p][_]={d:o,m:c,y:u,c:h?"outbound":o==this._todayDate.getDate()&&this._current_mon==this._todayDate.getMonth()&&this._current_year==this._todayDate.getFullYear()?"today":o==this._saved_day&&this._current_mon==this._saved_mon&&this._current_year==this._saved_year?"selday":null},o++,o>s&&(o=1,h=!0,this._current_mon+1>11?(c=0,u+=1):c+=1);for(var p=0;6>p;p++){for(var m=document.createElement("tr"),_=0;7>_;_++){var v=r[p][_],b=document.createElement("td"),f=$A([this._relative,this._leftpad_zero(v.m+1,2),this._leftpad_zero(v.d,2),v.y]).join("-");b.setAttribute("id",f),v.c&&(b.className=v.c),b.onclick=function(){var t=String($(this).id).split("-");$(e._relative).setAttribute("date",t[1]+"/"+t[2]+"/"+t[3]),$(e._relative).value=Date.fromUTC(t[1]+"/"+t[2]+"/"+t[3]).toUIString(!0),e._cellCallback&&e._cellCallback(),e.close()},b.innerHTML=v.d,m.appendChild(b)}t.appendChild(m)}return t},_nextMonthYear:function(){var e=this._current_mon,t=this._current_year;return e+1>11?(e=0,t+=1):e+=1,[e,t]},nextMonth:function(){var e=this._nextMonthYear();this._current_mon=e[0],this._current_year=e[1],this._redrawCalendar()},_prevMonthYear:function(){var e=this._current_mon,t=this._current_year;return 0>e-1?(e=11,t-=1):e-=1,[e,t]},prevMonth:function(){var e=this._prevMonthYear();this._current_mon=e[0],this._current_year=e[1],this._redrawCalendar()},_redrawCalendar:function(){this._setLocaleHdr();var e=$(this._id_datepicker+"-table");try{for(;e.hasChildNodes();)e.removeChild(e.childNodes[0])}catch(t){}e.appendChild(this._buildCalendar())},_setLocaleHdr:function(){var e=this._nextMonthYear();$(this._id_datepicker_next).setAttribute("title",this.getMonthLocale(e[0])+" "+e[1]);var t=this._prevMonthYear();$(this._id_datepicker_prev).setAttribute("title",this.getMonthLocale(t[0])+" "+t[1]),$(this._id_datepicker_hdr).update("&nbsp;&nbsp;&nbsp;"+this.getMonthYearOrder(this.getMonthLocale(this._current_mon),this._current_year,"&nbsp;")+"&nbsp;&nbsp;&nbsp;")}};